import{r,j as e,c as fe,R as Se}from"./client-Dd90u0gX.js";const v="http://127.0.0.1:17600",De=4;function ce(n){const a=n.trim();return a?a.endsWith("/")?a.slice(0,-1):a:v}function ne(){try{return ce(window.localStorage.getItem("tws-web-api-base")??v)}catch{return v}}function k(n){const a=n/3600;return a>=10?`${Math.round(a)}h`:`${a.toFixed(1)}h`}function C(n){const a=Math.max(0,Math.round(n/60)),h=Math.floor(a/60),d=a%60;return h>0?`${h}h ${d}m`:`${d}m`}function ke(n){return new Date(`${n}T00:00:00`).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function Ce(n){const a=new Date(n);a.getHours()<De&&a.setDate(a.getDate()-1);const h=a.getFullYear(),d=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0");return`${h}-${d}-${l}`}function le(n){switch(n){case"replace":return"Replace";case"productive":return"Productive";case"allow":return"Allow";case"temptation":return"Temptation";default:return n}}function ie(n){if(!n)return 0;const a=Date.parse(n);return Number.isFinite(a)?a:0}async function u(n,a,h){const d=await fetch(`${n}${a}`,{...h,headers:{"Content-Type":"application/json",...h?.headers??{}}});if(!d.ok){const l=await d.json().catch(()=>null),w=l&&typeof l=="object"&&"error"in l&&typeof l.error=="string"?l.error:`Request failed (${d.status})`;throw new Error(w)}return d.json()}function Ae(n){const a=n.trim();return a?a.startsWith("http://")||a.startsWith("https://")?a:`https://${a}`:null}function A(n,a){return!Number.isFinite(a)||a<=0?0:Math.max(0,Math.min(100,Math.round(n/a*100)))}function $e(){const[n,a]=r.useState("home"),[h,d]=r.useState(ne),[l,w]=r.useState(ne),[g,$]=r.useState(!0),[oe,I]=r.useState(!1),[L,P]=r.useState(!1),[E,b]=r.useState(null),[de,ue]=r.useState(Date.now()),[M,he]=r.useState({balance:0}),[m,pe]=r.useState(null),[i,me]=r.useState(null),[N,xe]=r.useState([]),[j,R]=r.useState([]),[T,je]=r.useState([]),[B,F]=r.useState(null),[O,U]=r.useState(""),[H,W]=r.useState(""),[_,z]=r.useState(""),[J,Y]=r.useState("replace"),[q,K]=r.useState(!1),[Q,f]=r.useState(null),[G,S]=r.useState(""),[V,X]=r.useState(!1),[Z,ge]=r.useState(null),x=r.useCallback(async(s=!1)=>{s||$(!0),I(!0),b(null);try{await u(l,"/health");const[c,o,p,t,y,Ne,re]=await Promise.all([u(l,"/wallet"),u(l,"/activities/summary?windowHours=24"),u(l,"/analytics/overview?days=7"),u(l,"/analytics/time-of-day?days=7"),u(l,"/library"),u(l,"/integrations/reading?limit=8"),u(l,"/settings/daily-onboarding")]);he(c),pe(o),me(p),xe(t),R(y),je(Ne.items??[]),F(re),S(re.note?.message??""),P(!0)}catch(c){P(!1),b(c.message||"Failed to load homepage data.")}finally{$(!1),I(!1)}},[l]);r.useEffect(()=>{x()},[x]),r.useEffect(()=>{const s=window.setInterval(()=>ue(Date.now()),6e4);return()=>window.clearInterval(s)},[]),r.useEffect(()=>{const s=window.setInterval(()=>x(!0),45e3);return()=>window.clearInterval(s)},[x]),r.useEffect(()=>{try{window.localStorage.setItem("tws-web-api-base",l)}catch{}},[l]);const ee=r.useMemo(()=>m?.topContexts?.slice(0,6)??[],[m]),D=r.useMemo(()=>{const s=i?.categoryBreakdown;return s?s.productive+s.neutral+s.frivolity+s.draining+s.idle:0},[i]),se=r.useMemo(()=>N.length?[...N].sort((s,c)=>c.productive-s.productive)[0]??null:null,[N]),ae=r.useMemo(()=>{const s=j.filter(t=>t.kind==="url"&&!t.consumedAt).sort((t,y)=>ie(t.lastUsedAt??t.createdAt)-ie(y.lastUsedAt??y.createdAt)).slice(0,6).map(t=>({id:`library-${t.id}`,type:"library",title:t.title??t.domain,subtitle:t.note??t.url??t.domain,url:t.url,purpose:t.purpose,libraryId:t.id})),c=T.slice(0,6).map(t=>({id:`reading-${t.id}`,type:"reading",title:t.title,subtitle:t.subtitle??t.source.toUpperCase(),url:t.action.kind==="deeplink"?t.action.url:void 0,source:t.source,progress:t.progress})),o=[],p=Math.max(s.length,c.length);for(let t=0;t<p;t+=1)s[t]&&o.push(s[t]),c[t]&&o.push(c[t]);return o.slice(0,8)},[j,T]),be=()=>{w(ce(h))},ye=async s=>{s.preventDefault(),f(null);const c=Ae(O);if(!c){f("Enter a valid URL.");return}K(!0);try{await u(l,"/library",{method:"POST",body:JSON.stringify({kind:"url",url:c,title:H.trim()||void 0,note:_.trim()||void 0,purpose:J})}),U(""),W(""),z(""),Y("replace"),await x(!0),a("library")}catch(o){f(o.message||"Unable to save.")}finally{K(!1)}},ve=async s=>{if(!(!s.id||s.consumedAt))try{const c=await u(l,`/library/${s.id}`,{method:"PATCH",body:JSON.stringify({consumedAt:new Date().toISOString()})});R(o=>o.map(p=>p.id===c.id?c:p))}catch(c){b(c.message||"Unable to mark item complete.")}},we=async s=>{s.preventDefault(),X(!0);try{const c=Ce(new Date),o=G.trim(),p=await u(l,"/settings/daily-onboarding",{method:"POST",body:JSON.stringify({lastPromptedDay:c,note:o?{day:c,message:o,deliveredAt:null,acknowledged:!1}:null})});F(p),S(p.note?.message??""),ge(Date.now())}catch(c){b(c.message||"Unable to save note.")}finally{X(!1)}},te=B?.note?.day?ke(B.note.day):null;return e.jsxs("div",{className:"app-shell web-home-shell",children:[e.jsxs("div",{className:"window-chrome",children:[e.jsxs("div",{className:"window-chrome-title","aria-hidden":!0,children:[e.jsx("div",{className:"title-dot"}),e.jsx("span",{children:"TimeWellSpent Web Home"})]}),e.jsxs("div",{className:"window-chrome-meta",children:[e.jsx("span",{className:`pill ${L?"success":"danger"}`,children:L?"API connected":"API offline"}),e.jsxs("span",{className:"pill ghost big",children:[M.balance," f-coins"]})]})]}),e.jsxs("aside",{className:"sidebar",children:[e.jsxs("div",{className:"brand",children:[e.jsx("div",{className:"logo",children:"â³"}),e.jsx("span",{children:"Homepage"})]}),e.jsxs("nav",{className:"nav-menu",children:[e.jsx("button",{className:n==="home"?"active":"",onClick:()=>a("home"),children:"Home"}),e.jsx("button",{className:n==="library"?"active":"",onClick:()=>a("library"),children:"Library"}),e.jsx("button",{className:n==="capture"?"active":"",onClick:()=>a("capture"),children:"Capture"})]}),e.jsxs("div",{className:"wallet-summary",children:[e.jsxs("div",{className:"balance",children:[e.jsx("span",{className:"coin",children:"ðŸª™"}),e.jsx("span",{className:"amount",children:M.balance})]}),e.jsx("div",{className:"rate",children:i?`${i.productivityScore} focus score`:"Focus score unavailable"})]}),e.jsxs("div",{className:"web-api-config",children:[e.jsx("label",{htmlFor:"api-base",children:"Local API"}),e.jsx("input",{id:"api-base",value:h,onChange:s=>d(s.target.value),placeholder:v}),e.jsx("button",{className:"primary",type:"button",onClick:be,children:"Connect"})]})]}),e.jsx("main",{className:"content web-home-main",children:e.jsxs("section",{className:"panel",children:[e.jsxs("header",{className:"panel-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Safe Landing"}),e.jsx("p",{className:"subtle",children:"Orient, choose your next move, and keep the day intentional."})]}),e.jsxs("div",{className:"web-header-actions",children:[e.jsx("span",{className:"pill ghost",children:new Date(de).toLocaleString([],{dateStyle:"medium",timeStyle:"short"})}),e.jsx("button",{type:"button",onClick:()=>x(),children:oe?"Refreshing...":"Refresh"})]})]}),E&&e.jsx("div",{className:"card web-inline-error",children:E}),g?e.jsx("div",{className:"card",children:"Loading homepage..."}):null,!g&&n==="home"&&e.jsxs("div",{className:"panel-body web-home-grid",children:[e.jsxs("article",{className:"card",children:[e.jsxs("div",{className:"card-header-row",children:[e.jsx("h2",{children:"Today Compass"}),e.jsx("span",{className:"pill ghost",children:i?`${i.periodDays}d lens`:"Local view"})]}),e.jsxs("div",{className:"web-stat-grid",children:[e.jsxs("div",{className:"web-stat",children:[e.jsx("span",{className:"subtle",children:"Active"}),e.jsx("strong",{children:m?C(m.totalSeconds):"0m"})]}),e.jsxs("div",{className:"web-stat",children:[e.jsx("span",{className:"subtle",children:"Deep Work"}),e.jsx("strong",{children:m?C(m.deepWorkSeconds):"0m"})]}),e.jsxs("div",{className:"web-stat",children:[e.jsx("span",{className:"subtle",children:"Focus Score"}),e.jsx("strong",{children:i?i.productivityScore:0})]}),e.jsxs("div",{className:"web-stat",children:[e.jsx("span",{className:"subtle",children:"Sessions"}),e.jsx("strong",{children:i?i.totalSessions:0})]})]}),e.jsxs("div",{className:"web-pill-row",children:[e.jsxs("span",{className:"pill success",children:["Peak ",i?`${i.peakProductiveHour}:00`:"--"]}),e.jsxs("span",{className:"pill warning",children:["Risk ",i?`${i.riskHour}:00`:"--"]}),e.jsx("span",{className:"pill ghost",children:se?`Best block ${se.hour}:00`:"No block yet"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Attention Mix"}),e.jsxs("div",{className:"web-category-list",children:[e.jsxs("div",{className:"web-category-row",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Productive"}),e.jsx("strong",{children:k(i?.categoryBreakdown.productive??0)})]}),e.jsx("div",{className:"web-category-bar",children:e.jsx("span",{style:{width:`${A(i?.categoryBreakdown.productive??0,D)}%`}})})]}),e.jsxs("div",{className:"web-category-row",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Neutral"}),e.jsx("strong",{children:k(i?.categoryBreakdown.neutral??0)})]}),e.jsx("div",{className:"web-category-bar neutral",children:e.jsx("span",{style:{width:`${A(i?.categoryBreakdown.neutral??0,D)}%`}})})]}),e.jsxs("div",{className:"web-category-row",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Frivolity"}),e.jsx("strong",{children:k(i?.categoryBreakdown.frivolity??0)})]}),e.jsx("div",{className:"web-category-bar frivolity",children:e.jsx("span",{style:{width:`${A(i?.categoryBreakdown.frivolity??0,D)}%`}})})]})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Top Contexts"}),ee.length?e.jsx("ul",{className:"web-list",children:ee.map(s=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.label}),e.jsx("span",{className:"subtle",children:s.category??"uncategorized"})]}),e.jsx("span",{children:C(s.seconds)})]},`${s.label}-${s.seconds}`))}):e.jsx("p",{className:"subtle",children:"No context data yet."})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Refresh Shelf"}),ae.length?e.jsx("ul",{className:"web-list",children:ae.map(s=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.title}),e.jsx("span",{className:"subtle",children:s.subtitle})]}),e.jsxs("div",{className:"web-item-actions",children:[s.type==="library"?e.jsx("span",{className:"pill ghost",children:le(s.purpose)}):null,s.type==="reading"&&typeof s.progress=="number"?e.jsxs("span",{className:"pill ghost",children:[Math.round(s.progress*100),"%"]}):null,s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",children:"Open"}):e.jsx("span",{className:"subtle",children:"Desktop only"})]})]},s.id))}):e.jsx("p",{className:"subtle",children:"No items in your shelf yet."})]}),e.jsxs("article",{className:"card web-full-width",children:[e.jsx("h2",{children:"Current Insight Feed"}),i?.insights?.length?e.jsx("ul",{className:"web-insight-list",children:i.insights.map(s=>e.jsx("li",{children:s},s))}):e.jsx("p",{className:"subtle",children:"Insights will appear once enough activity is collected."})]})]}),!g&&n==="library"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header-row",children:[e.jsx("h2",{children:"Library"}),e.jsxs("span",{className:"pill ghost",children:[j.length," items"]})]}),j.length?e.jsx("ul",{className:"web-list",children:j.slice(0,40).map(s=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.title??s.domain}),e.jsxs("span",{className:"subtle",children:[le(s.purpose),s.consumedAt?` â€¢ done ${new Date(s.consumedAt).toLocaleDateString()}`:""]})]}),e.jsxs("div",{className:"web-item-actions",children:[s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",children:"Open"}):null,s.consumedAt?null:e.jsx("button",{type:"button",onClick:()=>ve(s),children:"Done"})]})]},s.id))}):e.jsx("p",{className:"subtle",children:"Your library is empty. Capture a few URLs to start."})]}),!g&&n==="capture"&&e.jsxs("div",{className:"web-capture-grid",children:[e.jsxs("form",{className:"card",onSubmit:ye,children:[e.jsx("h2",{children:"Quick Capture"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"capture-url",children:"URL"}),e.jsx("input",{id:"capture-url",value:O,onChange:s=>U(s.target.value),placeholder:"https://..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"capture-title",children:"Title (optional)"}),e.jsx("input",{id:"capture-title",value:H,onChange:s=>W(s.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"capture-purpose",children:"Purpose"}),e.jsxs("select",{id:"capture-purpose",value:J,onChange:s=>Y(s.target.value),children:[e.jsx("option",{value:"replace",children:"Replace"}),e.jsx("option",{value:"productive",children:"Productive"}),e.jsx("option",{value:"allow",children:"Allow"}),e.jsx("option",{value:"temptation",children:"Temptation"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"capture-note",children:"Note (optional)"}),e.jsx("textarea",{id:"capture-note",rows:4,value:_,onChange:s=>z(s.target.value)})]}),Q?e.jsx("p",{className:"subtle",children:Q}):null,e.jsx("div",{className:"form-actions",children:e.jsx("button",{className:"primary",type:"submit",disabled:q,children:q?"Saving...":"Save to Library"})})]}),e.jsxs("form",{className:"card",onSubmit:we,children:[e.jsx("h2",{children:"Daily Orientation Note"}),e.jsx("p",{className:"subtle",children:te?`Current note for ${te}.`:"Set the note you want to see later today."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"daily-note",children:"Note"}),e.jsx("textarea",{id:"daily-note",rows:8,value:G,onChange:s=>S(s.target.value)})]}),e.jsxs("div",{className:"form-actions",children:[Z?e.jsxs("span",{className:"pill success",children:["Saved ",new Date(Z).toLocaleTimeString()]}):null,e.jsx("button",{className:"primary",type:"submit",disabled:V,children:V?"Saving...":"Save Note"})]})]})]})]})})]})}fe.createRoot(document.getElementById("root")).render(e.jsx(Se.StrictMode,{children:e.jsx($e,{})}));
//# sourceMappingURL=home-B8SZfpf9.js.map
