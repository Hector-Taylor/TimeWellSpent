import{r as a,j as e,c as Ne,R as Se}from"./client-Dd90u0gX.js";const y="http://127.0.0.1:17600",De=4;function ce(n){const t=n.trim();return t?t.endsWith("/")?t.slice(0,-1):t:y}function ne(){try{return ce(window.localStorage.getItem("tws-web-api-base")??y)}catch{return y}}function k(n){const t=n/3600;return t>=10?`${Math.round(t)}h`:`${t.toFixed(1)}h`}function C(n){const t=Math.max(0,Math.round(n/60)),h=Math.floor(t/60),d=t%60;return h>0?`${h}h ${d}m`:`${d}m`}function ke(n){return new Date(`${n}T00:00:00`).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}function Ce(n){const t=new Date(n);t.getHours()<De&&t.setDate(t.getDate()-1);const h=t.getFullYear(),d=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${h}-${d}-${l}`}function le(n){switch(n){case"replace":return"Replace";case"productive":return"Productive";case"allow":return"Allow";case"temptation":return"Temptation";default:return n}}function ie(n){if(!n)return 0;const t=Date.parse(n);return Number.isFinite(t)?t:0}async function u(n,t,h){const d=await fetch(`${n}${t}`,{...h,cache:"no-store",headers:{"Content-Type":"application/json",...h?.headers??{}}});if(!d.ok){const l=await d.json().catch(()=>null),w=l&&typeof l=="object"&&"error"in l&&typeof l.error=="string"?l.error:`Request failed (${d.status})`;throw new Error(w)}return d.json()}function Ae(n){const t=n.trim();return t?t.startsWith("http://")||t.startsWith("https://")?t:`https://${t}`:null}function A(n,t){return!Number.isFinite(t)||t<=0?0:Math.max(0,Math.min(100,Math.round(n/t*100)))}function $e(){const[n,t]=a.useState("home"),[h,d]=a.useState(ne),[l,w]=a.useState(ne),[g,$]=a.useState(!0),[oe,I]=a.useState(!1),[L,E]=a.useState(!1),[P,v]=a.useState(null),[de,ue]=a.useState(Date.now()),[M,he]=a.useState({balance:0}),[x,pe]=a.useState(null),[i,me]=a.useState(null),[f,xe]=a.useState([]),[j,R]=a.useState([]),[T,je]=a.useState([]),[B,F]=a.useState(null),[O,U]=a.useState(""),[H,W]=a.useState(""),[_,z]=a.useState(""),[J,Y]=a.useState("replace"),[q,K]=a.useState(!1),[Q,N]=a.useState(null),[V,S]=a.useState(""),[G,X]=a.useState(!1),[Z,ge]=a.useState(null),m=a.useCallback(async(s=!1)=>{s||$(!0),I(!0),v(null);try{await u(l,"/health");const[c,o,p,r,b,fe,re]=await Promise.all([u(l,"/wallet"),u(l,"/activities/summary?windowHours=24"),u(l,"/analytics/overview?days=7"),u(l,"/analytics/time-of-day?days=7"),u(l,"/library"),u(l,"/integrations/reading?limit=8"),u(l,"/settings/daily-onboarding")]);he(c),pe(o),me(p),xe(r),R(b),je(fe.items??[]),F(re),S(re.note?.message??""),E(!0)}catch(c){E(!1),v(c.message||"Failed to load homepage data.")}finally{$(!1),I(!1)}},[l]);a.useEffect(()=>{m()},[m]),a.useEffect(()=>{const s=window.setInterval(()=>ue(Date.now()),6e4);return()=>window.clearInterval(s)},[]),a.useEffect(()=>{const s=window.setInterval(()=>m(!0),45e3);return()=>window.clearInterval(s)},[m]),a.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&m(!0)};return window.addEventListener("focus",s),document.addEventListener("visibilitychange",s),()=>{window.removeEventListener("focus",s),document.removeEventListener("visibilitychange",s)}},[m]),a.useEffect(()=>{try{window.localStorage.setItem("tws-web-api-base",l)}catch{}},[l]);const ee=a.useMemo(()=>x?.topContexts?.slice(0,6)??[],[x]),D=a.useMemo(()=>{const s=i?.categoryBreakdown;return s?s.productive+s.neutral+s.frivolity+s.draining+s.idle:0},[i]),se=a.useMemo(()=>f.length?[...f].sort((s,c)=>c.productive-s.productive)[0]??null:null,[f]),te=a.useMemo(()=>{const s=j.filter(r=>r.kind==="url"&&!r.consumedAt).sort((r,b)=>ie(r.lastUsedAt??r.createdAt)-ie(b.lastUsedAt??b.createdAt)).slice(0,6).map(r=>({id:`library-${r.id}`,type:"library",title:r.title??r.domain,subtitle:r.note??r.url??r.domain,url:r.url,purpose:r.purpose,libraryId:r.id})),c=T.slice(0,6).map(r=>({id:`reading-${r.id}`,type:"reading",title:r.title,subtitle:r.subtitle??r.source.toUpperCase(),url:r.action.kind==="deeplink"?r.action.url:void 0,source:r.source,progress:r.progress})),o=[],p=Math.max(s.length,c.length);for(let r=0;r<p;r+=1)s[r]&&o.push(s[r]),c[r]&&o.push(c[r]);return o.slice(0,8)},[j,T]),ve=()=>{w(ce(h))},be=async s=>{s.preventDefault(),N(null);const c=Ae(O);if(!c){N("Enter a valid URL.");return}K(!0);try{await u(l,"/library",{method:"POST",body:JSON.stringify({kind:"url",url:c,title:H.trim()||void 0,note:_.trim()||void 0,purpose:J})}),U(""),W(""),z(""),Y("replace"),await m(!0),t("library")}catch(o){N(o.message||"Unable to save.")}finally{K(!1)}},ye=async s=>{if(!(!s.id||s.consumedAt))try{const c=await u(l,`/library/${s.id}`,{method:"PATCH",body:JSON.stringify({consumedAt:new Date().toISOString()})});R(o=>o.map(p=>p.id===c.id?c:p))}catch(c){v(c.message||"Unable to mark item complete.")}},we=async s=>{s.preventDefault(),X(!0);try{const c=Ce(new Date),o=V.trim(),p=await u(l,"/settings/daily-onboarding",{method:"POST",body:JSON.stringify({lastPromptedDay:c,note:o?{day:c,message:o,deliveredAt:null,acknowledged:!1}:null})});F(p),S(p.note?.message??""),ge(Date.now())}catch(c){v(c.message||"Unable to save note.")}finally{X(!1)}},ae=B?.note?.day?ke(B.note.day):null;return e.jsxs("div",{className:"app-shell web-home-shell",children:[e.jsxs("div",{className:"window-chrome",children:[e.jsxs("div",{className:"window-chrome-title","aria-hidden":!0,children:[e.jsx("div",{className:"title-dot"}),e.jsx("span",{children:"TimeWellSpent Web Home"})]}),e.jsxs("div",{className:"window-chrome-meta",children:[e.jsx("span",{className:`pill ${L?"success":"danger"}`,children:L?"API connected":"API offline"}),e.jsxs("span",{className:"pill ghost big",children:[M.balance," f-coins"]})]})]}),e.jsxs("aside",{className:"sidebar",children:[e.jsxs("div",{className:"brand",children:[e.jsx("div",{className:"logo",children:"â³"}),e.jsx("span",{children:"Homepage"})]}),e.jsxs("nav",{className:"nav-menu",children:[e.jsx("button",{className:n==="home"?"active":"",onClick:()=>t("home"),children:"Home"}),e.jsx("button",{className:n==="library"?"active":"",onClick:()=>t("library"),children:"Library"}),e.jsx("button",{className:n==="capture"?"active":"",onClick:()=>t("capture"),children:"Capture"})]}),e.jsxs("div",{className:"wallet-summary",children:[e.jsxs("div",{className:"balance",children:[e.jsx("span",{className:"coin",children:"ðŸª™"}),e.jsx("span",{className:"amount",children:M.balance})]}),e.jsx("div",{className:"rate",children:i?`${i.productivityScore} focus score`:"Focus score unavailable"})]}),e.jsxs("div",{className:"web-api-config",children:[e.jsx("label",{htmlFor:"api-base",children:"Local API"}),e.jsx("input",{id:"api-base",value:h,onChange:s=>d(s.target.value),placeholder:y}),e.jsx("button",{className:"primary",type:"button",onClick:ve,children:"Connect"})]})]}),e.jsx("main",{className:"content web-home-main",children:e.jsxs("section",{className:"panel",children:[e.jsxs("header",{className:"panel-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Safe Landing"}),e.jsx("p",{className:"subtle",children:"Orient, choose your next move, and keep the day intentional."})]}),e.jsxs("div",{className:"web-header-actions",children:[e.jsx("span",{className:"pill ghost",children:new Date(de).toLocaleString([],{dateStyle:"medium",timeStyle:"short"})}),e.jsx("button",{type:"button",onClick:()=>m(),children:oe?"Refreshing...":"Refresh"})]})]}),P&&e.jsx("div",{className:"card web-inline-error",children:P}),g?e.jsx("div",{className:"card",children:"Loading homepage..."}):null,!g&&n==="home"&&e.jsxs("div",{className:"panel-body web-home-grid",children:[e.jsxs("article",{className:"card",children:[e.jsxs("div",{className:"card-header-row",children:[e.jsx("h2",{children:"Today Compass"}),e.jsx("span",{className:"pill ghost",children:i?`${i.periodDays}d lens`:"Local view"})]}),e.jsxs("div",{className:"web-stat-grid",children:[e.jsxs("div",{className:"web-stat",children:[e.jsx("span",{className:"subtle",children:"Active"}),e.jsx("strong",{children:x?C(x.totalSeconds):"0m"})]}),e.jsxs("div",{className:"web-stat",children:[e.jsx("span",{className:"subtle",children:"Deep Work"}),e.jsx("strong",{children:x?C(x.deepWorkSeconds):"0m"})]}),e.jsxs("div",{className:"web-stat",children:[e.jsx("span",{className:"subtle",children:"Focus Score"}),e.jsx("strong",{children:i?i.productivityScore:0})]}),e.jsxs("div",{className:"web-stat",children:[e.jsx("span",{className:"subtle",children:"Sessions"}),e.jsx("strong",{children:i?i.totalSessions:0})]})]}),e.jsxs("div",{className:"web-pill-row",children:[e.jsxs("span",{className:"pill success",children:["Peak ",i?`${i.peakProductiveHour}:00`:"--"]}),e.jsxs("span",{className:"pill warning",children:["Risk ",i?`${i.riskHour}:00`:"--"]}),e.jsx("span",{className:"pill ghost",children:se?`Best block ${se.hour}:00`:"No block yet"})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Attention Mix"}),e.jsxs("div",{className:"web-category-list",children:[e.jsxs("div",{className:"web-category-row",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Productive"}),e.jsx("strong",{children:k(i?.categoryBreakdown.productive??0)})]}),e.jsx("div",{className:"web-category-bar",children:e.jsx("span",{style:{width:`${A(i?.categoryBreakdown.productive??0,D)}%`}})})]}),e.jsxs("div",{className:"web-category-row",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Neutral"}),e.jsx("strong",{children:k(i?.categoryBreakdown.neutral??0)})]}),e.jsx("div",{className:"web-category-bar neutral",children:e.jsx("span",{style:{width:`${A(i?.categoryBreakdown.neutral??0,D)}%`}})})]}),e.jsxs("div",{className:"web-category-row",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Frivolity"}),e.jsx("strong",{children:k(i?.categoryBreakdown.frivolity??0)})]}),e.jsx("div",{className:"web-category-bar frivolity",children:e.jsx("span",{style:{width:`${A(i?.categoryBreakdown.frivolity??0,D)}%`}})})]})]})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Top Contexts"}),ee.length?e.jsx("ul",{className:"web-list",children:ee.map(s=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.label}),e.jsx("span",{className:"subtle",children:s.category??"uncategorized"})]}),e.jsx("span",{children:C(s.seconds)})]},`${s.label}-${s.seconds}`))}):e.jsx("p",{className:"subtle",children:"No context data yet."})]}),e.jsxs("article",{className:"card",children:[e.jsx("h2",{children:"Refresh Shelf"}),te.length?e.jsx("ul",{className:"web-list",children:te.map(s=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.title}),e.jsx("span",{className:"subtle",children:s.subtitle})]}),e.jsxs("div",{className:"web-item-actions",children:[s.type==="library"?e.jsx("span",{className:"pill ghost",children:le(s.purpose)}):null,s.type==="reading"&&typeof s.progress=="number"?e.jsxs("span",{className:"pill ghost",children:[Math.round(s.progress*100),"%"]}):null,s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",children:"Open"}):e.jsx("span",{className:"subtle",children:"Desktop only"})]})]},s.id))}):e.jsx("p",{className:"subtle",children:"No items in your shelf yet."})]}),e.jsxs("article",{className:"card web-full-width",children:[e.jsx("h2",{children:"Current Insight Feed"}),i?.insights?.length?e.jsx("ul",{className:"web-insight-list",children:i.insights.map(s=>e.jsx("li",{children:s},s))}):e.jsx("p",{className:"subtle",children:"Insights will appear once enough activity is collected."})]})]}),!g&&n==="library"&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header-row",children:[e.jsx("h2",{children:"Library"}),e.jsxs("span",{className:"pill ghost",children:[j.length," items"]})]}),j.length?e.jsx("ul",{className:"web-list",children:j.slice(0,40).map(s=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.title??s.domain}),e.jsxs("span",{className:"subtle",children:[le(s.purpose),s.consumedAt?` â€¢ done ${new Date(s.consumedAt).toLocaleDateString()}`:""]})]}),e.jsxs("div",{className:"web-item-actions",children:[s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",children:"Open"}):null,s.consumedAt?null:e.jsx("button",{type:"button",onClick:()=>ye(s),children:"Done"})]})]},s.id))}):e.jsx("p",{className:"subtle",children:"Your library is empty. Capture a few URLs to start."})]}),!g&&n==="capture"&&e.jsxs("div",{className:"web-capture-grid",children:[e.jsxs("form",{className:"card",onSubmit:be,children:[e.jsx("h2",{children:"Quick Capture"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"capture-url",children:"URL"}),e.jsx("input",{id:"capture-url",value:O,onChange:s=>U(s.target.value),placeholder:"https://..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"capture-title",children:"Title (optional)"}),e.jsx("input",{id:"capture-title",value:H,onChange:s=>W(s.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"capture-purpose",children:"Purpose"}),e.jsxs("select",{id:"capture-purpose",value:J,onChange:s=>Y(s.target.value),children:[e.jsx("option",{value:"replace",children:"Replace"}),e.jsx("option",{value:"productive",children:"Productive"}),e.jsx("option",{value:"allow",children:"Allow"}),e.jsx("option",{value:"temptation",children:"Temptation"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"capture-note",children:"Note (optional)"}),e.jsx("textarea",{id:"capture-note",rows:4,value:_,onChange:s=>z(s.target.value)})]}),Q?e.jsx("p",{className:"subtle",children:Q}):null,e.jsx("div",{className:"form-actions",children:e.jsx("button",{className:"primary",type:"submit",disabled:q,children:q?"Saving...":"Save to Library"})})]}),e.jsxs("form",{className:"card",onSubmit:we,children:[e.jsx("h2",{children:"Daily Orientation Note"}),e.jsx("p",{className:"subtle",children:ae?`Current note for ${ae}.`:"Set the note you want to see later today."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"daily-note",children:"Note"}),e.jsx("textarea",{id:"daily-note",rows:8,value:V,onChange:s=>S(s.target.value)})]}),e.jsxs("div",{className:"form-actions",children:[Z?e.jsxs("span",{className:"pill success",children:["Saved ",new Date(Z).toLocaleTimeString()]}):null,e.jsx("button",{className:"primary",type:"submit",disabled:G,children:G?"Saving...":"Save Note"})]})]})]})]})})]})}Ne.createRoot(document.getElementById("root")).render(e.jsx(Se.StrictMode,{children:e.jsx($e,{})}));
//# sourceMappingURL=home-gTKEqhvj.js.map
