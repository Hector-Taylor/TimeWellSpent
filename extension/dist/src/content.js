import{r as f,j as e,c as P}from"../assets/client.js";function z({domain:s,status:n,reason:l,onClose:a}){const[o,c]=f.useState(15),[i,d]=f.useState(!1),u=n.rate?.ratePerMin??n.session?.ratePerMin??1,r=f.useMemo(()=>[...n.rate?.packs??[]].sort((t,x)=>t.minutes-x.minutes),[n.rate?.packs]),p=f.useMemo(()=>r.length?{min:r[0].minutes,max:r[r.length-1].minutes,step:1}:{min:5,max:120,step:5},[r]);f.useEffect(()=>{r.length?c(r[0].minutes):c(15)},[s,r]);const b=t=>r.length?r.reduce((x,g)=>{const M=Math.abs(g.minutes-t),S=Math.abs(x-t);return M<S?g.minutes:x},r[0].minutes):t,h=r.find(t=>t.minutes===o),m=h?h.price:Math.max(1,Math.round(o*u)),w=n.balance>=m,v=async()=>{if(!i){d(!0);try{const t=await chrome.runtime.sendMessage({type:"BUY_PACK",payload:{domain:s,minutes:o}});t.success?(y(),a()):alert(`Failed to purchase: ${t.error}`)}catch(t){console.error(t),alert("Failed to communicate with extension")}finally{d(!1)}}},j=async()=>{if(!i){d(!0);try{const t=await chrome.runtime.sendMessage({type:"START_METERED",payload:{domain:s}});t.success?(y(),a()):alert(`Failed to start metered session: ${t.error}`)}catch(t){console.error(t),alert("Failed to communicate with extension")}finally{d(!1)}}},k=n.session?n.session.mode==="pack"?"Session paused":"Metered session paused":"Unlock this site",N=n.session?n.session.mode==="pack"?`${Math.round(n.session.remainingSeconds/60)} minutes remaining`:"Metered: paying as you scroll":l==="insufficient-funds"?"Top up to keep browsing":"Pay with f-coins to continue";return e.jsx("div",{className:"tws-paywall-overlay",children:e.jsxs("div",{className:"tws-paywall-modal",children:[e.jsxs("header",{className:"tws-paywall-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),e.jsx("h2",{children:k}),e.jsx("p",{className:"tws-subtle",children:N})]}),e.jsxs("div",{className:"tws-wallet-badge",children:[e.jsx("span",{children:"Balance"}),e.jsxs("strong",{children:[n.balance," coins"]})]})]}),e.jsxs("div",{className:"tws-paywall-body",children:[e.jsxs("section",{className:"tws-paywall-option",children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:"Pay As You Go"}),e.jsx("p",{className:"tws-subtle",children:"Pay only for the time you spend."})]}),e.jsxs("div",{className:"tws-option-action",children:[e.jsxs("div",{className:"tws-price-tag",children:[e.jsx("strong",{children:E(u)}),e.jsx("small",{children:"coins / min"})]}),e.jsx("button",{className:"tws-secondary",onClick:j,disabled:n.balance<1||i,children:"Start Metered"})]})]}),e.jsx("div",{className:"tws-divider",children:e.jsx("span",{children:"OR"})}),e.jsxs("section",{className:"tws-paywall-option",children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:"Pre-pay Session"}),e.jsx("p",{className:"tws-subtle",children:"Commit to a fixed time."})]}),e.jsxs("div",{className:"tws-slider-container",children:[e.jsxs("div",{className:"tws-slider-labels",children:[e.jsxs("span",{children:[o," minutes"]}),e.jsxs("span",{className:"tws-subtle-info",children:[Math.round(o/960*100),"% of your day"]}),e.jsxs("strong",{children:[m," coins"]})]}),e.jsx("input",{type:"range",min:p.min,max:p.max,step:p.step,value:o,onChange:t=>c(b(Number(t.target.value)))}),e.jsxs("div",{className:"tws-slider-scale",children:[e.jsxs("small",{children:[p.min,"m"]}),e.jsxs("small",{children:[p.max,"m"]})]})]}),e.jsxs("div",{className:"tws-option-action",children:[e.jsxs("button",{className:"tws-primary",onClick:v,disabled:!w||i,children:["Unlock for ",m," coins"]}),!w&&e.jsxs("p",{className:"tws-error-text",children:["Need ",m-n.balance," more coins"]})]})]})]})]})})}function E(s){return Number.isInteger(s)?s.toString():s.toFixed(2).replace(/\.?0+$/,"")}function y(){const s=document.getElementById("tws-block-overlay");s&&s.remove(),document.body.style.overflow=""}const C=':root{--bg: #05070f;--fg: #f9fbff;--fg-muted: #96a9d1;--accent: #89f3d2;--accent-soft: rgba(137, 243, 210, .2);--danger: #ff8c8c}.tws-paywall-overlay{position:fixed;inset:0;background:radial-gradient(circle at 20% 20%,rgba(44,125,255,.18),transparent 28%),#050710f2;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:center;z-index:2147483647;font-family:Space Grotesk,Inter,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;color:var(--fg)}.tws-paywall-modal{width:min(500px,92vw);padding:32px;border-radius:24px;background:linear-gradient(140deg,#0c1222fa,#0c1222f2);box-shadow:0 30px 80px #00000073,inset 0 0 0 1px #ffffff14;display:flex;flex-direction:column;gap:24px}.tws-paywall-header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px}.tws-eyebrow{letter-spacing:.12em;text-transform:uppercase;color:var(--fg-muted);font-size:12px;margin:0 0 6px;font-weight:600}.tws-subtle{color:var(--fg-muted);margin:4px 0;font-size:14px;line-height:1.4}.tws-wallet-badge{display:flex;flex-direction:column;align-items:flex-end;background:#7cf4d41a;padding:8px 12px;border-radius:12px;border:1px solid rgba(124,244,212,.2)}.tws-wallet-badge span{font-size:11px;color:var(--fg-muted);text-transform:uppercase;letter-spacing:.05em}.tws-wallet-badge strong{color:var(--accent);font-size:16px}.tws-paywall-body{display:flex;flex-direction:column;gap:24px}.tws-paywall-option{background:#ffffff08;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:20px;transition:transform .2s ease,border-color .2s ease}.tws-paywall-option:hover{border-color:#ffffff1f;transform:translateY(-2px)}.tws-option-header{margin-bottom:16px}.tws-option-header h3{margin:0 0 4px;font-size:18px;font-weight:600}.tws-option-action{display:flex;align-items:center;justify-content:space-between;gap:16px}.tws-price-tag{display:flex;flex-direction:column}.tws-price-tag strong{font-size:24px;color:var(--accent);line-height:1}.tws-price-tag small{color:var(--fg-muted);font-size:12px}.tws-divider{display:flex;align-items:center;justify-content:center;position:relative;height:20px}.tws-divider:before{content:"";position:absolute;left:0;right:0;height:1px;background:#ffffff1a}.tws-divider span{background:#0e1324;padding:0 12px;color:var(--fg-muted);font-size:12px;font-weight:600;z-index:1;text-transform:uppercase}.tws-slider-container{margin-bottom:16px}.tws-slider-labels{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;font-size:14px}.tws-subtle-info{color:var(--fg-muted);font-size:12px;font-weight:500}.tws-slider-labels strong{color:var(--accent)}input[type=range]{width:100%;height:6px;background:#ffffff1a;border-radius:3px;outline:none;-webkit-appearance:none;appearance:none}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 0 10px #89f3d266;transition:transform .1s}input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.1)}.tws-slider-scale{display:flex;justify-content:space-between;margin-top:8px;color:var(--fg-muted);font-size:11px}button{padding:12px 20px;border-radius:12px;border:none;font-weight:600;cursor:pointer;font-size:14px;transition:all .2s;white-space:nowrap}.tws-primary{background:var(--accent);color:#05070f;width:100%}.tws-primary:hover:not(:disabled){background:#70e6c0;transform:translateY(-1px)}.tws-secondary{background:#ffffff1a;color:var(--fg)}.tws-secondary:hover:not(:disabled){background:#ffffff26}button:disabled{opacity:.5;cursor:not-allowed;transform:none}.tws-error-text{color:var(--danger);font-size:12px;margin-top:8px;text-align:center}';console.info("TimeWellSpent content script booted");chrome.runtime.onMessage.addListener((s,n,l)=>{if(s.type==="TWS_PING"){l?.({ok:!0});return}return s.type==="BLOCK_SCREEN"&&T(s.payload.domain,s.payload.reason),!0});async function T(s,n){const l=document.getElementById("tws-shadow-host");l&&l.remove();const a=document.createElement("div");a.id="tws-shadow-host",a.style.position="fixed",a.style.zIndex="2147483647",a.style.top="0",a.style.left="0",a.style.width="0",a.style.height="0",document.body.appendChild(a);const o=a.attachShadow({mode:"open"}),c=document.createElement("style");c.textContent=C,o.appendChild(c);const i=document.createElement("div");i.id="tws-mount-point",o.appendChild(i),document.body.style.overflow="hidden";const d=await chrome.runtime.sendMessage({type:"GET_STATUS",payload:{domain:s}});P.createRoot(i).render(e.jsx(z,{domain:s,status:d,reason:n,onClose:()=>{a.remove(),document.body.style.overflow=""}}))}
