import{r as d,j as e,c as B}from"../assets/client.js";function R({domain:s,status:n,reason:p,onClose:r}){const[i,f]=d.useState(15),[o,c]=d.useState(!1),[w,y]=d.useState(!1),[x,S]=d.useState(""),[b,l]=d.useState(null),v=n.rate?.ratePerMin??n.session?.ratePerMin??1,a=d.useMemo(()=>[...n.rate?.packs??[]].sort((t,h)=>t.minutes-h.minutes),[n.rate?.packs]),m=d.useMemo(()=>a.length?{min:a[0].minutes,max:a[a.length-1].minutes,step:1}:{min:5,max:120,step:5},[a]);d.useEffect(()=>{a.length?f(a[0].minutes):f(15)},[s,a]);const M=t=>a.length?a.reduce((h,N)=>{const F=Math.abs(N.minutes-t),T=Math.abs(h-t);return F<T?N.minutes:h},a[0].minutes):t,j=a.find(t=>t.minutes===i),u=j?j.price:Math.max(1,Math.round(i*v)),k=n.balance>=u,E=async()=>{if(!o){c(!0),l(null);try{const t=await chrome.runtime.sendMessage({type:"BUY_PACK",payload:{domain:s,minutes:i}});t.success?(g(),r()):l(`Failed to purchase: ${t.error}`)}catch(t){console.error(t),l("Failed to communicate with extension")}finally{c(!1)}}},z=async()=>{if(!o){c(!0),l(null);try{const t=await chrome.runtime.sendMessage({type:"START_METERED",payload:{domain:s}});t.success?(g(),r()):l(`Failed to start metered session: ${t.error}`)}catch(t){console.error(t),l("Failed to communicate with extension")}finally{c(!1)}}},C=async()=>{if(!(o||!x.trim())){c(!0),l(null);try{const t=await chrome.runtime.sendMessage({type:"START_EMERGENCY",payload:{domain:s,justification:x}});t.success?(g(),r()):l(`Failed: ${t.error}`)}catch(t){console.error(t),l("Failed to communicate with extension")}finally{c(!1)}}},P=n.session?n.session.mode==="pack"?"Session paused":n.session.mode==="emergency"?"Emergency session paused":"Metered session paused":"Unlock this site",I=n.session?n.session.mode==="pack"?`${Math.round(n.session.remainingSeconds/60)} minutes remaining`:n.session.mode==="emergency"?"Emergency access active":"Metered: paying as you scroll":p==="insufficient-funds"?"Top up to keep browsing":"Spend f-coins to continue";return w?e.jsx("div",{className:"tws-paywall-overlay",children:e.jsxs("div",{className:"tws-paywall-modal",children:[e.jsx("header",{className:"tws-paywall-header",children:e.jsxs("div",{children:[e.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),e.jsx("h2",{children:"I need it"}),e.jsx("p",{className:"tws-subtle",children:"Why do you need to access this site right now?"})]})}),e.jsx("div",{className:"tws-paywall-body",children:e.jsxs("div",{className:"tws-emergency-form",children:[e.jsx("textarea",{placeholder:"I need to check...",value:x,onChange:t=>S(t.target.value),autoFocus:!0}),e.jsxs("div",{className:"tws-emergency-actions",children:[e.jsx("button",{className:"tws-secondary",onClick:()=>y(!1),disabled:o,children:"Cancel"}),e.jsx("button",{className:"tws-primary",onClick:C,disabled:!x.trim()||o,children:"Access for free"})]})]})})]})}):e.jsx("div",{className:"tws-paywall-overlay",children:e.jsxs("div",{className:"tws-paywall-modal",children:[e.jsxs("header",{className:"tws-paywall-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),e.jsx("h2",{children:P}),e.jsx("p",{className:"tws-subtle",children:I})]}),e.jsxs("div",{className:"tws-wallet-badge",children:[e.jsx("span",{children:"Balance"}),e.jsxs("strong",{children:[n.balance," f-coins"]})]})]}),e.jsxs("div",{className:"tws-paywall-body",children:[b&&e.jsx("p",{className:"tws-error-text",style:{marginBottom:"12px"},children:b}),e.jsxs("section",{className:"tws-paywall-option",children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:"Pay As You Go"}),e.jsx("p",{className:"tws-subtle",children:"Pay only for the time you spend."})]}),e.jsxs("div",{className:"tws-option-action",children:[e.jsxs("div",{className:"tws-price-tag",children:[e.jsx("strong",{children:A(v)}),e.jsx("small",{children:"f-coins / min"})]}),e.jsx("button",{className:"tws-secondary",onClick:z,disabled:n.balance<1||o,children:"Start Metered"})]})]}),e.jsx("div",{className:"tws-divider",children:e.jsx("span",{children:"OR"})}),e.jsxs("section",{className:"tws-paywall-option",children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:"Pre-pay Session"}),e.jsx("p",{className:"tws-subtle",children:"Commit to a fixed time."})]}),e.jsxs("div",{className:"tws-slider-container",children:[e.jsxs("div",{className:"tws-slider-labels",children:[e.jsxs("span",{children:[i," minutes"]}),e.jsxs("span",{className:"tws-subtle-info",children:[Math.round(i/960*100),"% of your day"]}),e.jsxs("strong",{children:[u," f-coins"]})]}),e.jsx("input",{type:"range",min:m.min,max:m.max,step:m.step,value:i,onChange:t=>f(M(Number(t.target.value)))}),e.jsxs("div",{className:"tws-slider-scale",children:[e.jsxs("small",{children:[m.min,"m"]}),e.jsxs("small",{children:[m.max,"m"]})]})]}),e.jsxs("div",{className:"tws-option-action",children:[e.jsxs("button",{className:"tws-primary",onClick:E,disabled:!k||o,children:["Unlock for ",u," f-coins"]}),!k&&e.jsxs("p",{className:"tws-error-text",children:["Need ",u-n.balance," more f-coins"]})]})]}),e.jsx("div",{className:"tws-emergency-link",children:e.jsx("button",{onClick:()=>y(!0),children:"I need it"})})]})]})})}function A(s){return Number.isInteger(s)?s.toString():s.toFixed(2).replace(/\.?0+$/,"")}function g(){const s=document.getElementById("tws-block-overlay");s&&s.remove(),document.body.style.overflow=""}const _=':host{all:initial;font-family:Space Grotesk,Inter,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif}.tws-paywall-overlay{--bg: #05070f;--fg: #f9fbff;--fg-muted: #96a9d1;--accent: #89f3d2;--accent-soft: rgba(137, 243, 210, .2);--danger: #ff8c8c;position:fixed;inset:0;background:radial-gradient(circle at 20% 20%,rgba(44,125,255,.18),transparent 28%),#050710f2;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:center;z-index:2147483647;font-family:Space Grotesk,Inter,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;color:var(--fg);line-height:1.5}.tws-paywall-overlay *{box-sizing:border-box}h1,h2,h3,h4,h5,h6,p,span,div,a,button,input{color:inherit;font-family:inherit}.tws-paywall-modal{width:min(500px,92vw);padding:32px;border-radius:24px;background:linear-gradient(140deg,#0c1222fa,#0c1222f2);box-shadow:0 30px 80px #00000073,inset 0 0 0 1px #ffffff14;display:flex;flex-direction:column;gap:24px;position:relative;overflow:hidden}.tws-paywall-header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px}.tws-eyebrow{letter-spacing:.12em;text-transform:uppercase;color:var(--fg-muted);font-size:12px;margin:0 0 6px;font-weight:600}.tws-paywall-header h2{margin:0;font-size:24px;font-weight:700;color:var(--fg)}.tws-subtle{color:var(--fg-muted);margin:4px 0;font-size:14px;line-height:1.4}.tws-wallet-badge{display:flex;flex-direction:column;align-items:flex-end;background:#7cf4d41a;padding:8px 12px;border-radius:12px;border:1px solid rgba(124,244,212,.2)}.tws-wallet-badge span{font-size:11px;color:var(--fg-muted);text-transform:uppercase;letter-spacing:.05em}.tws-wallet-badge strong{color:var(--accent);font-size:16px}.tws-paywall-body{display:flex;flex-direction:column;gap:24px}.tws-paywall-option{background:#ffffff08;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:20px;transition:transform .2s ease,border-color .2s ease}.tws-paywall-option:hover{border-color:#ffffff1f;transform:translateY(-2px)}.tws-option-header{margin-bottom:16px}.tws-option-header h3{margin:0 0 4px;font-size:18px;font-weight:600;color:var(--fg)}.tws-option-action{display:flex;align-items:center;justify-content:space-between;gap:16px}.tws-price-tag{display:flex;flex-direction:column}.tws-price-tag strong{font-size:24px;color:var(--accent);line-height:1}.tws-price-tag small{color:var(--fg-muted);font-size:12px}.tws-divider{display:flex;align-items:center;justify-content:center;position:relative;height:20px}.tws-divider:before{content:"";position:absolute;left:0;right:0;height:1px;background:#ffffff1a}.tws-divider span{background:#0e1324;padding:0 12px;color:var(--fg-muted);font-size:12px;font-weight:600;z-index:1;text-transform:uppercase}.tws-slider-container{margin-bottom:16px}.tws-slider-labels{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;font-size:14px}.tws-subtle-info{color:var(--fg-muted);font-size:12px;font-weight:500}.tws-slider-labels strong{color:var(--accent)}input[type=range]{width:100%;height:6px;background:#ffffff1a;border-radius:3px;outline:none;-webkit-appearance:none;appearance:none}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 0 10px #89f3d266;transition:transform .1s}input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.1)}.tws-slider-scale{display:flex;justify-content:space-between;margin-top:8px;color:var(--fg-muted);font-size:11px}button{padding:12px 20px;border-radius:12px;border:none;font-weight:600;cursor:pointer;font-size:14px;transition:all .2s;white-space:nowrap}.tws-primary{background:var(--accent);color:#05070f;width:100%}.tws-primary:hover:not(:disabled){background:#70e6c0;transform:translateY(-1px)}.tws-secondary{background:#ffffff1a;color:var(--fg)}.tws-secondary:hover:not(:disabled){background:#ffffff26}button:disabled{opacity:.5;cursor:not-allowed;transform:none}.tws-error-text{color:var(--danger);font-size:12px;margin-top:8px;text-align:center}.tws-emergency-link{margin-top:16px;text-align:center}.tws-emergency-link button{background:none;border:none;color:var(--fg-muted);font-size:12px;text-decoration:underline;cursor:pointer;padding:4px;opacity:.6}.tws-emergency-link button:hover{opacity:1;color:var(--fg)}.tws-emergency-form{display:flex;flex-direction:column;gap:16px}.tws-emergency-form textarea{background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;color:var(--fg);font-family:inherit;font-size:14px;resize:vertical;min-height:80px}.tws-emergency-form textarea:focus{outline:none;border-color:var(--accent)}.tws-emergency-actions{display:flex;gap:12px}.tws-emergency-actions button{flex:1}';chrome.runtime.onMessage.addListener((s,n,p)=>{if(s.type==="TWS_PING"){p?.({ok:!0});return}return s.type==="BLOCK_SCREEN"&&G(s.payload.domain,s.payload.reason),!0});async function G(s,n){const p=document.getElementById("tws-shadow-host");p&&p.remove();const r=document.createElement("div");r.id="tws-shadow-host",r.style.position="fixed",r.style.zIndex="2147483647",r.style.top="0",r.style.left="0",r.style.width="0",r.style.height="0",document.body.appendChild(r);const i=r.attachShadow({mode:"open"}),f=document.createElement("style");f.textContent=_,i.appendChild(f);const o=document.createElement("div");o.id="tws-mount-point",i.appendChild(o),document.body.style.overflow="hidden";const c=await chrome.runtime.sendMessage({type:"GET_STATUS",payload:{domain:s}});B.createRoot(o).render(e.jsx(R,{domain:s,status:c,reason:n,onClose:()=>{r.remove(),document.body.style.overflow=""}}))}
