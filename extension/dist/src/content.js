import{r as o,j as t,c as ut}from"../assets/client.js";function Oe(l){return Number.isInteger(l)?l.toString():l.toFixed(2).replace(/\.?0+$/,"")}function ft(l,a,c){if(!l.length||a<=0)return[];const f=l.slice();let p=(c+1)*1103515245;const b=()=>(p=p*1103515245+12345>>>0,p/4294967295);for(let m=f.length-1;m>0;m-=1){const d=Math.floor(b()*(m+1));[f[m],f[d]]=[f[d],f[m]]}return f.slice(0,Math.min(a,f.length))}function _e(l){let a=0;for(let c=0;c<l.length;c+=1)a=(a<<5)-a+l.charCodeAt(c),a|=0;return a>>>0}function xt(l,a){let c=(_e(a)^l)>>>0;return c=c*1664525+1013904223>>>0,c/4294967295}function gt(l){switch(l){case"productive":return"productive";case"replace":return"replace";case"temptation":return"temptation";case"allow":return"allow";default:return"saved"}}function bt(l){const a=Math.max(0,Math.floor(l)),c=Math.floor(a/60),f=a%60;return`${c}:${f.toString().padStart(2,"0")}`}function ht(){try{const l=window.AudioContext||window.webkitAudioContext;if(!l)return;const a=new l,c=a.currentTime,f=a.createGain();f.gain.setValueAtTime(1e-4,c),f.gain.exponentialRampToValueAtTime(.18,c+.02),f.gain.exponentialRampToValueAtTime(1e-4,c+1.2),f.connect(a.destination);const p=a.createOscillator();p.type="sine",p.frequency.setValueAtTime(528,c),p.connect(f);const b=a.createOscillator();b.type="sine",b.frequency.setValueAtTime(792,c),b.connect(f),p.start(c),b.start(c),p.stop(c+1.2),b.stop(c+1.2),a.close().catch(()=>{})}catch{}}const wt=120,mt=[{id:"dashboard",label:"Dashboard"},{id:"library",label:"Library"},{id:"domains",label:"Domains"},{id:"settings",label:"Settings"},{id:"analytics",label:"Analytics"},{id:"economy",label:"Economy"},{id:"friends",label:"Friends"}];function yt({domain:l,status:a,reason:c,peek:f,onClose:p}){const[b,m]=o.useState(15),[d,h]=o.useState(!1),[pe,ue]=o.useState(!1),[U,Be]=o.useState(""),[D,g]=o.useState(null),[Le,fe]=o.useState(!1),[xe,$]=o.useState(0),[ge,qe]=o.useState(c==="insufficient-funds"),[y,be]=o.useState("for-you"),[J,Ke]=o.useState(0),[O,Ve]=o.useState("balanced"),[Q,Ye]=o.useState({}),[ee,he]=o.useState(8),[te,we]=o.useState({}),[me,F]=o.useState(null),[z,We]=o.useState({}),[C,re]=o.useState(null),[Ge,se]=o.useState(0),[_,T]=o.useState(!1),[ae,B]=o.useState(!1),[v,L]=o.useState(!1),[q,K]=o.useState(null),ye=o.useRef(null),[ne,ve]=o.useState(a.rotMode?.enabled??!1),[ke,je]=o.useState(!1),ie=a.rate?.ratePerMin??a.session?.ratePerMin??1,oe=a.emergencyPolicy??"balanced",V=!!f?.allowed,I=o.useMemo(()=>{switch(oe){case"off":return{id:"off",label:"Off",minutes:0,tokensPerDay:0,cooldownMinutes:0,urlLocked:!0,debtCoins:0};case"gentle":return{id:"gentle",label:"Gentle",minutes:5,tokensPerDay:null,cooldownMinutes:0,urlLocked:!0,debtCoins:0};case"strict":return{id:"strict",label:"Strict",minutes:2,tokensPerDay:1,cooldownMinutes:60,urlLocked:!0,debtCoins:15};case"balanced":default:return{id:"balanced",label:"Balanced",minutes:3,tokensPerDay:2,cooldownMinutes:30,urlLocked:!0,debtCoins:8}}},[oe]),Y=e=>`chrome://favicon2/?size=64&url=${encodeURIComponent(e)}`,Ne=e=>{try{const r=new URL(e);return r.hash="",r.toString()}catch{return null}},P=e=>{const r=Ne(e);return r?te[r]??null:null};o.useEffect(()=>{ve(a.rotMode?.enabled??!1)},[a.rotMode?.enabled]),o.useEffect(()=>{!V&&v&&(L(!1),K(null))},[V,v]),o.useEffect(()=>{if(!v||!q)return;const e=r=>{const n=r.clientX-q.x,s=r.clientY-q.y;Math.hypot(n,s)>=wt&&(L(!1),K(null))};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[v,q]);const He=e=>{if(V){if(v){L(!1),K(null);return}K({x:e.clientX,y:e.clientY}),L(!0)}},le=V?t.jsxs("div",{className:"tws-peek-controls",children:[t.jsx("button",{type:"button",className:`tws-peek-toggle ${v?"active":""}`,onClick:He,"aria-pressed":v,children:v?"Hide peek":"Peek"}),v&&t.jsx("div",{className:"tws-peek-hint",children:"Move mouse to return"})]}):null,Se=o.useMemo(()=>{const e=[],r=a.library?.replaceItems??[];for(const i of r)if(i)if(i.kind==="url"){if(!i.url||i.domain===l)continue;e.push({type:"url",id:`lib:${i.id}`,libraryId:i.id,title:i.title??i.domain,subtitle:i.note?i.note:"your replace pool",url:i.url})}else e.push({type:"app",id:`lib:${i.id}`,title:i.title??i.app??"Open app",subtitle:i.note?i.note:"your replace pool",app:i.app??"",requiresDesktop:!0});const n=a.library?.productiveItems??[];for(const i of n)if(i&&i.kind==="url"){if(!i.url||i.domain===l)continue;e.push({type:"url",id:`productive:${i.id}`,libraryId:i.id,title:i.title??i.domain,subtitle:i.note?i.note:"productive library",url:i.url})}const s=a.library?.readingItems??[];for(const i of s)!i||!i.id||!i.action||e.push({type:"desktop",id:`reading:${i.id}`,source:i.source,readingId:i.id,title:i.title??(i.source==="zotero"?"Zotero":"Books"),subtitle:i.subtitle?i.subtitle:i.source==="zotero"?"Zotero • curated reading":"Books • recent",action:i.action,thumbDataUrl:i.thumbDataUrl,iconDataUrl:i.iconDataUrl,progress:i.progress,requiresDesktop:!0});const u=a.library?.productiveDomains??[];for(const i of u){const N=(i??"").trim();!N||!N.includes(".")||N===l||e.push({type:"url",id:`prod:${N}`,title:N,subtitle:"productive",url:`https://${N}`})}e.push({type:"app",id:"app:Books",title:"Open Books",subtitle:"read something long-form",app:"Books",requiresDesktop:!0}),e.push({type:"app",id:"app:Zotero",title:"Open Zotero",subtitle:"pick a paper instead",app:"Zotero",requiresDesktop:!0}),e.push({type:"ritual",id:"ritual:meditation",ritual:"meditation",title:"Meditation",subtitle:"3-minute reset",minutes:3});const x=a.journal?.url??null,S=a.journal?.minutes??10;x&&e.push({type:"ritual",id:"ritual:journal",ritual:"journal",title:`${S}m journal`,subtitle:"write a few lines instead",minutes:S,url:x});const E=new Set;return e.filter(i=>!(E.has(i.id)||(E.add(i.id),z[i.id])))},[z,l,a.library?.productiveDomains,a.library?.productiveItems,a.library?.replaceItems,a.library?.readingItems]),W=o.useMemo(()=>ft(Se,3,xe),[Se,xe]);o.useEffect(()=>{const e=W.filter(s=>s.type==="url").map(s=>s.url),r=a.matchedPricedItem?.kind==="url"?a.matchedPricedItem.url:void 0;r&&e.push(r);const n=[...new Set(e)];n.length&&chrome.runtime.sendMessage({type:"GET_LINK_PREVIEWS",payload:{urls:n}}).then(s=>{!s?.success||!s.previews||we(u=>({...u,...s.previews}))}).catch(()=>{})},[W,a.matchedPricedItem?.url]);const k=async e=>{if(!(!e||d)){F(null),h(!0),g(null);try{if(e.type==="ritual"){if(e.ritual==="meditation"){re({kind:"meditation",minutes:e.minutes}),se(e.minutes*60),T(!1),B(!1);return}if(e.ritual==="journal"&&e.url){const n=await chrome.runtime.sendMessage({type:"OPEN_URL",payload:{url:e.url,roulette:{title:e.title}}});if(!n?.success)throw new Error(n?.error?String(n.error):"Failed to open journal");p();return}return}if(e.type==="url"){const s=P(e.url)?.title??e.title,u=await chrome.runtime.sendMessage({type:"OPEN_URL",payload:{url:e.url,roulette:{title:s,libraryId:e.libraryId}}});if(!u?.success)throw new Error(u?.error?String(u.error):"Failed to open URL");p();return}if(e.type==="desktop"){if(e.requiresDesktop&&!a.desktopConnected)throw new Error("Desktop app required for this action");const n=await chrome.runtime.sendMessage({type:"OPEN_DESKTOP_ACTION",payload:e.action});if(!n?.success)throw new Error(n?.error?String(n.error):"Failed to open in desktop app");p();return}if(e.requiresDesktop&&!a.desktopConnected)throw new Error("Desktop app required for this action");const r=await chrome.runtime.sendMessage({type:"OPEN_APP",payload:{app:e.app}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to open app");p()}catch(r){g(r.message)}finally{h(!1)}}},R=async e=>{if(!d){h(!0),g(null);try{if(e.type==="url"&&typeof e.libraryId=="number"){const r=await chrome.runtime.sendMessage({type:"MARK_LIBRARY_CONSUMED",payload:{id:e.libraryId,consumed:!0}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to mark consumed")}else if(e.type==="desktop"&&e.readingId){const r=await chrome.runtime.sendMessage({type:"MARK_READING_CONSUMED",payload:{id:e.readingId,consumed:!0}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to mark consumed")}else return;We(r=>{const n={...r,[e.id]:!0};return e.type==="url"&&typeof e.libraryId=="number"&&(n[`lib:${e.libraryId}`]=!0,n[`productive:${e.libraryId}`]=!0,n[`library:${e.libraryId}`]=!0),e.type==="desktop"&&e.readingId&&(n[`reading:${e.readingId}`]=!0),n}),F(null),$(r=>r+1)}catch(r){g(r.message)}finally{h(!1)}}},j=o.useMemo(()=>[...a.rate?.packs??[]].sort((e,r)=>e.minutes-r.minutes),[a.rate?.packs]),A=o.useMemo(()=>j.length?{min:j[0].minutes,max:j[j.length-1].minutes,step:1}:{min:5,max:120,step:5},[j]);o.useEffect(()=>{j.length?m(j[0].minutes):m(15)},[l,j]);const Ze=e=>j.length?j.reduce((r,n)=>{const s=Math.abs(n.minutes-e),u=Math.abs(r-e);return s<u?n.minutes:r},j[0].minutes):e,Ee=j.find(e=>e.minutes===b),G=Ee?Ee.price:Math.max(1,Math.round(b*ie)),Ie=a.balance>=G,Xe=async()=>{if(!d){h(!0),g(null);try{const e=await chrome.runtime.sendMessage({type:"BUY_PACK",payload:{domain:l,minutes:b}});if(!e?.success)throw new Error(e?.error?String(e.error):"Failed to start session");p()}catch(e){g(e.message)}finally{h(!1)}}},ze=async()=>{if(!d){h(!0),g(null);try{const e=await chrome.runtime.sendMessage({type:"START_METERED",payload:{domain:l}});if(!e?.success)throw new Error(e?.error?String(e.error):"Failed to start metered");p()}catch(e){g(e.message)}finally{h(!1)}}},Je=async()=>{const e=a.matchedPricedItem;if(!(d||!e||typeof e.price!="number")){h(!0),g(null);try{const r=await chrome.runtime.sendMessage({type:"START_STORE_SESSION",payload:{domain:l,price:e.price,url:window.location.href}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to unlock");p()}catch(r){g(r.message)}finally{h(!1)}}},Qe=async()=>{if(!(d||!U.trim())){h(!0),g(null);try{const e=await chrome.runtime.sendMessage({type:"START_EMERGENCY",payload:{domain:l,justification:U,url:window.location.href}});if(!e?.success)throw new Error(e?.error?String(e.error):"Failed to start emergency");p()}catch(e){g(e.message)}finally{h(!1)}}},Me=async e=>{if(!d){h(!0),g(null);try{const r=await chrome.runtime.sendMessage({type:"EMERGENCY_REVIEW",payload:{outcome:e,domain:l}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to record review");fe(!0)}catch(r){g(r.message)}finally{h(!1)}}},et=c==="url-locked"?"This pass is locked to a specific page":c==="insufficient-funds"?"Insufficient f-coins":a.session?.paused?"Session paused":"Choose what this tab becomes";if(o.useEffect(()=>{if(!C||!_)return;const e=window.setInterval(()=>{se(r=>r<=1?(window.clearInterval(e),T(!1),B(!0),ht(),0):r-1)},1e3);return()=>window.clearInterval(e)},[C,_]),C)return t.jsxs("div",{className:`tws-paywall-overlay ${v?"tws-peek-active":""}`,children:[le,t.jsxs("div",{className:"tws-paywall-modal",children:[t.jsxs("header",{className:"tws-paywall-header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),t.jsx("h2",{children:C.kind==="meditation"?"Meditation":"Ritual"}),t.jsx("p",{className:"tws-subtle",children:"A small reset helps you exit the attractor. Keep it simple: breathe, notice, return."})]}),t.jsxs("div",{className:"tws-wallet-badge",children:[t.jsx("span",{children:"Balance"}),t.jsxs("strong",{children:[a.balance," f-coins"]})]})]}),t.jsxs("div",{className:"tws-paywall-body",children:[D&&t.jsx("p",{className:"tws-error-text",children:D}),t.jsxs("section",{className:"tws-paywall-option",children:[t.jsxs("div",{className:"tws-option-header",children:[t.jsx("h3",{children:C.kind==="meditation"?`${C.minutes} minute timer`:"Timer"}),t.jsx("p",{className:"tws-subtle",style:{margin:0},children:ae?"Complete.":_?"In progress.":"Ready when you are."})]}),t.jsxs("div",{style:{display:"grid",gap:12},children:[t.jsx("div",{className:"tws-ritual-timer",children:bt(Ge)}),t.jsxs("div",{className:"tws-emergency-actions",children:[t.jsx("button",{className:"tws-secondary",onClick:()=>{re(null),T(!1),B(!1),$(e=>e+1)},disabled:d,children:"Back"}),ae?t.jsx("button",{className:"tws-primary",onClick:()=>{re(null),$(e=>e+1)},disabled:d,children:"Pick next"}):t.jsx("button",{className:"tws-primary",onClick:()=>T(e=>!e),disabled:d,children:_?"Pause":"Start"}),!ae&&t.jsx("button",{className:"tws-secondary",onClick:()=>{T(!1),se(C.minutes*60),B(!1)},disabled:d,children:"Reset"})]})]})]})]})]})]});if(pe)return t.jsxs("div",{className:`tws-paywall-overlay ${v?"tws-peek-active":""}`,children:[le,t.jsxs("div",{className:"tws-paywall-modal",children:[t.jsxs("header",{className:"tws-paywall-header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),t.jsx("h2",{children:"I need it"}),t.jsx("p",{className:"tws-subtle",children:"Emergency access is a safety hatch. Use it when you have a real purpose — not when you want a dopamine hit."})]}),t.jsxs("div",{className:"tws-wallet-badge",children:[t.jsx("span",{children:"Balance"}),t.jsxs("strong",{children:[a.balance," f-coins"]})]})]}),t.jsxs("div",{className:"tws-paywall-body",children:[D&&t.jsx("p",{className:"tws-error-text",children:D}),t.jsxs("div",{className:"tws-emergency-form",children:[t.jsxs("p",{className:"tws-subtle",style:{marginTop:0},children:["Policy: ",t.jsx("strong",{children:I.label}),I.id!=="off"&&t.jsxs(t.Fragment,{children:[" ","• ",I.minutes,"m window",typeof I.tokensPerDay=="number"?` • ${I.tokensPerDay}/day`:" • unlimited/day",I.cooldownMinutes>0?` • ${I.cooldownMinutes}m cooldown`:"",I.debtCoins>0?` • ${I.debtCoins} coin debt`:""]})]}),t.jsx("textarea",{placeholder:"I need to…",value:U,onChange:e=>Be(e.target.value),autoFocus:!0}),t.jsxs("div",{className:"tws-emergency-actions",children:[t.jsx("button",{className:"tws-secondary",onClick:()=>ue(!1),disabled:d,children:"Back"}),t.jsxs("button",{className:"tws-primary",onClick:Qe,disabled:!U.trim()||d,children:["Start emergency (",I.minutes,"m)"]})]})]})]})]})]});const w=a.matchedPricedItem&&typeof a.matchedPricedItem.price=="number"?a.matchedPricedItem:null,H=w?.kind==="url"&&w.url?P(w.url):null,Ce=H?.imageUrl??null,De=w?.kind==="url"&&w.url?H?.iconUrl??Y(w.url):null,Z=o.useMemo(()=>(a.library?.productiveItems??[]).filter(r=>!r||r.kind!=="url"||!r.url?!1:!z[`productive:${r.id}`]),[z,a.library?.productiveItems]),tt=e=>{!e||e.kind!=="url"||!e.url||k({type:"url",id:`productive:${e.id}`,title:e.title??e.domain,subtitle:e.note??void 0,url:e.url,libraryId:e.id})},rt=e=>{!e||e.kind!=="url"||!e.url||R({type:"url",id:`productive:${e.id}`,title:e.title??e.domain,subtitle:e.note??void 0,url:e.url,libraryId:e.id})},Te=o.useMemo(()=>{const e=[],r=a.library?.items??[];for(const s of r){if(!s||s.consumedAt||z[`library:${s.id}`]||z[`lib:${s.id}`]||z[`productive:${s.id}`])continue;const x=s.title??s.app??s.domain??"Saved item",S=s.note??(s.kind==="app"?"Desktop app":s.domain),E=s.lastUsedAt??s.createdAt??"",i=E?Date.parse(E):0,N=Number.isFinite(i)?i:0;e.push({id:`library:${s.id}`,entryType:"library",contentType:s.kind,title:x,subtitle:S,meta:s.kind==="app"?"app":gt(s.purpose),updatedAt:N,url:s.url,app:s.app,domain:s.domain,libraryId:s.id,purpose:s.purpose})}const n=a.library?.readingItems??[];for(const s of n)!s||!s.id||z[`reading:${s.id}`]||e.push({id:`reading:${s.id}`,entryType:"reading",contentType:"reading",title:s.title??(s.source==="zotero"?"Zotero":"Reading"),subtitle:s.subtitle??(s.source==="zotero"?"Zotero reading":"Books"),meta:s.source==="zotero"?"zotero":"books",updatedAt:s.updatedAt??0,readingId:s.id,source:s.source,action:s.action,thumbDataUrl:s.thumbDataUrl,iconDataUrl:s.iconDataUrl,progress:s.progress,requiresDesktop:!0});return e},[z,a.library?.items,a.library?.readingItems]),M=o.useMemo(()=>{const e=O==="fresh"?{recency:1.1,random:.4,vote:.8}:O==="wild"?{recency:.4,random:1.2,vote:.6}:{recency:.7,random:.7,vote:1},r=Date.now();return[...Te].sort((n,s)=>{const u=x=>{const S=Q[x.id]??0,E=xt(J,x.id),i=x.updatedAt?Math.max(0,r-x.updatedAt):1e3*60*60*24*30,N=Math.exp(-i/(1e3*60*60*24*10));return S*e.vote+E*e.random+N*e.recency};return u(s)-u(n)})},[Te,O,J,Q]),de=o.useMemo(()=>M.slice(0,Math.min(ee,M.length)),[M,ee]);o.useEffect(()=>{y==="feed"&&he(Math.min(8,M.length||0))},[J,M.length,y]);const Pe=(e,r)=>{Ye(n=>{const u=(n[e]??0)===r?0:r;return{...n,[e]:u}})},st=e=>{if(e.entryType==="reading"&&e.action&&e.readingId){k({type:"desktop",id:e.id,source:e.source??"zotero",readingId:e.readingId,title:e.title,subtitle:e.subtitle,action:e.action,thumbDataUrl:e.thumbDataUrl,iconDataUrl:e.iconDataUrl,progress:e.progress,requiresDesktop:!0});return}if(e.contentType==="app"&&e.app){k({type:"app",id:e.id,title:e.title,subtitle:e.subtitle,app:e.app,requiresDesktop:!0});return}e.url&&k({type:"url",id:e.id,title:e.title,subtitle:e.subtitle,url:e.url,libraryId:e.libraryId})},at=e=>{if(e.entryType==="reading"&&e.readingId){R({type:"desktop",id:e.id,source:e.source??"zotero",readingId:e.readingId,title:e.title,subtitle:e.subtitle,action:e.action??{kind:"deeplink"},requiresDesktop:!0});return}e.entryType==="library"&&e.libraryId&&e.url&&R({type:"url",id:e.id,title:e.title,subtitle:e.subtitle,url:e.url,libraryId:e.libraryId})};o.useEffect(()=>{if(y!=="feed")return;const e=ye.current;if(!e)return;const r=new IntersectionObserver(n=>{n.some(s=>s.isIntersecting)&&he(s=>Math.min(s+6,M.length))},{rootMargin:"320px 0px"});return r.observe(e),()=>r.disconnect()},[y,M.length]),o.useEffect(()=>{if(y!=="feed")return;const e=de.map(s=>s.url).filter(s=>!!s);if(!e.length)return;const n=[...new Set(e)].filter(s=>{const u=Ne(s);return u?!(u in te):!1});n.length&&chrome.runtime.sendMessage({type:"GET_LINK_PREVIEWS",payload:{urls:n}}).then(s=>{!s?.success||!s.previews||we(u=>({...u,...s.previews}))}).catch(()=>{})},[y,te,de]);const Re=y==="feed"?"library":"dashboard",nt=[{id:"balanced",label:"Balanced"},{id:"fresh",label:"Fresh"},{id:"wild",label:"Wild"}],it=ee<M.length,Ae=!a.desktopConnected,ot=e=>{chrome.runtime.sendMessage({type:"OPEN_DESKTOP_VIEW",payload:{view:e}}).then(r=>{r?.success||g(r?.error?String(r.error):"Failed to open desktop view")}).catch(r=>{g(r.message)})},lt=async()=>{if(ke)return;const e=!ne;je(!0),g(null);try{if(e&&a.balance<1)throw new Error("Need at least 1 f-coin to start rot mode.");const r=await chrome.runtime.sendMessage({type:"SET_ROT_MODE",payload:{enabled:e}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to update rot mode");ve(e),e&&await ze()}catch(r){g(r.message)}finally{je(!1)}};return t.jsxs("div",{className:`tws-paywall-overlay ${v?"tws-peek-active":""}`,children:[le,t.jsxs("div",{className:"tws-paywall-shell",children:[t.jsxs("aside",{className:"tws-paywall-sidebar",children:[t.jsxs("div",{className:"tws-sidebar-brand",children:[t.jsx("div",{className:"tws-logo",children:"TWS"}),t.jsxs("div",{children:[t.jsx("div",{className:"tws-brand-name",children:"TimeWellSpent"}),t.jsx("div",{className:"tws-brand-tag",children:"attention on purpose"})]})]}),t.jsx("nav",{className:"tws-sidebar-nav","aria-label":"TimeWellSpent",children:mt.map(e=>t.jsxs("button",{type:"button",className:e.id===Re?"active":"","aria-current":e.id===Re?"page":void 0,disabled:Ae,title:Ae?"Desktop app is offline":"Open in desktop app",onClick:()=>ot(e.id),children:[t.jsx("span",{className:"tws-nav-dot","aria-hidden":"true"}),e.label]},e.id))}),t.jsxs("div",{className:"tws-sidebar-footer",children:[t.jsxs("div",{className:"tws-sidebar-badge",children:[t.jsx("span",{children:"Balance"}),t.jsxs("strong",{children:[a.balance," f-coins"]})]}),t.jsx("p",{className:"tws-subtle",style:{margin:0},children:"This is your feed, tuned for what matters."})]})]}),t.jsxs("main",{className:"tws-paywall-main",children:[t.jsxs("header",{className:"tws-paywall-topbar",children:[t.jsxs("div",{children:[t.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),t.jsx("h2",{children:l}),t.jsx("p",{className:"tws-subtle",children:et})]}),t.jsxs("div",{className:"tws-feed-toggle",role:"tablist","aria-label":"Feed view",children:[t.jsx("button",{type:"button",className:y==="for-you"?"active":"",onClick:()=>be("for-you"),"aria-pressed":y==="for-you",children:"For you"}),t.jsx("button",{type:"button",className:y==="feed"?"active":"",onClick:()=>be("feed"),"aria-pressed":y==="feed",children:"Feed"})]})]}),t.jsxs("div",{className:"tws-paywall-content",children:[D&&t.jsx("p",{className:"tws-error-text",style:{marginBottom:0},children:D}),c==="emergency-expired"&&!Le&&t.jsxs("section",{className:"tws-paywall-option",style:{borderColor:"#d07f00"},children:[t.jsxs("div",{className:"tws-option-header",children:[t.jsx("h3",{children:"Emergency ended"}),t.jsxs("p",{className:"tws-subtle",children:["Quick check-in: did you do the thing you came for?",a.emergency?.lastEnded?.domain===l&&a.emergency.lastEnded.justification?` ("${a.emergency.lastEnded.justification}")`:""]})]}),t.jsxs("div",{className:"tws-option-action",children:[t.jsx("button",{className:"tws-secondary",disabled:d,onClick:()=>Me("not-kept"),children:"Not really"}),t.jsx("button",{className:"tws-primary",disabled:d,onClick:()=>Me("kept"),children:"Yes"})]})]}),y==="for-you"?t.jsxs("div",{className:"tws-bins",children:[t.jsxs("section",{className:"tws-paywall-option tws-attractors",children:[t.jsxs("div",{className:"tws-option-header tws-attractors-header",children:[t.jsxs("div",{children:[t.jsx("h3",{children:"Gentle redirection"}),t.jsx("p",{className:"tws-subtle",children:"You are not here because this site is irresistible. You are here because something else mattered - pick it."})]}),t.jsx("button",{className:"tws-link",type:"button",disabled:d,onClick:()=>$(e=>e+1),children:"Spin"})]}),W.length===0?t.jsx("p",{className:"tws-subtle",style:{margin:0},children:'Your Replace pool is empty. Save a few links with right-click → "Save to TimeWellSpent" → "Replace".'}):t.jsx("div",{className:"tws-attractors-grid",children:W.map(e=>{const r=d||e.type==="desktop"&&e.requiresDesktop&&!a.desktopConnected||e.type==="app"&&e.requiresDesktop&&!a.desktopConnected;if(e.type==="url"){const n=P(e.url),s=n?.imageUrl??null,u=n?.iconUrl??Y(e.url);return t.jsxs("div",{className:"tws-attractor-card",onClick:()=>{r||k(e)},role:"button",tabIndex:r?-1:0,"aria-disabled":r,onKeyDown:x=>{r||(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),k(e))},children:[t.jsxs("div",{className:"tws-attractor-thumb",children:[s?t.jsx("img",{className:"tws-attractor-thumb-img",src:s,alt:"",loading:"lazy"}):t.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),typeof e.libraryId=="number"&&t.jsx("button",{type:"button",className:"tws-card-menu-trigger","aria-label":"More",disabled:d,onClick:x=>{x.stopPropagation(),F(S=>S===e.id?null:e.id)},children:"⋯"}),me===e.id&&typeof e.libraryId=="number"&&t.jsx("div",{className:"tws-card-menu",role:"menu",onClick:x=>x.stopPropagation(),children:t.jsx("button",{type:"button",className:"tws-card-menu-item",disabled:d,onClick:()=>R(e),children:"Already consumed"})}),t.jsx("img",{className:"tws-attractor-favicon",src:u,alt:"",loading:"lazy"})]}),t.jsxs("div",{className:"tws-attractor-meta",children:[t.jsx("strong",{children:n?.title??e.title}),t.jsx("span",{children:n?.description??e.subtitle??"saved in your replace pool"}),t.jsx("small",{children:new URL(e.url).hostname.replace(/^www\\./,"")})]})]},e.id)}if(e.type==="desktop"){const n=e.source==="zotero"&&typeof e.progress=="number"?Math.round(Math.max(0,Math.min(1,e.progress))*100):null;return t.jsxs("div",{className:"tws-attractor-card",onClick:()=>{r||k(e)},title:e.requiresDesktop&&!a.desktopConnected?"Requires desktop app":void 0,role:"button",tabIndex:r?-1:0,"aria-disabled":r,onKeyDown:s=>{r||(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),k(e))},children:[t.jsxs("div",{className:"tws-attractor-thumb",children:[e.thumbDataUrl?t.jsx("img",{className:"tws-attractor-thumb-img",src:e.thumbDataUrl,alt:"",loading:"lazy"}):t.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),n!==null&&t.jsx("div",{className:"tws-progress-bar","aria-hidden":"true",children:t.jsx("div",{className:"tws-progress-fill",style:{width:`${n}%`}})}),t.jsx("button",{type:"button",className:"tws-card-menu-trigger","aria-label":"More",disabled:d,onClick:s=>{s.stopPropagation(),F(u=>u===e.id?null:e.id)},children:"⋯"}),me===e.id&&t.jsx("div",{className:"tws-card-menu",role:"menu",onClick:s=>s.stopPropagation(),children:t.jsx("button",{type:"button",className:"tws-card-menu-item",disabled:d,onClick:()=>R(e),children:"Already consumed"})}),e.iconDataUrl?t.jsx("img",{className:"tws-attractor-favicon",src:e.iconDataUrl,alt:"",loading:"lazy"}):t.jsx("div",{className:"tws-attractor-favicon","aria-hidden":"true"})]}),t.jsxs("div",{className:"tws-attractor-meta",children:[t.jsx("strong",{children:e.title}),t.jsx("span",{children:e.subtitle??"reading suggestion"}),t.jsx("small",{children:"desktop"})]})]},e.id)}return e.type==="ritual"?t.jsxs("div",{className:"tws-attractor-card",onClick:()=>{r||k(e)},role:"button",tabIndex:r?-1:0,"aria-disabled":r,onKeyDown:n=>{r||(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),k(e))},children:[t.jsxs("div",{className:"tws-attractor-thumb tws-attractor-thumb-ritual",children:[t.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),t.jsx("div",{className:"tws-attractor-app-badge",children:"Ritual"})]}),t.jsxs("div",{className:"tws-attractor-meta",children:[t.jsx("strong",{children:e.title}),t.jsx("span",{children:e.subtitle??"a small reset"}),t.jsx("small",{children:e.ritual==="meditation"?`${e.minutes}m`:"journal"})]})]},e.id):t.jsxs("div",{className:"tws-attractor-card",onClick:()=>{r||k(e)},title:e.requiresDesktop&&!a.desktopConnected?"Requires desktop app":void 0,role:"button",tabIndex:r?-1:0,"aria-disabled":r,onKeyDown:n=>{r||(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),k(e))},children:[t.jsxs("div",{className:"tws-attractor-thumb tws-attractor-thumb-app",children:[t.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),t.jsx("div",{className:"tws-attractor-app-badge",children:"App"})]}),t.jsxs("div",{className:"tws-attractor-meta",children:[t.jsx("strong",{children:e.title}),t.jsx("span",{children:e.subtitle??"open an app"}),t.jsx("small",{children:"desktop"})]})]},e.id)})})]}),t.jsxs("section",{className:"tws-paywall-option tws-library-shelf",children:[t.jsx("div",{className:"tws-option-header",children:t.jsxs("div",{children:[t.jsxs("h3",{children:["Productive library"," ",Z.length>0&&t.jsxs("span",{className:"tws-subtle",children:["(",Z.length,")"]})]}),t.jsx("p",{className:"tws-subtle",children:"Open something you already tagged as productive."})]})}),Z.length===0?t.jsx("p",{className:"tws-subtle",style:{margin:0},children:'No productive items yet. Right-click a page and choose "Productive" to add it.'}):t.jsx("div",{className:"tws-library-scroll",children:Z.map(e=>{const r=P(e.url??""),n=r?.title??e.title??e.domain,s=r?.description??e.note??e.domain,u=e.url?r?.iconUrl??Y(e.url):null;return t.jsxs("div",{className:"tws-library-item",children:[t.jsxs("div",{className:"tws-library-info",children:[u?t.jsx("img",{className:"tws-library-favicon",src:u,alt:"",loading:"lazy"}):t.jsx("div",{className:"tws-library-favicon tws-library-favicon-placeholder","aria-hidden":"true"}),t.jsxs("div",{className:"tws-library-meta",children:[t.jsx("strong",{children:n}),t.jsx("span",{children:s})]})]}),t.jsxs("div",{className:"tws-library-actions",children:[t.jsx("button",{className:"tws-secondary",type:"button",disabled:d,onClick:()=>tt(e),children:"Open"}),t.jsx("button",{className:"tws-link",type:"button",disabled:d,onClick:()=>rt(e),children:"Done"})]})]},e.id)})})]})]}):t.jsxs("div",{className:"tws-feed",children:[t.jsxs("div",{className:"tws-feed-toolbar",children:[t.jsxs("div",{className:"tws-feed-lens",children:[t.jsx("span",{className:"tws-feed-label",children:"Surface"}),t.jsx("div",{className:"tws-feed-lens-group",children:nt.map(e=>t.jsx("button",{type:"button",className:O===e.id?"active":"",onClick:()=>Ve(e.id),children:e.label},e.id))})]}),t.jsx("button",{className:"tws-secondary tws-compact",type:"button",onClick:()=>Ke(e=>e+1),disabled:d,children:"Shuffle"})]}),M.length===0?t.jsx("p",{className:"tws-subtle",style:{margin:0},children:"Your library is empty. Save a few pages to see them here."}):t.jsxs("div",{className:"tws-feed-list",children:[de.map((e,r)=>{const n=e.url?P(e.url):null,s=n?.title??e.title??e.domain??e.app??"Saved item",u=n?.description??e.subtitle??"Saved for later.",x=e.thumbDataUrl??n?.imageUrl??null,S=e.iconDataUrl??(e.url?n?.iconUrl??Y(e.url):null),E=d||e.requiresDesktop&&!a.desktopConnected,i=Q[e.id]??0,N=e.domain??e.app??s??e.meta??e.id,dt={"--cover-hue":`${_e(N)%360}`},ct=(s??"T").trim().charAt(0).toUpperCase()||"T",Ue=e.domain?e.domain.replace(/^www\\./,""):e.app?e.app:e.source==="zotero"?"Zotero":e.source==="books"?"Books":"",$e=e.contentType==="reading"&&typeof e.progress=="number"?Math.round(Math.max(0,Math.min(1,e.progress))*100):null,pt=e.entryType==="reading"||e.entryType==="library"&&e.contentType==="url";return t.jsxs("article",{className:`tws-feed-card ${E?"disabled":""}`,style:{animationDelay:`${r*60}ms`},children:[t.jsx("div",{className:"tws-feed-avatar",children:S?t.jsx("img",{src:S,alt:"",loading:"lazy"}):t.jsx("div",{className:"tws-feed-avatar-fallback","aria-hidden":"true"})}),t.jsxs("div",{className:"tws-feed-body",children:[t.jsxs("div",{className:"tws-feed-header",children:[t.jsxs("div",{className:"tws-feed-title",children:[t.jsx("strong",{children:s}),t.jsx("span",{className:"tws-feed-chip",children:e.meta})]}),t.jsx("button",{className:"tws-feed-open",type:"button",disabled:E,title:E?"Requires desktop app":void 0,onClick:()=>st(e),children:"Open"})]}),t.jsx("p",{className:"tws-feed-subtitle",children:u}),t.jsxs("div",{className:"tws-feed-thumb",style:dt,children:[x&&t.jsx("img",{src:x,alt:"",loading:"lazy",referrerPolicy:"no-referrer",onLoad:X=>X.currentTarget.setAttribute("data-loaded","true"),onError:X=>{X.currentTarget.removeAttribute("data-loaded"),X.currentTarget.style.display="none"}}),t.jsxs("div",{className:"tws-feed-cover",children:[t.jsx("div",{className:"tws-feed-cover-initial",children:ct}),t.jsxs("div",{className:"tws-feed-cover-meta",children:[t.jsx("span",{children:e.meta}),t.jsx("strong",{children:s})]})]})]}),$e!==null&&t.jsx("div",{className:"tws-feed-progress","aria-hidden":"true",children:t.jsx("div",{className:"tws-feed-progress-fill",style:{width:`${$e}%`}})}),Ue&&t.jsx("div",{className:"tws-feed-meta-line",children:Ue}),t.jsxs("div",{className:"tws-feed-actions",children:[t.jsx("button",{type:"button",className:`tws-feed-react ${i===1?"active":""}`,onClick:()=>Pe(e.id,1),disabled:d,children:"Like"}),t.jsx("button",{type:"button",className:`tws-feed-react ${i===-1?"active":""}`,onClick:()=>Pe(e.id,-1),disabled:d,children:"Dislike"}),pt&&t.jsx("button",{type:"button",className:"tws-feed-ghost",onClick:()=>at(e),disabled:d,children:"Done"})]})]})]},e.id)}),t.jsx("div",{ref:ye,className:"tws-feed-sentinel",children:it?"Loading more...":"End of your library"})]})]})]})]}),t.jsxs("aside",{className:"tws-paywall-rail",children:[t.jsxs("div",{className:"tws-rail-card",children:[t.jsxs("div",{className:"tws-rail-row",children:[t.jsx("span",{className:"tws-rail-label",children:"Rate"}),t.jsxs("strong",{children:[Oe(ie)," f-coins/min"]})]}),t.jsx("p",{className:"tws-subtle",style:{margin:0},children:"Proceed only when it matches your intention."})]}),t.jsxs("div",{className:"tws-rail-card tws-rot-card",children:[t.jsxs("div",{className:"tws-rot-header",children:[t.jsx("strong",{children:"Rot mode"}),t.jsx("button",{type:"button",className:`tws-rot-toggle ${ne?"active":""}`,onClick:lt,disabled:ke||d,children:ne?"On":"Off"})]}),t.jsx("p",{className:"tws-subtle",style:{margin:0},children:"Opens all frivolous domains, metered and paused when you leave."})]}),t.jsx("div",{className:"tws-proceed-dock",children:t.jsxs("details",{className:"tws-details",open:ge,onToggle:e=>qe(e.target.open),children:[t.jsxs("summary",{children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[t.jsx("strong",{children:"Proceed anyway"}),t.jsx("span",{children:"Timebox recommended - metered and emergency are intentionally harder."})]}),t.jsx("span",{children:ge?"-":"+"})]}),t.jsxs("div",{className:"tws-details-body",children:[w&&t.jsxs("section",{className:"tws-paywall-option",style:{margin:0},children:[t.jsxs("div",{className:"tws-option-header",children:[t.jsx("h3",{children:"Unlock your saved item"}),t.jsx("p",{className:"tws-subtle",children:"Pay once for this exact page, then leave when you are done."})]}),w.url&&t.jsx("div",{className:"tws-attractors-grid",style:{gridTemplateColumns:"1fr",marginBottom:12},children:t.jsxs("button",{type:"button",className:"tws-attractor-card",disabled:!0,style:{cursor:"default"},children:[t.jsxs("div",{className:"tws-attractor-thumb",children:[Ce?t.jsx("img",{className:"tws-attractor-thumb-img",src:Ce,alt:"",loading:"lazy"}):t.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),De&&t.jsx("img",{className:"tws-attractor-favicon",src:De,alt:"",loading:"lazy"}),t.jsxs("div",{className:"tws-price-pill",children:[w.price,t.jsx("span",{children:"f-coins"})]})]}),t.jsxs("div",{className:"tws-attractor-meta",children:[t.jsx("strong",{children:H?.title??w.title??w.domain}),t.jsx("span",{children:H?.description??"Saved one-time unlock"}),t.jsx("small",{children:w.domain})]})]})}),t.jsxs("div",{className:"tws-option-action",children:[t.jsxs("div",{className:"tws-price-tag",children:[t.jsx("strong",{children:w.price}),t.jsx("small",{children:"f-coins"})]}),t.jsx("button",{className:"tws-primary",onClick:Je,disabled:d||a.balance<w.price,children:"Unlock now"})]}),a.balance<w.price&&t.jsxs("p",{className:"tws-error-text",style:{marginTop:8},children:["Need ",w.price-a.balance," more f-coins"]})]}),t.jsxs("section",{className:"tws-paywall-option",style:{margin:0},children:[t.jsxs("div",{className:"tws-option-header",children:[t.jsx("h3",{children:"Timeboxed session (recommended)"}),t.jsx("p",{className:"tws-subtle",children:"Commit to a fixed time and leave when it ends."})]}),t.jsxs("div",{className:"tws-slider-container",children:[t.jsxs("div",{className:"tws-slider-labels",children:[t.jsxs("span",{children:[b," minutes"]}),t.jsx("span",{className:"tws-subtle-info",children:"timebox"}),t.jsxs("strong",{children:[G," f-coins"]})]}),t.jsx("input",{type:"range",min:A.min,max:A.max,step:A.step,value:b,onChange:e=>m(Ze(Number(e.target.value)))}),t.jsxs("div",{className:"tws-slider-scale",children:[t.jsxs("small",{children:[A.min,"m"]}),t.jsxs("small",{children:[A.max,"m"]})]})]}),t.jsxs("div",{className:"tws-option-action",children:[t.jsxs("button",{className:"tws-primary",onClick:Xe,disabled:!Ie||d,children:["Proceed for ",G," f-coins"]}),!Ie&&t.jsxs("p",{className:"tws-error-text",children:["Need ",G-a.balance," more f-coins"]})]})]}),t.jsxs("section",{className:"tws-paywall-option",style:{margin:0},children:[t.jsxs("div",{className:"tws-option-header",children:[t.jsx("h3",{children:"Metered"}),t.jsx("p",{className:"tws-subtle",children:"Charges continuously while you stay. Use only if you trust yourself."})]}),t.jsxs("div",{className:"tws-option-action",children:[t.jsxs("div",{className:"tws-price-tag",children:[t.jsx("strong",{children:Oe(ie)}),t.jsx("small",{children:"f-coins / min"})]}),t.jsx("button",{className:"tws-secondary",onClick:ze,disabled:a.balance<1||d,children:"Proceed metered"})]})]}),t.jsx("div",{className:"tws-emergency-link",children:oe==="off"?t.jsx("button",{disabled:!0,title:"Emergency access is disabled in Settings.",children:"Emergency disabled"}):t.jsx("button",{onClick:()=>{fe(!1),ue(!0)},children:"I need it (Emergency)"})})]})]})})]})]})]})}const vt=':host{all:initial;font-family:Space Grotesk,Avenir Next,Helvetica Neue,sans-serif}.tws-paywall-overlay{--bg-base: #0b0d12;--bg-raised: #151822;--bg-elevated: #1f2431;--fg: #f2ede7;--fg-muted: #9a938d;--fg-subtle: #6c6762;--accent: #d39a5f;--accent-strong: #f1b46b;--accent-cool: #7da3ff;--accent-soft: rgba(211, 154, 95, .16);--danger: #c77171;--border: rgba(255, 255, 255, .08);--border-strong: rgba(255, 255, 255, .16);position:fixed;inset:0;background:radial-gradient(circle at 12% 12%,rgba(125,163,255,.18),transparent 40%),radial-gradient(circle at 88% 8%,rgba(211,154,95,.16),transparent 48%),linear-gradient(180deg,#0b0d12,#0f1218);display:block;z-index:2147483647;color:var(--fg);line-height:1.5;overflow-y:auto;overscroll-behavior:contain;-webkit-overflow-scrolling:touch}.tws-paywall-overlay.tws-peek-active{background:transparent}.tws-paywall-overlay.tws-peek-active:before{opacity:0}.tws-paywall-overlay.tws-peek-active .tws-paywall-modal,.tws-paywall-overlay.tws-peek-active .tws-paywall-shell{opacity:0;pointer-events:none}.tws-peek-controls{position:fixed;top:16px;right:16px;display:flex;flex-direction:column;align-items:flex-end;gap:6px;z-index:1}.tws-peek-toggle{border-radius:999px;border:1px solid var(--border-strong);background:#111113eb;color:var(--fg);padding:6px 12px;font-size:12px;font-weight:600;cursor:pointer}.tws-peek-toggle:hover{border-color:#c8956c66}.tws-peek-toggle.active{background:#c8956c2e;border-color:#c8956c73}.tws-peek-hint{font-size:11px;color:var(--fg-muted);background:#08080ab3;padding:4px 8px;border-radius:999px}.tws-paywall-overlay *{box-sizing:border-box}.tws-paywall-overlay:before{content:"";position:fixed;inset:0;pointer-events:none;background-image:linear-gradient(rgba(255,255,255,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.015) 1px,transparent 1px);background-size:60px 60px;z-index:-1}h1,h2,h3,h4,h5,h6,p,span,div,a,button,input{color:inherit;font-family:inherit}.tws-paywall-shell{width:min(1400px,100%);margin:0 auto;min-height:100vh;padding:28px 32px 40px;display:grid;grid-template-columns:220px minmax(0,1fr) 320px;gap:24px}.tws-paywall-sidebar{display:flex;flex-direction:column;gap:24px;position:sticky;top:24px;align-self:start}.tws-sidebar-brand{display:flex;align-items:center;gap:12px}.tws-logo{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(140deg,#7da3ff38,#d39a5f29);border:1px solid var(--border-strong);font-weight:700;letter-spacing:.1em;font-size:12px;color:var(--fg);text-transform:uppercase}.tws-brand-name{font-weight:700;font-size:16px;letter-spacing:.02em}.tws-brand-tag{font-size:12px;color:var(--fg-muted)}.tws-sidebar-nav{display:flex;flex-direction:column;gap:6px}.tws-sidebar-nav button{display:flex;align-items:center;gap:10px;border:1px solid transparent;background:transparent;color:var(--fg-muted);padding:8px 12px;border-radius:999px;font-size:14px;text-align:left}.tws-sidebar-nav button:hover{color:var(--fg);background:#ffffff0a}.tws-sidebar-nav button:disabled{opacity:.55;cursor:not-allowed}.tws-sidebar-nav button.active{color:var(--fg);background:#7da3ff24;border-color:#7da3ff52}.tws-nav-dot{width:8px;height:8px;border-radius:50%;background:var(--accent);opacity:.55}.tws-sidebar-nav button.active .tws-nav-dot{opacity:1;background:var(--accent-strong)}.tws-sidebar-footer{display:flex;flex-direction:column;gap:10px;padding:14px;border-radius:16px;background:#ffffff0a;border:1px solid var(--border)}.tws-sidebar-badge{display:flex;flex-direction:column;gap:4px;font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--fg-muted)}.tws-sidebar-badge strong{font-size:18px;color:var(--accent-strong);letter-spacing:.02em}.tws-paywall-main{min-width:0;display:flex;flex-direction:column;gap:16px}.tws-paywall-topbar{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:16px 18px;border-radius:18px;background:linear-gradient(140deg,#151822eb,#151822c7);border:1px solid var(--border)}.tws-feed-toggle{display:flex;gap:6px;padding:6px;border-radius:999px;background:#ffffff0a;border:1px solid var(--border)}.tws-feed-toggle button{padding:6px 12px;border-radius:999px;border:none;background:transparent;color:var(--fg-muted);font-size:13px;font-weight:600}.tws-feed-toggle button.active{background:#7da3ff38;color:var(--fg)}.tws-paywall-content{display:flex;flex-direction:column;gap:14px}.tws-bins{display:flex;flex-direction:column;gap:16px}.tws-feed{display:flex;flex-direction:column;gap:14px}.tws-feed-toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 12px;border-radius:16px;border:1px solid var(--border);background:#ffffff08}.tws-feed-lens{display:flex;align-items:center;gap:10px}.tws-feed-label{font-size:11px;text-transform:uppercase;letter-spacing:.12em;color:var(--fg-muted)}.tws-feed-lens-group{display:flex;gap:6px;background:#ffffff0a;padding:4px;border-radius:999px}.tws-feed-lens-group button{padding:6px 10px;border-radius:999px;border:none;background:transparent;color:var(--fg-muted);font-size:12px;font-weight:600}.tws-feed-lens-group button.active{background:#d39a5f2e;color:var(--fg)}.tws-compact{padding:6px 12px;font-size:12px;border-radius:999px}.tws-feed-list{display:flex;flex-direction:column;gap:12px}.tws-feed-card{display:grid;grid-template-columns:48px minmax(0,1fr);gap:14px;padding:14px;border-radius:18px;background:#ffffff08;border:1px solid var(--border);animation:tws-rise .45s ease both;transition:transform .2s ease,border-color .2s ease}.tws-feed-card:hover{border-color:var(--border-strong);transform:translateY(-1px)}.tws-feed-card.disabled{opacity:.65}.tws-feed-avatar{width:44px;height:44px;border-radius:14px;overflow:hidden;background:#ffffff0d;display:grid;place-items:center;border:1px solid rgba(255,255,255,.08)}.tws-feed-avatar img{width:100%;height:100%;object-fit:cover}.tws-feed-avatar-fallback{width:18px;height:18px;border-radius:50%;background:#d39a5f73;box-shadow:0 0 0 4px #d39a5f26}.tws-feed-body{display:flex;flex-direction:column;gap:10px;min-width:0}.tws-feed-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}.tws-feed-title{display:flex;flex-wrap:wrap;align-items:center;gap:8px}.tws-feed-title strong{font-size:15px;font-weight:700}.tws-feed-chip{padding:4px 8px;border-radius:999px;background:#7da3ff24;color:var(--fg);font-size:11px;text-transform:uppercase;letter-spacing:.08em}.tws-feed-open{padding:6px 12px;border-radius:999px;border:1px solid rgba(211,154,95,.4);background:#d39a5f1f;color:var(--fg);font-size:12px;font-weight:600}.tws-feed-subtitle{margin:0;color:var(--fg-muted);font-size:13px;line-height:1.4}.tws-feed-thumb{position:relative;height:180px;border-radius:16px;overflow:hidden;border:1px solid rgba(255,255,255,.12);background:radial-gradient(circle at 20% 20%,rgba(255,255,255,.15),transparent 55%),linear-gradient(135deg,hsl(var(--cover-hue, 32) 52% 26%),hsl(calc(var(--cover-hue, 32) + 28) 58% 20%))}.tws-feed-thumb:after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,transparent 30%,rgba(0,0,0,.55));opacity:.6;z-index:2}.tws-feed-thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:1;transition:opacity .25s ease}.tws-feed-thumb img[data-loaded=true]+.tws-feed-cover{opacity:0;transform:translateY(6px)}.tws-feed-cover{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:space-between;padding:16px;z-index:3;color:#f6efe7;transition:opacity .25s ease,transform .25s ease}.tws-feed-cover-initial{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;font-weight:700;font-size:16px;background:#ffffff29;border:1px solid rgba(255,255,255,.2);box-shadow:0 8px 18px #00000059}.tws-feed-cover-meta{display:flex;flex-direction:column;gap:6px}.tws-feed-cover-meta span{font-size:11px;text-transform:uppercase;letter-spacing:.18em;color:#ffffffb3}.tws-feed-cover-meta strong{font-size:14px;font-weight:700;line-height:1.2;color:#fffaf2}.tws-feed-progress{height:6px;border-radius:999px;background:#ffffff14;overflow:hidden}.tws-feed-progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-strong))}.tws-feed-meta-line{font-size:11px;color:var(--fg-subtle);text-transform:uppercase;letter-spacing:.16em}.tws-feed-actions{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.tws-feed-react,.tws-feed-ghost{padding:6px 12px;border-radius:999px;border:1px solid var(--border);background:#ffffff0a;color:var(--fg-muted);font-size:12px;font-weight:600}.tws-feed-react.active{background:#7da3ff2e;border-color:#7da3ff73;color:var(--fg)}.tws-feed-ghost{background:transparent}.tws-feed-sentinel{text-align:center;font-size:12px;color:var(--fg-muted);padding:12px 0 4px}.tws-paywall-rail{display:flex;flex-direction:column;gap:16px;position:sticky;top:24px;min-height:calc(100vh - 64px);align-self:start}.tws-rail-card{padding:16px;border-radius:18px;background:#ffffff0a;border:1px solid var(--border);display:flex;flex-direction:column;gap:10px}.tws-rot-header{display:flex;align-items:center;justify-content:space-between;gap:12px}.tws-rot-toggle{padding:6px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:#ffffff0f;color:var(--fg-muted);font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.08em}.tws-rot-toggle.active{background:#d39a5f38;border-color:#d39a5f80;color:var(--fg)}.tws-rail-row{display:flex;align-items:center;justify-content:space-between;gap:12px}.tws-rail-label{font-size:12px;text-transform:uppercase;letter-spacing:.12em;color:var(--fg-muted)}.tws-proceed-dock{margin-top:auto}.tws-proceed-dock .tws-details{background:#ffffff04;border-color:#ffffff14}.tws-proceed-dock .tws-details summary{background:#ffffff05}.tws-proceed-dock .tws-details summary strong{font-size:13px}.tws-proceed-dock .tws-details summary span{font-size:11px}@keyframes tws-rise{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@media(max-width:1100px){.tws-paywall-shell{grid-template-columns:200px minmax(0,1fr)}.tws-paywall-rail{position:static;min-height:0}}@media(max-width:900px){.tws-paywall-shell{grid-template-columns:1fr;padding:20px 18px 32px}.tws-paywall-sidebar,.tws-paywall-rail{position:static}.tws-paywall-topbar{flex-direction:column;align-items:flex-start}.tws-feed-toggle{width:100%;justify-content:center}.tws-feed-card{grid-template-columns:1fr}}.tws-paywall-modal{width:min(860px,100%);margin:0 auto;min-height:100vh;padding:26px 18px 44px;border-radius:0;background:transparent;box-shadow:none;display:flex;flex-direction:column;gap:16px;position:relative;overflow:visible}.tws-paywall-header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;padding:18px;border-radius:18px;background:linear-gradient(140deg,#111113eb,#111113d1);box-shadow:inset 0 0 0 1px var(--border)}.tws-eyebrow{letter-spacing:.12em;text-transform:uppercase;color:var(--fg-muted);font-size:12px;margin:0 0 6px;font-weight:600}.tws-paywall-header h2{margin:0;font-size:24px;font-weight:700;color:var(--fg)}.tws-subtle{color:var(--fg-muted);margin:4px 0;font-size:14px;line-height:1.4}.tws-wallet-badge{display:flex;flex-direction:column;align-items:flex-end;background:var(--accent-soft);padding:8px 12px;border-radius:12px;border:1px solid rgba(200,149,108,.2)}.tws-wallet-badge span{font-size:11px;color:var(--fg-muted);text-transform:uppercase;letter-spacing:.05em}.tws-wallet-badge strong{color:var(--accent);font-size:16px}.tws-paywall-body{display:flex;flex-direction:column;gap:14px}.tws-paywall-option{background:#ffffff09;border:1px solid var(--border);border-radius:16px;padding:16px;transition:transform .2s ease,border-color .2s ease}.tws-paywall-option:hover{border-color:var(--border-strong)}.tws-option-header{margin-bottom:16px}.tws-option-header h3{margin:0 0 4px;font-size:18px;font-weight:600;color:var(--fg)}.tws-option-action{display:flex;align-items:center;justify-content:space-between;gap:16px}.tws-price-tag{display:flex;flex-direction:column}.tws-price-tag strong{font-size:24px;color:var(--accent);line-height:1}.tws-price-tag small{color:var(--fg-muted);font-size:12px}.tws-divider{display:flex;align-items:center;justify-content:center;position:relative;height:20px}.tws-divider:before{content:"";position:absolute;left:0;right:0;height:1px;background:#ffffff1a}.tws-divider span{background:var(--bg-base);padding:0 12px;color:var(--fg-muted);font-size:12px;font-weight:600;z-index:1;text-transform:uppercase}.tws-slider-container{margin-bottom:16px}.tws-slider-labels{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;font-size:14px}.tws-subtle-info{color:var(--fg-muted);font-size:12px;font-weight:500}.tws-slider-labels strong{color:var(--accent)}input[type=range]{width:100%;height:6px;background:#ffffff1a;border-radius:3px;outline:none;-webkit-appearance:none;appearance:none}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 0 10px #89f3d266;transition:transform .1s}input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.1)}.tws-slider-scale{display:flex;justify-content:space-between;margin-top:8px;color:var(--fg-muted);font-size:11px}button{padding:12px 20px;border-radius:12px;border:none;font-weight:600;cursor:pointer;font-size:14px;transition:all .2s;white-space:normal}.tws-primary{background:var(--accent);color:#0a0a0b;width:100%}.tws-primary:hover:not(:disabled){background:#daa06d}.tws-secondary{background:#ffffff14;color:var(--fg);border:1px solid rgba(255,255,255,.08)}.tws-secondary:hover:not(:disabled){background:#ffffff1c}button:disabled{opacity:.5;cursor:not-allowed;transform:none}.tws-error-text{color:var(--danger);font-size:12px;margin-top:8px;text-align:center}.tws-emergency-link{margin-top:16px;text-align:center}.tws-emergency-link button{background:none;border:none;color:var(--fg-muted);font-size:12px;text-decoration:underline;cursor:pointer;padding:4px;opacity:.6}.tws-emergency-link button:hover{opacity:1;color:var(--fg)}.tws-emergency-form{display:flex;flex-direction:column;gap:16px}.tws-emergency-form textarea{background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;color:var(--fg);font-family:inherit;font-size:14px;resize:vertical;min-height:80px}.tws-emergency-form textarea:focus{outline:none;border-color:var(--accent)}.tws-emergency-actions{display:flex;gap:12px}.tws-emergency-actions button{flex:1}.tws-attractors-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}.tws-link{background:none;border:none;color:var(--fg-muted);font-size:12px;text-decoration:underline;cursor:pointer;padding:4px;opacity:.85}.tws-link:hover:not(:disabled){opacity:1;color:var(--fg)}.tws-attractors-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}.tws-attractor-card{text-align:left;padding:0;border-radius:14px;background:#ffffff08;border:1px solid var(--border);display:flex;flex-direction:column;gap:10px;overflow:hidden;cursor:pointer}.tws-attractor-card:hover:not(:disabled):not([aria-disabled=true]){border-color:var(--border-strong)}.tws-attractor-card:disabled,.tws-attractor-card[aria-disabled=true]{opacity:.6;cursor:not-allowed}.tws-attractor-card:focus-visible{outline:2px solid rgba(200,149,108,.55);outline-offset:2px}.tws-attractors{border-color:#c8956c38;background:linear-gradient(180deg,#c8956c14,#ffffff08)}.tws-library-shelf{border-color:#7eb88c47;background:linear-gradient(180deg,#7eb88c14,#ffffff08)}.tws-library-scroll{display:flex;flex-direction:column;gap:10px;max-height:240px;overflow-y:auto;padding-right:6px}.tws-library-item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#ffffff08}.tws-library-info{display:flex;align-items:center;gap:10px;min-width:0}.tws-library-favicon{width:32px;height:32px;border-radius:8px;object-fit:cover;background:#ffffff0f;flex-shrink:0}.tws-library-favicon-placeholder{background:#ffffff14}.tws-library-meta{display:flex;flex-direction:column;gap:2px;min-width:0}.tws-library-meta strong{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.tws-library-meta span{font-size:12px;color:var(--fg-muted);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.tws-library-actions{display:flex;align-items:center;gap:8px;flex-shrink:0;flex-wrap:wrap}.tws-library-actions .tws-secondary{padding:6px 10px;font-size:12px}.tws-library-actions .tws-link{font-size:12px}.tws-details{border-radius:16px;border:1px solid var(--border);background:#ffffff05;overflow:hidden}.tws-details summary{list-style:none;cursor:pointer;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;background:#ffffff08}.tws-details summary::-webkit-details-marker{display:none}.tws-details summary strong{font-size:14px}.tws-details summary span{font-size:12px;color:var(--fg-muted)}.tws-details-body{padding:14px 16px 16px;display:flex;flex-direction:column;gap:14px}.tws-attractor-card strong{font-size:14px;font-weight:700}.tws-attractor-card span{font-size:12px;color:var(--fg-muted)}.tws-attractor-thumb{position:relative;width:100%;aspect-ratio:16 / 9;background:#ffffff05}.tws-card-menu-trigger{position:absolute;top:10px;right:10px;width:32px;height:32px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0a0a0b94;color:#ffffffd1;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;line-height:1;box-shadow:0 10px 22px #00000059,inset 0 0 0 1px #ffffff0d}.tws-card-menu-trigger:disabled{opacity:.6;cursor:not-allowed}.tws-card-menu{position:absolute;top:48px;right:10px;min-width:170px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#101012eb;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);box-shadow:0 18px 36px #00000073;padding:6px;z-index:2}.tws-card-menu-item{width:100%;text-align:left;border:none;background:transparent;color:var(--fg);padding:10px;border-radius:10px;cursor:pointer;font-size:13px}.tws-card-menu-item:hover:not(:disabled){background:#ffffff0f}.tws-card-menu-item:disabled{opacity:.6;cursor:not-allowed}.tws-attractor-thumb-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:saturate(.95) contrast(.98) brightness(.92)}.tws-progress-bar{position:absolute;left:0;right:0;bottom:0;height:8px;background:#0a0a0b99;box-shadow:inset 0 1px #ffffff14;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}.tws-progress-fill{height:100%;width:0;background:linear-gradient(90deg,#c8956ceb,#f4d0aae0);box-shadow:0 0 16px #c8956c40;transition:width .22s ease}.tws-attractor-thumb-placeholder{position:absolute;inset:0;background:radial-gradient(120px 80px at 20% 30%,rgba(200,149,108,.22),transparent 55%),radial-gradient(140px 90px at 80% 35%,rgba(200,149,108,.12),transparent 60%),linear-gradient(160deg,#ffffff0d,#0000)}.tws-attractor-thumb-app{background:radial-gradient(120px 80px at 20% 30%,rgba(200,149,108,.16),transparent 55%),radial-gradient(140px 90px at 80% 35%,rgba(255,255,255,.06),transparent 60%),linear-gradient(160deg,#ffffff0d,#0000)}.tws-attractor-thumb-ritual{background:radial-gradient(120px 80px at 20% 30%,rgba(106,169,255,.12),transparent 55%),radial-gradient(140px 90px at 80% 35%,rgba(200,149,108,.14),transparent 60%),linear-gradient(160deg,#ffffff0d,#0000)}.tws-attractor-favicon{position:absolute;left:10px;bottom:10px;width:28px;height:28px;border-radius:8px;background:#0a0a0bc7;box-shadow:0 8px 18px #00000059,inset 0 0 0 1px #ffffff14;padding:6px}.tws-attractor-app-badge{position:absolute;left:10px;bottom:10px;display:inline-flex;align-items:center;justify-content:center;padding:7px 10px;border-radius:999px;background:#0a0a0bb8;box-shadow:0 8px 18px #00000059,inset 0 0 0 1px #ffffff14;font-size:12px;font-weight:600;color:var(--fg)}.tws-attractor-meta{padding:12px 12px 14px;display:flex;flex-direction:column;gap:6px}.tws-attractor-meta strong{font-size:14px;font-weight:700;line-height:1.2;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.tws-attractor-meta span{font-size:12px;color:var(--fg-muted);line-height:1.3;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.tws-attractor-meta small{font-size:11px;color:#ffffff6b;letter-spacing:.02em;text-transform:none}.tws-ritual-timer{font-variant-numeric:tabular-nums;font-size:52px;font-weight:700;text-align:center;padding:16px 10px;border-radius:14px;background:#ffffff06;border:1px solid rgba(255,255,255,.06);box-shadow:inset 0 1px #ffffff0a}.tws-price-pill{position:absolute;right:10px;bottom:10px;display:inline-flex;align-items:baseline;gap:4px;padding:6px 10px;border-radius:999px;background:#0a0a0bb8;box-shadow:0 8px 18px #00000059,inset 0 0 0 1px #ffffff14;font-size:13px;font-weight:700;color:var(--accent)}.tws-price-pill span{font-size:10px;color:var(--fg-muted);font-weight:500}@media(max-width:520px){.tws-paywall-modal{padding:18px 14px 36px}.tws-paywall-header{padding:16px 14px}.tws-option-action{flex-direction:column;align-items:stretch}.tws-price-tag{align-items:flex-start}.tws-attractors-grid{grid-template-columns:1fr}.tws-feed-header{flex-direction:column;align-items:flex-start}.tws-feed-thumb{height:150px}}',kt=1e4;let Fe=null;function ce(){document.visibilityState==="visible"&&document.hasFocus()&&chrome.runtime.sendMessage({type:"PAGE_HEARTBEAT",payload:{url:window.location.href,title:document.title}}).catch(()=>{})}function jt(){Fe==null&&(Fe=window.setInterval(ce,kt),ce())}jt();document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&ce()});chrome.runtime.onMessage.addListener((l,a,c)=>{if(l.type==="TWS_PING"){c?.({ok:!0});return}return l.type==="BLOCK_SCREEN"&&Nt(l.payload.domain,l.payload.reason,l.payload.peek),!0});async function Nt(l,a,c){const f=document.getElementById("tws-shadow-host");f&&f.remove();const p=document.createElement("div");p.id="tws-shadow-host",p.style.position="fixed",p.style.zIndex="2147483647",p.style.inset="0",p.style.width="100%",p.style.height="100%",p.style.background="#05060a",document.body.appendChild(p);const b=p.attachShadow({mode:"open"}),m=document.createElement("style");m.textContent=vt,b.appendChild(m);const d=document.createElement("div");d.id="tws-mount-point",b.appendChild(d),document.body.style.overflow="hidden";const h=await chrome.runtime.sendMessage({type:"GET_STATUS",payload:{domain:l,url:window.location.href}});ut.createRoot(d).render(t.jsx(yt,{domain:l,status:h,reason:a,peek:c,onClose:()=>{p.remove(),document.body.style.overflow=""}}))}
