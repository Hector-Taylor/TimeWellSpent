import{r as p,j as e,c as we}from"../assets/client.js";function be(l){return Number.isInteger(l)?l.toString():l.toFixed(2).replace(/\.?0+$/,"")}function ye(l,s,d){if(!l.length||s<=0)return[];const n=l.slice();let f=(d+1)*1103515245;const h=()=>(f=f*1103515245+12345>>>0,f/4294967295);for(let i=n.length-1;i>0;i-=1){const u=Math.floor(h()*(i+1));[n[i],n[u]]=[n[u],n[i]]}return n.slice(0,Math.min(s,n.length))}function ve(l){const s=Math.max(0,Math.floor(l)),d=Math.floor(s/60),n=s%60;return`${d}:${n.toString().padStart(2,"0")}`}function je(){try{const l=window.AudioContext||window.webkitAudioContext;if(!l)return;const s=new l,d=s.currentTime,n=s.createGain();n.gain.setValueAtTime(1e-4,d),n.gain.exponentialRampToValueAtTime(.18,d+.02),n.gain.exponentialRampToValueAtTime(1e-4,d+1.2),n.connect(s.destination);const f=s.createOscillator();f.type="sine",f.frequency.setValueAtTime(528,d),f.connect(n);const h=s.createOscillator();h.type="sine",h.frequency.setValueAtTime(792,d),h.connect(n),f.start(d),h.start(d),f.stop(d+1.2),h.stop(d+1.2),s.close().catch(()=>{})}catch{}}function ke({domain:l,status:s,reason:d,onClose:n}){const[f,h]=p.useState(15),[i,u]=p.useState(!1),[q,L]=p.useState(!1),[M,ne]=p.useState(""),[k,x]=p.useState(null),[ie,K]=p.useState(!1),[G,C]=p.useState(0),[Y,oe]=p.useState(d==="insufficient-funds"),[le,ce]=p.useState({}),[V,I]=p.useState(null),[W,de]=p.useState({}),[j,A]=p.useState(null),[pe,O]=p.useState(0),[P,S]=p.useState(!1),[_,z]=p.useState(!1),H=s.rate?.ratePerMin??s.session?.ratePerMin??1,B=s.emergencyPolicy??"balanced",b=p.useMemo(()=>{switch(B){case"off":return{id:"off",label:"Off",minutes:0,tokensPerDay:0,cooldownMinutes:0,urlLocked:!0,debtCoins:0};case"gentle":return{id:"gentle",label:"Gentle",minutes:5,tokensPerDay:null,cooldownMinutes:0,urlLocked:!0,debtCoins:0};case"strict":return{id:"strict",label:"Strict",minutes:2,tokensPerDay:1,cooldownMinutes:60,urlLocked:!0,debtCoins:15};case"balanced":default:return{id:"balanced",label:"Balanced",minutes:3,tokensPerDay:2,cooldownMinutes:30,urlLocked:!0,debtCoins:8}}},[B]),Z=t=>`chrome://favicon2/?size=64&url=${encodeURIComponent(t)}`,F=t=>{try{const r=new URL(t);return r.hash="",le[r.toString()]??null}catch{return null}},J=p.useMemo(()=>{const t=[],r=s.library?.replaceItems??[];for(const a of r)if(a)if(a.kind==="url"){if(!a.url||a.domain===l)continue;t.push({type:"url",id:`lib:${a.id}`,libraryId:a.id,title:a.title??a.domain,subtitle:a.note?a.note:"your replace pool",url:a.url})}else t.push({type:"app",id:`lib:${a.id}`,title:a.title??a.app??"Open app",subtitle:a.note?a.note:"your replace pool",app:a.app??"",requiresDesktop:!0});const o=s.library?.readingItems??[];for(const a of o)!a||!a.id||!a.action||t.push({type:"desktop",id:`reading:${a.id}`,source:a.source,readingId:a.id,title:a.title??(a.source==="zotero"?"Zotero":"Books"),subtitle:a.subtitle?a.subtitle:a.source==="zotero"?"Zotero • curated reading":"Books • recent",action:a.action,thumbDataUrl:a.thumbDataUrl,iconDataUrl:a.iconDataUrl,progress:a.progress,requiresDesktop:!0});const c=s.library?.productiveDomains??[];for(const a of c){const N=(a??"").trim();!N||!N.includes(".")||N===l||t.push({type:"url",id:`prod:${N}`,title:N,subtitle:"productive",url:`https://${N}`})}t.push({type:"app",id:"app:Books",title:"Open Books",subtitle:"read something long-form",app:"Books",requiresDesktop:!0}),t.push({type:"app",id:"app:Zotero",title:"Open Zotero",subtitle:"pick a paper instead",app:"Zotero",requiresDesktop:!0}),t.push({type:"ritual",id:"ritual:meditation",ritual:"meditation",title:"Meditation",subtitle:"3-minute reset",minutes:3});const g=s.journal?.url??null,y=s.journal?.minutes??10;g&&t.push({type:"ritual",id:"ritual:journal",ritual:"journal",title:`${y}m journal`,subtitle:"write a few lines instead",minutes:y,url:g});const U=new Set;return t.filter(a=>!(U.has(a.id)||(U.add(a.id),W[a.id])))},[W,l,s.library?.productiveDomains,s.library?.replaceItems,s.library?.readingItems]),D=p.useMemo(()=>ye(J,3,G),[J,G]);p.useEffect(()=>{const t=D.filter(c=>c.type==="url").map(c=>c.url),r=s.matchedPricedItem?.kind==="url"?s.matchedPricedItem.url:void 0;r&&t.push(r);const o=[...new Set(t)];o.length&&chrome.runtime.sendMessage({type:"GET_LINK_PREVIEWS",payload:{urls:o}}).then(c=>{!c?.success||!c.previews||ce(g=>({...g,...c.previews}))}).catch(()=>{})},[D,s.matchedPricedItem?.url]);const v=async t=>{if(!(!t||i)){I(null),u(!0),x(null);try{if(t.type==="ritual"){if(t.ritual==="meditation"){A({kind:"meditation",minutes:t.minutes}),O(t.minutes*60),S(!1),z(!1);return}if(t.ritual==="journal"&&t.url){const o=await chrome.runtime.sendMessage({type:"OPEN_URL",payload:{url:t.url,roulette:{title:t.title}}});if(!o?.success)throw new Error(o?.error?String(o.error):"Failed to open journal");n();return}return}if(t.type==="url"){const c=F(t.url)?.title??t.title,g=await chrome.runtime.sendMessage({type:"OPEN_URL",payload:{url:t.url,roulette:{title:c,libraryId:t.libraryId}}});if(!g?.success)throw new Error(g?.error?String(g.error):"Failed to open URL");n();return}if(t.type==="desktop"){if(t.requiresDesktop&&!s.desktopConnected)throw new Error("Desktop app required for this action");const o=await chrome.runtime.sendMessage({type:"OPEN_DESKTOP_ACTION",payload:t.action});if(!o?.success)throw new Error(o?.error?String(o.error):"Failed to open in desktop app");n();return}if(t.requiresDesktop&&!s.desktopConnected)throw new Error("Desktop app required for this action");const r=await chrome.runtime.sendMessage({type:"OPEN_APP",payload:{app:t.app}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to open app");n()}catch(r){x(r.message)}finally{u(!1)}}},Q=async t=>{if(!i){u(!0),x(null);try{if(t.type==="url"&&typeof t.libraryId=="number"){const r=await chrome.runtime.sendMessage({type:"MARK_LIBRARY_CONSUMED",payload:{id:t.libraryId,consumed:!0}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to mark consumed")}else if(t.type==="desktop"&&t.readingId){const r=await chrome.runtime.sendMessage({type:"MARK_READING_CONSUMED",payload:{id:t.readingId,consumed:!0}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to mark consumed")}else return;de(r=>({...r,[t.id]:!0})),I(null),C(r=>r+1)}catch(r){x(r.message)}finally{u(!1)}}},w=p.useMemo(()=>[...s.rate?.packs??[]].sort((t,r)=>t.minutes-r.minutes),[s.rate?.packs]),E=p.useMemo(()=>w.length?{min:w[0].minutes,max:w[w.length-1].minutes,step:1}:{min:5,max:120,step:5},[w]);p.useEffect(()=>{w.length?h(w[0].minutes):h(15)},[l,w]);const ue=t=>w.length?w.reduce((r,o)=>{const c=Math.abs(o.minutes-t),g=Math.abs(r-t);return c<g?o.minutes:r},w[0].minutes):t,X=w.find(t=>t.minutes===f),R=X?X.price:Math.max(1,Math.round(f*H)),ee=s.balance>=R,fe=async()=>{if(!i){u(!0),x(null);try{const t=await chrome.runtime.sendMessage({type:"BUY_PACK",payload:{domain:l,minutes:f}});if(!t?.success)throw new Error(t?.error?String(t.error):"Failed to start session");n()}catch(t){x(t.message)}finally{u(!1)}}},me=async()=>{if(!i){u(!0),x(null);try{const t=await chrome.runtime.sendMessage({type:"START_METERED",payload:{domain:l}});if(!t?.success)throw new Error(t?.error?String(t.error):"Failed to start metered");n()}catch(t){x(t.message)}finally{u(!1)}}},he=async()=>{const t=s.matchedPricedItem;if(!(i||!t||typeof t.price!="number")){u(!0),x(null);try{const r=await chrome.runtime.sendMessage({type:"START_STORE_SESSION",payload:{domain:l,price:t.price,url:window.location.href}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to unlock");n()}catch(r){x(r.message)}finally{u(!1)}}},xe=async()=>{if(!(i||!M.trim())){u(!0),x(null);try{const t=await chrome.runtime.sendMessage({type:"START_EMERGENCY",payload:{domain:l,justification:M,url:window.location.href}});if(!t?.success)throw new Error(t?.error?String(t.error):"Failed to start emergency");n()}catch(t){x(t.message)}finally{u(!1)}}},te=async t=>{if(!i){u(!0),x(null);try{const r=await chrome.runtime.sendMessage({type:"EMERGENCY_REVIEW",payload:{outcome:t,domain:l}});if(!r?.success)throw new Error(r?.error?String(r.error):"Failed to record review");K(!0)}catch(r){x(r.message)}finally{u(!1)}}},ge=d==="url-locked"?"This pass is locked to a specific page":d==="insufficient-funds"?"Insufficient f-coins":s.session?.paused?"Session paused":"Choose what this tab becomes";if(p.useEffect(()=>{if(!j||!P)return;const t=window.setInterval(()=>{O(r=>r<=1?(window.clearInterval(t),S(!1),z(!0),je(),0):r-1)},1e3);return()=>window.clearInterval(t)},[j,P]),j)return e.jsx("div",{className:"tws-paywall-overlay",children:e.jsxs("div",{className:"tws-paywall-modal",children:[e.jsxs("header",{className:"tws-paywall-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),e.jsx("h2",{children:j.kind==="meditation"?"Meditation":"Ritual"}),e.jsx("p",{className:"tws-subtle",children:"A small reset helps you exit the attractor. Keep it simple: breathe, notice, return."})]}),e.jsxs("div",{className:"tws-wallet-badge",children:[e.jsx("span",{children:"Balance"}),e.jsxs("strong",{children:[s.balance," f-coins"]})]})]}),e.jsxs("div",{className:"tws-paywall-body",children:[k&&e.jsx("p",{className:"tws-error-text",children:k}),e.jsxs("section",{className:"tws-paywall-option",children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:j.kind==="meditation"?`${j.minutes} minute timer`:"Timer"}),e.jsx("p",{className:"tws-subtle",style:{margin:0},children:_?"Complete.":P?"In progress.":"Ready when you are."})]}),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{className:"tws-ritual-timer",children:ve(pe)}),e.jsxs("div",{className:"tws-emergency-actions",children:[e.jsx("button",{className:"tws-secondary",onClick:()=>{A(null),S(!1),z(!1),C(t=>t+1)},disabled:i,children:"Back"}),_?e.jsx("button",{className:"tws-primary",onClick:()=>{A(null),C(t=>t+1)},disabled:i,children:"Pick next"}):e.jsx("button",{className:"tws-primary",onClick:()=>S(t=>!t),disabled:i,children:P?"Pause":"Start"}),!_&&e.jsx("button",{className:"tws-secondary",onClick:()=>{S(!1),O(j.minutes*60),z(!1)},disabled:i,children:"Reset"})]})]})]})]})]})});if(q)return e.jsx("div",{className:"tws-paywall-overlay",children:e.jsxs("div",{className:"tws-paywall-modal",children:[e.jsxs("header",{className:"tws-paywall-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),e.jsx("h2",{children:"I need it"}),e.jsx("p",{className:"tws-subtle",children:"Emergency access is a safety hatch. Use it when you have a real purpose — not when you want a dopamine hit."})]}),e.jsxs("div",{className:"tws-wallet-badge",children:[e.jsx("span",{children:"Balance"}),e.jsxs("strong",{children:[s.balance," f-coins"]})]})]}),e.jsxs("div",{className:"tws-paywall-body",children:[k&&e.jsx("p",{className:"tws-error-text",children:k}),e.jsxs("div",{className:"tws-emergency-form",children:[e.jsxs("p",{className:"tws-subtle",style:{marginTop:0},children:["Policy: ",e.jsx("strong",{children:b.label}),b.id!=="off"&&e.jsxs(e.Fragment,{children:[" ","• ",b.minutes,"m window",typeof b.tokensPerDay=="number"?` • ${b.tokensPerDay}/day`:" • unlimited/day",b.cooldownMinutes>0?` • ${b.cooldownMinutes}m cooldown`:"",b.debtCoins>0?` • ${b.debtCoins} coin debt`:""]})]}),e.jsx("textarea",{placeholder:"I need to…",value:M,onChange:t=>ne(t.target.value),autoFocus:!0}),e.jsxs("div",{className:"tws-emergency-actions",children:[e.jsx("button",{className:"tws-secondary",onClick:()=>L(!1),disabled:i,children:"Back"}),e.jsxs("button",{className:"tws-primary",onClick:xe,disabled:!M.trim()||i,children:["Start emergency (",b.minutes,"m)"]})]})]})]})]})});const m=s.matchedPricedItem&&typeof s.matchedPricedItem.price=="number"?s.matchedPricedItem:null,T=m?.kind==="url"&&m.url?F(m.url):null,re=T?.imageUrl??null,se=m?.kind==="url"&&m.url?T?.iconUrl??Z(m.url):null;return e.jsx("div",{className:"tws-paywall-overlay",children:e.jsxs("div",{className:"tws-paywall-modal",children:[e.jsxs("header",{className:"tws-paywall-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"tws-eyebrow",children:"TimeWellSpent"}),e.jsx("h2",{children:l}),e.jsx("p",{className:"tws-subtle",children:ge})]}),e.jsxs("div",{className:"tws-wallet-badge",children:[e.jsx("span",{children:"Balance"}),e.jsxs("strong",{children:[s.balance," f-coins"]})]})]}),e.jsxs("div",{className:"tws-paywall-body",children:[k&&e.jsx("p",{className:"tws-error-text",style:{marginBottom:0},children:k}),d==="emergency-expired"&&!ie&&e.jsxs("section",{className:"tws-paywall-option",style:{borderColor:"#d07f00"},children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:"Emergency ended"}),e.jsxs("p",{className:"tws-subtle",children:["Quick check-in: did you do the thing you came for?",s.emergency?.lastEnded?.domain===l&&s.emergency.lastEnded.justification?` (“${s.emergency.lastEnded.justification}”)`:""]})]}),e.jsxs("div",{className:"tws-option-action",children:[e.jsx("button",{className:"tws-secondary",disabled:i,onClick:()=>te("not-kept"),children:"Not really"}),e.jsx("button",{className:"tws-primary",disabled:i,onClick:()=>te("kept"),children:"Yes"})]})]}),e.jsxs("section",{className:"tws-paywall-option tws-attractors",children:[e.jsxs("div",{className:"tws-option-header tws-attractors-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Try this instead"}),e.jsx("p",{className:"tws-subtle",children:"You’re not here because this site is irresistible. You’re here because something else mattered — pick it."})]}),e.jsx("button",{className:"tws-link",type:"button",disabled:i,onClick:()=>C(t=>t+1),children:"Spin"})]}),D.length===0?e.jsx("p",{className:"tws-subtle",style:{margin:0},children:"Your Replace pool is empty. Save a few links with right-click → “Save to TimeWellSpent” → “Replace”."}):e.jsx("div",{className:"tws-attractors-grid",children:D.map(t=>{const r=i||t.type==="desktop"&&t.requiresDesktop&&!s.desktopConnected||t.type==="app"&&t.requiresDesktop&&!s.desktopConnected;if(t.type==="url"){const o=F(t.url),c=o?.imageUrl??null,g=o?.iconUrl??Z(t.url);return e.jsxs("div",{className:"tws-attractor-card",onClick:()=>{r||v(t)},role:"button",tabIndex:r?-1:0,"aria-disabled":r,onKeyDown:y=>{r||(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),v(t))},children:[e.jsxs("div",{className:"tws-attractor-thumb",children:[c?e.jsx("img",{className:"tws-attractor-thumb-img",src:c,alt:"",loading:"lazy"}):e.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),typeof t.libraryId=="number"&&e.jsx("button",{type:"button",className:"tws-card-menu-trigger","aria-label":"More",disabled:i,onClick:y=>{y.stopPropagation(),I(U=>U===t.id?null:t.id)},children:"⋯"}),V===t.id&&typeof t.libraryId=="number"&&e.jsx("div",{className:"tws-card-menu",role:"menu",onClick:y=>y.stopPropagation(),children:e.jsx("button",{type:"button",className:"tws-card-menu-item",disabled:i,onClick:()=>Q(t),children:"Already consumed"})}),e.jsx("img",{className:"tws-attractor-favicon",src:g,alt:"",loading:"lazy"})]}),e.jsxs("div",{className:"tws-attractor-meta",children:[e.jsx("strong",{children:o?.title??t.title}),e.jsx("span",{children:o?.description??t.subtitle??"saved in your replace pool"}),e.jsx("small",{children:new URL(t.url).hostname.replace(/^www\\./,"")})]})]},t.id)}if(t.type==="desktop"){const o=t.source==="zotero"&&typeof t.progress=="number"?Math.round(Math.max(0,Math.min(1,t.progress))*100):null;return e.jsxs("div",{className:"tws-attractor-card",onClick:()=>{r||v(t)},title:t.requiresDesktop&&!s.desktopConnected?"Requires desktop app":void 0,role:"button",tabIndex:r?-1:0,"aria-disabled":r,onKeyDown:c=>{r||(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),v(t))},children:[e.jsxs("div",{className:"tws-attractor-thumb",children:[t.thumbDataUrl?e.jsx("img",{className:"tws-attractor-thumb-img",src:t.thumbDataUrl,alt:"",loading:"lazy"}):e.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),o!==null&&e.jsx("div",{className:"tws-progress-bar","aria-hidden":"true",children:e.jsx("div",{className:"tws-progress-fill",style:{width:`${o}%`}})}),e.jsx("button",{type:"button",className:"tws-card-menu-trigger","aria-label":"More",disabled:i,onClick:c=>{c.stopPropagation(),I(g=>g===t.id?null:t.id)},children:"⋯"}),V===t.id&&e.jsx("div",{className:"tws-card-menu",role:"menu",onClick:c=>c.stopPropagation(),children:e.jsx("button",{type:"button",className:"tws-card-menu-item",disabled:i,onClick:()=>Q(t),children:"Already consumed"})}),t.iconDataUrl?e.jsx("img",{className:"tws-attractor-favicon",src:t.iconDataUrl,alt:"",loading:"lazy"}):e.jsx("div",{className:"tws-attractor-favicon","aria-hidden":"true"})]}),e.jsxs("div",{className:"tws-attractor-meta",children:[e.jsx("strong",{children:t.title}),e.jsx("span",{children:t.subtitle??"reading suggestion"}),e.jsx("small",{children:"desktop"})]})]},t.id)}return t.type==="ritual"?e.jsxs("div",{className:"tws-attractor-card",onClick:()=>{r||v(t)},role:"button",tabIndex:r?-1:0,"aria-disabled":r,onKeyDown:o=>{r||(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),v(t))},children:[e.jsxs("div",{className:"tws-attractor-thumb tws-attractor-thumb-ritual",children:[e.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),e.jsx("div",{className:"tws-attractor-app-badge",children:"Ritual"})]}),e.jsxs("div",{className:"tws-attractor-meta",children:[e.jsx("strong",{children:t.title}),e.jsx("span",{children:t.subtitle??"a small reset"}),e.jsx("small",{children:t.ritual==="meditation"?`${t.minutes}m`:"journal"})]})]},t.id):e.jsxs("div",{className:"tws-attractor-card",onClick:()=>{r||v(t)},title:t.requiresDesktop&&!s.desktopConnected?"Requires desktop app":void 0,role:"button",tabIndex:r?-1:0,"aria-disabled":r,onKeyDown:o=>{r||(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),v(t))},children:[e.jsxs("div",{className:"tws-attractor-thumb tws-attractor-thumb-app",children:[e.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),e.jsx("div",{className:"tws-attractor-app-badge",children:"App"})]}),e.jsxs("div",{className:"tws-attractor-meta",children:[e.jsx("strong",{children:t.title}),e.jsx("span",{children:t.subtitle??"open an app"}),e.jsx("small",{children:"desktop"})]})]},t.id)})})]}),e.jsxs("details",{className:"tws-details",open:Y,onToggle:t=>oe(t.target.open),children:[e.jsxs("summary",{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("strong",{children:"Proceed anyway"}),e.jsx("span",{children:"Timebox recommended • metered and emergency are intentionally harder."})]}),e.jsx("span",{children:Y?"−":"+"})]}),e.jsxs("div",{className:"tws-details-body",children:[m&&e.jsxs("section",{className:"tws-paywall-option",style:{margin:0},children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:"Unlock your saved item"}),e.jsx("p",{className:"tws-subtle",children:"Pay once for this exact page, then leave when you’re done."})]}),m.url&&e.jsx("div",{className:"tws-attractors-grid",style:{gridTemplateColumns:"1fr",marginBottom:12},children:e.jsxs("button",{type:"button",className:"tws-attractor-card",disabled:!0,style:{cursor:"default"},children:[e.jsxs("div",{className:"tws-attractor-thumb",children:[re?e.jsx("img",{className:"tws-attractor-thumb-img",src:re,alt:"",loading:"lazy"}):e.jsx("div",{className:"tws-attractor-thumb-placeholder","aria-hidden":"true"}),se&&e.jsx("img",{className:"tws-attractor-favicon",src:se,alt:"",loading:"lazy"}),e.jsxs("div",{className:"tws-price-pill",children:[m.price,e.jsx("span",{children:"f-coins"})]})]}),e.jsxs("div",{className:"tws-attractor-meta",children:[e.jsx("strong",{children:T?.title??m.title??m.domain}),e.jsx("span",{children:T?.description??"Saved one-time unlock"}),e.jsx("small",{children:m.domain})]})]})}),e.jsxs("div",{className:"tws-option-action",children:[e.jsxs("div",{className:"tws-price-tag",children:[e.jsx("strong",{children:m.price}),e.jsx("small",{children:"f-coins"})]}),e.jsx("button",{className:"tws-primary",onClick:he,disabled:i||s.balance<m.price,children:"Unlock now"})]}),s.balance<m.price&&e.jsxs("p",{className:"tws-error-text",style:{marginTop:8},children:["Need ",m.price-s.balance," more f-coins"]})]}),e.jsxs("section",{className:"tws-paywall-option",style:{margin:0},children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:"Timeboxed session (recommended)"}),e.jsx("p",{className:"tws-subtle",children:"Commit to a fixed time and leave when it ends."})]}),e.jsxs("div",{className:"tws-slider-container",children:[e.jsxs("div",{className:"tws-slider-labels",children:[e.jsxs("span",{children:[f," minutes"]}),e.jsx("span",{className:"tws-subtle-info",children:"timebox"}),e.jsxs("strong",{children:[R," f-coins"]})]}),e.jsx("input",{type:"range",min:E.min,max:E.max,step:E.step,value:f,onChange:t=>h(ue(Number(t.target.value)))}),e.jsxs("div",{className:"tws-slider-scale",children:[e.jsxs("small",{children:[E.min,"m"]}),e.jsxs("small",{children:[E.max,"m"]})]})]}),e.jsxs("div",{className:"tws-option-action",children:[e.jsxs("button",{className:"tws-primary",onClick:fe,disabled:!ee||i,children:["Proceed for ",R," f-coins"]}),!ee&&e.jsxs("p",{className:"tws-error-text",children:["Need ",R-s.balance," more f-coins"]})]})]}),e.jsxs("section",{className:"tws-paywall-option",style:{margin:0},children:[e.jsxs("div",{className:"tws-option-header",children:[e.jsx("h3",{children:"Metered"}),e.jsx("p",{className:"tws-subtle",children:"Charges continuously while you stay. Use only if you trust yourself."})]}),e.jsxs("div",{className:"tws-option-action",children:[e.jsxs("div",{className:"tws-price-tag",children:[e.jsx("strong",{children:be(H)}),e.jsx("small",{children:"f-coins / min"})]}),e.jsx("button",{className:"tws-secondary",onClick:me,disabled:s.balance<1||i,children:"Proceed metered"})]})]}),e.jsx("div",{className:"tws-emergency-link",children:B==="off"?e.jsx("button",{disabled:!0,title:"Emergency access is disabled in Settings.",children:"Emergency disabled"}):e.jsx("button",{onClick:()=>{K(!1),L(!0)},children:"I need it (Emergency)"})})]})]})]})]})})}const Ne=':host{all:initial;font-family:Inter,-apple-system,BlinkMacSystemFont,system-ui,Segoe UI,sans-serif}.tws-paywall-overlay{--bg-base: #0a0a0b;--bg-raised: #111113;--bg-elevated: #1f1f23;--fg: #e8e4df;--fg-muted: #8a8680;--fg-subtle: #5c5955;--accent: #c8956c;--accent-soft: rgba(200, 149, 108, .15);--danger: #c77171;--border: rgba(255, 255, 255, .06);--border-strong: rgba(255, 255, 255, .12);position:fixed;inset:0;background:radial-gradient(ellipse 80% 50% at 50% -20%,rgba(200,149,108,.08),transparent),var(--bg-base);display:block;z-index:2147483647;color:var(--fg);line-height:1.5;overflow-y:auto;overscroll-behavior:contain;-webkit-overflow-scrolling:touch}.tws-paywall-overlay *{box-sizing:border-box}.tws-paywall-overlay:before{content:"";position:fixed;inset:0;pointer-events:none;background-image:linear-gradient(rgba(255,255,255,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.015) 1px,transparent 1px);background-size:60px 60px;z-index:-1}h1,h2,h3,h4,h5,h6,p,span,div,a,button,input{color:inherit;font-family:inherit}.tws-paywall-modal{width:min(860px,100%);margin:0 auto;min-height:100vh;padding:26px 18px 44px;border-radius:0;background:transparent;box-shadow:none;display:flex;flex-direction:column;gap:16px;position:relative;overflow:visible}.tws-paywall-header{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;padding:18px;border-radius:18px;background:linear-gradient(140deg,#111113eb,#111113d1);box-shadow:inset 0 0 0 1px var(--border)}.tws-eyebrow{letter-spacing:.12em;text-transform:uppercase;color:var(--fg-muted);font-size:12px;margin:0 0 6px;font-weight:600}.tws-paywall-header h2{margin:0;font-size:24px;font-weight:700;color:var(--fg)}.tws-subtle{color:var(--fg-muted);margin:4px 0;font-size:14px;line-height:1.4}.tws-wallet-badge{display:flex;flex-direction:column;align-items:flex-end;background:var(--accent-soft);padding:8px 12px;border-radius:12px;border:1px solid rgba(200,149,108,.2)}.tws-wallet-badge span{font-size:11px;color:var(--fg-muted);text-transform:uppercase;letter-spacing:.05em}.tws-wallet-badge strong{color:var(--accent);font-size:16px}.tws-paywall-body{display:flex;flex-direction:column;gap:14px}.tws-paywall-option{background:#ffffff09;border:1px solid var(--border);border-radius:16px;padding:16px;transition:transform .2s ease,border-color .2s ease}.tws-paywall-option:hover{border-color:var(--border-strong)}.tws-option-header{margin-bottom:16px}.tws-option-header h3{margin:0 0 4px;font-size:18px;font-weight:600;color:var(--fg)}.tws-option-action{display:flex;align-items:center;justify-content:space-between;gap:16px}.tws-price-tag{display:flex;flex-direction:column}.tws-price-tag strong{font-size:24px;color:var(--accent);line-height:1}.tws-price-tag small{color:var(--fg-muted);font-size:12px}.tws-divider{display:flex;align-items:center;justify-content:center;position:relative;height:20px}.tws-divider:before{content:"";position:absolute;left:0;right:0;height:1px;background:#ffffff1a}.tws-divider span{background:var(--bg-base);padding:0 12px;color:var(--fg-muted);font-size:12px;font-weight:600;z-index:1;text-transform:uppercase}.tws-slider-container{margin-bottom:16px}.tws-slider-labels{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;font-size:14px}.tws-subtle-info{color:var(--fg-muted);font-size:12px;font-weight:500}.tws-slider-labels strong{color:var(--accent)}input[type=range]{width:100%;height:6px;background:#ffffff1a;border-radius:3px;outline:none;-webkit-appearance:none;appearance:none}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 0 10px #89f3d266;transition:transform .1s}input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.1)}.tws-slider-scale{display:flex;justify-content:space-between;margin-top:8px;color:var(--fg-muted);font-size:11px}button{padding:12px 20px;border-radius:12px;border:none;font-weight:600;cursor:pointer;font-size:14px;transition:all .2s;white-space:normal}.tws-primary{background:var(--accent);color:#0a0a0b;width:100%}.tws-primary:hover:not(:disabled){background:#daa06d}.tws-secondary{background:#ffffff14;color:var(--fg);border:1px solid rgba(255,255,255,.08)}.tws-secondary:hover:not(:disabled){background:#ffffff1c}button:disabled{opacity:.5;cursor:not-allowed;transform:none}.tws-error-text{color:var(--danger);font-size:12px;margin-top:8px;text-align:center}.tws-emergency-link{margin-top:16px;text-align:center}.tws-emergency-link button{background:none;border:none;color:var(--fg-muted);font-size:12px;text-decoration:underline;cursor:pointer;padding:4px;opacity:.6}.tws-emergency-link button:hover{opacity:1;color:var(--fg)}.tws-emergency-form{display:flex;flex-direction:column;gap:16px}.tws-emergency-form textarea{background:#0000004d;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;color:var(--fg);font-family:inherit;font-size:14px;resize:vertical;min-height:80px}.tws-emergency-form textarea:focus{outline:none;border-color:var(--accent)}.tws-emergency-actions{display:flex;gap:12px}.tws-emergency-actions button{flex:1}.tws-attractors-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}.tws-link{background:none;border:none;color:var(--fg-muted);font-size:12px;text-decoration:underline;cursor:pointer;padding:4px;opacity:.85}.tws-link:hover:not(:disabled){opacity:1;color:var(--fg)}.tws-attractors-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}.tws-attractor-card{text-align:left;padding:0;border-radius:14px;background:#ffffff08;border:1px solid var(--border);display:flex;flex-direction:column;gap:10px;overflow:hidden;cursor:pointer}.tws-attractor-card:hover:not(:disabled):not([aria-disabled=true]){border-color:var(--border-strong)}.tws-attractor-card:disabled,.tws-attractor-card[aria-disabled=true]{opacity:.6;cursor:not-allowed}.tws-attractor-card:focus-visible{outline:2px solid rgba(200,149,108,.55);outline-offset:2px}.tws-attractors{border-color:#c8956c38;background:linear-gradient(180deg,#c8956c14,#ffffff08)}.tws-details{border-radius:16px;border:1px solid var(--border);background:#ffffff05;overflow:hidden}.tws-details summary{list-style:none;cursor:pointer;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;background:#ffffff08}.tws-details summary::-webkit-details-marker{display:none}.tws-details summary strong{font-size:14px}.tws-details summary span{font-size:12px;color:var(--fg-muted)}.tws-details-body{padding:14px 16px 16px;display:flex;flex-direction:column;gap:14px}.tws-attractor-card strong{font-size:14px;font-weight:700}.tws-attractor-card span{font-size:12px;color:var(--fg-muted)}.tws-attractor-thumb{position:relative;width:100%;aspect-ratio:16 / 9;background:#ffffff05}.tws-card-menu-trigger{position:absolute;top:10px;right:10px;width:32px;height:32px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0a0a0b94;color:#ffffffd1;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;line-height:1;box-shadow:0 10px 22px #00000059,inset 0 0 0 1px #ffffff0d}.tws-card-menu-trigger:disabled{opacity:.6;cursor:not-allowed}.tws-card-menu{position:absolute;top:48px;right:10px;min-width:170px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#101012eb;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);box-shadow:0 18px 36px #00000073;padding:6px;z-index:2}.tws-card-menu-item{width:100%;text-align:left;border:none;background:transparent;color:var(--fg);padding:10px;border-radius:10px;cursor:pointer;font-size:13px}.tws-card-menu-item:hover:not(:disabled){background:#ffffff0f}.tws-card-menu-item:disabled{opacity:.6;cursor:not-allowed}.tws-attractor-thumb-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:saturate(.95) contrast(.98) brightness(.92)}.tws-progress-bar{position:absolute;left:0;right:0;bottom:0;height:8px;background:#0a0a0b99;box-shadow:inset 0 1px #ffffff14;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}.tws-progress-fill{height:100%;width:0;background:linear-gradient(90deg,#c8956ceb,#f4d0aae0);box-shadow:0 0 16px #c8956c40;transition:width .22s ease}.tws-attractor-thumb-placeholder{position:absolute;inset:0;background:radial-gradient(120px 80px at 20% 30%,rgba(200,149,108,.22),transparent 55%),radial-gradient(140px 90px at 80% 35%,rgba(200,149,108,.12),transparent 60%),linear-gradient(160deg,#ffffff0d,#0000)}.tws-attractor-thumb-app{background:radial-gradient(120px 80px at 20% 30%,rgba(200,149,108,.16),transparent 55%),radial-gradient(140px 90px at 80% 35%,rgba(255,255,255,.06),transparent 60%),linear-gradient(160deg,#ffffff0d,#0000)}.tws-attractor-thumb-ritual{background:radial-gradient(120px 80px at 20% 30%,rgba(106,169,255,.12),transparent 55%),radial-gradient(140px 90px at 80% 35%,rgba(200,149,108,.14),transparent 60%),linear-gradient(160deg,#ffffff0d,#0000)}.tws-attractor-favicon{position:absolute;left:10px;bottom:10px;width:28px;height:28px;border-radius:8px;background:#0a0a0bc7;box-shadow:0 8px 18px #00000059,inset 0 0 0 1px #ffffff14;padding:6px}.tws-attractor-app-badge{position:absolute;left:10px;bottom:10px;display:inline-flex;align-items:center;justify-content:center;padding:7px 10px;border-radius:999px;background:#0a0a0bb8;box-shadow:0 8px 18px #00000059,inset 0 0 0 1px #ffffff14;font-size:12px;font-weight:600;color:var(--fg)}.tws-attractor-meta{padding:12px 12px 14px;display:flex;flex-direction:column;gap:6px}.tws-attractor-meta strong{font-size:14px;font-weight:700;line-height:1.2;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.tws-attractor-meta span{font-size:12px;color:var(--fg-muted);line-height:1.3;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.tws-attractor-meta small{font-size:11px;color:#ffffff6b;letter-spacing:.02em;text-transform:none}.tws-ritual-timer{font-variant-numeric:tabular-nums;font-size:52px;font-weight:700;text-align:center;padding:16px 10px;border-radius:14px;background:#ffffff06;border:1px solid rgba(255,255,255,.06);box-shadow:inset 0 1px #ffffff0a}.tws-price-pill{position:absolute;right:10px;bottom:10px;display:inline-flex;align-items:baseline;gap:4px;padding:6px 10px;border-radius:999px;background:#0a0a0bb8;box-shadow:0 8px 18px #00000059,inset 0 0 0 1px #ffffff14;font-size:13px;font-weight:700;color:var(--accent)}.tws-price-pill span{font-size:10px;color:var(--fg-muted);font-weight:500}@media(max-width:520px){.tws-paywall-modal{padding:18px 14px 36px}.tws-paywall-header{padding:16px 14px}.tws-option-action{flex-direction:column;align-items:stretch}.tws-price-tag{align-items:flex-start}.tws-attractors-grid{grid-template-columns:1fr}}',Se=1e4;let ae=null;function $(){document.visibilityState==="visible"&&document.hasFocus()&&chrome.runtime.sendMessage({type:"PAGE_HEARTBEAT",payload:{url:window.location.href,title:document.title}}).catch(()=>{})}function Ee(){ae==null&&(ae=window.setInterval($,Se),$())}Ee();document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&$()});chrome.runtime.onMessage.addListener((l,s,d)=>{if(l.type==="TWS_PING"){d?.({ok:!0});return}return l.type==="BLOCK_SCREEN"&&Me(l.payload.domain,l.payload.reason),!0});async function Me(l,s){const d=document.getElementById("tws-shadow-host");d&&d.remove();const n=document.createElement("div");n.id="tws-shadow-host",n.style.position="fixed",n.style.zIndex="2147483647",n.style.inset="0",n.style.width="100%",n.style.height="100%",document.body.appendChild(n);const f=n.attachShadow({mode:"open"}),h=document.createElement("style");h.textContent=Ne,f.appendChild(h);const i=document.createElement("div");i.id="tws-mount-point",f.appendChild(i),document.body.style.overflow="hidden";const u=await chrome.runtime.sendMessage({type:"GET_STATUS",payload:{domain:l,url:window.location.href}});we.createRoot(i).render(e.jsx(ke,{domain:l,status:u,reason:s,onClose:()=>{n.remove(),document.body.style.overflow=""}}))}
