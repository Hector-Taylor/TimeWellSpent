import{r as c,j as e,c as M}from"../assets/client.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))m(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&m(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function m(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();function v(){const[t,o]=c.useState(null),[r,m]=c.useState(null),[s,a]=c.useState(null),[l,j]=c.useState(!0),[g,d]=c.useState(null),[y,f]=c.useState(!1);c.useEffect(()=>{async function i(){const u=await O();m(u);const p=await chrome.runtime.sendMessage({type:"GET_CONNECTION"});if(o(p),u){const b=await chrome.runtime.sendMessage({type:"GET_STATUS",payload:{domain:u}});a(b)}j(!1)}i()},[]);const S=async i=>{const u=await chrome.runtime.sendMessage({type:"GET_CONNECTION"});if(o(u),i){const p=await chrome.runtime.sendMessage({type:"GET_STATUS",payload:{domain:i}});a(p)}},n=c.useMemo(()=>!r||!t?null:t.sessions[r]??null,[r,t]),h=n?.paused||s?.session?.paused,N=n?.remainingSeconds??s?.session?.remainingSeconds??0;c.useEffect(()=>{d(null)},[r]);const x=n?.mode==="pack"&&n.purchasePrice&&n.purchasedSeconds&&n.purchasedSeconds>0?Math.round(n.remainingSeconds/n.purchasedSeconds*n.purchasePrice):null;c.useEffect(()=>{n&&d(null)},[n?.mode]);async function w(){if(r){f(!0),d(null);try{h?await chrome.runtime.sendMessage({type:"RESUME_SESSION",payload:{domain:r}}):await chrome.runtime.sendMessage({type:"PAUSE_SESSION",payload:{domain:r}}),await S(r)}catch{d("Could not update the session state.")}finally{f(!1)}}}async function E(){if(r){f(!0),d(null);try{const i=await chrome.runtime.sendMessage({type:"END_SESSION",payload:{domain:r}});await S(r),i?.success?i?.refund&&i.refund>0?d(`Session ended. Refunded ${i.refund} coins.`):d("Session ended and blocked."):d(i?.error??"Could not end this session.")}catch{d("Could not end this session.")}finally{f(!1)}}}return l?e.jsx("div",{className:"panel",children:"Loadingâ€¦"}):e.jsxs("div",{className:"panel",children:[e.jsxs("div",{className:"banner",children:[e.jsx("span",{className:`badge ${t?.desktopConnected?"on":"off"}`,children:t?.desktopConnected?"Desktop linked":"Offline"}),e.jsxs("div",{children:[e.jsx("strong",{children:"TimeWellSpent Companion"}),e.jsx("br",{}),e.jsxs("small",{children:["Last sync ",t?.lastSync?T(t.lastSync):"never"]})]})]}),e.jsxs("div",{className:"wallet-row",children:[e.jsx("span",{children:"ðŸ’° Balance"}),e.jsxs("strong",{children:[s?.balance??0," f-coins"]})]}),r&&e.jsxs("div",{className:"session-card",children:[e.jsxs("div",{className:"row",children:[e.jsx("strong",{children:r}),e.jsx("span",{className:"badge",children:n?.mode??"blocked"})]}),n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"Status"}),e.jsx("span",{children:h?"Paused":n.mode==="emergency"?"Emergency":"Spending"})]}),e.jsxs("div",{className:"row",children:[e.jsx("span",{children:"Remaining"}),e.jsx("span",{children:n.mode==="metered"||n.mode==="emergency"?"âˆž":C(N)})]}),e.jsx("small",{className:"note",children:n.mode==="metered"?"Ending stops spend immediately and re-blocks this tab.":n.mode==="emergency"?`Free access â€” ${n.justification||"emergency override"}`:`Ending early refunds unused time${x?` (~${x} coins)`:""}.`}),e.jsxs("div",{className:"button-stack",children:[e.jsx("button",{className:"danger",disabled:y,onClick:E,children:"End session"}),e.jsx("button",{className:"secondary",disabled:y,onClick:w,children:h?"Resume spending":"Pause spending"})]})]}):e.jsx("div",{className:"row",children:e.jsx("span",{children:"No session for this tab."})}),g&&e.jsx("div",{className:"session-note",children:g})]})]})}async function O(){const t=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t.length||!t[0].url)return null;try{return new URL(t[0].url).hostname.replace(/^www\./,"")}catch{return null}}function T(t){const o=Math.floor((Date.now()-t)/1e3);return o<60?"just now":o<3600?`${Math.floor(o/60)}m ago`:o<86400?`${Math.floor(o/3600)}h ago`:`${Math.floor(o/86400)}d ago`}function C(t){return`${Math.max(1,Math.round(t/60))} min`}M.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(v,{})}));
