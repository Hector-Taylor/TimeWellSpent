{"version":3,"mappings":";6oCAEA,IAAIA,GAAsB,GAE1B,eAAeC,IAAY,CACzB,MAAMC,EAAS,MAAAC,GAAA,IAAM,OAAO,mBAAY,sBACxC,MAAI,CAACH,IAAuBE,GAAO,sBACjCA,EAAM,oBAAoB,UAAY,wFAAgE,WACtGF,GAAsB,IAEjBE,CACT,CAEA,eAAeE,IAAkB,CAC/B,MAAMC,EAAO,MAAAF,GAAA,IAAM,OAAO,qBAAQ,4CAClC,OAAQE,GAAK,SAAWA,CAC1B,CAwBA,SAASC,GAAWC,EAAc,CAEhC,OADgBA,EAAK,MAAM,qCAAqC,GAChD,QAAU,CAC5B,CAEA,SAASC,GAAgBC,EAAgB,CACvC,OAAO,OAAOA,GAAU,SAAWA,EAAQ,EAC7C,CAEA,SAASC,GAAcC,EAAgE,CACrF,MAAO,CACL,YAAaA,EAAM,aAAe,KAClC,WAAYA,EAAM,YAAc,KAChC,SAAUA,EAAM,UAAY,KAC5B,mBAAoBA,EAAM,oBAAsB,EAChD,oBAAqBA,EAAM,qBAAuB,EAClD,eAAgBA,EAAM,gBAAkB,EACxC,eAAgBA,EAAM,gBAAkB,EACxC,oBAAqBA,EAAM,qBAAuB,KAClD,cAAeA,EAAM,eAAiB,KAE1C,CAEA,SAASC,GAAkB,CAAE,OAAAC,GAAkC,CAC7D,OACEC,MAAC,OAAI,UAAU,2BACb,gBAAC,KAAG,UAAAD,EAAO,cAAc,yDAAqD,EAChF,CAEJ,CAEA,SAASE,GAAkB,CACzB,IAAAC,EACA,MAAAC,EACA,iBAAAC,CACF,EAIG,CACD,MAAMC,EAAYC,SAAiC,IAAI,EACjDC,EAAWD,SAA8B,IAAI,EAC7C,CAACE,EAAOC,CAAQ,EAAIC,WAAwB,IAAI,EAChD,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAACG,EAAYC,CAAa,EAAIJ,WAAS,CAAC,EACxC,CAACK,EAAWC,EAAY,EAAIN,WAAwB,IAAI,EACxD,CAACO,EAAMC,CAAO,EAAIR,WAAS,CAAC,EAC5B,CAACS,EAAcC,CAAe,EAAIV,WAAS,CAAC,EAC5C,CAACW,EAAcC,CAAe,EAAIZ,WAAS,CAAC,EAC5C,CAACa,EAAoBC,CAAqB,EAAId,WAAS,CAAC,EACxD,CAACe,GAAqBC,CAAsB,EAAIhB,WAAS,CAAC,EAC1D,CAACiB,EAAeC,CAAgB,EAAIlB,WAAwB,IAAI,EAEhEmB,GAAYvB,SAAY,IAAI,EAC5BwB,EAAiBxB,SAAO,CAAC,EACzByB,EAAkBzB,SAAoB,IAAI,GAAK,EAC/C0B,EAAoB1B,SAA4B,IAAI,GAAK,EAEzD2B,EAAiBF,EAAgB,QAAQ,KACzCG,GAAiB,MAAM,KAAKF,EAAkB,QAAQ,SAAS,EAClE,OAAO,CAAC,CAACG,CAAI,IAAMJ,EAAgB,QAAQ,IAAII,CAAI,CAAC,EACpD,OAAO,CAACC,EAAK,EAAGC,CAAK,IAAMD,EAAMC,EAAO,CAAC,EACtCC,GAAsBC,UAAQ,IAAM,CACxC,GAAI,CAACxB,GAAaiB,EAAkB,QAAQ,OAAS,EAAG,OAAO,KAC/D,MAAMQ,EAAeR,EAAkB,QAAQ,KAEzCS,EADiB,MAAM,KAAKT,EAAkB,QAAQ,QAAQ,EAAE,OAAO,CAACI,EAAKC,IAAUD,EAAMC,EAAO,CAAC,EAC9E,KAAK,IAAI,EAAGG,CAAY,EACrD,OAAO,KAAK,MAAMC,EAAM1B,CAAS,CACnC,EAAG,CAACA,EAAWM,CAAY,CAAC,EACtBqB,EAAW3B,EAAY,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGF,EAAa,KAAK,IAAI,EAAGE,CAAS,CAAC,CAAC,EAAI,KAE7F4B,mBAAU,IAAM,CACdvC,IACER,GAAc,CACZ,YAAaiB,EACb,WAAYE,EACZ,SAAA2B,EACA,mBAAAnB,EACA,oBAAAE,GACA,eAAAQ,EACA,eAAAC,GACA,oBAAAI,GACA,cAAAX,CAAA,CACD,EAEL,EAAG,CACDJ,EACAe,GACAb,GACAE,EACAvB,EACAW,EACAF,EACAoB,EACAS,EACAR,EAAA,CACD,EAEDS,YAAU,IAAM,CACd,IAAIC,EAAY,GAChB,OAAAhC,EAAW,EAAI,EACfH,EAAS,IAAI,EACbsB,EAAgB,YAAc,IAC9BC,EAAkB,YAAc,IAChClB,EAAc,CAAC,EACfc,EAAiB,IAAI,EACrBJ,EAAsB,CAAC,EACvBE,EAAuB,CAAC,EACxBN,EAAgB,CAAC,EACjBE,EAAgB,CAAC,GAEhB,SAAY,CACX,GAAI,CACF,MAAMlC,EAAQ,MAAMD,GAAA,EACpB,GAAIyD,EAAW,OAEf,MAAMC,EAAM,MADCzD,EAAM,YAAYc,CAAG,EACX,QACvB,GAAI0C,EAAW,CACb,MAAMC,EAAI,UACV,MACF,CACAhB,GAAU,QAAUgB,EACpB7B,GAAa6B,EAAI,UAAY,IAAI,EACjC/B,EAAc,CAAC,CACjB,OAASgC,EAAW,CACbF,GACHnC,EAAUqC,EAAoB,SAAW,oBAAoB,CAEjE,SACOF,GAAWhC,EAAW,EAAK,CAClC,CACF,KAEO,IAAM,CACXgC,EAAY,GACZ,MAAMC,EAAMhB,GAAU,QACtBA,GAAU,QAAU,KAChBgB,GAAK,SACFA,EAAI,SAEb,CACF,EAAG,CAAC3C,CAAG,CAAC,EAERyC,YAAU,IAAM,CACd,MAAMI,EAAQ,OAAO,YAAY,IAAM,CACrC,MAAMC,EAAU,SAAS,kBAAoB,UACzCA,GAASxB,EAAuB7B,GAAUA,EAAQ,CAAC,EACnDqD,GAAW,SAAS,cAAoCrD,GAAUA,EAAQ,CAAC,CACjF,EAAG,GAAI,EACP,MAAO,IAAM,OAAO,cAAcoD,CAAK,CACzC,EAAG,EAAE,EAELJ,YAAU,IAAM,CACd,IAAIC,EAAY,GAoDhB,OAnD0B,SAAY,CACpC,MAAMC,EAAMhB,GAAU,QAChBoB,EAAS5C,EAAU,QACnB6C,EAAQ3C,EAAS,QACvB,GAAI,CAACsC,GAAO,CAACI,GAAU,CAACC,GAAS,CAACrC,EAAY,OAC9C,MAAMsC,EAAQ,EAAErB,EAAe,QAC/B,GAAI,CACF,MAAMK,EAAO,MAAMU,EAAI,QAAQhC,CAAU,EACzC,GAAI+B,GAAaO,IAAUrB,EAAe,QAAS,OACnD,MAAMsB,GAAejB,EAAK,YAAY,CAAE,MAAO,EAAG,EAE5CkB,EADiB,KAAK,IAAI,IAAKH,EAAM,YAAc,EAAE,EAC3B,KAAK,IAAI,EAAGE,GAAa,KAAK,EAAKnC,EAC7DqC,EAAWnB,EAAK,YAAY,CAAE,MAAAkB,EAAO,EACrCE,EAAc,OAAO,kBAAoB,EACzCC,EAAgBP,EAAO,WAAW,IAAI,EAC5C,GAAI,CAACO,EAAe,MAAM,IAAI,MAAM,8BAA8B,EAelE,GAbAP,EAAO,MAAQ,KAAK,MAAMK,EAAS,MAAQC,CAAW,EACtDN,EAAO,OAAS,KAAK,MAAMK,EAAS,OAASC,CAAW,EACxDN,EAAO,MAAM,MAAQ,GAAG,KAAK,MAAMK,EAAS,KAAK,CAAC,KAClDL,EAAO,MAAM,OAAS,GAAG,KAAK,MAAMK,EAAS,MAAM,CAAC,KACpDE,EAAc,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC3CA,EAAc,UAAU,EAAG,EAAGP,EAAO,MAAOA,EAAO,MAAM,EAOzD,MALmBd,EAAK,OAAO,CAC7B,cAAAqB,EACA,SAAAF,EACA,UAAWC,IAAgB,EAAI,CAACA,EAAa,EAAG,EAAGA,EAAa,EAAG,CAAC,EAAI,OACzE,EACgB,QACbX,GAAaO,IAAUrB,EAAe,QAAS,OAEnDF,EAAiB,QAAQf,CAAU,GAAGE,EAAY,OAAOA,CAAS,GAAK,EAAE,EAAE,EAC3E,MAAM0C,EAAkB1B,EAAgB,QAAQ,KAGhD,GAFAA,EAAgB,QAAQ,IAAIlB,CAAU,EAElC,CAACmB,EAAkB,QAAQ,IAAInB,CAAU,EAAG,CAE9C,MAAMpB,IADc,MAAM0C,EAAK,kBACL,OAAS,IAChC,IAAKuB,GAAchE,GAAgBgE,GAAM,GAAG,CAAC,EAC7C,KAAK,GAAG,EACX1B,EAAkB,QAAQ,IAAInB,EAAYrB,GAAWC,CAAI,CAAC,CAC5D,EACIsC,EAAgB,QAAQ,OAAS0B,GAAmBzB,EAAkB,QAAQ,IAAInB,CAAU,IAC9FS,EAAiB3B,GAAUA,EAAQ,CAAC,CAExC,OAASgE,EAAa,CACff,GAAWnC,EAAUkD,EAAsB,SAAW,2BAA2B,CACxF,CACF,GAEK,EACE,IAAM,CACXf,EAAY,EACd,CACF,EAAG,CAAC7B,EAAWF,EAAYI,EAAME,CAAY,CAAC,EAE9CwB,YAAU,IAAM,CACd,MAAMiB,EAAW,IAAM,CACrB9B,EAAe,SAAW,EAC1BV,EAAiBzB,GAAUA,EAAQ,CAAC,CACtC,EACA,cAAO,iBAAiB,SAAUiE,CAAQ,EACnC,IAAM,OAAO,oBAAoB,SAAUA,CAAQ,CAC5D,EAAG,EAAE,EAGHC,OAAC,OAAI,UAAU,wBACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,OAAI,UAAU,+BACb,UAAA7D,MAAC,UAAQ,SAAAG,CAAA,CAAM,EACfH,MAAC,QAAK,UAAU,2BAA4B,YAAiB,MAAM,GACrE,EACA6D,OAAC,OAAI,UAAU,uCACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAMc,EAAenB,GAAU,KAAK,IAAI,EAAGA,EAAQ,CAAC,CAAC,EAAG,SAAUkB,GAAc,EAAG,gBAElH,EACAb,MAAC,QAAK,UAAU,2BACb,SAAAe,EAAY,GAAGF,CAAU,IAAIE,CAAS,GAAKF,CAAA,CAC9C,EACAb,MAAC,UACC,KAAK,SACL,QAAS,IAAMc,EAAenB,GAAWoB,EAAY,KAAK,IAAIA,EAAWpB,EAAQ,CAAC,EAAIA,EAAQ,CAAE,EAChG,SAAUoB,GAAa,MAAQF,GAAcE,EAC9C,kBAGDf,MAAC,UAAO,KAAK,SAAS,QAAS,IAAMkB,EAASvB,GAAU,KAAK,IAAI,GAAK,KAAK,OAAOA,EAAQ,IAAO,EAAE,EAAI,EAAE,CAAC,EAAG,cAE7G,EACAK,MAAC,UAAO,KAAK,SAAS,QAAS,IAAMkB,EAASvB,GAAU,KAAK,IAAI,IAAK,KAAK,OAAOA,EAAQ,IAAO,EAAE,EAAI,EAAE,CAAC,EAAG,cAE7G,GACF,GACF,EACCa,EAAQR,MAAC,KAAE,UAAU,wBAAyB,WAAM,EAAO,KAC5D6D,OAAC,OAAI,UAAU,wBAAwB,IAAKtD,EACzC,UAAAI,EAAUX,MAAC,OAAI,UAAU,0BAA0B,wBAAY,EAAS,WACxE,UAAO,IAAKK,EAAW,UAAWM,EAAU,gBAAkB,GAAI,GACrE,GACF,CAEJ,CAEA,SAASmD,GAAmB,CAC1B,IAAA5D,EACA,MAAAC,EACA,iBAAAC,CACF,EAIG,CACD,MAAM2D,EAAWzD,SAA8B,IAAI,EAC7C0D,EAAU1D,SAAY,IAAI,EAC1B2D,EAAe3D,SAAY,IAAI,EAC/B4D,EAAkB5D,SAA4B,IAAI,GAAK,EACvD6D,EAAqB7D,SAAoB,IAAI,GAAK,EAClD,CAACE,EAAOC,CAAQ,EAAIC,WAAwB,IAAI,EAChD,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAAC0D,GAAaC,CAAc,EAAI3D,WAAwB,IAAI,EAC5D,CAAC4D,EAAYC,CAAa,EAAI7D,WAAwB,IAAI,EAC1D,CAACgC,EAAU8B,CAAW,EAAI9D,WAAwB,IAAI,EACtD,CAACiB,EAAeC,CAAgB,EAAIlB,WAAwB,IAAI,EAChE,CAACa,EAAoBC,EAAqB,EAAId,WAAS,CAAC,EACxD,CAACe,EAAqBC,CAAsB,EAAIhB,WAAS,CAAC,EAC1D,CAACwB,EAAgBuC,EAAiB,EAAI/D,WAAS,CAAC,EAChD,CAAC4B,EAAqBoC,CAAsB,EAAIhE,WAAwB,IAAI,EAC5E,CAACiE,EAAWC,CAAY,EAAIlE,WAAS,EAAE,EAEvCuB,GAAiBkC,EAAmB,QAAQ,KAElDxB,YAAU,IAAM,CACdvC,IACER,GAAc,CACZ,YAAAwE,GACA,WAAAE,EACA,SAAA5B,EACA,mBAAAnB,EACA,oBAAAE,EACA,eAAAQ,GACA,eAAAC,EACA,oBAAAI,EACA,cAAAX,CAAA,CACD,EAEL,EAAG,CACDJ,EACA6C,GACA9B,EACAb,EACAE,EACAvB,EACA6B,GACAS,EACA4B,EACApC,CAAA,CACD,EAEDS,YAAU,IAAM,CACd,MAAMI,EAAQ,OAAO,YAAY,IAAM,CACrC,MAAMC,EAAU,SAAS,kBAAoB,UACzCA,GAASxB,GAAuB7B,GAAUA,EAAQ,CAAC,EACnDqD,GAAW,SAAS,cAAoCrD,GAAUA,EAAQ,CAAC,CACjF,EAAG,GAAI,EACP,MAAO,IAAM,OAAO,cAAcoD,CAAK,CACzC,EAAG,EAAE,EAELJ,YAAU,IAAM,CACd,IAAIC,EAAY,GAChBhC,EAAW,EAAI,EACfH,EAAS,IAAI,EACb4D,EAAe,IAAI,EACnBE,EAAc,IAAI,EAClBC,EAAY,IAAI,EAChB5C,EAAiB,IAAI,EACrBJ,GAAsB,CAAC,EACvBE,EAAuB,CAAC,EACxB+C,GAAkB,CAAC,EACnBC,EAAuB,IAAI,EAC3BE,EAAa,EAAE,EACfV,EAAgB,YAAc,IAC9BC,EAAmB,YAAc,IAEjC,MAAMU,EAAQd,EAAS,QACvB,GAAI,CAACc,EAAO,OACZA,EAAM,UAAY,GAElB,IAAIC,EAAY,KACZC,EAAiB,KAErB,MAAMC,EAAkB,IAAM,CAC5B,MAAM3C,EAAQ,MAAM,KAAK6B,EAAgB,QAAQ,SAAS,EACvD,OAAO,CAAC,CAACe,CAAG,IAAMd,EAAmB,QAAQ,IAAIc,CAAG,CAAC,EACrD,OAAO,CAAC7C,EAAK,EAAG8C,CAAK,IAAM9C,EAAM8C,EAAO,CAAC,EAC5CT,GAAkBpC,CAAK,EACvB,MAAM8C,EAAgBjB,EAAgB,QAAQ,KAC9C,GAAIiB,EAAgB,EAAG,CACrB,MAAMC,EAAa,MAAM,KAAKlB,EAAgB,QAAQ,QAAQ,EAAE,OAAO,CAAC9B,EAAK8C,IAAU9C,EAAM8C,EAAO,CAAC,EAC/FG,EAAc,MAAM,QAASP,EAAa,OAAO,UAAU,EAC5DA,EAAa,MAAM,WAAW,OAC/BK,EACJT,EAAuB,KAAK,MAAOU,EAAaD,EAAiB,KAAK,IAAIA,EAAeE,CAAW,CAAC,CAAC,CACxG,CACF,EAEMC,EAAmB,MAAOC,EAAcC,IAA0B,CACtE,MAAMP,EAAMM,GAAQ,WAAWC,GAAgB,CAAC,GAChD,GAAI,CAAAtB,EAAgB,QAAQ,IAAIe,CAAG,EACnC,GAAI,CACF,MAAMQ,EAAUD,GAAgB,KAAOV,EAAK,QAAQU,CAAY,EAAI,KAC9DE,EAASD,EAAU,MAAM,QAAQ,QAASA,EAAgB,KAAMX,EAAa,MAAM,KAAKA,CAAI,CAAC,CAAC,EAAI,KAClGrF,EAAOiG,GAAU,OAAQA,EAAoB,iBAAiB,aAAgB,SAC/EA,EAAoB,gBAAgB,YACrC,GACJxB,EAAgB,QAAQ,IAAIe,EAAKzF,GAAWC,CAAI,CAAC,EACjDuF,EAAA,CACF,MAAQ,CAER,CACF,EAEMW,GAAeC,GAAkB,CACrC,GAAIhD,EAAW,OACf,MAAMiD,EAAgB,OAAO,SAASD,GAAU,OAAO,WAAW,IAAI,EAAI,OAAOA,EAAS,MAAM,UAAU,IAAI,EAAI,KAC5GE,EAAiB,OAAO,SAASF,GAAU,OAAO,WAAW,KAAK,EAAI,OAAOA,EAAS,MAAM,UAAU,KAAK,EAAI,KAC/GL,EAAO,OAAOK,GAAU,OAAO,MAAS,SAAWA,EAAS,MAAM,KAAO,GACzEJ,EAAe,OAAO,SAASI,GAAU,OAAO,KAAK,EAAI,OAAOA,EAAS,MAAM,KAAK,EAAI,OACxFG,EAAc,OAAOH,GAAU,OAAO,YAAe,SACvDA,EAAS,MAAM,WACf,OAAOA,GAAU,KAAK,YAAe,SACnCA,EAAS,IAAI,WACb,KAEFL,EACFpB,EAAmB,QAAQ,IAAIoB,CAAI,EAC1BC,GAAgB,MACzBrB,EAAmB,QAAQ,IAAI,WAAWqB,CAAY,EAAE,EAE1DR,EAAA,GACIO,GAAQC,GAAgB,OACrBF,EAAiBC,EAAMC,CAAY,EAG1C,MAAMQ,GAAsB,IAAM,CAChC,GAAI,CACF,MAAMC,EAAanB,EAAa,UAChC,OAAI,OAAOmB,GAAW,QAAW,WAAmB,OAAOA,EAAU,QAAQ,EACzE,OAAOA,GAAW,OAAU,SAAiB,OAAOA,EAAU,KAAK,EAChE,IACT,MAAQ,CACN,OAAO,IACT,CACF,KAEMC,EAAqBL,GAAwCD,GAAU,OAAO,UAAY,KAC1FO,EAAoBL,GAA0CE,EACpE3B,EAAe6B,CAAkB,EACjC3B,EAAc4B,CAAiB,EAC/B3B,EAAYuB,GAAe,KAAO,KAAK,IAAI,EAAG,KAAK,IAAI,EAAGA,CAAW,CAAC,EAAI,IAAI,EAC9EnE,EAAiB2D,IAASW,GAAsB,KAAO,YAAYA,CAAkB,GAAK,OAAO,EACjGtB,EAAasB,GAAsB,KAAO,OAAOA,CAAkB,EAAI,EAAE,CAC3E,EAEA,OAAC,SAAY,CACX,GAAI,CACF,MAAME,EAAc,MAAM9G,GAAA,EAC1B,GAAIsD,EAAW,OAEfkC,EAAOsB,EAAYlG,CAAG,EACtB6E,EAAYD,EAAK,SAASD,EAAO,CAC/B,MAAO,OACP,OAAQ,OACR,OAAQ,OACT,EACDb,EAAQ,QAAUc,EAClBb,EAAa,QAAUc,EACvBA,EAAU,GAAG,YAAaY,EAAW,EAErC,MAAOb,EAAa,MACpB,GAAI,CACF,MAAOA,EAAa,UAAU,SAAS,IAAI,CAC7C,MAAQ,CAER,CACA,MAAMC,EAAU,SAClB,OAASjC,EAAW,CACbF,GACHnC,EAAUqC,EAAoB,SAAW,qBAAqB,CAElE,SACOF,GAAWhC,EAAW,EAAK,CAClC,CACF,KAEO,IAAM,CACXgC,EAAY,GACZ,GAAI,CACFmC,GAAW,IAAI,YAAaY,EAAW,CACzC,MAAQ,CAER,CACA,GAAI,CACFZ,GAAW,SACb,MAAQ,CAER,CACA,GAAI,CACFD,GAAM,SACR,MAAQ,CAER,CACAd,EAAQ,QAAU,KAClBC,EAAa,QAAU,IACzB,CACF,EAAG,CAAC/D,CAAG,CAAC,EAER,MAAMmG,GAAS,SAAY,CACzB,GAAI,CACF,MAAMpC,EAAa,SAAS,MAC9B,OAASqC,EAAU,CACjB7F,EAAU6F,EAAmB,SAAW,iCAAiC,CAC3E,CACF,EAEMC,EAAS,SAAY,CACzB,GAAI,CACF,MAAMtC,EAAa,SAAS,MAC9B,OAASqC,EAAU,CACjB7F,EAAU6F,EAAmB,SAAW,6BAA6B,CACvE,CACF,EAEME,EAAiB,SAAY,CACjC,MAAM7G,EAAQ,OAAOgF,CAAS,EAC9B,GAAI,CAAC,OAAO,SAAShF,CAAK,GAAKA,GAAS,EAAG,OAC3C,MAAMmF,EAAOd,EAAQ,QACfe,EAAYd,EAAa,QAC/B,GAAI,GAACa,GAAQ,CAACC,GACd,GAAI,CACF,MAAMkB,EAAanB,EAAa,UAChC,IAAI2B,EAAqB,KACrBR,GAAa,OAAOA,EAAU,iBAAoB,aACpDQ,EAAMR,EAAU,gBAAgB,KAAK,MAAMtG,CAAK,CAAC,GAE/C8G,GACF,MAAM1B,EAAU,QAAQ0B,CAAG,CAE/B,OAASC,EAAW,CAClBjG,EAAUiG,EAAoB,SAAW,4BAA4B,CACvE,CACF,EAEA,OACE7C,OAAC,OAAI,UAAU,wBACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,OAAI,UAAU,+BACb,UAAA7D,MAAC,UAAQ,SAAAG,CAAA,CAAM,EACfH,MAAC,QAAK,UAAU,2BAA4B,YAAiB,OAAO,GACtE,EACA6D,OAAC,OAAI,UAAU,uCACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAASqG,GAAQ,gBAEvC,EACArG,MAAC,SACC,KAAK,OACL,MAAO2E,EACP,UAAU,UACV,UAAU,gCACV,SAAWgC,GAAU/B,EAAa+B,EAAM,OAAO,KAAK,EACpD,UAAYA,GAAU,CAChBA,EAAM,MAAQ,UAChBA,EAAM,iBACDH,EAAA,EAET,EACA,aAAW,kBAEbxG,MAAC,QAAK,UAAU,2BACb,WAAa,KAAKsE,CAAU,GAAK,GACpC,EACAtE,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKwG,EAAA,EAAkB,cAE5D,QACC,UAAO,KAAK,SAAS,QAASD,EAAQ,gBAEvC,GACF,GACF,EACC/F,EAAQR,MAAC,KAAE,UAAU,wBAAyB,WAAM,EAAO,KAC5D6D,OAAC,OAAI,UAAU,wBACZ,UAAAlD,EAAUX,MAAC,OAAI,UAAU,0BAA0B,yBAAa,EAAS,KAC1EA,MAAC,OAAI,IAAK+D,EAAU,UAAW,6BAA6BpD,EAAU,aAAe,EAAE,GAAI,GAC7F,GACF,CAEJ,CAEO,SAASiG,GAAuB,CAAE,IAAA1G,EAAK,OAAAH,EAAQ,MAAAI,EAAO,iBAAAC,EAAkB,UAAAyG,GAAoB,CACjG,OAAI9G,IAAW,MACNC,MAACC,GAAA,CAAkB,IAAAC,EAAU,MAAAC,EAAc,iBAAAC,CAAA,CAAoC,EAEpFL,IAAW,OACNC,MAAC8D,GAAA,CAAmB,IAAA5D,EAAU,MAAAC,EAAc,iBAAAC,CAAA,CAAoC,QAGtF,OAAI,UAAAyG,EACH,SAAA7G,MAACF,GAAA,CAAkB,OAAAC,EAAgB,EACrC,CAEJ,CC9aA,SAAS+G,IAAkB,CACzB,OAAI,OAAO,OAAW,KAAe,OAAO,OAAO,YAAe,WAAmB,OAAO,aACrF,WAAW,KAAK,KAAK,IAAI,KAAK,SAAS,SAAS,EAAE,EAAE,MAAM,EAAG,EAAE,CAAC,EACzE,CAEA,SAAStH,GAAWC,EAAc,CAEhC,OADgBA,EAAK,MAAM,qCAAqC,GAChD,QAAU,CAC5B,CAEA,SAASsH,GAAiBC,EAAc,CACtC,OAAOA,EAAK,SAAS,GAAG,EAAIA,EAAK,MAAM,EAAG,EAAE,EAAIA,CAClD,CAEA,SAASC,IAAsB,CAE7B,OADkB,WACD,QAAQ,SAAW,IACtC,CAEA,eAAeC,GAAaC,EAAiBC,EAAcC,EAAgC,CACzF,MAAMC,EAAW,MAAM,MAAM,GAAGP,GAAiBI,CAAO,CAAC,GAAGC,CAAI,GAAI,CAClE,GAAGC,EACH,MAAO,WACP,QAAS,CACP,eAAgB,mBAChB,GAAIA,GAAM,SAAW,EAAC,CACxB,CACD,EACD,GAAI,CAACC,EAAS,GAAI,CAChB,MAAMC,EAAW,MAAMD,EAAS,OAAO,MAAM,IAAM,IAAI,EACvD,MAAM,IAAI,MAAMC,GAAS,OAAS,mBAAmBD,EAAS,MAAM,GAAG,CACzE,CACA,OAAOA,EAAS,MAClB,CAEA,SAASE,GAAeC,EAAiB,CACvC,MAAMC,EAAO,KAAK,IAAI,EAAG,KAAK,MAAMD,EAAU,EAAE,CAAC,EAC3CE,EAAQ,KAAK,MAAMD,EAAO,EAAE,EAC5BE,EAAMF,EAAO,GACnB,OAAIC,EAAQ,EAAU,GAAGA,CAAK,KAAKC,CAAG,IAC/B,GAAGA,CAAG,GACf,CAEA,SAASC,GAAmBC,EAAqB,CAC/C,GAAI,CAACA,EAAK,MAAO,MACjB,MAAMC,EAAK,KAAK,MAAMD,CAAG,EACzB,GAAI,CAAC,OAAO,SAASC,CAAE,EAAG,MAAO,WACjC,MAAMC,EAAS,KAAK,MAAQD,EACtBL,EAAO,KAAK,MAAMM,EAAS,GAAK,EACtC,GAAIN,EAAO,EAAG,MAAO,WACrB,GAAIA,EAAO,GAAI,MAAO,GAAGA,CAAI,QAC7B,MAAMC,EAAQ,KAAK,MAAMD,EAAO,EAAE,EAClC,OAAIC,EAAQ,GAAW,GAAGA,CAAK,QAExB,GADM,KAAK,MAAMA,EAAQ,EAAE,CACpB,OAChB,CAEA,SAASM,GAAkBC,EAAyB,CAClD,OAAQA,EAAA,CACN,IAAK,UACH,MAAO,YACT,IAAK,aACH,MAAO,cACT,IAAK,YACH,MAAO,OACT,IAAK,gBACH,MAAO,WACT,QACE,MAAO,SAEb,CAEA,SAASC,GAAkBD,EAA0B,CACnD,OAAQA,EAAA,CACN,IAAK,UACH,MAAO,UACT,IAAK,QACH,MAAO,QACT,IAAK,WACH,MAAO,WACT,IAAK,UACH,MAAO,UACT,IAAK,QACH,MAAO,QACT,IAAK,QACH,MAAO,QACT,QACE,MAAO,UAEb,CAEA,SAASE,GAAgBF,EAA0B/H,EAAe,CAChE,MAAMkI,EAA+C,CACnD,QAAS,IACT,MAAO,IACP,SAAU,GACV,QAAS,IACT,MAAO,IACP,MAAO,IACP,MAAO,KAET,IAAIC,EAAO,EACX,QAASC,EAAI,EAAGA,EAAIpI,EAAM,OAAQoI,GAAK,EAAGD,EAAQA,EAAO,GAAKnI,EAAM,WAAWoI,CAAC,EAAK,EACrF,MAAMC,EAAS,KAAK,IAAIF,CAAI,EAAI,GAC1BG,GAAMJ,EAASH,CAAI,EAAIM,GAAU,IACjCE,GAAMD,EAAK,IAAM,IACvB,MAAO,+BAA+BA,CAAE,yBAAyBC,CAAE,kBACrE,CAEA,SAASC,GAAiBhJ,EAAe,CACvC,MAAMiJ,EAAI,OAAOjJ,CAAK,EACtB,MAAI,CAAC,OAAO,SAASiJ,CAAC,GAAKA,GAAK,EAAU,KACnC,KAAK,MAAMA,CAAC,CACrB,CAEA,SAASC,GAAmBC,EAAoB,CAC9C,MAAMF,EAAI,OAAOE,CAAG,EACpB,MAAI,CAAC,OAAO,SAASF,CAAC,GAAKA,GAAK,EAAU,GACnC,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,KAAK,MAAMA,CAAC,CAAC,CAAC,CACjD,CAEA,SAASG,GAAwBD,EAAwC,CACvE,OAAQA,EAAA,CACN,IAAK,UACL,IAAK,QACL,IAAK,WACL,IAAK,UACL,IAAK,QACL,IAAK,QACL,IAAK,QACH,OAAOA,EACT,QACE,MAAO,UAEb,CAEA,SAASE,IAAkE,CACzE,GAAI,OAAO,OAAW,IAAa,OAAO,KAC1C,MAAMC,EAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACnDC,GAAUD,EAAO,IAAI,kBAAkB,GAAK,IAAI,OACtD,GAAI,CAACC,EAAQ,OAAO,KAEpB,MAAMC,EAAgBN,GAAmBI,EAAO,IAAI,kBAAkB,CAAC,EAEvE,GAAIC,IAAW,SAAU,CACvB,MAAME,EAAY,OAAOH,EAAO,IAAI,sBAAsB,CAAC,EAC3D,MAAI,CAAC,OAAO,SAASG,CAAS,GAAKA,GAAa,EAAU,KACnD,CACL,OAAQ,SACR,UAAW,KAAK,MAAMA,CAAS,EAC/B,cAAAD,CAAA,CAEJ,CAEA,GAAID,IAAW,SAAU,CACvB,MAAM/I,EAAQ8I,EAAO,IAAI,iBAAiB,EACpCI,EAAaJ,EAAO,IAAI,kBAAkB,EAChD,MAAO,CACL,OAAQ,SACR,KAAMF,GAAwBE,EAAO,IAAI,gBAAgB,CAAC,EAC1D,cAAAE,EACA,MAAOhJ,GAAO,OAASA,EAAM,OAAS,KACtC,WAAYkJ,GAAY,OAASA,EAAW,OAAS,KAEzD,CAEA,OAAO,IACT,CAEA,SAASC,IAAuC,CAC9C,GAAI,OAAO,OAAW,IAAa,OACnC,MAAMC,EAAM,IAAI,IAAI,OAAO,SAAS,IAAI,EAClCC,EAAO,CAAC,GAAGD,EAAI,aAAa,MAAM,EACxC,IAAIE,EAAU,GACd,UAAWxE,KAAOuE,EACXvE,EAAI,WAAW,YAAY,IAChCsE,EAAI,aAAa,OAAOtE,CAAG,EAC3BwE,EAAU,IAEZ,GAAI,CAACA,EAAS,OACd,MAAMC,EAAO,GAAGH,EAAI,QAAQ,GAAGA,EAAI,MAAM,GAAGA,EAAI,IAAI,GACpD,OAAO,QAAQ,aAAa,KAAM,GAAIG,CAAI,CAC5C,CAEA,MAAMC,GAAsB,CAC1B,MAAO,GACP,KAAM,UACN,WAAY,UACZ,UAAW,GACX,SAAU,GACV,WAAY,EACd,EAEA,SAASC,GAAkBjD,EAAgD,CACzE,OAAIA,EAAM,SAAWA,EAAM,SAAWA,EAAM,OAAe,GACvDA,EAAM,IAAI,SAAW,EAAU,GAC5BA,EAAM,MAAQ,aAAeA,EAAM,MAAQ,UAAYA,EAAM,MAAQ,SAAWA,EAAM,MAAQ,KACvG,CAEO,SAASkD,GAAmB,CAAE,QAAA1C,EAAS,QAAA2C,EAAS,QAAAC,EAAU,OAAgB,CAC/E,KAAM,CAACC,EAAWC,CAAY,EAAIvJ,WAAkC,IAAI,EAClE,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAACF,EAAOC,CAAQ,EAAIC,WAAwB,IAAI,EAChD,CAACwJ,EAAQC,CAAS,EAAIzJ,WAAwB,IAAI,EAClD,CAAC0J,EAAcC,EAAe,EAAI3J,WAAS,EAAK,EAChD,CAAC4J,EAAeC,CAAgB,EAAI7J,WAAS,EAAK,EAClD,CAAC8J,EAAYC,CAAa,EAAI/J,WAASiJ,EAAmB,EAC1D,CAACe,EAAeC,CAAgB,EAAIjK,WAAsC,IAAI,EAC9E,CAACkK,EAAaC,CAAc,EAAInK,WAAS,EAAK,EAC9C,CAACoK,GAAkBC,CAAmB,EAAIrK,WAAwB,IAAI,EACtEsK,EAAa1K,SAAoC,IAAI,EACrD2K,EAAkB3K,SAAmCyJ,IAAY,YAAcf,GAAA,EAAwC,IAAI,EAC3HkC,GAAyB5K,SAAO,EAAK,EAE3CqC,YAAU,IAAM,CACdqI,EAAW,QAAUN,CACvB,EAAG,CAACA,CAAa,CAAC,EAElB,MAAMS,EAAgBC,cAAY,MAAOC,EAAS,KAAU,CACrDA,GAAQzK,EAAW,EAAI,EAC5BH,EAAS,IAAI,EACb,GAAI,CACF,MAAM6K,EAAO,MAAMpE,GAA4BC,EAAS,qCAAqC,EAC7F8C,EAAaqB,CAAI,CACnB,OAASxI,EAAW,CAClBrC,EAAUqC,EAAoB,SAAW,gCAAgC,CAC3E,SACOuI,GAAQzK,EAAW,EAAK,CAC/B,CACF,EAAG,CAACuG,CAAO,CAAC,EAEZxE,YAAU,IAAM,CACTwI,EAAA,CACP,EAAG,CAACA,CAAa,CAAC,EAElBxI,YAAU,IAAM,CACd,MAAMI,EAAQ,OAAO,YAAY,IAAM,CAChCoI,EAAc,EAAI,CACzB,EAAG,GAAM,EACT,MAAO,IAAM,OAAO,cAAcpI,CAAK,CACzC,EAAG,CAACoI,CAAa,CAAC,EAElB,MAAMI,EAAiBhJ,UACrB,IAAMyH,GAAW,QAAQ,KAAMwB,GAAWA,EAAO,KAAOV,EAAgB,GAAKd,GAAW,QAAQ,CAAC,GAAK,KACtG,CAACA,GAAW,QAASc,EAAgB,GAGjCW,EAAgBlJ,UAAQ,KACdyH,GAAW,UAAY,IACxB,OACX,CAAC0B,EAAKC,KACJD,EAAI,OAAS,EACTC,EAAQ,SAAW,WAAUD,EAAI,QAAU,GAC3CC,EAAQ,OAAS,YAAWD,EAAI,SAAW,GAC3CC,EAAQ,aAAe,YAAWD,EAAI,KAAO,GAC1CA,GAET,CAAE,MAAO,EAAG,OAAQ,EAAG,QAAS,EAAG,IAAK,EAAE,EAE3C,CAAC1B,GAAW,QAAQ,CAAC,EAElB4B,EAAgBR,cACpB,MAAO7D,GAAyC,CAC9CgD,EAAiB,EAAI,EACrB,GAAI,CACF,MAAMsB,EAAU,MAAM3E,GAAgCC,EAAS,oBAAqB,CAClF,OAAQ,OACR,KAAM,KAAK,UAAUI,CAAO,EAC7B,EACD,OAAA4C,EAAU,YAAY0B,EAAQ,KAAK,IAAI,EACvCxB,GAAgB,EAAK,EACrBI,EAAcd,EAAmB,EACjC,MAAMwB,EAAc,EAAI,EACjBU,CACT,OAASC,EAAa,CACpB,OAAArL,EAAUqL,EAAsB,SAAW,2BAA2B,EAC/D,IACT,SACEvB,EAAiB,EAAK,CACxB,CACF,EACA,CAACpD,EAASgE,CAAa,GAGnBY,GAAeX,cACnB,MAAOhC,EAAmB7B,IACjBL,GAAgCC,EAAS,qBAAqBiC,CAAS,GAAI,CAChF,OAAQ,QACR,KAAM,KAAK,UAAU7B,CAAO,EAC7B,EAEH,CAACJ,CAAO,GAGJ6E,GAAeZ,cACnB,MAAOhC,GAAsB,CAC3B,GAAI,CACF,MAAMlC,GAAgCC,EAAS,qBAAqBiC,CAAS,SAAU,CAAE,OAAQ,OAAQ,CAC3G,MAAQ,CAER,CACF,EACA,CAACjC,CAAO,GAGJ8E,EAAoBb,cACxB,MAAOO,GAAkC,CACvC,GAAI,CAACA,EAAQ,UAAW,CACtBxB,EAAUwB,EAAQ,aAAe,YAAc,+DAAiE,2BAA2B,EAC3I,MACF,CACA,MAAMK,GAAaL,EAAQ,EAAE,EAC7B,OAAO,KAAKA,EAAQ,UAAW,SAAU,qBAAqB,EAC9DxB,EAAU,sBAAsBwB,EAAQ,KAAK,IAAI,EAC5CR,EAAc,EAAI,CACzB,EACA,CAACA,EAAea,EAAY,GAGxBE,EAA8Bd,cAClC,MAAOO,EAA+BxC,IAAiC,CACrE,MAAMgD,EAAUlF,GAAA,EAChB,GAAI8C,IAAY,aAAe,CAACoC,GAAS,YAAa,CACpD,MAAMF,EAAkBN,CAAO,EAC/B,MACF,CACA,GAAI,CAACA,EAAQ,UAAW,CACtBxB,EAAUwB,EAAQ,aAAe,YAAc,kEAAoE,2BAA2B,EAC9I,MACF,CACAd,EAAe,EAAI,EACnB,GAAI,CACF,MAAMuB,EAAS,MAAMD,EAAQ,YAAY,CACvC,KAAM,sBACN,QAAS,CACP,UAAWR,EAAQ,GACnB,aAAcA,EAAQ,MACtB,YAAaA,EAAQ,KACrB,WAAYA,EAAQ,WACpB,UAAWA,EAAQ,UACnB,SAAUA,EAAQ,UAAY,KAC9B,iBAAkBA,EAAQ,iBAC1B,cAAAxC,EACA,cAAe,mBACf,eAAgB,GAClB,CACD,EACD,GAAI,CAACiD,GAAQ,QACX,MAAM,IAAI,MAAMA,GAAQ,OAAS,wCAAwC,EAE3EjC,EAAU,WAAWwB,EAAQ,KAAK,mCAAmC,CACvE,OAASU,EAAW,CAClB5L,EAAU4L,EAAoB,SAAW,wCAAwC,CACnF,SACExB,EAAe,EAAK,CACtB,CACF,EACA,CAACoB,EAAmBlC,CAAO,GAGvBuC,EAAsBlB,cAC1B,MAAOO,EAA+BxC,IAAiC,CACrE,GAAI,CAAAyB,EACJ,CAAAC,EAAe,EAAI,EACnB,GAAI,CACF,MAAM0B,EAAYzF,GAAA,EAClB,MAAMI,GAAUC,EAAS,oCAAqC,CAC5D,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,UAAAoF,EACA,UAAWZ,EAAQ,GACnB,cAAe7B,EACf,cAAAX,CAAA,CACD,EACF,EAEDwB,EAAiB,CACf,UAAA4B,EACA,QAAAZ,EACA,cAAAxC,EACA,YAAa,KAAK,MAClB,UAAWwC,EAAQ,UAAY,GAC/B,iBAAkBA,EAAQ,aAAe,GACzC,kBAAmBA,EAAQ,kBAAoBnM,GAAWmM,EAAQ,UAAY,EAAE,EAChF,iBAAkBA,EAAQ,kBAAoBnM,GAAWmM,EAAQ,UAAY,EAAE,EAC/E,mBAAoB,EACpB,oBAAqB,EACrB,gBAAiB,EACjB,gBAAiB,EACjB,kBAAmB,EACnB,cAAe,EACf,gBAAiBA,EAAQ,UAAY,IAAI,OACzC,gBAAiB,GACjB,cAAe,wBAChB,EACDxB,EAAU,WAAWhB,EAAgB,GAAGA,CAAa,IAAM,EAAE,yBAAyBwC,EAAQ,KAAK,KAAK,MAAM,CAChH,OAASa,EAAY,CACnB/L,EAAU+L,EAAqB,SAAW,kCAAkC,CAC9E,SACE3B,EAAe,EAAK,CACtB,EACF,EACA,CAAC1D,EAASyD,EAAad,CAAO,GAG1B2C,EAAuBrB,cAC3B,MAAOO,EAA+BxC,IAAiC,CAKrE,GAHEY,IAAY,aACZ4B,EAAQ,aAAe,WACvB,EAAQA,EAAQ,UACQ,CACxB,MAAMO,EAA4BP,EAASxC,CAAa,EACxD,MACF,CACA,MAAMmD,EAAoBX,EAASxC,CAAa,CAClD,EACA,CAAC+C,EAA6BI,EAAqBvC,CAAO,GAGtD2C,EAAsBtB,cAC1B,MAAOlD,GAA6B,CAClC,MAAMyE,EAAU3B,EAAW,QAC3B,GAAK2B,EACL,GAAI,CACF,MAAMzF,GAAUC,EAAS,+BAA+BwF,EAAQ,SAAS,IAAIzE,CAAI,GAAI,CACnF,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,WAAY,IAAI,OAAO,cACvB,mBAAoByE,EAAQ,mBAC5B,oBAAqBA,EAAQ,oBAC7B,gBAAiBA,EAAQ,gBACzB,gBAAiBA,EAAQ,gBACzB,kBAAmBA,EAAQ,kBAC3B,cAAeA,EAAQ,cACvB,iBAAkBA,EAAQ,iBAC1B,eAAgBA,EAAQ,eACxB,cAAeA,EAAQ,cACxB,EACF,CACH,MAAQ,CAER,CACF,EACA,CAACxF,CAAO,GAGJyF,EAAoBxB,cACxB,MAAOyB,EAAc,KAAS,CAC5B,MAAMF,EAAU3B,EAAW,QAC3B,GAAI,GAAC2B,GAAW/B,GAChB,CAAAC,EAAe,EAAI,EACnB,GAAI,CACF,MAAM6B,EAAoB,KAAK,EAC3BG,GACF,MAAMd,GAAaY,EAAQ,QAAQ,GAAI,CACrC,SAAUA,EAAQ,UAClB,iBAAkBA,EAAQ,iBAC1B,YAAaA,EAAQ,iBACrB,cAAe,IAAI,OAAO,aAAY,CACvC,EAEHhC,EAAiB,IAAI,EACrBR,EAAU,sBAAsBwC,EAAQ,QAAQ,KAAK,MAAMA,EAAQ,eAAiB,EAAI,IAAM,EAAE,GAAGA,EAAQ,aAAa,UAAU,EAClI,MAAMxB,EAAc,EAAI,CAC1B,OAAS2B,EAAU,CACjBrM,EAAUqM,EAAmB,SAAW,gCAAgC,CAC1E,SACEjC,EAAe,EAAK,CACtB,EACF,EACA,CAACM,EAAeY,GAAcW,EAAqB9B,CAAW,GAGhEjI,YAAU,IAAM,CACd,GAAI,CAAC+H,EAAe,OACpB,MAAMqC,EAAapG,GAAyB,CACtCA,EAAM,MAAQ,UACXiG,EAAkB,EAAI,CAE/B,EACA,cAAO,iBAAiB,UAAWG,CAAS,EACrC,IAAM,OAAO,oBAAoB,UAAWA,CAAS,CAC9D,EAAG,CAACrC,EAAekC,CAAiB,CAAC,EAErCjK,YAAU,IAAM,CACd,GAAI,CAAC+H,EAAe,OACpB,MAAM3H,EAAQ,OAAO,YAAY,IAAM,CACrC4H,EAAkBqC,GAAS,CACzB,GAAI,CAACA,EAAM,OAAOA,EAClB,MAAMhK,EAAU,SAAS,kBAAoB,UACvCzB,EAAqByB,EAAUgK,EAAK,mBAAqB,EAAIA,EAAK,mBAClEvL,EAAsBuB,GAAW,SAAS,WAAagK,EAAK,oBAAsB,EAAIA,EAAK,oBAC3FC,EACJ,CAACD,EAAK,iBACNA,EAAK,eAAiB,MACtBzL,GAAsByL,EAAK,cAAgB,GACvC,GACAA,EAAK,gBACX,MAAO,CAAE,GAAGA,EAAM,mBAAAzL,EAAoB,oBAAAE,EAAqB,gBAAAwL,CAAA,CAC7D,CAAC,CACH,EAAG,GAAI,EACP,MAAO,IAAM,OAAO,cAAclK,CAAK,CACzC,EAAG,CAAC2H,CAAa,CAAC,EAElB/H,YAAU,IAAM,CACd,GAAI,CAAC+H,EAAe,OACpB,MAAM3H,EAAQ,OAAO,YAAY,IAAM,CAChC2J,EAAoB,UAAU,CACrC,EAAG,GAAI,EACP,MAAO,IAAM,OAAO,cAAc3J,CAAK,CACzC,EAAG,CAAC2H,EAAegC,CAAmB,CAAC,EAEvC/J,YAAU,IACD,IAAM,CACN+J,EAAoB,KAAK,CAChC,EACC,CAACA,CAAmB,CAAC,EAExB,MAAMQ,EAAwB9B,cAAa+B,GAAqB,CAC9DxC,EAAkBqC,GAAS,CACzB,GAAI,CAACA,EAAM,OAAOA,EAClB,MAAMI,EAAYJ,EAAK,iBACjBK,EAAY7N,GAAW2N,CAAQ,EAC/BG,EAAOD,EAAYD,EACzB,MAAO,CACL,GAAGJ,EACH,UAAWG,EACX,iBAAkBE,EAClB,eAAgBF,EAAS,OACzB,gBAAiBH,EAAK,iBAAmBM,EAAO,EAAIA,EAAO,GAC3D,kBAAmBN,EAAK,mBAAqBM,EAAO,EAAI,KAAK,IAAIA,CAAI,EAAI,GACzE,cAAeD,EAAYL,EAAK,kBAEpC,CAAC,CACH,EAAG,EAAE,EAECO,EAAqBnC,cAAazE,GAAmD,CACpFiD,GAAkBjD,CAAK,GAC5BgE,EAAkBqC,GAAUA,GAAO,CAAE,GAAGA,EAAM,gBAAiBA,EAAK,gBAAkB,EAAW,CACnG,EAAG,EAAE,EAECQ,GAAyBjL,UAAQ,IAChCmI,GAAe,cACb,KAAK,IAAI,EAAGA,EAAc,cAAgB,GAAKA,EAAc,kBAAkB,EAD5C,KAEzC,CAACA,CAAa,CAAC,EAEZ+C,EAA0BrC,cAC9B,MAAOI,EAAuBtD,EAA2B,YAAc,CACrE,MAAMwF,EAAcxF,IAAS,UAAY,UAAYC,GAAkBD,CAAI,EACrEyF,EAAY,IAAI,OAAO,mBAAmB,GAAI,CAAE,MAAO,QAAS,IAAK,UAAW,EAChFC,EAAc,WAAWpC,EAAO,IAAI;AAAA;AAAA,EAC1C,MAAMI,EAAc,CAClB,MAAO,GAAG8B,CAAW,MAAMC,CAAS,GACpC,KAAAzF,EACA,WAAY,UACZ,SAAU0F,EACV,WAAYpC,EAAO,KACnB,YAAa,sCACd,CACH,EACA,CAACI,CAAa,GAGViC,EAAwBzC,cAC5B,MAAOlD,GAA6B,CAClC,MAAMyF,EAAY,IAAI,OAAO,mBAAmB,GAAI,CAAE,MAAO,QAAS,IAAK,UAAW,EAChFnC,EAASxB,GAAW,QAAQ,KAAMtG,GAASA,EAAK,OAASwE,GAAQxE,EAAK,OAAS,KAAK,GAAK,KACzFvD,EACJ+H,IAAS,UACL,aAAayF,CAAS,GACtBzF,IAAS,QACP,cACAA,IAAS,WACP,gBACAA,IAAS,UACP,gBACA,GAAGC,GAAkBD,CAAI,CAAC,SACtC,MAAM0D,EAAc,CAClB,MAAAzL,EACA,KAAA+H,EACA,WAAY,UACZ,SAAUsD,EAAS,WAAWA,EAAO,IAAI;AAAA;AAAA,EAAS,GAClD,WAAYA,GAAQ,MAAQ,KAC5B,YACEtD,IAAS,UACL,4DACA,uCACP,CACH,EACA,CAAC0D,EAAe5B,GAAW,OAAO,GAG9B8D,EAAmB1C,cACvB,MAAOzE,GAAqB,CAC1BA,EAAM,iBACN,MAAMxG,EAAQqK,EAAW,MAAM,OAC/B,GAAI,CAACrK,EAAO,CACVM,EAAS,mCAAmC,EAC5C,MACF,CACA,GAAI+J,EAAW,aAAe,WAAa,CAACA,EAAW,UAAU,QAAU,CAACA,EAAW,SAAS,OAAQ,CACtG/J,EAAS,sDAAsD,EAC/D,MACF,CAEA,MAAMmL,EAAc,CAClB,MAAAzL,EACA,KAAMqK,EAAW,KACjB,WAAYA,EAAW,WACvB,UAAWA,EAAW,UAAU,QAAU,KAC1C,SAAUA,EAAW,SAAS,QAAU,KACxC,WAAY7B,GAAiB6B,EAAW,UAAU,EAClD,SAAUA,EAAW,aAAe,UAAY,GAAK,KACrD,YAAa,KACb,WAAYe,GAAgB,MAAQ,KACrC,CACH,EACA,CAACf,EAAYoB,EAAeL,CAAc,GAG5C5I,YAAU,IAAM,CACd,GAAIoH,IAAY,YAAa,OAC7B,MAAMgE,EAAe9C,EAAgB,QAGrC,GAFI,CAAC8C,GAAgB7C,GAAuB,SACxCvK,GAAW,CAACqJ,GACZM,GAAiBM,GAAeF,EAAe,OAEnD,IAAI9H,EAAY,GA8DhB,OA5DwB,SAAY,CAClCsI,GAAuB,QAAU,GACjC,GAAI,CACF,GAAI6C,EAAa,SAAW,SAAU,CACpC,IAAIpC,GAAU3B,EAAU,SAAS,KAAMtG,IAASA,GAAK,KAAOqK,EAAa,SAAS,GAAK,KAQvF,GAPKpC,KAKHA,IAJa,MAAMzE,GACjBC,EACA,qDAEa,MAAM,KAAMzD,IAASA,GAAK,KAAOqK,EAAa,SAAS,GAAK,MAEzE,CAACpC,GAAS,CACP/I,GACHnC,EAAS,2DAA2D,EAEtE,MACF,CACKmC,GACH,MAAM6J,EAAqBd,GAASoC,EAAa,aAAa,EAEhE,MACF,CAEA,MAAM7F,EAAO6F,EAAa,KACpBJ,EAAY,IAAI,OAAO,mBAAmB,GAAI,CAAE,MAAO,QAAS,IAAK,UAAW,EAChFK,EACJ9F,IAAS,UACL,aAAayF,CAAS,GACtBzF,IAAS,QACP,cACAA,IAAS,WACP,gBACAA,IAAS,UACP,gBACA,GAAGC,GAAkBD,CAAI,CAAC,MAAMyF,CAAS,GAC/CtE,GAAa0E,EAAa,YAAY,OAASA,EAAa,WAAW,OAAS,KAChFlC,GAAU,MAAMD,EAAc,CAClC,MAAOmC,EAAa,OAAO,QAAUC,EACrC,KAAA9F,EACA,WAAY,UACZ,SAAUmB,GAAa,WAAWA,EAAU;AAAA;AAAA,EAAS,GACrD,WAAAA,GACA,YACEnB,IAAS,UACL,4DACA,uCACP,EACD,GAAI,CAAC2D,IAAWjJ,EAAW,OAC3B,MAAM0J,EAAoBT,GAASkC,EAAa,aAAa,CAC/D,OAASE,EAAa,CACfrL,GACHnC,EAAUwN,EAAsB,SAAW,4CAA4C,CAE3F,SACEhD,EAAgB,QAAU,KACrBrI,GAAW0G,GAAA,CAClB,CACF,GAEK,EACE,IAAM,CACX1G,EAAY,EACd,CACF,EAAG,CACD8H,EACAvD,EACAyE,EACA5B,EACArJ,EACA2J,EACAM,EACA6B,EACAH,EACAvC,CAAA,CACD,EAED,MAAMmE,EACJnE,IAAY,MACR,qCACA,4DAEN,OACElG,OAAAsK,WAAA,CACE,UAAAtK,OAAC,WAAQ,UAAWqK,EAClB,UAAArK,OAAC,OAAI,UAAU,yBACb,UAAAA,OAAC,OACC,UAAA7D,MAAC,KAAE,UAAW+J,IAAY,MAAQ,UAAY,iBAAkB,0BAAc,EAC9E/J,MAAC,MAAG,0DAA8C,EAClDA,MAAC,KAAE,UAAU,yBAAyB,qHAEtC,GACF,EACA6D,OAAC,OAAI,UAAU,gCACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKmL,EAAA,EACvC,SAAAxK,EAAU,WAAa,UAC1B,QACC,UAAO,KAAK,SAAS,UAAU,UAAU,QAAS,IAAM0J,GAAiB+D,GAAM,CAACA,CAAC,EAC/E,SAAAhE,EAAe,iBAAmB,cACrC,GACF,GACF,EAEC5J,EAAQR,MAAC,KAAE,UAAU,+BAAgC,WAAM,EAAO,KAClEkK,EAASlK,MAAC,KAAE,UAAU,yBAA0B,WAAO,EAAO,KAE/D6D,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,QAAK,UAAU,aAAc,UAAA4H,EAAc,MAAM,aAAS,EAC3D5H,OAAC,QAAK,UAAU,aAAc,UAAA4H,EAAc,OAAO,WAAO,EAC1D5H,OAAC,QAAK,UAAU,aAAc,UAAA4H,EAAc,IAAI,eAAW,EAC3D5H,OAAC,QAAK,UAAU,aAAa,mBACpBmG,EAAY,GAAGA,EAAU,SAAS,MAAM,UAAY,EAAI,IAAM,EAAE,GAAGA,EAAU,SAAS,MAAM,QAAQ,SAAW,MACxH,EACAnG,OAAC,QAAK,UAAU,aAAa,kBACrBmG,EAAY,GAAGA,EAAU,SAAS,KAAK,eAAe,QAAQ,CAAC,CAAC,OAAS,MACjF,GACF,EAEAnG,OAAC,OAAI,UAAU,4BACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK6N,EAAsB,SAAS,EAAG,SAAUvD,EAAe,0BAErG,EACAtK,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK6N,EAAsB,OAAO,EAAG,SAAUvD,EAAe,uBAEnG,EACAtK,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK6N,EAAsB,UAAU,EAAG,SAAUvD,EAAe,0BAEtG,EACAtK,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK6N,EAAsB,SAAS,EAAG,SAAUvD,EAAe,yBAErG,GACF,EAECN,GAAW,aAAa,OACvBhK,MAAC,OAAI,UAAU,8BACZ,SAAAgK,EAAU,YAAY,IAAKqE,GAC1BxK,OAAC,WAAoD,UAAU,0BAC7D,UAAAA,OAAC,OAAI,UAAU,iCAAiC,MAAO,CAAE,WAAYuE,GAAgBiG,EAAW,QAAQ,KAAMA,EAAW,QAAQ,KAAK,GACpI,UAAArO,MAAC,QAAK,UAAU,iCAAkC,YAAkBqO,EAAW,QAAQ,IAAI,EAAE,EAC7FrO,MAAC,UAAQ,SAAAqO,EAAW,QAAQ,MAAM,QACjC,SAAO,SAAApG,GAAkBoG,EAAW,QAAQ,UAAU,EAAE,GAC3D,EACAxK,OAAC,OAAI,UAAU,gCACb,UAAA7D,MAAC,KAAE,UAAU,yBAA0B,SAAAqO,EAAW,OAAO,EACzDrO,MAAC,KAAE,UAAU,oCAAqC,WAAW,cAAc,EAC3E6D,OAAC,OAAI,UAAU,6BACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKyM,EAAqB4B,EAAW,QAAS,EAAE,EAAG,SAAUzD,EAAa,qBAE/G,EACA5K,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKyM,EAAqB4B,EAAW,QAAS,EAAE,EAAG,SAAUzD,EAAa,qBAE/G,EACCyD,EAAW,QAAQ,UAClBrO,MAAC,UACC,KAAK,SACL,QAAS,IAAM,KAAM+J,IAAY,aAAesE,EAAW,QAAQ,aAAe,UAC9EnC,EAA4BmC,EAAW,QAAS,EAAE,EAClDpC,EAAkBoC,EAAW,OAAO,GAEvC,aAAY,aAAeA,EAAW,QAAQ,aAAe,UAAY,eAAiB,gBAE3F,MACN,GACF,IA3BY,cAAcA,EAAW,QAAQ,EAAE,EA4BjD,CACD,EACH,EACE,KAEHrE,GAAW,SAAS,OACnBnG,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,OAAI,UAAU,gCACb,UAAA7D,MAAC,UAAO,0BAAc,EACtBA,MAAC,QAAK,UAAU,yBAAyB,+CAAmC,GAC9E,EACAA,MAAC,OAAI,UAAU,6BACZ,WAAU,QAAQ,IAAKwL,GACtB3H,OAAC,UACC,KAAK,SAEL,UAAW,uBAAuB0H,GAAgB,KAAOC,EAAO,GAAK,SAAW,EAAE,GAClF,QAAS,IAAMT,EAAoBS,EAAO,EAAE,EAE5C,UAAAxL,MAAC,QAAM,WAAO,OAAS,MAAQ,MAAQmI,GAAkBqD,EAAO,IAAI,EAAE,EACtExL,MAAC,SAAO,SAAAwL,EAAO,KAAK,IALfA,EAAO,GAOf,EACH,EACCD,EACC1H,OAAC,OAAI,UAAU,gCACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKyN,EAAwBlC,EAAgB,SAAS,EAAG,SAAUjB,EAAe,+BAEvH,EACAtK,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKyN,EAAwBlC,EAAgB,OAAO,EAAG,SAAUjB,EAAe,mCAErH,GACF,EACE,MACN,EACE,KAEHF,EACCvG,OAAC,QAAK,UAAU,2BAA2B,SAAUiK,EACnD,UAAAjK,OAAC,OAAI,UAAU,+BACb,UAAAA,OAAC,OACC,UAAA7D,MAAC,SAAM,iBAAK,EACZA,MAAC,SACC,MAAOwK,EAAW,MAClB,SAAW7D,GAAU8D,EAAeuC,IAAU,CAAE,GAAGA,EAAM,MAAOrG,EAAM,OAAO,OAAQ,EACrF,YAAY,iBACd,EACF,SACC,OACC,UAAA3G,MAAC,SAAM,gBAAI,EACX6D,OAAC,UACC,MAAO2G,EAAW,KAClB,SAAW7D,GAAU8D,EAAeuC,IAAU,CAAE,GAAGA,EAAM,KAAMrG,EAAM,OAAO,OAA8B,EAE1G,UAAA3G,MAAC,UAAO,MAAM,UAAU,mBAAO,EAC/BA,MAAC,UAAO,MAAM,QAAQ,iBAAK,EAC3BA,MAAC,UAAO,MAAM,WAAW,oBAAQ,EACjCA,MAAC,UAAO,MAAM,UAAU,mBAAO,EAC/BA,MAAC,UAAO,MAAM,QAAQ,iBAAK,EAC3BA,MAAC,UAAO,MAAM,QAAQ,iBAAK,EAC3BA,MAAC,UAAO,MAAM,QAAQ,iBAAK,IAC7B,EACF,SACC,OACC,UAAAA,MAAC,SAAM,kBAAM,EACb6D,OAAC,UACC,MAAO2G,EAAW,WAClB,SAAW7D,GAAU8D,EAAeuC,IAAU,CAAE,GAAGA,EAAM,WAAYrG,EAAM,OAAO,OAA6B,EAE/G,UAAA3G,MAAC,UAAO,MAAM,UAAU,qBAAS,EACjCA,MAAC,UAAO,MAAM,aAAa,sBAAU,EACrCA,MAAC,UAAO,MAAM,YAAY,qBAAS,EACnCA,MAAC,UAAO,MAAM,gBAAgB,yBAAa,IAC7C,EACF,SACC,OACC,UAAAA,MAAC,SAAM,kCAAsB,EAC7BA,MAAC,SACC,UAAU,UACV,MAAOwK,EAAW,WAClB,SAAW7D,GAAU8D,EAAeuC,IAAU,CAAE,GAAGA,EAAM,WAAYrG,EAAM,OAAO,OAAQ,EAC1F,YAAY,aACd,EACF,GACF,EACC6D,EAAW,aAAe,UACzB3G,OAAC,OAAI,UAAU,+BACb,UAAAA,OAAC,OACC,UAAA7D,MAAC,SAAM,iCAAqB,EAC5BA,MAAC,SACC,MAAOwK,EAAW,UAClB,SAAW7D,GAAU8D,EAAeuC,IAAU,CAAE,GAAGA,EAAM,UAAWrG,EAAM,OAAO,OAAQ,EACzF,YAAY,6CACd,EACF,SACC,OACC,UAAA3G,MAAC,SAAM,gCAAoB,EAC3BA,MAAC,SACC,MAAOwK,EAAW,SAClB,SAAW7D,GAAU8D,EAAeuC,IAAU,CAAE,GAAGA,EAAM,SAAUrG,EAAM,OAAO,OAAQ,EACxF,YAAY,yBACd,EACF,GACF,EACE,KACJ9C,OAAC,OAAI,UAAU,6BACb,UAAA7D,MAAC,UAAO,UAAU,UAAU,KAAK,SAAS,SAAUsK,EACjD,SAAAA,EAAgB,YAAc,yBACjC,EACCiB,EAAiBvL,MAAC,QAAK,UAAU,aAAa,wBAAY,EAAU,MACvE,GACF,EACE,KAEJA,MAAC,OAAI,UAAU,2BACZ,SAAAgK,GAAW,UAAU,OACpBA,EAAU,SAAS,IAAK2B,GAAY,CAClC,MAAM2C,EACJ3C,EAAQ,YAAcA,EAAQ,WAAa,EACvC,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,KAAK,MAAOA,EAAQ,iBAAmBA,EAAQ,WAAc,GAAG,CAAC,CAAC,EAC5F,KACN,cACG,WAAyB,UAAW,+BAA+BA,EAAQ,MAAM,GAChF,UAAA3L,MAAC,UACC,KAAK,SACL,UAAU,oCACV,QAAS,IAAM,KAAKyM,EAAqBd,EAAS,EAAE,EACpD,SAAUf,EACV,aAAY,oBAAoBe,EAAQ,KAAK,GAE7C,SAAA9H,OAAC,QAAK,UAAU,8BAA8B,MAAO,CAAE,WAAYuE,GAAgBuD,EAAQ,KAAMA,EAAQ,KAAK,GAC5G,UAAA3L,MAAC,QAAK,UAAU,8BAA+B,SAAAmI,GAAkBwD,EAAQ,IAAI,EAAE,EAC/E3L,MAAC,QAAK,UAAU,8BAA+B,WAAQ,MAAM,QAC5D,QAAK,UAAU,6BAA8B,SAAAiI,GAAkB0D,EAAQ,UAAU,EAAE,GACtF,IAEF9H,OAAC,OAAI,UAAU,6BACb,UAAAA,OAAC,OAAI,UAAU,iCACb,UAAA7D,MAAC,UAAQ,WAAQ,MAAM,EACvBA,MAAC,QAAK,UAAW,cAAc2L,EAAQ,SAAW,OAAS,UAAY,EAAE,GAAK,SAAAA,EAAQ,OAAO,GAC/F,EACA9H,OAAC,OAAI,UAAU,8BACb,UAAAA,OAAC,QAAM,UAAA8H,EAAQ,iBAAiB,iBAAiB,UAAM,SACtD,QAAM,UAAAA,EAAQ,aAAa,aAAS,QACpC,QAAM,SAAA9D,GAAmB8D,EAAQ,eAAiBA,EAAQ,SAAS,EAAE,GACxE,EACCA,EAAQ,YAAc3L,MAAC,KAAE,UAAU,gCAAiC,SAAA2L,EAAQ,YAAY,EAAO,KAC/F2C,GAAe,KACdzK,OAAC,OAAI,UAAU,iCACb,UAAAA,OAAC,OAAI,UAAA7D,MAAC,QAAK,gBAAI,SAAQ,QAAM,UAAA2L,EAAQ,iBAAiB,IAAEA,EAAQ,YAAW,GAAO,EAClF3L,MAAC,OAAI,UAAU,oCAAoC,SAAAA,MAAC,QAAK,MAAO,CAAE,MAAO,GAAGsO,CAAW,KAAO,EAAE,GAClG,EACE,KACJzK,OAAC,OAAI,UAAU,6BACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKyM,EAAqBd,EAAS,EAAE,EAAG,SAAUf,EAAa,qBAEpG,EACA5K,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKyM,EAAqBd,EAAS,EAAE,EAAG,SAAUf,EAAa,qBAEpG,EACCe,EAAQ,UACP3L,MAAC,UACC,KAAK,SACL,QAAS,IAAM,KAAM+J,IAAY,aAAe4B,EAAQ,aAAe,UACnEO,EAA4BP,EAAS,EAAE,EACvCM,EAAkBN,CAAO,GAE5B,SAAA5B,IAAY,aAAe4B,EAAQ,aAAe,UAAY,eAAiB,gBAEhF,KACJ3L,MAAC,UACC,KAAK,SACL,QAAS,SAAY,CACnB,GAAI,CACF,MAAM+L,GAAaJ,EAAQ,GAAI,CAC7B,OAAQA,EAAQ,SAAW,OAAS,SAAW,OAC/C,cAAe,IAAI,OAAO,aAAY,CACvC,EACD,MAAMR,EAAc,EAAI,CAC1B,OAASoD,EAAW,CAClB9N,EAAU8N,EAAoB,SAAW,kCAAkC,CAC7E,CACF,EAEC,SAAA5C,EAAQ,SAAW,OAAS,SAAW,QAC1C,EACF,GACF,IAjEYA,EAAQ,EAkEtB,CAEJ,CAAC,EACChL,EACFX,MAAC,KAAE,UAAU,yBAAyB,qCAAyB,EAE/DA,MAAC,KAAE,UAAU,yBAAyB,oHAEtC,EAEJ,EAECgK,GAAW,SACVnG,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,OAAI,UAAU,yBACb,UAAA7D,MAAC,QAAK,8BAAkB,QACvB,UAAQ,SAAAwH,GAAewC,EAAU,SAAS,MAAM,aAAa,EAAE,GAClE,EACAnG,OAAC,OAAI,UAAU,yBACb,UAAA7D,MAAC,QAAK,2BAAe,SACpB,UAAQ,UAAAgK,EAAU,SAAS,MAAM,UAAY,EAAI,IAAM,GAAIA,EAAU,SAAS,MAAM,UAAS,GAChG,EACAnG,OAAC,OAAI,UAAU,yBACb,UAAA7D,MAAC,QAAK,sBAAU,EAChBA,MAAC,UAAQ,SAAAgK,EAAU,SAAS,KAAK,oBAAoB,QAAQ,CAAC,EAAE,GAClE,EACAnG,OAAC,OAAI,UAAU,yBACb,UAAA7D,MAAC,QAAK,4BAAgB,EACtBA,MAAC,UAAQ,SAAAgK,EAAU,SAAS,MAAM,SAAS,GAC7C,GACF,EACE,KAEHA,GAAW,UAAU,UAAU,aAC7B,MAAG,UAAU,2BACX,SAAAA,EAAU,SAAS,SAAS,IAAKwE,GAChCxO,MAAC,MAAkB,YAAVwO,CAAkB,CAC5B,EACH,EACE,MACN,EAEC9D,EACC7G,OAAC,OAAI,UAAU,kBAAkB,KAAK,SAAS,aAAW,OAAO,aAAY,WAAW6G,EAAc,QAAQ,KAAK,GACjH,UAAA7G,OAAC,OAAI,UAAU,yBAAyB,QAAU8C,GAAUA,EAAM,kBAChE,UAAA9C,OAAC,UAAO,UAAU,0BAChB,UAAAA,OAAC,OACC,UAAA7D,MAAC,KAAE,UAAW+J,IAAY,MAAQ,UAAY,iBAAkB,0BAAc,EAC9E/J,MAAC,MAAI,SAAA0K,EAAc,QAAQ,MAAM,EACjC7G,OAAC,KAAE,UAAU,yBACV,UAAAsE,GAAkBuC,EAAc,QAAQ,IAAI,EAAE,MAAIzC,GAAkByC,EAAc,QAAQ,UAAU,EAAE,aAAW,IACjH,IAAI,KAAKA,EAAc,WAAW,EAAE,mBAAmB,GAAI,CAAE,UAAW,QAAS,GACpF,GACF,EACA7G,OAAC,OAAI,UAAU,6BACZ,UAAA6G,EAAc,QAAQ,UACrB1K,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKiM,EAAkBvB,EAAc,OAAO,EAAG,uBAEpF,EACE,KACJ1K,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK4M,EAAkB,EAAI,EAAG,SAAUhC,EAC1E,SAAAA,EAAc,UAAY,aAC7B,GACF,GACF,EAEA/G,OAAC,OAAI,UAAU,wBACb,UAAAA,OAAC,OAAI,UAAU,8BACb,UAAAA,OAAC,OAAI,UAAU,2BACb,UAAA7D,MAAC,QAAK,UAAU,aACb,SAAA0K,EAAc,cAAgB,GAAGA,EAAc,aAAa,WAAa,eAC5E,EACC8C,IAA0B,KACzBxN,MAAC,QAAK,UAAW,cAAc0K,EAAc,gBAAkB,UAAY,EAAE,GAC1E,SAAAA,EAAc,gBAAkB,kBAAoB,GAAGlD,GAAegG,EAAsB,CAAE,QACjG,EACE,KACJ3J,OAAC,QAAK,UAAU,aAAc,UAAA6G,EAAc,iBAAiB,iBAAiB,UAAM,EACpF7G,OAAC,QAAK,UAAU,aAAa,iBACtB6G,EAAc,eAAiB,EAAI,IAAM,GAAIA,EAAc,eAClE,EACA7G,OAAC,QAAK,UAAU,aAAc,UAAA6G,EAAc,gBAAgB,iBAAiB,SAAK,EAClF7G,OAAC,QAAK,UAAU,aAAc,UAAA2D,GAAekD,EAAc,mBAAmB,EAAE,YAAQ,GAC1F,EACA1K,MAAC,YACC,UAAU,0BACV,MAAO0K,EAAc,UACrB,SAAW/D,GAAUuG,EAAsBvG,EAAM,OAAO,KAAK,EAC7D,UAAW4G,EACX,YACE7C,EAAc,QAAQ,WAClB,WAAWA,EAAc,QAAQ,UAAU;AAAA;AAAA,2BAC3C,+CAEN,UAAS,IACX,EACF,EAEA7G,OAAC,SAAM,UAAU,wBACf,UAAAA,OAAC,OAAI,UAAU,4BACb,UAAA7D,MAAC,MAAG,yBAAa,EACjBA,MAAC,KAAE,UAAU,yBAAyB,sDAA0C,EAChFA,MAAC,YACC,KAAM,EACN,MAAO0K,EAAc,iBACrB,SAAW/D,GACTgE,EAAkBqC,GAAUA,GAAO,CAAE,GAAGA,EAAM,iBAAkBrG,EAAM,OAAO,MAAe,EAE9F,YAAY,uDACd,EACF,EAEC+D,EAAc,QAAQ,WACrB7G,OAAC,OAAI,UAAU,4BACb,UAAA7D,MAAC,MAAG,kBAAM,EACVA,MAAC,KAAG,SAAA0K,EAAc,QAAQ,WAAW,GACvC,EACE,KAEJ7G,OAAC,OAAI,UAAU,4BACb,UAAA7D,MAAC,MAAG,2BAAe,EACnB6D,OAAC,MAAG,UAAU,8BACZ,UAAAA,OAAC,MAAG,UAAA7D,MAAC,QAAK,kBAAM,EAAOA,MAAC,UAAQ,SAAAwH,GAAekD,EAAc,kBAAkB,EAAE,GAAS,SACzF,MAAG,UAAA1K,MAAC,QAAK,mBAAO,EAAOA,MAAC,UAAQ,SAAAwH,GAAekD,EAAc,mBAAmB,EAAE,GAAS,SAC3F,MAAG,UAAA1K,MAAC,QAAK,sBAAU,EAAOA,MAAC,UAAQ,SAAA0K,EAAc,gBAAgB,gBAAe,CAAE,GAAS,SAC3F,MAAG,UAAA1K,MAAC,QAAK,uBAAW,EAAOA,MAAC,UAAQ,SAAA0K,EAAc,gBAAgB,gBAAe,CAAE,GAAS,SAC5F,MAAG,UAAA1K,MAAC,QAAK,yBAAa,EAAOA,MAAC,UAAQ,SAAA0K,EAAc,kBAAkB,gBAAe,CAAE,GAAS,SAChG,MAAG,UAAA1K,MAAC,QAAK,qBAAS,SAAQ,UAAQ,UAAA0K,EAAc,eAAiB,EAAI,IAAM,GAAIA,EAAc,eAAc,GAAS,GACvH,GACF,GACF,GACF,GACF,EACA1K,MAAC,UAAO,UAAU,iCAAiC,KAAK,SAAS,aAAW,wBAAwB,QAAS,IAAM,KAAK4M,EAAkB,EAAI,EAAG,GACnJ,EACE,MACN,CAEJ,CC5vCA,MAAM6B,GAAU,mBACVC,GAAa,EACbC,GAAa,QAEnB,IAAIC,GAAyC,KAE7C,SAASC,GAAoBC,EAAwB,CACnD,OAAO,IAAI,QAAW,CAACC,EAASC,IAAW,CACzCF,EAAQ,UAAY,IAAMC,EAAQD,EAAQ,MAAM,EAChDA,EAAQ,QAAU,IAAME,EAAOF,EAAQ,OAAS,IAAI,MAAM,0BAA0B,CAAC,CACvF,CAAC,CACH,CAEA,SAASG,GAAgBC,EAA6B,CACpD,OAAO,IAAI,QAAc,CAACH,EAASC,IAAW,CAC5CE,EAAY,WAAa,IAAMH,EAAA,EAC/BG,EAAY,QAAU,IAAMF,EAAOE,EAAY,OAAS,IAAI,MAAM,8BAA8B,CAAC,EACjGA,EAAY,QAAU,IAAMF,EAAOE,EAAY,OAAS,IAAI,MAAM,+BAA+B,CAAC,CACpG,CAAC,CACH,CAEA,SAASC,IAAe,CACtB,OAAKP,KACHA,GAAY,IAAI,QAAqB,CAACG,EAASC,IAAW,CACxD,MAAMF,EAAU,OAAO,UAAU,KAAKL,GAASC,EAAU,EACzDI,EAAQ,gBAAkB,IAAM,CAC9B,MAAMM,EAAKN,EAAQ,OACnB,GAAI,CAACM,EAAG,iBAAiB,SAAST,EAAU,EAAG,CAC7C,MAAMU,EAAQD,EAAG,kBAAkBT,GAAY,CAAE,QAAS,KAAM,EAChEU,EAAM,YAAY,YAAa,YAAa,CAAE,OAAQ,GAAO,EAC7DA,EAAM,YAAY,eAAgB,eAAgB,CAAE,OAAQ,GAAO,CACrE,CACF,EACAP,EAAQ,UAAY,IAAMC,EAAQD,EAAQ,MAAM,EAChDA,EAAQ,QAAU,IAAME,EAAOF,EAAQ,OAAS,IAAI,MAAM,qCAAqC,CAAC,CAClG,CAAC,GAEIF,EACT,CAEA,SAASU,GAAYC,EAAkBC,EAA6C,CAClF,MAAMC,EAAYF,EAAS,cACrBG,GAAaF,GAAY,IAAI,cACnC,OAAIC,EAAU,SAAS,MAAM,GAAKC,IAAc,kBAA0B,MAExED,EAAU,SAAS,OAAO,GAC1BC,IAAc,wBACdA,IAAc,+BAEP,OAEF,SACT,CAEA,SAASC,GAAkBJ,EAAkB,CAO3C,OANmBA,EAAS,QAAQ,WAAY,EAAE,EAE/C,QAAQ,QAAS,GAAG,EACpB,QAAQ,UAAW,GAAG,EACtB,QAAQ,WAAY,KAAK,EACzB,QACkBA,CACvB,CAEA,SAASK,GAAUC,EAAgD,CACjE,KAAM,CAAE,KAAMC,EAAO,GAAGhL,GAAS+K,EACjC,OAAO/K,CACT,CAEA,SAASiL,IAAW,CAClB,OAAI,OAAO,OAAW,KAAe,OAAO,OAAO,YAAe,WACzD,OAAO,aAET,QAAQ,KAAK,KAAK,IAAI,KAAK,SAAS,SAAS,EAAE,EAAE,MAAM,EAAG,EAAE,CAAC,EACtE,CAEO,SAASC,GAAsBC,EAAY,CAChD,OAAOX,GAAYW,EAAK,KAAMA,EAAK,IAAI,IAAM,SAC/C,CAEA,eAAsBC,IAAmD,CAEvE,MAAMhB,GADK,MAAMC,GAAA,GACM,YAAYR,GAAY,UAAU,EAEnDG,EADQI,EAAY,YAAYP,EAAU,EAC1B,SAChBwB,EAAW,MAAMtB,GAAiBC,CAAO,EAC/C,aAAMG,GAAgBC,CAAW,EAC1BiB,EACJ,IAAIP,EAAS,EACb,KAAK,CAACQ,EAAGC,IAAM,CACd,MAAMC,EAAQF,EAAE,cAAgBA,EAAE,WAAaA,EAAE,UAEjD,OADcC,EAAE,cAAgBA,EAAE,WAAaA,EAAE,WAClCC,CACjB,CAAC,CACL,CAEA,eAAsBC,GAAoBC,EAA2C,CACnF,MAAMC,EAAgBD,EAAM,OAAOR,EAAqB,EACxD,GAAI,CAACS,EAAc,OAAQ,MAAO,GAElC,MAAMC,EAAM,KAAK,MAEXxB,GADK,MAAMC,GAAA,GACM,YAAYR,GAAY,WAAW,EACpDU,EAAQH,EAAY,YAAYP,EAAU,EAC1CgC,EAA8B,GAEpC,UAAWV,KAAQQ,EAAe,CAChC,MAAMZ,EAAgC,CACpC,GAAIE,GAAA,EACJ,MAAOJ,GAAkBM,EAAK,IAAI,EAClC,SAAUA,EAAK,KACf,SAAUA,EAAK,OAASX,GAAYW,EAAK,IAAI,IAAM,OAAS,uBAAyB,mBACrF,OAAQX,GAAYW,EAAK,KAAMA,EAAK,IAAI,EACxC,UAAWA,EAAK,KAChB,UAAWS,EACX,UAAWA,EACX,aAAc,KACd,KAAMT,CAAA,EAERZ,EAAM,IAAIQ,CAAM,EAChBc,EAAS,KAAKf,GAAUC,CAAM,CAAC,CACjC,CAEA,aAAMZ,GAAgBC,CAAW,EAC1ByB,CACT,CAEA,eAAsBC,GAAoBC,EAAmE,CAE3G,MAAM3B,GADK,MAAMC,GAAA,GACM,YAAYR,GAAY,WAAW,EACpDU,EAAQH,EAAY,YAAYP,EAAU,EAC1CmC,EAAY,MAAMjC,GAAiBQ,EAAM,IAAIwB,CAAE,CAAC,EACtD,GAAI,CAACC,EACH,aAAM7B,GAAgBC,CAAW,EAC1B,KAGT,MAAM6B,EAAiC,CACrC,GAAGD,EACH,aAAc,KAAK,MACnB,UAAW,KAAK,KAAI,EAEtB,OAAAzB,EAAM,IAAI0B,CAAO,EACjB,MAAM9B,GAAgBC,CAAW,EAE1B,CACL,KAAMU,GAAUmB,CAAO,EACvB,KAAMA,EAAQ,KAElB,CAEA,eAAsBC,GAAsBH,EAA2B,CAErE,MAAM3B,GADK,MAAMC,GAAA,GACM,YAAYR,GAAY,WAAW,EAC1DO,EAAY,YAAYP,EAAU,EAAE,OAAOkC,CAAE,EAC7C,MAAM5B,GAAgBC,CAAW,CACnC,CCrIA,MAAM+B,GAAmB,yBACnBC,GAAmB,EAEzB,SAASnK,GAAiBpH,EAAe,CACvC,MAAMwR,EAAUxR,EAAM,OACtB,OAAKwR,EACEA,EAAQ,SAAS,GAAG,EAAIA,EAAQ,MAAM,EAAG,EAAE,EAAIA,EADjCF,EAEvB,CAEA,SAASG,IAAoB,CAC3B,GAAI,CACF,OAAOrK,GAAiB,OAAO,aAAa,QAAQ,kBAAkB,GAAKkK,EAAgB,CAC7F,MAAQ,CACN,OAAOA,EACT,CACF,CAEA,SAASI,GAAY5J,EAAiB,CACpC,MAAME,EAAQF,EAAU,KACxB,OAAIE,GAAS,GAAW,GAAG,KAAK,MAAMA,CAAK,CAAC,IACrC,GAAGA,EAAM,QAAQ,CAAC,CAAC,GAC5B,CAEA,SAASH,GAAeC,EAAiB,CACvC,MAAM6J,EAAe,KAAK,IAAI,EAAG,KAAK,MAAM7J,EAAU,EAAE,CAAC,EACnDE,EAAQ,KAAK,MAAM2J,EAAe,EAAE,EACpCC,EAAUD,EAAe,GAC/B,OAAI3J,EAAQ,EAAU,GAAGA,CAAK,KAAK4J,CAAO,IACnC,GAAGA,CAAO,GACnB,CAEA,SAASC,GAAeC,EAAa,CAEnC,OADa,IAAI,KAAK,GAAGA,CAAG,WAAW,EAC3B,mBAAmB,GAAI,CAAE,QAAS,QAAS,MAAO,QAAS,IAAK,UAAW,CACzF,CAEA,SAASC,GAAUC,EAAY,CAC7B,MAAMC,EAAQ,IAAI,KAAKD,CAAI,EACvBC,EAAM,WAAaV,IACrBU,EAAM,QAAQA,EAAM,UAAY,CAAC,EAEnC,MAAMC,EAAOD,EAAM,cACbE,EAAQ,OAAOF,EAAM,WAAa,CAAC,EAAE,SAAS,EAAG,GAAG,EACpDH,EAAM,OAAOG,EAAM,SAAS,EAAE,SAAS,EAAG,GAAG,EACnD,MAAO,GAAGC,CAAI,IAAIC,CAAK,IAAIL,CAAG,EAChC,CAEA,SAASM,GAAaC,EAAyB,CAC7C,OAAQA,EAAA,CACN,IAAK,UACH,MAAO,UACT,IAAK,aACH,MAAO,aACT,IAAK,QACH,MAAO,QACT,IAAK,aACH,MAAO,aACT,QACE,OAAOA,CAAA,CAEb,CAEA,SAASC,GAAStS,EAA2B,CAC3C,GAAI,CAACA,EAAO,MAAO,GACnB,MAAMuS,EAAS,KAAK,MAAMvS,CAAK,EAC/B,OAAO,OAAO,SAASuS,CAAM,EAAIA,EAAS,CAC5C,CAEA,eAAehL,EAAaC,EAAiBC,EAAcC,EAAgC,CACzF,MAAMC,EAAW,MAAM,MAAM,GAAGH,CAAO,GAAGC,CAAI,GAAI,CAChD,GAAGC,EACH,MAAO,WACP,QAAS,CACP,eAAgB,mBAChB,GAAIA,GAAM,SAAW,EAAC,CACxB,CACD,EACD,GAAI,CAACC,EAAS,GAAI,CAChB,MAAMC,EAAU,MAAMD,EAAS,OAAO,MAAM,IAAM,IAAI,EAChD6K,EACJ5K,GAAW,OAAOA,GAAY,UAAY,UAAWA,GAAW,OAAOA,EAAQ,OAAU,SACrFA,EAAQ,MACR,mBAAmBD,EAAS,MAAM,IACxC,MAAM,IAAI,MAAM6K,CAAO,CACzB,CACA,OAAO7K,EAAS,MAClB,CAEA,SAAS8K,GAAatJ,EAAa,CACjC,MAAMqI,EAAUrI,EAAI,OACpB,OAAKqI,EACDA,EAAQ,WAAW,SAAS,GAAKA,EAAQ,WAAW,UAAU,EAAUA,EACrE,WAAWA,CAAO,GAFJ,IAGvB,CAEA,SAASkB,GAAU1S,EAAe2S,EAAe,CAC/C,MAAI,CAAC,OAAO,SAASA,CAAK,GAAKA,GAAS,EAAU,EAC3C,KAAK,IAAI,EAAG,KAAK,IAAI,IAAK,KAAK,MAAO3S,EAAQ2S,EAAS,GAAG,CAAC,CAAC,CACrE,CAEA,SAASC,GAAY5S,EAAe,CAClC,GAAI,CAAC,OAAO,SAASA,CAAK,GAAKA,GAAS,EAAG,MAAO,MAClD,MAAM6S,EAAQ,CAAC,IAAK,KAAM,KAAM,IAAI,EACpC,IAAIC,EAAS9S,EACT+S,EAAY,EAChB,KAAOD,GAAU,MAAQC,EAAYF,EAAM,OAAS,GAClDC,GAAU,KACVC,GAAa,EAEf,MAAMC,EAAYF,GAAU,KAAOC,IAAc,EAAI,EAAI,EACzD,MAAO,GAAGD,EAAO,QAAQE,CAAS,CAAC,IAAIH,EAAME,CAAS,CAAC,EACzD,CAEA,SAASE,GAAe9N,EAAuB,CAC7C,OAAIA,EAAK,SAAW,MAAc,MAC9BA,EAAK,SAAW,OAAe,OAC5B,UACT,CAEA,SAAS+N,GAAiB1S,EAAe,CACvC,IAAImI,EAAO,EACX,QAASwK,EAAQ,EAAGA,EAAQ3S,EAAM,OAAQ2S,GAAS,EACjDxK,EAAQA,EAAO,GAAKnI,EAAM,WAAW2S,CAAK,EAAK,EAEjD,MAAMC,EAAM,KAAK,IAAIzK,CAAI,EAAI,IACvB0K,GAAQD,EAAM,IAAM,IAC1B,MAAO,+BAA+BA,CAAG,yBAAyBC,CAAI,mBACxE,CAEA,SAASC,IAAwB,CAC/B,OAAI,OAAO,OAAW,KAAe,OAAO,OAAO,YAAe,WAAmB,OAAO,aACrF,UAAU,KAAK,KAAK,IAAI,KAAK,SAAS,SAAS,EAAE,EAAE,MAAM,EAAG,EAAE,CAAC,EACxE,CAEA,SAASC,GAAgBpO,EAAuB,CAC9C,MAAO,SAASA,EAAK,MAAM,IAAIA,EAAK,QAAQ,IAAIA,EAAK,SAAS,EAChE,CAEA,SAAwBqO,IAAc,CACpC,KAAM,CAACC,EAAMC,CAAO,EAAI3S,WAAe,MAAM,EACvC,CAAC4S,EAAcC,CAAe,EAAI7S,WAAS0Q,EAAiB,EAC5D,CAACjK,EAASqM,CAAU,EAAI9S,WAAS0Q,EAAiB,EAClD,CAACzQ,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAAC+S,EAAYC,CAAa,EAAIhT,WAAS,EAAK,EAC5C,CAACiT,EAAWC,CAAY,EAAIlT,WAAS,EAAK,EAC1C,CAACF,GAAOC,CAAQ,EAAIC,WAAwB,IAAI,EAChD,CAACmT,EAAcC,CAAe,EAAIpT,WAAwB,IAAI,EAC9D,CAACgQ,EAAKqD,CAAM,EAAIrT,WAAS,KAAK,KAAK,EAEnC,CAACsT,EAAQC,CAAS,EAAIvT,WAAyB,CAAE,QAAS,EAAG,EAC7D,CAACwT,EAASC,EAAU,EAAIzT,WAAiC,IAAI,EAC7D,CAAC0T,EAAUC,CAAW,EAAI3T,WAAmC,IAAI,EACjE,CAAC4T,EAAkBC,EAAmB,EAAI7T,WAA2C,IAAI,EACzF,CAAC8T,EAAWC,CAAY,EAAI/T,WAA2B,EAAE,EACzD,CAACgU,EAAcC,CAAe,EAAIjU,WAAwB,EAAE,EAC5D,CAACkU,GAAcC,EAAe,EAAInU,WAA6B,EAAE,EACjE,CAACoU,EAAkBC,CAAmB,EAAIrU,WAA4B,EAAE,EACxE,CAACsU,EAAyBC,CAA0B,EAAIvU,WAAS,EAAI,EACrE,CAACwU,EAAsBC,CAAuB,EAAIzU,WAAS,EAAK,EAChE,CAAC0U,EAAmBC,CAAoB,EAAI3U,WAAwB,IAAI,EACxE,CAAC4U,GAAkBC,CAAmB,EAAI7U,WAAS,EAAK,EACxD,CAAC8U,EAAoBC,CAAqB,EAAI/U,WAAoD,IAAI,EACtG,CAACgV,EAAeC,CAAgB,EAAIjV,WAA+B,IAAI,EACvE,CAACkV,EAAmBC,CAAoB,EAAInV,WAAqC,EAAE,EACnF,CAACoV,EAA0BC,CAA2B,EAAIrV,WAAS,EAAK,EACxE,CAACsV,EAAiBC,EAAkB,EAAIvV,WAAS,EAAE,EACnD,CAACwV,GAAgBC,EAAiB,EAAIzV,WAAS,EAAK,EACpD0V,GAAqB9V,SAAgC,IAAI,EACzD+V,GAAmB/V,SAAsC,IAAI,EAC7DgW,GAAoBhW,SAAqD,IAAI,EAC7E,CAACiW,GAAYC,EAAa,EAAI9V,WAAsC,IAAI,EAExE,CAAC+V,GAAYC,EAAa,EAAIhW,WAAS,EAAE,EACzC,CAACiW,GAAcC,EAAe,EAAIlW,WAAS,EAAE,EAC7C,CAACmW,GAAaC,EAAc,EAAIpW,WAAS,EAAE,EAC3C,CAACqW,GAAgBC,EAAiB,EAAItW,WAAyB,SAAS,EACxE,CAACuW,GAAeC,EAAgB,EAAIxW,WAAS,EAAK,EAClD,CAACyW,GAAcC,EAAe,EAAI1W,WAAwB,IAAI,EAE9D,CAAC2W,GAAWC,EAAY,EAAI5W,WAAS,EAAE,EACvC,CAAC6W,GAAYC,EAAa,EAAI9W,WAAS,EAAK,EAC5C,CAAC+W,GAAaC,EAAc,EAAIhX,WAAwB,IAAI,EAE5DiX,EAAevM,cACnB,MAAOC,EAAS,KAAU,CACnBA,GAAQzK,EAAW,EAAI,EAC5B8S,EAAc,EAAI,EAClBjT,EAAS,IAAI,EACb,GAAI,CACF,MAAMyG,EAA8BC,EAAS,SAAS,EACtD,KAAM,CAACyQ,EAAYC,EAAaC,EAAcC,EAAcC,GAAUC,GAAaC,GAAaC,EAAc,EAAI,MAAM,QAAQ,IAAI,CAClIjR,EAA0BC,EAAS,SAAS,EAC5CD,EAA2BC,EAAS,oCAAoC,EACxED,EAA6BC,EAAS,4BAA4B,EAClED,EAAqCC,EAAS,sCAAsC,EACpFD,EAA4BC,EAAS,+BAA+B,EACpED,EAAyBC,EAAS,UAAU,EAC5CD,EAAyCC,EAAS,+BAA+B,EACjFD,EAAgCC,EAAS,4BAA4B,EACtE,EACD8M,EAAU2D,CAAU,EACpBzD,GAAW0D,CAAW,EACtBxD,EAAYyD,CAAY,EACxBvD,GAAoBwD,CAAY,EAChCtD,EAAauD,EAAQ,EACrBrD,EAAgBsD,EAAW,EAC3BpD,GAAgBqD,GAAY,OAAS,EAAE,EACvC1B,GAAc2B,EAAc,EAC5Bb,GAAaa,GAAe,MAAM,SAAW,EAAE,EAC/CvE,EAAa,EAAI,CACnB,OAAS9Q,EAAW,CAClB8Q,EAAa,EAAK,EAClBnT,EAAUqC,EAAoB,SAAW,+BAA+B,CAC1E,SACElC,EAAW,EAAK,EAChB8S,EAAc,EAAK,CACrB,CACF,EACA,CAACvM,CAAO,GAGJiR,GAA+BhN,cAAY,SAAY,CAC3D,GAAI,CACF,GAAI,CAAC,UAAU,SAAS,SAAU,OAClC,MAAMiN,EAAW,MAAM,UAAU,QAAQ,WACzC5C,EAAsB,CACpB,MAAO4C,EAAS,MAChB,MAAOA,EAAS,MACjB,CACH,MAAQ,CAER,CACF,EAAG,EAAE,EAECC,GAA0BlN,cAAY,MAAOmN,EAAa,KAAU,CACpEA,KAAuC,EAAI,EAC/C,GAAI,CACF,MAAMC,EAAQ,MAAMtI,GAAA,EACpB6E,EAAoByD,CAAK,CAC3B,OAASC,EAAa,CACpBpD,EAAsBoD,EAAsB,SAAW,oCAAoC,CAC7F,SACMF,KAAuC,EAAK,CAClD,CACF,EAAG,EAAE,EAECG,GAActN,cAAY,IAAM,CACpCuK,EAAkBgD,IACZA,GACF,IAAI,gBAAgBA,EAAS,SAAS,EAEjC,KACR,CACH,EAAG,EAAE,EAECC,GAAmBxN,cACvB,MAAOtG,GAA0B,CAC/BuQ,EAAqB,IAAI,EACzB,GAAI,CACF,MAAMwD,EAAS,MAAMjI,GAAoB9L,EAAK,EAAE,EAChD,GAAI,CAAC+T,EAAQ,CACXxD,EAAqB,oDAAoD,EACzE,MAAMiD,GAAA,EACN,MACF,CACA,MAAMQ,EAAY,IAAI,gBAAgBD,EAAO,IAAI,EACjDlD,EAAkBgD,IACZA,GACF,IAAI,gBAAgBA,EAAS,SAAS,EAEjC,CAAE,KAAME,EAAO,KAAM,UAAAC,CAAA,EAC7B,EACD,MAAMR,GAAA,EACNxE,EAAgB,WAAW+E,EAAO,KAAK,KAAK,0BAA0B,CACxE,OAASJ,EAAa,CACpBpD,EAAsBoD,EAAsB,SAAW,sBAAsB,CAC/E,CACF,EACA,CAACH,EAAuB,GAGpBS,GAAoB3N,cACxB,MAAOoF,GAAkB,CACvB,MAAMwI,EAAaxI,EAAM,OAAQP,GAASD,GAAsBC,CAAI,CAAC,EAC/DgJ,EAAgBzI,EAAM,OAASwI,EAAW,OAChD,GAAI,CAACA,EAAW,OAAQ,CACtB3D,EAAqB,4BAA4B,EACjD,MACF,CAEAF,EAAwB,EAAI,EAC5BE,EAAqB,IAAI,EACzB,GAAI,CACF,MAAM1E,EAAW,MAAMJ,GAAoByI,CAAU,EACrD,MAAM,QAAQ,IAAI,CAACV,KAA2BF,GAAA,CAA8B,CAAC,EACzEzH,EAAS,OAAS,IACpBmD,EACEmF,EAAgB,EACZ,SAAStI,EAAS,MAAM,QAAQA,EAAS,SAAW,EAAI,GAAK,GAAG,KAAKsI,CAAa,aAClF,SAAStI,EAAS,MAAM,QAAQA,EAAS,SAAW,EAAI,GAAK,GAAG,gCAElEA,EAAS,SAAW,GACtB,MAAMiI,GAAiBjI,EAAS,CAAC,CAAC,EAGxC,OAAS8H,EAAa,CACpBpD,EAAsBoD,EAAsB,SAAW,gCAAgC,CACzF,SACEtD,EAAwB,EAAK,CAC/B,CACF,EACA,CAACyD,GAAkBN,GAAyBF,EAA4B,GAGpEc,GAAqB9N,cACzB,MAAOtG,GAA0B,CAE/B,GADkB,OAAO,QAAQ,WAAWA,EAAK,KAAK,kCAAkC,EAExF,GAAI,CACF,MAAMkM,GAAsBlM,EAAK,EAAE,EACnC6Q,EAAkBgD,GACZA,GAAU,KAAK,KAAO7T,EAAK,IAC7B,IAAI,gBAAgB6T,EAAS,SAAS,EAC/B,MAEFA,CACR,EACD,MAAM,QAAQ,IAAI,CAACL,KAA2BF,GAAA,CAA8B,CAAC,EAC7EtE,EAAgB,YAAYhP,EAAK,KAAK,iCAAiC,CACzE,OAAS2T,EAAa,CACpBpD,EAAsBoD,EAAsB,SAAW,wBAAwB,CACjF,CACF,EACA,CAACH,GAAyBF,EAA4B,GAGlDe,GAAyB/N,cAAY,SAAY,CACrD,GAAI,CAAC0J,EAAiB,OAAQ,CAC5BhB,EAAgB,wDAAwD,EACxE,MACF,CACA,MAAMsF,EAAStE,EAAiB,KAAK,MAAM,KAAK,SAAWA,EAAiB,MAAM,CAAC,EACnF,MAAM8D,GAAiBQ,CAAM,CAC/B,EAAG,CAACtE,EAAkB8D,EAAgB,CAAC,EAEjCS,GAA8BjO,cAClC,MAAOlD,GAA6B,CAClC,GAAI,CAACwN,GAAiB,CAACY,GAAkB,QAAS,OAClD,MAAMgD,EAAWjD,GAAiB,QAClC,GAAKiD,EACL,GAAI,CACF,MAAMpS,EAAUC,EAAS,gCAAgCmP,GAAkB,QAAQ,SAAS,IAAIpO,CAAI,GAAI,CACtG,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,WAAY,IAAI,OAAO,cACvB,YAAaoR,EAAS,YACtB,WAAYA,EAAS,WACrB,SAAUA,EAAS,SACnB,mBAAoBA,EAAS,mBAC7B,oBAAqBA,EAAS,oBAC9B,eAAgBA,EAAS,eACzB,eAAgBA,EAAS,eACzB,oBAAqBA,EAAS,oBAC9B,cAAeA,EAAS,cACzB,EACF,CACH,MAAQ,CAER,CACF,EACA,CAACnS,EAASuO,CAAa,GAGnB6D,GAA+BnO,cAAakO,GAAqC,CACrFjD,GAAiB,QAAUiD,CAC7B,EAAG,EAAE,EAECE,GAAwBpO,cAC5B,MAAOqO,GAAmB,CACxB1D,EAA4B,EAAI,EAChC,GAAI,CACF,MAAMxO,EAAU,MAAML,EACpBC,EACA,0CAA0C,mBAAmBsS,CAAM,CAAC,cAEtE5D,EAAqB,MAAM,QAAQtO,EAAQ,KAAK,EAAIA,EAAQ,MAAQ,EAAE,CACxE,MAAQ,CACNsO,EAAqB,EAAE,CACzB,SACEE,EAA4B,EAAK,CACnC,CACF,EACA,CAAC5O,CAAO,GAGJuS,GAAyBtO,cAC7B,MAAOlD,GAA+B,CACpC,GAAI,CAACwN,EAAe,OACpB,MAAM4D,EAAWjD,GAAiB,QAClC,GAAI,CAACiD,EAAU,CACbxF,EAAgB,wDAAwD,EACxE,MACF,CACA,MAAM2F,EAASvG,GAAgBwC,EAAc,IAAI,EAC3CiE,EAAW3D,EAAgB,OACjC,GAAI9N,IAAS,QAAU,CAACyR,EAAU,CAChC7F,EAAgB,qBAAqB,EACrC,MACF,CACAqC,GAAkB,EAAI,EACtB,GAAI,CACF,MAAMjP,EAAUC,EAAS,kCAAmC,CAC1D,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,OAAAsS,EACA,MAAO/D,EAAc,KAAK,MAC1B,KAAAxN,EACA,UAAWoO,GAAkB,SAAS,WAAa,KACnD,YAAagD,EAAS,YACtB,WAAYA,EAAS,WACrB,SAAUA,EAAS,SACnB,cAAeA,EAAS,cACxB,aAAc,KACd,SAAUpR,IAAS,OAASyR,EAAW,KACxC,EACF,EACGzR,IAAS,QAAQ+N,GAAmB,EAAE,EAC1C,MAAM,QAAQ,IAAI,CAACuD,GAAsBC,CAAM,EAAG9B,EAAa,EAAI,CAAC,CAAC,EACrE7D,EAAgB5L,IAAS,OAAS,cAAgB,kBAAkB,CACtE,OAAS0R,EAAiB,CACxB9F,EAAiB8F,EAA0B,SAAW,4BAA4B,CACpF,SACEzD,GAAkB,EAAK,CACzB,CACF,EACA,CAACH,EAAiB7O,EAASwQ,EAAc6B,GAAuB9D,CAAa,GAGzEmE,GAAyBzO,cAC7B,MAAOyF,GAAe,CACpB,GAAK6E,EACL,CAAAS,GAAkB,EAAI,EACtB,GAAI,CACF,MAAMjP,EAAUC,EAAS,mCAAmC0J,CAAE,GAAI,CAAE,OAAQ,SAAU,EACtF,MAAM,QAAQ,IAAI,CAAC2I,GAAsBtG,GAAgBwC,EAAc,IAAI,CAAC,EAAGiC,EAAa,EAAI,CAAC,CAAC,EAClG7D,EAAgB,qBAAqB,CACvC,OAAS8F,EAAiB,CACxB9F,EAAiB8F,EAA0B,SAAW,8BAA8B,CACtF,SACEzD,GAAkB,EAAK,CACzB,EACF,EACA,CAAChP,EAASwQ,EAAc6B,GAAuB9D,CAAa,GAG9D/S,YAAU,IAAM,CACdgV,EAAA,CACF,EAAG,CAACA,CAAY,CAAC,EAEjBhV,YAAU,IAAM,CACT2V,GAAwB,EAAI,EAC5BF,GAAA,CACP,EAAG,CAACE,GAAyBF,EAA4B,CAAC,EAE1DzV,YAAU,IAAM,CACd,MAAMmX,EAAU,OAAO,YAAY,IAAM/F,EAAO,KAAK,KAAK,EAAG,GAAM,EACnE,MAAO,IAAM,OAAO,cAAc+F,CAAO,CAC3C,EAAG,EAAE,EAELnX,YAAU,IAAM,CACd,MAAMoX,EAAY,OAAO,YAAY,IAAMpC,EAAa,EAAI,EAAG,IAAM,EACrE,MAAO,IAAM,OAAO,cAAcoC,CAAS,CAC7C,EAAG,CAACpC,CAAY,CAAC,EAEjBhV,YAAU,IAAM,CACd,MAAMqX,EAAsB,IAAM,CAC5B,SAAS,kBAAoB,WAC1BrC,EAAa,EAAI,CAE1B,EACA,cAAO,iBAAiB,QAASqC,CAAmB,EACpD,SAAS,iBAAiB,mBAAoBA,CAAmB,EAC1D,IAAM,CACX,OAAO,oBAAoB,QAASA,CAAmB,EACvD,SAAS,oBAAoB,mBAAoBA,CAAmB,CACtE,CACF,EAAG,CAACrC,CAAY,CAAC,EAEjBhV,YAAU,IAAM,CACd,GAAI,CACF,OAAO,aAAa,QAAQ,mBAAoBwE,CAAO,CACzD,MAAQ,CAER,CACF,EAAG,CAACA,CAAO,CAAC,EAEZxE,YAAU,IAAM,CACd,GAAI,CAAC+S,EAAe,OACpB,MAAM3I,EAAapG,GAAyB,CACtCA,EAAM,MAAQ,UAAU+R,GAAA,CAC9B,EACA,cAAO,iBAAiB,UAAW3L,CAAS,EACrC,IAAM,OAAO,oBAAoB,UAAWA,CAAS,CAC9D,EAAG,CAAC2L,GAAahD,CAAa,CAAC,EAE/B/S,YAAU,IACD,IAAM,CACP+S,GACF,IAAI,gBAAgBA,EAAc,SAAS,CAE/C,EACC,CAACA,CAAa,CAAC,EAElB/S,YAAU,IAAM,CACd,GAAI,CAAC+S,EAAe,CAClBY,GAAkB,QAAU,KAC5BD,GAAiB,QAAU,KAC3BR,EAAqB,EAAE,EACvBI,GAAmB,EAAE,EACrB,MACF,CAEA,MAAMgE,EAAoBhH,GAAA,EACpBwG,EAASvG,GAAgBwC,EAAc,IAAI,EACjDY,GAAkB,QAAU,CAAE,UAAW2D,EAAmB,OAAAR,CAAA,EAC5DpD,GAAiB,QAAU,KAC3BJ,GAAmB,EAAE,EAChBuD,GAAsBC,CAAM,GAGhC,SAAY,CACX,GAAI,CACF,MAAMvS,EAAUC,EAAS,qCAAsC,CAC7D,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,UAAW8S,EACX,OAAAR,EACA,MAAO/D,EAAc,KAAK,MAC1B,SAAUA,EAAc,KAAK,SAC7B,OAAQA,EAAc,KAAK,OAC3B,cAAe,eAChB,EACF,CACH,MAAQ,CAIR,CACF,KAEA,MAAMwE,EAAgB,OAAO,YAAY,IAAM,CACxCb,GAA4B,UAAU,CAC7C,EAAG,GAAI,EAEP,MAAO,IAAM,CAEX,OAAO,cAAca,CAAa,EAC7Bb,GAA4B,KAAK,EACjC1B,EAAa,EAAI,EACtBrB,GAAkB,QAAU,IAC9B,CACF,EAAG,CAACnP,EAASwQ,EAAc6B,GAAuBH,GAA6B3D,CAAa,CAAC,EAE7F,MAAMyE,GAAc5X,UAAQ,IAAM2R,GAAS,aAAa,MAAM,EAAG,CAAC,GAAK,GAAI,CAACA,CAAO,CAAC,EAC9EkG,GAAgB7X,UAAQ,IAAM,CAClC,MAAM8X,EAAYjG,GAAU,kBAC5B,OAAKiG,EACEA,EAAU,WAAaA,EAAU,QAAUA,EAAU,UAAYA,EAAU,SAAWA,EAAU,KADhF,CAEzB,EAAG,CAACjG,CAAQ,CAAC,EAEPkG,GAAW/X,UAAQ,IAClBiS,EAAU,OACR,CAAC,GAAGA,CAAS,EAAE,KAAK,CAACpE,EAAGC,IAAMA,EAAE,WAAaD,EAAE,UAAU,EAAE,CAAC,GAAK,KAD1C,KAE7B,CAACoE,CAAS,CAAC,EAER+F,GAAahY,UAAQ,IAAM,CAC/B,MAAMiY,EAAa9F,EAChB,OAAQhR,GAASA,EAAK,OAAS,OAAS,CAACA,EAAK,UAAU,EACxD,KAAK,CAAC0M,EAAGC,KAAM4B,GAAS7B,EAAE,YAAcA,EAAE,SAAS,EAAI6B,GAAS5B,GAAE,YAAcA,GAAE,SAAS,CAAC,EAC5F,MAAM,EAAG,CAAC,EACV,IAAK3M,IAAU,CACd,GAAI,WAAWA,EAAK,EAAE,GACtB,KAAM,UACN,MAAOA,EAAK,OAASA,EAAK,OAC1B,SAAUA,EAAK,MAAQA,EAAK,KAAOA,EAAK,OACxC,IAAKA,EAAK,IACV,QAASA,EAAK,QACd,UAAWA,EAAK,IAChB,EAEE+W,EAAU7F,GAAa,MAAM,EAAG,CAAC,EAAE,IAAKlR,IAAU,CACtD,GAAI,WAAWA,EAAK,EAAE,GACtB,KAAM,UACN,MAAOA,EAAK,MACZ,SAAUA,EAAK,UAAYA,EAAK,OAAO,cACvC,IAAKA,EAAK,OAAO,OAAS,WAAaA,EAAK,OAAO,IAAM,OACzD,OAAQA,EAAK,OACb,SAAUA,EAAK,UACf,EAEIgX,EAAwE,GACxEC,EAAM,KAAK,IAAIH,EAAW,OAAQC,EAAQ,MAAM,EACtD,QAASG,EAAM,EAAGA,EAAMD,EAAKC,GAAO,EAC9BJ,EAAWI,CAAG,KAAU,KAAKJ,EAAWI,CAAG,CAAC,EAC5CH,EAAQG,CAAG,KAAU,KAAKH,EAAQG,CAAG,CAAC,EAE5C,OAAOF,EAAO,MAAM,EAAG,CAAC,CAC1B,EAAG,CAAChG,EAAcE,EAAY,CAAC,EAEzBiG,GAAuBtY,UAAQ,IAAMuS,EAAiB,CAAC,GAAK,KAAM,CAACA,CAAgB,CAAC,EACpFgG,GAAoBvY,UAAQ,IAAMuS,EAAiB,MAAM,EAAG,CAAC,EAAG,CAACA,CAAgB,CAAC,EAClFiG,GAAyBxY,UAC7B,IACEqT,EAAkB,OAChB,CAAClK,EAAKsP,KACAA,EAAW,OAAS,cAAatP,EAAI,YAAc,GACnDsP,EAAW,OAAS,SAAQtP,EAAI,OAAS,GACtCA,GAET,CAAE,WAAY,EAAG,MAAO,EAAE,EAE9B,CAACkK,CAAiB,GAEdqF,GAAqB1Y,UACzB,IACEuS,EAAiB,OACf,CAACpJ,EAAK5G,KACAA,EAAK,SAAW,QAAO4G,EAAI,KAAO,GAClC5G,EAAK,SAAW,SAAQ4G,EAAI,MAAQ,GACpC5G,EAAK,eAAc4G,EAAI,QAAU,GAC9BA,GAET,CAAE,IAAK,EAAG,KAAM,EAAG,OAAQ,EAAE,EAEjC,CAACoJ,CAAgB,GAEboG,GAAqB1F,GAAoB,MAC3C,GAAGjD,GAAYiD,EAAmB,KAAK,CAAC,QAAQA,EAAmB,MAAQ,MAAMjD,GAAYiD,EAAmB,KAAK,CAAC,SAAW,EAAE,GACnI,yCAEE2F,GAAqB,IAAM,CAC/B3H,EAAWzM,GAAiBuM,CAAY,CAAC,CAC3C,EAEM8H,GAAsB,MAAOzU,GAAqB,CACtDA,EAAM,iBACNyQ,GAAgB,IAAI,EACpB,MAAMiE,EAAajJ,GAAaqE,EAAU,EAC1C,GAAI,CAAC4E,EAAY,CACfjE,GAAgB,oBAAoB,EACpC,MACF,CACAF,GAAiB,EAAI,EACrB,GAAI,CACF,MAAMhQ,EAAuBC,EAAS,WAAY,CAChD,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,KAAM,MACN,IAAKkU,EACL,MAAO1E,GAAa,QAAU,OAC9B,KAAME,GAAY,QAAU,OAC5B,QAASE,EAAA,CACV,EACF,EACDL,GAAc,EAAE,EAChBE,GAAgB,EAAE,EAClBE,GAAe,EAAE,EACjBE,GAAkB,SAAS,EAC3B,MAAMW,EAAa,EAAI,EACvBtE,EAAQ,SAAS,CACnB,OAASiI,EAAa,CACpBlE,GAAiBkE,EAAsB,SAAW,iBAAiB,CACrE,SACEpE,GAAiB,EAAK,CACxB,CACF,EAEMqE,GAAiB,MAAO7X,GAAsB,CAClD,GAAI,GAACA,EAAK,IAAMA,EAAK,YACrB,GAAI,CACF,MAAMqN,EAAU,MAAM7J,EAAuBC,EAAS,YAAYzD,EAAK,EAAE,GAAI,CAC3E,OAAQ,QACR,KAAM,KAAK,UAAU,CACnB,WAAY,IAAI,OAAO,aAAY,CACpC,EACF,EACDiR,EAAiB3H,GAASA,EAAK,IAAKwO,GAAWA,EAAM,KAAOzK,EAAQ,GAAKA,EAAUyK,CAAM,CAAC,CAC5F,OAASjN,EAAW,CAClB9N,EAAU8N,EAAoB,SAAW,+BAA+B,CAC1E,CACF,EAEMkN,GAAiB,MAAO9U,GAAqB,CACjDA,EAAM,iBACN6Q,GAAc,EAAI,EAClB,GAAI,CACF,MAAM/F,EAAMC,GAAU,IAAI,IAAM,EAC1BS,EAAUkF,GAAU,OACpBqE,EAAY,MAAMxU,EAAgCC,EAAS,6BAA8B,CAC7F,OAAQ,OACR,KAAM,KAAK,UAAU,CACnB,gBAAiBsK,EACjB,KAAMU,EACF,CACE,IAAAV,EACA,QAAAU,EACA,YAAa,KACb,aAAc,IAEhB,KACL,EACF,EACDqE,GAAckF,CAAS,EACvBpE,GAAaoE,EAAU,MAAM,SAAW,EAAE,EAC1ChE,GAAe,KAAK,KAAK,CAC3B,OAASiE,EAAW,CAClBlb,EAAUkb,EAAoB,SAAW,sBAAsB,CACjE,SACEnE,GAAc,EAAK,CACrB,CACF,EAEMoE,GAAerF,IAAY,MAAM,IAAM/E,GAAe+E,GAAW,KAAK,GAAG,EAAI,KAEnF,OACE1S,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,OAAI,UAAU,gBACb,UAAAA,OAAC,OAAI,UAAU,sBAAsB,cAAW,GAC9C,UAAA7D,MAAC,OAAI,UAAU,YAAY,EAC3BA,MAAC,QAAK,kCAAsB,GAC9B,EACA6D,OAAC,OAAI,UAAU,qBACb,UAAA7D,MAAC,QAAK,UAAW,QAAQ2T,EAAY,UAAY,QAAQ,GAAK,SAAAA,EAAY,gBAAkB,cAAc,EAC1G9P,OAAC,QAAK,UAAU,iBAAkB,UAAAmQ,EAAO,QAAQ,YAAQ,GAC3D,GACF,EAEAnQ,OAAC,SAAM,UAAU,UACf,UAAAA,OAAC,OAAI,UAAU,QACb,UAAA7D,MAAC,OAAI,UAAU,OAAO,aAAC,EACvBA,MAAC,QAAK,oBAAQ,GAChB,EAEA6D,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,UAAO,UAAWoT,IAAS,OAAS,SAAW,GAAI,QAAS,IAAMC,EAAQ,MAAM,EAAG,gBAEpF,EACArT,MAAC,UAAO,UAAWoT,IAAS,UAAY,SAAW,GAAI,QAAS,IAAMC,EAAQ,SAAS,EAAG,mBAE1F,EACArT,MAAC,UAAO,UAAWoT,IAAS,UAAY,SAAW,GAAI,QAAS,IAAMC,EAAQ,SAAS,EAAG,mBAE1F,GACF,EAEAxP,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,UACb,UAAA7D,MAAC,QAAK,UAAU,OAAO,cAAE,EACzBA,MAAC,QAAK,UAAU,SAAU,WAAO,QAAQ,GAC3C,EACAA,MAAC,OAAI,UAAU,OAAQ,WAAW,GAAGoU,EAAS,iBAAiB,eAAiB,0BAA0B,GAC5G,EAEAvQ,OAAC,OAAI,UAAU,iBACb,UAAA7D,MAAC,SAAM,QAAQ,WAAW,qBAAS,EACnCA,MAAC,SACC,GAAG,WACH,MAAOsT,EACP,SAAW3M,GAAU4M,EAAgB5M,EAAM,OAAO,KAAK,EACvD,YAAasK,EAAA,GAEfjR,MAAC,UAAO,UAAU,UAAU,KAAK,SAAS,QAASmb,GAAoB,mBAEvE,GACF,GACF,QAEC,QAAK,UAAU,wBACd,SAAAtX,OAAC,WAAQ,UAAU,QACjB,UAAAA,OAAC,UAAO,UAAU,eAChB,UAAAA,OAAC,OACC,UAAA7D,MAAC,MAAG,wBAAY,EAChBA,MAAC,KAAE,UAAU,SAAS,wEAA4D,GACpF,EACA6D,OAAC,OAAI,UAAU,qBACb,UAAA7D,MAAC,QAAK,UAAU,aAAc,aAAI,KAAK0Q,CAAG,EAAE,eAAe,GAAI,CAAE,UAAW,SAAU,UAAW,QAAS,EAAE,EAC5G1Q,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM2X,EAAA,EAClC,SAAAlE,EAAa,gBAAkB,UAClC,GACF,GACF,EAECjT,IAASR,MAAC,OAAI,UAAU,wBAAyB,SAAAQ,GAAM,EACvDqT,GAAgB7T,MAAC,OAAI,UAAU,yBAA0B,SAAA6T,EAAa,EACtElT,EAAUX,MAAC,OAAI,UAAU,OAAO,+BAAmB,EAAS,KAE5D,CAACW,GAAWyS,IAAS,QACpBvP,OAAC,OAAI,UAAU,2BACb,UAAAA,OAAC,WACC,UAAW,wCAAwCyR,GAAmB,cAAgB,EAAE,GACxF,YAAc3O,GAAU,CACtBA,EAAM,iBACN4O,EAAoB,EAAI,CAC1B,EACA,WAAa5O,GAAU,CACrBA,EAAM,iBACD2O,IAAkBC,EAAoB,EAAI,CACjD,EACA,YAAc5O,GAAU,CACtBA,EAAM,iBACF,CAAAA,EAAM,cAAc,SAASA,EAAM,aAA4B,GACnE4O,EAAoB,EAAK,CAC3B,EACA,OAAS5O,GAAU,CACjBA,EAAM,iBACN4O,EAAoB,EAAK,EACpBwD,GAAkB,MAAM,KAAKpS,EAAM,aAAa,OAAS,EAAE,CAAC,CACnE,EAEA,UAAA9C,OAAC,OAAI,UAAU,wBACb,UAAAA,OAAC,OAAI,UAAU,wBACb,UAAA7D,MAAC,KAAE,UAAU,UAAU,wBAAY,EACnCA,MAAC,MAAG,4DAAgD,EACpDA,MAAC,KAAE,UAAU,SAAS,2IAEtB,EACA6D,OAAC,OAAI,UAAU,sBACb,UAAAA,OAAC,QAAK,UAAU,iBAAkB,UAAAiR,EAAiB,OAAO,UAAM,EAChEjR,OAAC,QAAK,UAAU,aAAc,UAAAoX,GAAmB,IAAI,SAAK,EAC1DpX,OAAC,QAAK,UAAU,aAAc,UAAAoX,GAAmB,KAAK,UAAM,EAC5DpX,OAAC,QAAK,UAAU,aAAc,UAAAoX,GAAmB,OAAO,WAAO,GACjE,EACApX,OAAC,OAAI,UAAU,qBACb,UAAA7D,MAAC,UACC,UAAU,UACV,KAAK,SACL,QAAS,IAAMoW,GAAmB,SAAS,QAC3C,SAAUlB,EAET,WAAuB,eAAiB,sBAE3ClV,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKmZ,GAAA,EAA0B,kCAEpE,GACF,EACAnZ,MAAC,KAAE,UAAU,6BAA8B,SAAAkb,GAAmB,EAC9Dlb,MAAC,SACC,IAAKoW,GACL,KAAK,OACL,OAAO,kDACP,SAAQ,GACR,OAAM,GACN,SAAWzP,GAAU,CACnB,MAAM6J,EAAQ,MAAM,KAAK7J,EAAM,OAAO,OAAS,EAAE,EACjDA,EAAM,OAAO,MAAQ,GAChBoS,GAAkBvI,CAAK,CAC9B,IAED4E,EAAoBpV,MAAC,KAAE,UAAU,0BAA2B,WAAkB,EAAO,MACxF,EAEAA,MAAC,OAAI,UAAU,6BACZ,WACCA,MAAC,OAAI,UAAU,mBACb,eAAC,UAAO,qCAAyB,EACnC,EACE6a,GACFhX,OAAAsK,WAAA,CACE,UAAAnO,MAAC,UACC,KAAK,SACL,UAAU,0BACV,QAAS,IAAM,KAAK4Y,GAAiBiC,EAAoB,EACzD,aAAY,QAAQA,GAAqB,KAAK,GAE9C,SAAAhX,OAAC,QACC,UAAU,mBACV,MAAO,CAAE,WAAYgP,GAAiBgI,GAAqB,KAAK,GAChE,cAAY,OAEZ,UAAA7a,MAAC,QAAK,UAAU,yBAA0B,SAAA4S,GAAeiI,EAAoB,EAAE,EAC/E7a,MAAC,QAAK,UAAU,yBAA0B,YAAqB,MAAM,QACpE,QAAK,UAAU,wBAAyB,SAAAuS,GAAYsI,GAAqB,SAAS,EAAE,IACvF,GAEFhX,OAAC,OAAI,UAAU,4BACb,UAAA7D,MAAC,QAAK,UAAU,aAAa,6BAAiB,EAC9CA,MAAC,UAAQ,SAAA6a,GAAqB,MAAM,EACpC7a,MAAC,QAAK,UAAU,SAAU,YAAqB,SAAS,EACxD6D,OAAC,OAAI,UAAU,mBACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK4Y,GAAiBiC,EAAoB,EAAG,gBAElF,EACA7a,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKkZ,GAAmB2B,EAAoB,EAAG,kBAEpF,GACF,GACF,GACF,EAEAhX,OAAC,OAAI,UAAU,mBACb,UAAA7D,MAAC,UAAO,+CAAmC,EAC3CA,MAAC,KAAE,UAAU,SAAS,4FAAgF,GACxG,EAEJ,GACF,EAEC8a,GAAkB,OACjB9a,MAAC,OAAI,UAAU,wBACZ,SAAA8a,GAAkB,IAAKhW,GACtBjB,OAAC,WAEC,UAAW,yBAAyB6R,GAAe,KAAK,KAAO5Q,EAAK,GAAK,SAAW,EAAE,GAEtF,UAAA9E,MAAC,UACC,KAAK,SACL,UAAU,oCACV,QAAS,IAAM,KAAK4Y,GAAiB9T,CAAI,EACzC,aAAY,QAAQA,EAAK,KAAK,GAE9B,SAAAjB,OAAC,QACC,UAAU,8BACV,MAAO,CAAE,WAAYgP,GAAiB/N,EAAK,KAAK,GAChD,cAAY,OAEZ,UAAA9E,MAAC,QAAK,UAAU,+BAAgC,SAAA4S,GAAe9N,CAAI,EAAE,EACrE9E,MAAC,QAAK,UAAU,8BAA+B,WAAK,MAAM,IAC5D,GAEF6D,OAAC,OAAI,UAAU,6BACb,UAAAA,OAAC,OACC,UAAA7D,MAAC,UAAQ,WAAK,MAAM,EACpBA,MAAC,QAAK,UAAU,SAAU,WAAK,SAAS,QACvC,QAAK,UAAU,SAAU,SAAAuS,GAAYzN,EAAK,SAAS,EAAE,GACxD,EACAjB,OAAC,OAAI,UAAU,mBACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK4Y,GAAiB9T,CAAI,EAAG,gBAElE,EACA9E,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKkZ,GAAmBpU,CAAI,EAAG,kBAEpE,GACF,GACF,IAhCKA,EAAK,GAkCb,EACH,EACE,cAGL+E,GAAA,CAAmB,QAAA1C,EAAkB,QAAQ,eAAe,QAAQ,MAAM,EAE3EtD,OAAC,WAAQ,UAAU,OACjB,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA7D,MAAC,MAAG,0BAAc,EAClBA,MAAC,QAAK,UAAU,aAAc,WAAmB,GAAGsU,EAAiB,UAAU,WAAa,cAAc,GAC5G,EACAzQ,OAAC,OAAI,UAAU,gBACb,UAAAA,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,uBAAW,EACpCA,MAAC,UAAQ,SAAAsU,GAAkB,MAAM,WAAa,EAAE,GAClD,EACAzQ,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,uBAAW,QACnC,UAAS,UAAAsU,GAAkB,MAAM,WAAa,GAAG,gBAAe,CAAE,GACrE,EACAzQ,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,wBAAY,QACpC,UAAQ,SAAAwH,GAAe8M,GAAkB,MAAM,eAAiB,CAAC,EAAE,GACtE,EACAzQ,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,wBAAY,EACrCA,MAAC,UAAQ,SAAAsU,GAAkB,KAAK,cAAc,QAAQ,CAAC,GAAK,MAAM,GACpE,EACAzQ,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,6BAAiB,EAC1CA,MAAC,UAAQ,SAAAsU,GAAkB,YAAY,YAAc,EAAE,GACzD,EACAzQ,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,6BAAiB,EAC1CA,MAAC,UAAQ,SAAAsU,GAAkB,YAAY,OAAS,EAAE,GACpD,GACF,EACCA,GAAkB,YACjBzQ,OAAC,OAAI,UAAU,yBACb,UAAA7D,MAAC,UAAQ,SAAAsU,EAAiB,YAAY,MAAM,EAC5CzQ,OAAC,QAAK,UAAU,SACb,UAAAyQ,EAAiB,YAAY,WAC1B,GAAGA,EAAiB,YAAY,aAAe,CAAC,IAAIA,EAAiB,YAAY,UAAU,MAC3F,GACHA,EAAiB,YAAY,UAAY,KACtC,GAAG,KAAK,MAAMA,EAAiB,YAAY,SAAW,GAAG,CAAC,aAC1D,eACN,GACF,EAEAtU,MAAC,KAAE,UAAU,SAAS,iEAAqD,GAE/E,EAEA6D,OAAC,WAAQ,UAAU,OACjB,UAAA7D,MAAC,MAAG,0BAAc,EACjBsU,GAAkB,OAAO,OACxBtU,MAAC,OAAI,UAAU,oBACZ,SAAAsU,EAAiB,MAAM,IAAKuH,GAAU,CACrC,MAAMC,EAAW,KAAK,IAAI,EAAG,GAAGxH,EAAiB,MAAM,IAAKyH,GAAMA,EAAE,SAAS,CAAC,EACxEC,EAAM,KAAK,MAAOH,EAAM,UAAYC,EAAY,GAAG,EACzD,OACEjY,OAAC,OAAoB,UAAU,sBAC7B,UAAAA,OAAC,OAAI,UAAU,uBACb,UAAA7D,MAAC,QAAM,SAAAwR,GAAeqK,EAAM,GAAG,EAAE,SAChC,QAAM,UAAAA,EAAM,UAAU,OAAKA,EAAM,UAAU,iBAAiB,KAAC,GAChE,EACA7b,MAAC,OAAI,UAAU,oCACb,eAAC,QAAK,MAAO,CAAE,MAAO,GAAG,KAAK,IAAI6b,EAAM,UAAY,EAAI,EAAI,EAAGG,CAAG,CAAC,IAAI,CAAG,EAC5E,IAPQH,EAAM,GAQhB,CAEJ,CAAC,EACH,QAEC,KAAE,UAAU,SAAS,6CAAiC,EAExDvH,GAAkB,UAAU,aAC1B,MAAG,UAAU,mBACX,SAAAA,EAAiB,SAAS,IAAK9F,GAC9BxO,MAAC,MAAkB,YAAVwO,CAAkB,CAC5B,EACH,EACE,MACN,EAEA3K,OAAC,WAAQ,UAAU,OACjB,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA7D,MAAC,MAAG,yBAAa,EACjBA,MAAC,QAAK,UAAU,aAAc,WAAW,GAAGoU,EAAS,UAAU,SAAW,aAAa,GACzF,EACAvQ,OAAC,OAAI,UAAU,gBACb,UAAAA,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,kBAAM,QAC9B,UAAQ,SAAAkU,EAAU1M,GAAe0M,EAAQ,YAAY,EAAI,KAAK,GACjE,EACArQ,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,qBAAS,QACjC,UAAQ,SAAAkU,EAAU1M,GAAe0M,EAAQ,eAAe,EAAI,KAAK,GACpE,EACArQ,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,uBAAW,EACpCA,MAAC,UAAQ,SAAAoU,EAAWA,EAAS,kBAAoB,EAAE,GACrD,EACAvQ,OAAC,OAAI,UAAU,WACb,UAAA7D,MAAC,QAAK,UAAU,SAAS,oBAAQ,EACjCA,MAAC,UAAQ,SAAAoU,EAAWA,EAAS,cAAgB,EAAE,GACjD,GACF,EACAvQ,OAAC,OAAI,UAAU,eACb,UAAAA,OAAC,QAAK,UAAU,eAAe,kBAAMuQ,EAAW,GAAGA,EAAS,kBAAkB,MAAQ,MAAK,EAC3FvQ,OAAC,QAAK,UAAU,eAAe,kBAAMuQ,EAAW,GAAGA,EAAS,QAAQ,MAAQ,MAAK,EACjFpU,MAAC,QAAK,UAAU,aAAc,YAAW,cAAcsa,GAAS,IAAI,MAAQ,eAAe,GAC7F,GACF,EAEAzW,OAAC,WAAQ,UAAU,OACjB,UAAA7D,MAAC,MAAG,yBAAa,EACjB6D,OAAC,OAAI,UAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,OACC,UAAA7D,MAAC,QAAK,sBAAU,QACf,UAAQ,SAAAqR,GAAY+C,GAAU,kBAAkB,YAAc,CAAC,EAAE,GACpE,QACC,OAAI,UAAU,mBACb,SAAApU,MAAC,QAAK,MAAO,CAAE,MAAO,GAAGqS,GAAU+B,GAAU,kBAAkB,YAAc,EAAGgG,EAAa,CAAC,KAAO,EACvG,GACF,EACAvW,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,OACC,UAAA7D,MAAC,QAAK,mBAAO,QACZ,UAAQ,SAAAqR,GAAY+C,GAAU,kBAAkB,SAAW,CAAC,EAAE,GACjE,QACC,OAAI,UAAU,2BACb,SAAApU,MAAC,QAAK,MAAO,CAAE,MAAO,GAAGqS,GAAU+B,GAAU,kBAAkB,SAAW,EAAGgG,EAAa,CAAC,KAAO,EACpG,GACF,EACAvW,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,OACC,UAAA7D,MAAC,QAAK,qBAAS,QACd,UAAQ,SAAAqR,GAAY+C,GAAU,kBAAkB,WAAa,CAAC,EAAE,GACnE,QACC,OAAI,UAAU,6BACb,SAAApU,MAAC,QAAK,MAAO,CAAE,MAAO,GAAGqS,GAAU+B,GAAU,kBAAkB,WAAa,EAAGgG,EAAa,CAAC,KAAO,EACtG,GACF,GACF,GACF,EAEAvW,OAAC,WAAQ,UAAU,OACjB,UAAA7D,MAAC,MAAG,wBAAY,EACfma,GAAY,OACXna,MAAC,MAAG,UAAU,WACX,SAAAma,GAAY,IAAK8B,GAChBpY,OAAC,MACC,UAAAA,OAAC,OACC,UAAA7D,MAAC,UAAQ,WAAQ,MAAM,QACtB,QAAK,UAAU,SAAU,SAAAic,EAAQ,UAAY,gBAAgB,GAChE,EACAjc,MAAC,QAAM,SAAAwH,GAAeyU,EAAQ,OAAO,EAAE,IALhC,GAAGA,EAAQ,KAAK,IAAIA,EAAQ,OAAO,EAM5C,CACD,EACH,EAEAjc,MAAC,KAAE,UAAU,SAAS,gCAAoB,GAE9C,EAEA6D,OAAC,WAAQ,UAAU,OACjB,UAAA7D,MAAC,MAAG,yBAAa,EAChBua,GAAW,OACVva,MAAC,MAAG,UAAU,WACX,SAAAua,GAAW,IAAK7W,GACfG,OAAC,MACC,UAAAA,OAAC,OACC,UAAA7D,MAAC,UAAQ,WAAK,MAAM,EACpBA,MAAC,QAAK,UAAU,SAAU,WAAK,SAAS,GAC1C,EACA6D,OAAC,OAAI,UAAU,mBACZ,UAAAH,EAAK,OAAS,UAAY1D,MAAC,QAAK,UAAU,aAAc,SAAA+R,GAAarO,EAAK,OAAO,EAAE,EAAU,KAC7FA,EAAK,OAAS,WAAa,OAAOA,EAAK,UAAa,SACnDG,OAAC,QAAK,UAAU,aAAc,eAAK,MAAMH,EAAK,SAAW,GAAG,EAAE,KAAC,EAC7D,KACHA,EAAK,IACJ1D,MAAC,KAAE,KAAM0D,EAAK,IAAK,OAAO,SAAS,IAAI,aAAa,gBAEpD,QAEC,QAAK,UAAU,SAAS,wBAAY,GAEzC,IAjBOA,EAAK,EAkBd,CACD,EACH,EAEA1D,MAAC,KAAE,UAAU,SAAS,uCAA2B,GAErD,EAEA6D,OAAC,WAAQ,UAAU,sBACjB,UAAA7D,MAAC,MAAG,gCAAoB,EACvBoU,GAAU,UAAU,OACnBpU,MAAC,MAAG,UAAU,mBACX,SAAAoU,EAAS,SAAS,IAAK5F,GACtBxO,MAAC,MAAkB,SAAAwO,GAAVA,CAAkB,CAC5B,EACH,EAEAxO,MAAC,KAAE,UAAU,SAAS,mEAAuD,GAEjF,GACF,EAGD,CAACW,GAAWyS,IAAS,WACpBvP,OAAC,OAAI,UAAU,OACb,UAAAA,OAAC,OAAI,UAAU,kBACb,UAAA7D,MAAC,MAAG,mBAAO,EACX6D,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,QAAK,UAAU,aAAc,UAAA6Q,EAAa,OAAO,UAAM,EACxD1U,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAKmZ,GAAA,EAA0B,6BAEpE,GACF,GACF,EACCzE,EAAa,OACZ1U,MAAC,MAAG,UAAU,WACX,SAAA0U,EAAa,MAAM,EAAG,EAAE,EAAE,IAAKhR,UAC7B,MACC,UAAAG,OAAC,OACC,UAAA7D,MAAC,UAAQ,SAAA0D,EAAK,OAASA,EAAK,OAAO,EACnCG,OAAC,QAAK,UAAU,SACb,UAAAkO,GAAarO,EAAK,OAAO,EACzBA,EAAK,WAAa,WAAW,IAAI,KAAKA,EAAK,UAAU,EAAE,oBAAoB,GAAK,IACnF,GACF,EACAG,OAAC,OAAI,UAAU,mBACZ,UAAAH,EAAK,IACJ1D,MAAC,KAAE,KAAM0D,EAAK,IAAK,OAAO,SAAS,IAAI,aAAa,gBAEpD,EACE,KACFA,EAAK,WAIH,KAHF1D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAMub,GAAe7X,CAAI,EAAG,gBAE3D,CACE,EACN,IAnBOA,EAAK,EAoBd,CACD,EACH,EAEA1D,MAAC,KAAE,UAAU,SAAS,+DAAmD,GAE7E,EAGD,CAACW,GAAWyS,IAAS,WACpBvP,OAAC,OAAI,UAAU,mBACb,UAAAA,OAAC,QAAK,UAAU,OAAO,SAAUuX,GAC/B,UAAApb,MAAC,MAAG,yBAAa,EACjB6D,OAAC,OAAI,UAAU,aACb,UAAA7D,MAAC,SAAM,QAAQ,cAAc,eAAG,EAChCA,MAAC,SACC,GAAG,cACH,MAAOyW,GACP,SAAW9P,GAAU+P,GAAc/P,EAAM,OAAO,KAAK,EACrD,YAAY,eACd,EACF,EACA9C,OAAC,OAAI,UAAU,WACb,UAAAA,OAAC,OAAI,UAAU,aACb,UAAA7D,MAAC,SAAM,QAAQ,gBAAgB,4BAAgB,EAC/CA,MAAC,SACC,GAAG,gBACH,MAAO2W,GACP,SAAWhQ,GAAUiQ,GAAgBjQ,EAAM,OAAO,KAAK,GACzD,EACF,EACA9C,OAAC,OAAI,UAAU,aACb,UAAA7D,MAAC,SAAM,QAAQ,kBAAkB,mBAAO,EACxC6D,OAAC,UACC,GAAG,kBACH,MAAOkT,GACP,SAAWpQ,GAAUqQ,GAAkBrQ,EAAM,OAAO,KAAuB,EAE3E,UAAA3G,MAAC,UAAO,MAAM,UAAU,mBAAO,EAC/BA,MAAC,UAAO,MAAM,aAAa,sBAAU,EACrCA,MAAC,UAAO,MAAM,QAAQ,iBAAK,EAC3BA,MAAC,UAAO,MAAM,aAAa,sBAAU,IACvC,EACF,GACF,EACA6D,OAAC,OAAI,UAAU,aACb,UAAA7D,MAAC,SAAM,QAAQ,eAAe,2BAAe,EAC7CA,MAAC,YACC,GAAG,eACH,KAAM,EACN,MAAO6W,GACP,SAAWlQ,GAAUmQ,GAAenQ,EAAM,OAAO,KAAK,GACxD,EACF,EACCwQ,GAAenX,MAAC,KAAE,UAAU,SAAU,YAAa,EAAO,KAC3DA,MAAC,OAAI,UAAU,eACb,eAAC,UAAO,UAAU,UAAU,KAAK,SAAS,SAAUiX,GACjD,SAAAA,GAAgB,YAAc,kBACjC,EACF,GACF,EAEApT,OAAC,QAAK,UAAU,OAAO,SAAU4X,GAC/B,UAAAzb,MAAC,MAAG,kCAAsB,EAC1BA,MAAC,KAAE,UAAU,SACV,YAAe,oBAAoB4b,EAAY,IAAM,4CACxD,EACA/X,OAAC,OAAI,UAAU,aACb,UAAA7D,MAAC,SAAM,QAAQ,aAAa,gBAAI,EAChCA,MAAC,YAAS,GAAG,aAAa,KAAM,EAAG,MAAOqX,GAAW,SAAW1Q,GAAU2Q,GAAa3Q,EAAM,OAAO,KAAK,EAAG,GAC9G,EACA9C,OAAC,OAAI,UAAU,eACZ,UAAA4T,GAAc5T,OAAC,QAAK,UAAU,eAAe,mBAAO,IAAI,KAAK4T,EAAW,EAAE,oBAAmB,EAAE,EAAU,KAC1GzX,MAAC,UAAO,UAAU,UAAU,KAAK,SAAS,SAAUuX,GACjD,SAAAA,GAAa,YAAc,YAC9B,GACF,GACF,GACF,GAEJ,EACF,EAEC7B,EACC1V,MAAC,OACC,UAAU,qBACV,KAAK,SACL,aAAW,OACX,aAAY,WAAW0V,EAAc,KAAK,KAAK,GAC/C,QAASgD,GAET,SAAA7U,OAAC,OAAI,UAAU,2BAA2B,QAAU8C,GAAUA,EAAM,kBAClE,UAAA9C,OAAC,UAAO,UAAU,4BAChB,UAAAA,OAAC,OACC,UAAA7D,MAAC,KAAE,UAAU,UAAU,0BAAc,EACrCA,MAAC,MAAI,SAAA0V,EAAc,KAAK,MAAM,EAC9B7R,OAAC,KAAE,UAAU,SACV,UAAA6R,EAAc,KAAK,SAAS,MAAI9C,GAAe8C,EAAc,IAAI,EAAE,MAAInD,GAAYmD,EAAc,KAAK,SAAS,GAClH,GACF,EACA7R,OAAC,OAAI,UAAU,mBACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,OAAO,KAAK0V,EAAc,UAAW,SAAU,qBAAqB,EAAG,uBAE5G,EACA1V,MAAC,KAAE,KAAM0V,EAAc,UAAW,SAAUA,EAAc,KAAK,SAAU,oBAEzE,QACC,UAAO,KAAK,SAAS,QAASgD,GAAa,iBAE5C,GACF,GACF,QACC,OAAI,UAAU,+BACb,SAAA7U,OAAC,OAAI,UAAU,iCACb,UAAA7D,MAAC,OAAI,UAAU,gCACb,SAAAA,MAAC4G,GAAA,CACC,IAAK8O,EAAc,UACnB,OAAQA,EAAc,KAAK,OAC3B,MAAOA,EAAc,KAAK,MAC1B,iBAAkB6D,EAAA,GAEtB,EACA1V,OAAC,SAAM,UAAU,yBAAyB,aAAW,qBACnD,UAAAA,OAAC,OAAI,UAAU,gCACb,UAAAA,OAAC,OACC,UAAA7D,MAAC,KAAE,UAAU,UAAU,uBAAW,EAClCA,MAAC,MAAG,8BAAkB,GACxB,EACA6D,OAAC,OAAI,UAAU,sBACb,UAAAA,OAAC,QAAK,UAAU,aAAc,UAAA+R,EAAkB,OAAO,UAAM,EAC7D/R,OAAC,QAAK,UAAU,aAAc,UAAAkX,GAAuB,WAAW,eAAW,EAC3ElX,OAAC,QAAK,UAAU,aAAc,UAAAkX,GAAuB,MAAM,UAAM,GACnE,GACF,EAEAlX,OAAC,OAAI,UAAU,kCACb,UAAA7D,MAAC,SAAM,QAAQ,kBAAkB,UAAU,SAAS,0CAEpD,EACAA,MAAC,YACC,GAAG,kBACH,KAAM,EACN,MAAOgW,EACP,SAAWrP,GAAUsP,GAAmBtP,EAAM,OAAO,KAAK,EAC1D,YAAY,4CACZ,SAAUuP,EAAA,GAEZrS,OAAC,OAAI,UAAU,mBACb,UAAA7D,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK0Z,GAAuB,WAAW,EAAG,SAAUxD,GACtF,SAAAA,GAAiB,YAAc,iBAClC,EACAlW,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK0Z,GAAuB,MAAM,EAAG,SAAUxD,GACjF,SAAAA,GAAiB,YAAc,YAClC,GACF,GACF,EAEAlW,MAAC,OAAI,UAAU,kCACZ,SAAA8V,EACC9V,MAAC,KAAE,UAAU,SAAS,kCAAsB,EAC1C4V,EAAkB,OACpB5V,MAAC,MAAG,UAAU,8BACX,SAAA4V,EAAkB,IAAKoF,GACtBnX,OAAC,MAAuB,UAAW,mCAAmCmX,EAAW,IAAI,GACnF,UAAAnX,OAAC,OAAI,UAAU,oCACb,UAAA7D,MAAC,QAAK,UAAW,cAAcgb,EAAW,OAAS,OAAS,UAAY,EAAE,GACvE,SAAAA,EAAW,OAAS,OAAS,OAAS,YACzC,EACAhb,MAAC,QAAK,UAAU,SACb,aAAI,KAAKgb,EAAW,SAAS,EAAE,eAAe,GAAI,CACjD,UAAW,QACX,UAAW,QACZ,EACH,GACF,EACAnX,OAAC,OAAI,UAAU,kCACb,UAAA7D,MAAC,UAAQ,SAAAgb,EAAW,eAAiB,mBAAmB,EACvDA,EAAW,aAAe,KACzBhb,MAAC,QAAK,UAAU,SACb,WAAW,WACR,QAAQgb,EAAW,WAAW,IAAIA,EAAW,UAAU,GACvD,QAAQA,EAAW,WAAW,GACpC,EACE,MACN,EACCA,EAAW,aACVhb,MAAC,cAAW,UAAU,8BAA+B,SAAAgb,EAAW,aAAa,EAC3E,KACHA,EAAW,SAAWhb,MAAC,KAAE,UAAU,6BAA8B,SAAAgb,EAAW,SAAS,EAAO,WAC5F,OAAI,UAAU,mBACb,SAAAhb,MAAC,UAAO,KAAK,SAAS,QAAS,IAAM,KAAK6Z,GAAuBmB,EAAW,EAAE,EAAG,SAAU9E,GAAgB,kBAE3G,EACF,IA9BO8E,EAAW,EA+BpB,CACD,EACH,QAEC,KAAE,UAAU,SAAS,wHAEtB,EAEJ,GACF,GACF,EACF,EACCtF,EAAc,KAAK,SAAW,aAC5B,KAAE,UAAU,iCAAiC,6GAE9C,EACE,MACN,IAEA,MACN,CAEJ,CCt6CAwG,GAAS,WAAW,SAAS,eAAe,MAAM,CAAgB,EAAE,aACjEC,GAAM,WAAN,CACC,SAAAnc,MAACmT,KAAY,EACf,CACF","names":["pdfWorkerConfigured","loadPdfJs","pdfjs","__vitePreload","loadEpubFactory","mod","countWords","text","safeTextContent","value","buildSnapshot","input","ReaderUnsupported","format","jsx","PdfEmbeddedReader","src","title","onSnapshotChange","canvasRef","useRef","stageRef","error","setError","useState","loading","setLoading","pageNumber","setPageNumber","pageCount","setPageCount","zoom","setZoom","viewportTick","setViewportTick","statsVersion","setStatsVersion","activeSecondsTotal","setActiveSecondsTotal","focusedSecondsTotal","setFocusedSecondsTotal","locationLabel","setLocationLabel","pdfDocRef","renderTokenRef","visitedPagesRef","pageWordCountsRef","pagesReadTotal","wordsReadTotal","page","sum","words","estimatedTotalWords","useMemo","countedPages","avg","progress","useEffect","cancelled","doc","loadError","timer","visible","canvas","stage","token","baseViewport","scale","viewport","outputScale","canvasContext","prevVisitedSize","item","renderError","onResize","jsxs","EpubEmbeddedReader","mountRef","bookRef","renditionRef","sectionWordsRef","visitedSectionsRef","currentPage","setCurrentPage","totalPages","setTotalPages","setProgress","setWordsReadTotal","setEstimatedTotalWords","pageInput","setPageInput","mount","book","rendition","recalcWordStats","key","count","knownSections","totalKnown","spineLength","loadSectionWords","href","sectionIndex","section","loaded","onRelocated","location","displayedPage","displayedTotal","rawProgress","totalLocationCount","locations","derivedCurrentPage","derivedTotalPages","ePubFactory","goPrev","navError","goNext","jumpToLocation","cfi","jumpError","event","EmbeddedDocumentReader","className","createSessionId","normalizeApiBase","base","getExtensionRuntime","fetchJson","apiBase","path","init","response","payload","formatDuration","seconds","mins","hours","rem","formatRelativeTime","iso","ms","diffMs","formatTargetLabel","kind","formatProjectKind","projectGradient","baseHues","hash","i","jitter","h1","h2","clampPositiveInt","n","clampSprintMinutes","raw","parseWritingProjectKind","readWritingLaunchIntentFromLocation","params","action","sprintMinutes","projectId","promptText","clearWritingLaunchIntentFromLocation","url","keys","changed","next","DEFAULT_CREATE_FORM","canCountKeystroke","WritingStudioPanel","surface","variant","dashboard","setDashboard","notice","setNotice","composerOpen","setComposerOpen","savingProject","setSavingProject","createForm","setCreateForm","activeSession","setActiveSession","sessionBusy","setSessionBusy","selectedPromptId","setSelectedPromptId","sessionRef","launchIntentRef","launchIntentHandledRef","loadDashboard","useCallback","silent","data","selectedPrompt","prompt","projectCounts","acc","project","createProject","created","createError","patchProject","touchProject","openProjectTarget","startExternalTrackedSession","runtime","result","openError","startTrackedSession","sessionId","startError","launchProjectSession","postWritingProgress","session","endTrackedSession","saveProject","endError","onKeyDown","prev","sprintCompleted","handleDraftTextChange","nextText","prevWords","nextWords","diff","handleDraftKeyDown","remainingSprintSeconds","createProjectFromPrompt","titlePrefix","dateLabel","initialText","createTemplateProject","submitCreateForm","launchIntent","fallbackTitle","launchError","rootClassName","Fragment","v","suggestion","progressPct","markError","insight","DB_NAME","DB_VERSION","BOOK_STORE","dbPromise","requestToPromise","request","resolve","reject","transactionDone","transaction","openDatabase","db","store","inferFormat","fileName","mimeType","lowerName","lowerMime","titleFromFileName","mapRecord","record","_blob","createId","isReaderFileSupported","file","listLocalReaderBooks","records","a","b","aRank","addLocalReaderBooks","files","acceptedFiles","now","inserted","openLocalReaderBook","id","existing","updated","deleteLocalReaderBook","DEFAULT_API_BASE","DAILY_START_HOUR","trimmed","loadStoredApiBase","formatHours","totalMinutes","minutes","formatDayLabel","day","dayKeyFor","date","local","year","month","purposeLabel","purpose","safeDate","parsed","message","normalizeUrl","toPercent","total","formatBytes","units","amount","unitIndex","precision","formatBookType","coverGradientFor","index","hue","hue2","createReaderSessionId","localBookDocKey","WebHomepage","pane","setPane","apiBaseInput","setApiBaseInput","setApiBase","refreshing","setRefreshing","connected","setConnected","readerNotice","setReaderNotice","setNow","wallet","setWallet","summary","setSummary","overview","setOverview","literaryOverview","setLiteraryOverview","timeOfDay","setTimeOfDay","libraryItems","setLibraryItems","readingItems","setReadingItems","localReaderBooks","setLocalReaderBooks","loadingLocalReaderBooks","setLoadingLocalReaderBooks","uploadingReaderBooks","setUploadingReaderBooks","readerUploadError","setReaderUploadError","readerDragActive","setReaderDragActive","readerStorageUsage","setReaderStorageUsage","readerSession","setReaderSession","readerAnnotations","setReaderAnnotations","loadingReaderAnnotations","setLoadingReaderAnnotations","annotationDraft","setAnnotationDraft","annotationBusy","setAnnotationBusy","readerFileInputRef","readerMetricsRef","readerTrackingRef","dailyState","setDailyState","captureUrl","setCaptureUrl","captureTitle","setCaptureTitle","captureNote","setCaptureNote","capturePurpose","setCapturePurpose","savingCapture","setSavingCapture","captureError","setCaptureError","dailyNote","setDailyNote","savingNote","setSavingNote","noteSavedAt","setNoteSavedAt","loadHomepage","walletData","summaryData","overviewData","literaryData","timeData","libraryData","readingData","onboardingData","refreshReaderStorageEstimate","estimate","refreshLocalReaderBooks","showLoader","books","readerError","closeReader","previous","openUploadedBook","opened","objectUrl","handleReaderFiles","validFiles","rejectedCount","removeUploadedBook","openRandomUploadedBook","choice","postLiterarySessionProgress","snapshot","handleEmbeddedReaderSnapshot","loadReaderAnnotations","docKey","createReaderAnnotation","noteText","annotationError","deleteReaderAnnotation","clockId","refreshId","refreshOnVisibility","trackingSessionId","progressTimer","topContexts","activeSeconds","breakdown","bestHour","shelfItems","candidates","reading","merged","max","idx","featuredUploadedBook","shelfPreviewBooks","readerAnnotationCounts","annotation","uploadedBookCounts","readerStorageLabel","handleApplyApiBase","handleCaptureSubmit","normalized","submitError","handleMarkDone","entry","handleSaveNote","nextState","saveError","noteDayLabel","point","maxWords","d","pct","context","ReactDOM","React"],"ignoreList":[],"sources":["../../src/renderer/components/EmbeddedDocumentReader.tsx","../../src/renderer/components/WritingStudioPanel.tsx","../../src/renderer/localReaderShelf.ts","../../src/renderer/WebHomepage.tsx","../../src/renderer/web-homepage.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from 'react';\n\nlet pdfWorkerConfigured = false;\n\nasync function loadPdfJs() {\n  const pdfjs = (await import('pdfjs-dist')) as any;\n  if (!pdfWorkerConfigured && pdfjs?.GlobalWorkerOptions) {\n    pdfjs.GlobalWorkerOptions.workerSrc = new URL('pdfjs-dist/build/pdf.worker.min.mjs', import.meta.url).toString();\n    pdfWorkerConfigured = true;\n  }\n  return pdfjs;\n}\n\nasync function loadEpubFactory() {\n  const mod = (await import('epubjs')) as any;\n  return (mod?.default ?? mod) as (src: string) => any;\n}\n\ntype BookFormat = 'pdf' | 'epub' | 'unknown';\n\nexport type EmbeddedReaderSnapshot = {\n  currentPage: number | null;\n  totalPages: number | null;\n  progress: number | null;\n  activeSecondsTotal: number;\n  focusedSecondsTotal: number;\n  pagesReadTotal: number;\n  wordsReadTotal: number;\n  estimatedTotalWords: number | null;\n  locationLabel: string | null;\n};\n\ntype Props = {\n  src: string;\n  format: BookFormat;\n  title: string;\n  onSnapshotChange?: (snapshot: EmbeddedReaderSnapshot) => void;\n  className?: string;\n};\n\nfunction countWords(text: string) {\n  const matches = text.match(/[A-Za-z0-9]+(?:['-][A-Za-z0-9]+)*/g);\n  return matches?.length ?? 0;\n}\n\nfunction safeTextContent(value: unknown) {\n  return typeof value === 'string' ? value : '';\n}\n\nfunction buildSnapshot(input: Partial<EmbeddedReaderSnapshot>): EmbeddedReaderSnapshot {\n  return {\n    currentPage: input.currentPage ?? null,\n    totalPages: input.totalPages ?? null,\n    progress: input.progress ?? null,\n    activeSecondsTotal: input.activeSecondsTotal ?? 0,\n    focusedSecondsTotal: input.focusedSecondsTotal ?? 0,\n    pagesReadTotal: input.pagesReadTotal ?? 0,\n    wordsReadTotal: input.wordsReadTotal ?? 0,\n    estimatedTotalWords: input.estimatedTotalWords ?? null,\n    locationLabel: input.locationLabel ?? null\n  };\n}\n\nfunction ReaderUnsupported({ format }: { format: BookFormat }) {\n  return (\n    <div className=\"embedded-reader-fallback\">\n      <p>{format.toUpperCase()} preview is not supported in the embedded reader yet.</p>\n    </div>\n  );\n}\n\nfunction PdfEmbeddedReader({\n  src,\n  title,\n  onSnapshotChange\n}: {\n  src: string;\n  title: string;\n  onSnapshotChange?: (snapshot: EmbeddedReaderSnapshot) => void;\n}) {\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const stageRef = useRef<HTMLDivElement | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [pageCount, setPageCount] = useState<number | null>(null);\n  const [zoom, setZoom] = useState(1);\n  const [viewportTick, setViewportTick] = useState(0);\n  const [statsVersion, setStatsVersion] = useState(0);\n  const [activeSecondsTotal, setActiveSecondsTotal] = useState(0);\n  const [focusedSecondsTotal, setFocusedSecondsTotal] = useState(0);\n  const [locationLabel, setLocationLabel] = useState<string | null>(null);\n\n  const pdfDocRef = useRef<any>(null);\n  const renderTokenRef = useRef(0);\n  const visitedPagesRef = useRef<Set<number>>(new Set());\n  const pageWordCountsRef = useRef<Map<number, number>>(new Map());\n\n  const pagesReadTotal = visitedPagesRef.current.size;\n  const wordsReadTotal = Array.from(pageWordCountsRef.current.entries())\n    .filter(([page]) => visitedPagesRef.current.has(page))\n    .reduce((sum, [, words]) => sum + words, 0);\n  const estimatedTotalWords = useMemo(() => {\n    if (!pageCount || pageWordCountsRef.current.size === 0) return null;\n    const countedPages = pageWordCountsRef.current.size;\n    const totalWordsSeen = Array.from(pageWordCountsRef.current.values()).reduce((sum, words) => sum + words, 0);\n    const avg = totalWordsSeen / Math.max(1, countedPages);\n    return Math.round(avg * pageCount);\n  }, [pageCount, statsVersion]);\n  const progress = pageCount ? Math.max(0, Math.min(1, pageNumber / Math.max(1, pageCount))) : null;\n\n  useEffect(() => {\n    onSnapshotChange?.(\n      buildSnapshot({\n        currentPage: pageNumber,\n        totalPages: pageCount,\n        progress,\n        activeSecondsTotal,\n        focusedSecondsTotal,\n        pagesReadTotal,\n        wordsReadTotal,\n        estimatedTotalWords,\n        locationLabel\n      })\n    );\n  }, [\n    activeSecondsTotal,\n    estimatedTotalWords,\n    focusedSecondsTotal,\n    locationLabel,\n    onSnapshotChange,\n    pageCount,\n    pageNumber,\n    pagesReadTotal,\n    progress,\n    wordsReadTotal\n  ]);\n\n  useEffect(() => {\n    let cancelled = false;\n    setLoading(true);\n    setError(null);\n    visitedPagesRef.current = new Set();\n    pageWordCountsRef.current = new Map();\n    setPageNumber(1);\n    setLocationLabel(null);\n    setActiveSecondsTotal(0);\n    setFocusedSecondsTotal(0);\n    setViewportTick(0);\n    setStatsVersion(0);\n\n    (async () => {\n      try {\n        const pdfjs = await loadPdfJs();\n        if (cancelled) return;\n        const task = pdfjs.getDocument(src);\n        const doc = await task.promise;\n        if (cancelled) {\n          await doc.destroy();\n          return;\n        }\n        pdfDocRef.current = doc;\n        setPageCount(doc.numPages ?? null);\n        setPageNumber(1);\n      } catch (loadError) {\n        if (!cancelled) {\n          setError((loadError as Error).message || 'Unable to open PDF');\n        }\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n      const doc = pdfDocRef.current;\n      pdfDocRef.current = null;\n      if (doc?.destroy) {\n        void doc.destroy();\n      }\n    };\n  }, [src]);\n\n  useEffect(() => {\n    const timer = window.setInterval(() => {\n      const visible = document.visibilityState === 'visible';\n      if (visible) setActiveSecondsTotal((value) => value + 1);\n      if (visible && document.hasFocus()) setFocusedSecondsTotal((value) => value + 1);\n    }, 1000);\n    return () => window.clearInterval(timer);\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    const renderCurrentPage = async () => {\n      const doc = pdfDocRef.current;\n      const canvas = canvasRef.current;\n      const stage = stageRef.current;\n      if (!doc || !canvas || !stage || !pageNumber) return;\n      const token = ++renderTokenRef.current;\n      try {\n        const page = await doc.getPage(pageNumber);\n        if (cancelled || token !== renderTokenRef.current) return;\n        const baseViewport = page.getViewport({ scale: 1 });\n        const availableWidth = Math.max(280, stage.clientWidth - 12);\n        const scale = (availableWidth / Math.max(1, baseViewport.width)) * zoom;\n        const viewport = page.getViewport({ scale });\n        const outputScale = window.devicePixelRatio || 1;\n        const canvasContext = canvas.getContext('2d');\n        if (!canvasContext) throw new Error('Canvas rendering unavailable');\n\n        canvas.width = Math.floor(viewport.width * outputScale);\n        canvas.height = Math.floor(viewport.height * outputScale);\n        canvas.style.width = `${Math.floor(viewport.width)}px`;\n        canvas.style.height = `${Math.floor(viewport.height)}px`;\n        canvasContext.setTransform(1, 0, 0, 1, 0, 0);\n        canvasContext.clearRect(0, 0, canvas.width, canvas.height);\n\n        const renderTask = page.render({\n          canvasContext,\n          viewport,\n          transform: outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : undefined\n        });\n        await renderTask.promise;\n        if (cancelled || token !== renderTokenRef.current) return;\n\n        setLocationLabel(`Page ${pageNumber}${pageCount ? ` of ${pageCount}` : ''}`);\n        const prevVisitedSize = visitedPagesRef.current.size;\n        visitedPagesRef.current.add(pageNumber);\n\n        if (!pageWordCountsRef.current.has(pageNumber)) {\n          const textContent = await page.getTextContent();\n          const text = (textContent.items ?? [])\n            .map((item: any) => safeTextContent(item?.str))\n            .join(' ');\n          pageWordCountsRef.current.set(pageNumber, countWords(text));\n        }\n        if (visitedPagesRef.current.size !== prevVisitedSize || pageWordCountsRef.current.has(pageNumber)) {\n          setStatsVersion((value) => value + 1);\n        }\n      } catch (renderError) {\n        if (!cancelled) setError((renderError as Error).message || 'Unable to render PDF page');\n      }\n    };\n\n    void renderCurrentPage();\n    return () => {\n      cancelled = true;\n    };\n  }, [pageCount, pageNumber, zoom, viewportTick]);\n\n  useEffect(() => {\n    const onResize = () => {\n      renderTokenRef.current += 1;\n      setViewportTick((value) => value + 1);\n    };\n    window.addEventListener('resize', onResize);\n    return () => window.removeEventListener('resize', onResize);\n  }, []);\n\n  return (\n    <div className=\"embedded-reader-shell\">\n      <div className=\"embedded-reader-toolbar\">\n        <div className=\"embedded-reader-toolbarGroup\">\n          <strong>{title}</strong>\n          <span className=\"embedded-reader-metaText\">{locationLabel ?? 'PDF'}</span>\n        </div>\n        <div className=\"embedded-reader-toolbarGroup actions\">\n          <button type=\"button\" onClick={() => setPageNumber((value) => Math.max(1, value - 1))} disabled={pageNumber <= 1}>\n            Prev\n          </button>\n          <span className=\"embedded-reader-metaText\">\n            {pageCount ? `${pageNumber}/${pageCount}` : pageNumber}\n          </span>\n          <button\n            type=\"button\"\n            onClick={() => setPageNumber((value) => (pageCount ? Math.min(pageCount, value + 1) : value + 1))}\n            disabled={pageCount != null && pageNumber >= pageCount}\n          >\n            Next\n          </button>\n          <button type=\"button\" onClick={() => setZoom((value) => Math.max(0.6, Math.round((value - 0.1) * 10) / 10))}>\n            A-\n          </button>\n          <button type=\"button\" onClick={() => setZoom((value) => Math.min(2.4, Math.round((value + 0.1) * 10) / 10))}>\n            A+\n          </button>\n        </div>\n      </div>\n      {error ? <p className=\"embedded-reader-error\">{error}</p> : null}\n      <div className=\"embedded-reader-stage\" ref={stageRef}>\n        {loading ? <div className=\"embedded-reader-loading\">Loading PDF</div> : null}\n        <canvas ref={canvasRef} className={loading ? 'hidden-canvas' : ''} />\n      </div>\n    </div>\n  );\n}\n\nfunction EpubEmbeddedReader({\n  src,\n  title,\n  onSnapshotChange\n}: {\n  src: string;\n  title: string;\n  onSnapshotChange?: (snapshot: EmbeddedReaderSnapshot) => void;\n}) {\n  const mountRef = useRef<HTMLDivElement | null>(null);\n  const bookRef = useRef<any>(null);\n  const renditionRef = useRef<any>(null);\n  const sectionWordsRef = useRef<Map<string, number>>(new Map());\n  const visitedSectionsRef = useRef<Set<string>>(new Set());\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [currentPage, setCurrentPage] = useState<number | null>(null);\n  const [totalPages, setTotalPages] = useState<number | null>(null);\n  const [progress, setProgress] = useState<number | null>(null);\n  const [locationLabel, setLocationLabel] = useState<string | null>(null);\n  const [activeSecondsTotal, setActiveSecondsTotal] = useState(0);\n  const [focusedSecondsTotal, setFocusedSecondsTotal] = useState(0);\n  const [wordsReadTotal, setWordsReadTotal] = useState(0);\n  const [estimatedTotalWords, setEstimatedTotalWords] = useState<number | null>(null);\n  const [pageInput, setPageInput] = useState('');\n\n  const pagesReadTotal = visitedSectionsRef.current.size;\n\n  useEffect(() => {\n    onSnapshotChange?.(\n      buildSnapshot({\n        currentPage,\n        totalPages,\n        progress,\n        activeSecondsTotal,\n        focusedSecondsTotal,\n        pagesReadTotal,\n        wordsReadTotal,\n        estimatedTotalWords,\n        locationLabel\n      })\n    );\n  }, [\n    activeSecondsTotal,\n    currentPage,\n    estimatedTotalWords,\n    focusedSecondsTotal,\n    locationLabel,\n    onSnapshotChange,\n    pagesReadTotal,\n    progress,\n    totalPages,\n    wordsReadTotal\n  ]);\n\n  useEffect(() => {\n    const timer = window.setInterval(() => {\n      const visible = document.visibilityState === 'visible';\n      if (visible) setActiveSecondsTotal((value) => value + 1);\n      if (visible && document.hasFocus()) setFocusedSecondsTotal((value) => value + 1);\n    }, 1000);\n    return () => window.clearInterval(timer);\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    setLoading(true);\n    setError(null);\n    setCurrentPage(null);\n    setTotalPages(null);\n    setProgress(null);\n    setLocationLabel(null);\n    setActiveSecondsTotal(0);\n    setFocusedSecondsTotal(0);\n    setWordsReadTotal(0);\n    setEstimatedTotalWords(null);\n    setPageInput('');\n    sectionWordsRef.current = new Map();\n    visitedSectionsRef.current = new Set();\n\n    const mount = mountRef.current;\n    if (!mount) return undefined;\n    mount.innerHTML = '';\n\n    let book: any = null;\n    let rendition: any = null;\n\n    const recalcWordStats = () => {\n      const words = Array.from(sectionWordsRef.current.entries())\n        .filter(([key]) => visitedSectionsRef.current.has(key))\n        .reduce((sum, [, count]) => sum + count, 0);\n      setWordsReadTotal(words);\n      const knownSections = sectionWordsRef.current.size;\n      if (knownSections > 0) {\n        const totalKnown = Array.from(sectionWordsRef.current.values()).reduce((sum, count) => sum + count, 0);\n        const spineLength = Array.isArray((book as any).spine?.spineItems)\n          ? (book as any).spine.spineItems.length\n          : knownSections;\n        setEstimatedTotalWords(Math.round((totalKnown / knownSections) * Math.max(knownSections, spineLength)));\n      }\n    };\n\n    const loadSectionWords = async (href: string, sectionIndex?: number) => {\n      const key = href || `section-${sectionIndex ?? 0}`;\n      if (sectionWordsRef.current.has(key)) return;\n      try {\n        const section = sectionIndex != null ? book.section(sectionIndex) : null;\n        const loaded = section ? await Promise.resolve((section as any).load((book as any).load?.bind(book))) : null;\n        const text = loaded && typeof (loaded as Document).documentElement?.textContent === 'string'\n          ? (loaded as Document).documentElement.textContent\n          : '';\n        sectionWordsRef.current.set(key, countWords(text));\n        recalcWordStats();\n      } catch {\n        // Best effort only. EPUB sections can fail to load if the engine already disposed them.\n      }\n    };\n\n    const onRelocated = (location: any) => {\n      if (cancelled) return;\n      const displayedPage = Number.isFinite(location?.start?.displayed?.page) ? Number(location.start.displayed.page) : null;\n      const displayedTotal = Number.isFinite(location?.start?.displayed?.total) ? Number(location.start.displayed.total) : null;\n      const href = typeof location?.start?.href === 'string' ? location.start.href : '';\n      const sectionIndex = Number.isFinite(location?.start?.index) ? Number(location.start.index) : undefined;\n      const rawProgress = typeof location?.start?.percentage === 'number'\n        ? location.start.percentage\n        : typeof location?.end?.percentage === 'number'\n          ? location.end.percentage\n          : null;\n\n      if (href) {\n        visitedSectionsRef.current.add(href);\n      } else if (sectionIndex != null) {\n        visitedSectionsRef.current.add(`section-${sectionIndex}`);\n      }\n      recalcWordStats();\n      if (href || sectionIndex != null) {\n        void loadSectionWords(href, sectionIndex);\n      }\n\n      const totalLocationCount = (() => {\n        try {\n          const locations = (book as any).locations;\n          if (typeof locations?.length === 'function') return Number(locations.length());\n          if (typeof locations?.total === 'number') return Number(locations.total);\n          return null;\n        } catch {\n          return null;\n        }\n      })();\n\n      const derivedCurrentPage = displayedPage != null ? displayedPage : location?.start?.location ?? null;\n      const derivedTotalPages = displayedTotal != null ? displayedTotal : totalLocationCount;\n      setCurrentPage(derivedCurrentPage);\n      setTotalPages(derivedTotalPages);\n      setProgress(rawProgress != null ? Math.max(0, Math.min(1, rawProgress)) : null);\n      setLocationLabel(href || (derivedCurrentPage != null ? `Location ${derivedCurrentPage}` : 'EPUB'));\n      setPageInput(derivedCurrentPage != null ? String(derivedCurrentPage) : '');\n    };\n\n    (async () => {\n      try {\n        const ePubFactory = await loadEpubFactory();\n        if (cancelled) return;\n\n        book = ePubFactory(src);\n        rendition = book.renderTo(mount, {\n          width: '100%',\n          height: '100%',\n          spread: 'none'\n        });\n        bookRef.current = book;\n        renditionRef.current = rendition;\n        rendition.on('relocated', onRelocated);\n\n        await (book as any).ready;\n        try {\n          await (book as any).locations.generate(1024);\n        } catch {\n          // location generation is best-effort for progress / virtual pages\n        }\n        await rendition.display();\n      } catch (loadError) {\n        if (!cancelled) {\n          setError((loadError as Error).message || 'Unable to open EPUB');\n        }\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n\n    return () => {\n      cancelled = true;\n      try {\n        rendition?.off('relocated', onRelocated);\n      } catch {\n        // ignore\n      }\n      try {\n        rendition?.destroy();\n      } catch {\n        // ignore\n      }\n      try {\n        book?.destroy();\n      } catch {\n        // ignore\n      }\n      bookRef.current = null;\n      renditionRef.current = null;\n    };\n  }, [src]);\n\n  const goPrev = async () => {\n    try {\n      await renditionRef.current?.prev();\n    } catch (navError) {\n      setError((navError as Error).message || 'Unable to move to previous page');\n    }\n  };\n\n  const goNext = async () => {\n    try {\n      await renditionRef.current?.next();\n    } catch (navError) {\n      setError((navError as Error).message || 'Unable to move to next page');\n    }\n  };\n\n  const jumpToLocation = async () => {\n    const value = Number(pageInput);\n    if (!Number.isFinite(value) || value <= 0) return;\n    const book = bookRef.current;\n    const rendition = renditionRef.current;\n    if (!book || !rendition) return;\n    try {\n      const locations = (book as any).locations;\n      let cfi: string | null = null;\n      if (locations && typeof locations.cfiFromLocation === 'function') {\n        cfi = locations.cfiFromLocation(Math.round(value));\n      }\n      if (cfi) {\n        await rendition.display(cfi);\n      }\n    } catch (jumpError) {\n      setError((jumpError as Error).message || 'Unable to jump to location');\n    }\n  };\n\n  return (\n    <div className=\"embedded-reader-shell\">\n      <div className=\"embedded-reader-toolbar\">\n        <div className=\"embedded-reader-toolbarGroup\">\n          <strong>{title}</strong>\n          <span className=\"embedded-reader-metaText\">{locationLabel ?? 'EPUB'}</span>\n        </div>\n        <div className=\"embedded-reader-toolbarGroup actions\">\n          <button type=\"button\" onClick={goPrev}>\n            Prev\n          </button>\n          <input\n            type=\"text\"\n            value={pageInput}\n            inputMode=\"numeric\"\n            className=\"embedded-reader-locationInput\"\n            onChange={(event) => setPageInput(event.target.value)}\n            onKeyDown={(event) => {\n              if (event.key === 'Enter') {\n                event.preventDefault();\n                void jumpToLocation();\n              }\n            }}\n            aria-label=\"EPUB location\"\n          />\n          <span className=\"embedded-reader-metaText\">\n            {totalPages ? `/ ${totalPages}` : ''}\n          </span>\n          <button type=\"button\" onClick={() => void jumpToLocation()}>\n            Go\n          </button>\n          <button type=\"button\" onClick={goNext}>\n            Next\n          </button>\n        </div>\n      </div>\n      {error ? <p className=\"embedded-reader-error\">{error}</p> : null}\n      <div className=\"embedded-reader-stage\">\n        {loading ? <div className=\"embedded-reader-loading\">Loading EPUB</div> : null}\n        <div ref={mountRef} className={`embedded-reader-epubMount ${loading ? 'is-loading' : ''}`} />\n      </div>\n    </div>\n  );\n}\n\nexport function EmbeddedDocumentReader({ src, format, title, onSnapshotChange, className }: Props) {\n  if (format === 'pdf') {\n    return <PdfEmbeddedReader src={src} title={title} onSnapshotChange={onSnapshotChange} />;\n  }\n  if (format === 'epub') {\n    return <EpubEmbeddedReader src={src} title={title} onSnapshotChange={onSnapshotChange} />;\n  }\n  return (\n    <div className={className}>\n      <ReaderUnsupported format={format} />\n    </div>\n  );\n}\n","import { useCallback, useEffect, useMemo, useRef, useState, type FormEvent, type KeyboardEvent as ReactKeyboardEvent } from 'react';\n\ntype WritingProjectKind = 'journal' | 'paper' | 'substack' | 'fiction' | 'essay' | 'notes' | 'other';\ntype WritingTargetKind = 'tws-doc' | 'google-doc' | 'tana-node' | 'external-link';\ntype WritingProjectStatus = 'active' | 'paused' | 'done' | 'archived';\ntype WritingSurface = 'extension-newtab' | 'web-homepage' | 'desktop-renderer';\n\ntype WritingProjectRecord = {\n  id: number;\n  projectKey: string;\n  title: string;\n  kind: WritingProjectKind;\n  targetKind: WritingTargetKind;\n  status: WritingProjectStatus;\n  targetUrl?: string | null;\n  targetId?: string | null;\n  wordTarget?: number | null;\n  currentWordCount: number;\n  totalKeystrokes: number;\n  totalWordsAdded: number;\n  totalWordsDeleted: number;\n  totalNetWords: number;\n  sessionCount: number;\n  bodyText?: string | null;\n  reentryNote?: string | null;\n  promptText?: string | null;\n  lastTouchedAt?: string | null;\n  lastSessionStartedAt?: string | null;\n  lastSessionEndedAt?: string | null;\n  createdAt: string;\n  updatedAt: string;\n};\n\ntype WritingPrompt = {\n  id: string;\n  kind: WritingProjectKind | 'any';\n  text: string;\n};\n\ntype WritingSuggestion = {\n  project: WritingProjectRecord;\n  reason: string;\n  smallNextStep: string;\n  score: number;\n};\n\ntype WritingDailyPoint = {\n  day: string;\n  activeSeconds: number;\n  focusedSeconds: number;\n  keystrokes: number;\n  wordsAdded: number;\n  wordsDeleted: number;\n  netWords: number;\n  sessions: number;\n  projects: number;\n};\n\ntype WritingAnalyticsOverview = {\n  periodDays: number;\n  totals: {\n    activeSeconds: number;\n    focusedSeconds: number;\n    keystrokes: number;\n    wordsAdded: number;\n    wordsDeleted: number;\n    netWords: number;\n    sessions: number;\n    projects: number;\n  };\n  today: {\n    activeSeconds: number;\n    focusedSeconds: number;\n    keystrokes: number;\n    wordsAdded: number;\n    wordsDeleted: number;\n    netWords: number;\n    sessions: number;\n    projects: number;\n  };\n  pace: {\n    wordsPerMinute: number;\n    keystrokesPerMinute: number;\n  };\n  currentProject?: {\n    id: number;\n    title: string;\n    kind: WritingProjectKind;\n    targetKind: WritingTargetKind;\n    lastTouchedAt: string;\n    currentWordCount: number;\n    reentryNote?: string | null;\n  } | null;\n  daily: WritingDailyPoint[];\n  insights: string[];\n};\n\ntype WritingDashboard = {\n  overview: WritingAnalyticsOverview;\n  projects: WritingProjectRecord[];\n  suggestions: WritingSuggestion[];\n  prompts: WritingPrompt[];\n};\n\ntype WritingProjectCreateRequest = {\n  title: string;\n  kind: WritingProjectKind;\n  targetKind: WritingTargetKind;\n  targetUrl?: string | null;\n  targetId?: string | null;\n  wordTarget?: number | null;\n  bodyText?: string | null;\n  reentryNote?: string | null;\n  promptText?: string | null;\n  status?: WritingProjectStatus;\n};\n\ntype WritingProjectUpdateRequest = {\n  title?: string;\n  kind?: WritingProjectKind;\n  targetKind?: WritingTargetKind;\n  status?: WritingProjectStatus;\n  targetUrl?: string | null;\n  targetId?: string | null;\n  wordTarget?: number | null;\n  bodyText?: string | null;\n  reentryNote?: string | null;\n  promptText?: string | null;\n  currentWordCount?: number | null;\n  lastTouchedAt?: string | null;\n};\n\ntype Variant = 'web' | 'extension';\n\ntype Props = {\n  apiBase: string;\n  surface: WritingSurface;\n  variant?: Variant;\n};\n\ntype ActiveWritingSession = {\n  sessionId: string;\n  project: WritingProjectRecord;\n  sprintMinutes: number | null;\n  startedAtMs: number;\n  draftText: string;\n  reentryNoteDraft: string;\n  baselineWordCount: number;\n  currentWordCount: number;\n  activeSecondsTotal: number;\n  focusedSecondsTotal: number;\n  keystrokesTotal: number;\n  wordsAddedTotal: number;\n  wordsDeletedTotal: number;\n  netWordsTotal: number;\n  bodyTextLength: number;\n  sprintCompleted: boolean;\n  locationLabel: string | null;\n};\n\ntype WritingLaunchIntent =\n  | {\n      action: 'resume';\n      projectId: number;\n      sprintMinutes: number | null;\n    }\n  | {\n      action: 'create';\n      kind: WritingProjectKind;\n      sprintMinutes: number | null;\n      title?: string | null;\n      promptText?: string | null;\n    };\n\nfunction createSessionId() {\n  if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') return crypto.randomUUID();\n  return `writing-${Date.now()}-${Math.random().toString(36).slice(2, 10)}`;\n}\n\nfunction countWords(text: string) {\n  const matches = text.match(/[A-Za-z0-9]+(?:['-][A-Za-z0-9]+)*/g);\n  return matches?.length ?? 0;\n}\n\nfunction normalizeApiBase(base: string) {\n  return base.endsWith('/') ? base.slice(0, -1) : base;\n}\n\nfunction getExtensionRuntime() {\n  const globalObj = globalThis as { chrome?: { runtime?: { sendMessage?: (message: unknown) => Promise<unknown> } } };\n  return globalObj.chrome?.runtime ?? null;\n}\n\nasync function fetchJson<T>(apiBase: string, path: string, init?: RequestInit): Promise<T> {\n  const response = await fetch(`${normalizeApiBase(apiBase)}${path}`, {\n    ...init,\n    cache: 'no-store',\n    headers: {\n      'Content-Type': 'application/json',\n      ...(init?.headers ?? {})\n    }\n  });\n  if (!response.ok) {\n    const payload = (await response.json().catch(() => null)) as { error?: string } | null;\n    throw new Error(payload?.error ?? `Request failed (${response.status})`);\n  }\n  return response.json() as Promise<T>;\n}\n\nfunction formatDuration(seconds: number) {\n  const mins = Math.max(0, Math.round(seconds / 60));\n  const hours = Math.floor(mins / 60);\n  const rem = mins % 60;\n  if (hours > 0) return `${hours}h ${rem}m`;\n  return `${rem}m`;\n}\n\nfunction formatRelativeTime(iso?: string | null) {\n  if (!iso) return 'New';\n  const ms = Date.parse(iso);\n  if (!Number.isFinite(ms)) return 'Recently';\n  const diffMs = Date.now() - ms;\n  const mins = Math.round(diffMs / 60000);\n  if (mins < 1) return 'Just now';\n  if (mins < 60) return `${mins}m ago`;\n  const hours = Math.round(mins / 60);\n  if (hours < 48) return `${hours}h ago`;\n  const days = Math.round(hours / 24);\n  return `${days}d ago`;\n}\n\nfunction formatTargetLabel(kind: WritingTargetKind) {\n  switch (kind) {\n    case 'tws-doc':\n      return 'TWS Draft';\n    case 'google-doc':\n      return 'Google Docs';\n    case 'tana-node':\n      return 'Tana';\n    case 'external-link':\n      return 'External';\n    default:\n      return 'Target';\n  }\n}\n\nfunction formatProjectKind(kind: WritingProjectKind) {\n  switch (kind) {\n    case 'journal':\n      return 'Journal';\n    case 'paper':\n      return 'Paper';\n    case 'substack':\n      return 'Substack';\n    case 'fiction':\n      return 'Fiction';\n    case 'essay':\n      return 'Essay';\n    case 'notes':\n      return 'Notes';\n    default:\n      return 'Writing';\n  }\n}\n\nfunction projectGradient(kind: WritingProjectKind, title: string) {\n  const baseHues: Record<WritingProjectKind, number> = {\n    journal: 178,\n    paper: 214,\n    substack: 26,\n    fiction: 332,\n    essay: 280,\n    notes: 120,\n    other: 260\n  };\n  let hash = 0;\n  for (let i = 0; i < title.length; i += 1) hash = (hash * 31 + title.charCodeAt(i)) | 0;\n  const jitter = Math.abs(hash) % 28;\n  const h1 = (baseHues[kind] + jitter) % 360;\n  const h2 = (h1 + 42) % 360;\n  return `linear-gradient(160deg, hsl(${h1} 78% 58% / 0.95), hsl(${h2} 85% 44% / 0.9))`;\n}\n\nfunction clampPositiveInt(value: string) {\n  const n = Number(value);\n  if (!Number.isFinite(n) || n <= 0) return null;\n  return Math.round(n);\n}\n\nfunction clampSprintMinutes(raw: string | null) {\n  const n = Number(raw);\n  if (!Number.isFinite(n) || n <= 0) return 10;\n  return Math.max(1, Math.min(120, Math.round(n)));\n}\n\nfunction parseWritingProjectKind(raw: string | null): WritingProjectKind {\n  switch (raw) {\n    case 'journal':\n    case 'paper':\n    case 'substack':\n    case 'fiction':\n    case 'essay':\n    case 'notes':\n    case 'other':\n      return raw;\n    default:\n      return 'journal';\n  }\n}\n\nfunction readWritingLaunchIntentFromLocation(): WritingLaunchIntent | null {\n  if (typeof window === 'undefined') return null;\n  const params = new URLSearchParams(window.location.search);\n  const action = (params.get('tws_write_action') ?? '').trim();\n  if (!action) return null;\n\n  const sprintMinutes = clampSprintMinutes(params.get('tws_write_sprint'));\n\n  if (action === 'resume') {\n    const projectId = Number(params.get('tws_write_project_id'));\n    if (!Number.isFinite(projectId) || projectId <= 0) return null;\n    return {\n      action: 'resume',\n      projectId: Math.round(projectId),\n      sprintMinutes\n    };\n  }\n\n  if (action === 'create') {\n    const title = params.get('tws_write_title');\n    const promptText = params.get('tws_write_prompt');\n    return {\n      action: 'create',\n      kind: parseWritingProjectKind(params.get('tws_write_kind')),\n      sprintMinutes,\n      title: title?.trim() ? title.trim() : null,\n      promptText: promptText?.trim() ? promptText.trim() : null\n    };\n  }\n\n  return null;\n}\n\nfunction clearWritingLaunchIntentFromLocation() {\n  if (typeof window === 'undefined') return;\n  const url = new URL(window.location.href);\n  const keys = [...url.searchParams.keys()];\n  let changed = false;\n  for (const key of keys) {\n    if (!key.startsWith('tws_write_')) continue;\n    url.searchParams.delete(key);\n    changed = true;\n  }\n  if (!changed) return;\n  const next = `${url.pathname}${url.search}${url.hash}`;\n  window.history.replaceState(null, '', next);\n}\n\nconst DEFAULT_CREATE_FORM = {\n  title: '',\n  kind: 'journal' as WritingProjectKind,\n  targetKind: 'tws-doc' as WritingTargetKind,\n  targetUrl: '',\n  targetId: '',\n  wordTarget: ''\n};\n\nfunction canCountKeystroke(event: ReactKeyboardEvent<HTMLTextAreaElement>) {\n  if (event.metaKey || event.ctrlKey || event.altKey) return false;\n  if (event.key.length === 1) return true;\n  return event.key === 'Backspace' || event.key === 'Delete' || event.key === 'Enter' || event.key === 'Tab';\n}\n\nexport function WritingStudioPanel({ apiBase, surface, variant = 'web' }: Props) {\n  const [dashboard, setDashboard] = useState<WritingDashboard | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [notice, setNotice] = useState<string | null>(null);\n  const [composerOpen, setComposerOpen] = useState(false);\n  const [savingProject, setSavingProject] = useState(false);\n  const [createForm, setCreateForm] = useState(DEFAULT_CREATE_FORM);\n  const [activeSession, setActiveSession] = useState<ActiveWritingSession | null>(null);\n  const [sessionBusy, setSessionBusy] = useState(false);\n  const [selectedPromptId, setSelectedPromptId] = useState<string | null>(null);\n  const sessionRef = useRef<ActiveWritingSession | null>(null);\n  const launchIntentRef = useRef<WritingLaunchIntent | null>(variant === 'extension' ? readWritingLaunchIntentFromLocation() : null);\n  const launchIntentHandledRef = useRef(false);\n\n  useEffect(() => {\n    sessionRef.current = activeSession;\n  }, [activeSession]);\n\n  const loadDashboard = useCallback(async (silent = false) => {\n    if (!silent) setLoading(true);\n    setError(null);\n    try {\n      const data = await fetchJson<WritingDashboard>(apiBase, '/writing/dashboard?days=14&limit=12');\n      setDashboard(data);\n    } catch (loadError) {\n      setError((loadError as Error).message ?? 'Unable to load Writing Studio.');\n    } finally {\n      if (!silent) setLoading(false);\n    }\n  }, [apiBase]);\n\n  useEffect(() => {\n    void loadDashboard();\n  }, [loadDashboard]);\n\n  useEffect(() => {\n    const timer = window.setInterval(() => {\n      void loadDashboard(true);\n    }, 60_000);\n    return () => window.clearInterval(timer);\n  }, [loadDashboard]);\n\n  const selectedPrompt = useMemo(\n    () => dashboard?.prompts.find((prompt) => prompt.id === selectedPromptId) ?? dashboard?.prompts[0] ?? null,\n    [dashboard?.prompts, selectedPromptId]\n  );\n\n  const projectCounts = useMemo(() => {\n    const items = dashboard?.projects ?? [];\n    return items.reduce(\n      (acc, project) => {\n        acc.total += 1;\n        if (project.status === 'active') acc.active += 1;\n        if (project.kind === 'journal') acc.journal += 1;\n        if (project.targetKind === 'tws-doc') acc.tws += 1;\n        return acc;\n      },\n      { total: 0, active: 0, journal: 0, tws: 0 }\n    );\n  }, [dashboard?.projects]);\n\n  const createProject = useCallback(\n    async (payload: WritingProjectCreateRequest) => {\n      setSavingProject(true);\n      try {\n        const created = await fetchJson<WritingProjectRecord>(apiBase, '/writing/projects', {\n          method: 'POST',\n          body: JSON.stringify(payload)\n        });\n        setNotice(`Created ${created.title}.`);\n        setComposerOpen(false);\n        setCreateForm(DEFAULT_CREATE_FORM);\n        await loadDashboard(true);\n        return created;\n      } catch (createError) {\n        setError((createError as Error).message ?? 'Unable to create project.');\n        return null;\n      } finally {\n        setSavingProject(false);\n      }\n    },\n    [apiBase, loadDashboard]\n  );\n\n  const patchProject = useCallback(\n    async (projectId: number, payload: WritingProjectUpdateRequest) => {\n      return fetchJson<WritingProjectRecord>(apiBase, `/writing/projects/${projectId}`, {\n        method: 'PATCH',\n        body: JSON.stringify(payload)\n      });\n    },\n    [apiBase]\n  );\n\n  const touchProject = useCallback(\n    async (projectId: number) => {\n      try {\n        await fetchJson<WritingProjectRecord>(apiBase, `/writing/projects/${projectId}/touch`, { method: 'POST' });\n      } catch {\n        // best effort\n      }\n    },\n    [apiBase]\n  );\n\n  const openProjectTarget = useCallback(\n    async (project: WritingProjectRecord) => {\n      if (!project.targetUrl) {\n        setNotice(project.targetKind === 'tana-node' ? 'Add a Tana URL/deeplink to this project to open it directly.' : 'No target link saved yet.');\n        return;\n      }\n      await touchProject(project.id);\n      window.open(project.targetUrl, '_blank', 'noopener,noreferrer');\n      setNotice(`Opened target for ${project.title}.`);\n      void loadDashboard(true);\n    },\n    [loadDashboard, touchProject]\n  );\n\n  const startExternalTrackedSession = useCallback(\n    async (project: WritingProjectRecord, sprintMinutes: number | null) => {\n      const runtime = getExtensionRuntime();\n      if (variant !== 'extension' || !runtime?.sendMessage) {\n        await openProjectTarget(project);\n        return;\n      }\n      if (!project.targetUrl) {\n        setNotice(project.targetKind === 'tana-node' ? 'Add a Tana URL/deeplink to this project to track it in-browser.' : 'No target link saved yet.');\n        return;\n      }\n      setSessionBusy(true);\n      try {\n        const result = await runtime.sendMessage({\n          type: 'OPEN_WRITING_TARGET',\n          payload: {\n            projectId: project.id,\n            projectTitle: project.title,\n            projectKind: project.kind,\n            targetKind: project.targetKind,\n            targetUrl: project.targetUrl,\n            targetId: project.targetId ?? null,\n            currentWordCount: project.currentWordCount,\n            sprintMinutes,\n            sourceSurface: 'extension-newtab',\n            replaceCurrent: true\n          }\n        }) as { success?: boolean; error?: string };\n        if (!result?.success) {\n          throw new Error(result?.error ?? 'Unable to open tracked writing target.');\n        }\n        setNotice(`Opened ${project.title} with live writing HUD tracking.`);\n      } catch (openError) {\n        setError((openError as Error).message ?? 'Unable to open tracked writing target.');\n      } finally {\n        setSessionBusy(false);\n      }\n    },\n    [openProjectTarget, variant]\n  );\n\n  const startTrackedSession = useCallback(\n    async (project: WritingProjectRecord, sprintMinutes: number | null) => {\n      if (sessionBusy) return;\n      setSessionBusy(true);\n      try {\n        const sessionId = createSessionId();\n        await fetchJson(apiBase, '/analytics/writing/sessions/start', {\n          method: 'POST',\n          body: JSON.stringify({\n            sessionId,\n            projectId: project.id,\n            sourceSurface: surface,\n            sprintMinutes\n          })\n        });\n\n        setActiveSession({\n          sessionId,\n          project,\n          sprintMinutes,\n          startedAtMs: Date.now(),\n          draftText: project.bodyText ?? '',\n          reentryNoteDraft: project.reentryNote ?? '',\n          baselineWordCount: project.currentWordCount ?? countWords(project.bodyText ?? ''),\n          currentWordCount: project.currentWordCount ?? countWords(project.bodyText ?? ''),\n          activeSecondsTotal: 0,\n          focusedSecondsTotal: 0,\n          keystrokesTotal: 0,\n          wordsAddedTotal: 0,\n          wordsDeletedTotal: 0,\n          netWordsTotal: 0,\n          bodyTextLength: (project.bodyText ?? '').length,\n          sprintCompleted: false,\n          locationLabel: 'Writing Studio Editor'\n        });\n        setNotice(`Started ${sprintMinutes ? `${sprintMinutes}m` : ''} writing session for ${project.title}.`.trim());\n      } catch (startError) {\n        setError((startError as Error).message ?? 'Unable to start writing session.');\n      } finally {\n        setSessionBusy(false);\n      }\n    },\n    [apiBase, sessionBusy, surface]\n  );\n\n  const launchProjectSession = useCallback(\n    async (project: WritingProjectRecord, sprintMinutes: number | null) => {\n      const shouldUseExternalHud =\n        variant === 'extension' &&\n        project.targetKind !== 'tws-doc' &&\n        Boolean(project.targetUrl);\n      if (shouldUseExternalHud) {\n        await startExternalTrackedSession(project, sprintMinutes);\n        return;\n      }\n      await startTrackedSession(project, sprintMinutes);\n    },\n    [startExternalTrackedSession, startTrackedSession, variant]\n  );\n\n  const postWritingProgress = useCallback(\n    async (kind: 'progress' | 'end') => {\n      const session = sessionRef.current;\n      if (!session) return;\n      try {\n        await fetchJson(apiBase, `/analytics/writing/sessions/${session.sessionId}/${kind}`, {\n          method: 'POST',\n          body: JSON.stringify({\n            occurredAt: new Date().toISOString(),\n            activeSecondsTotal: session.activeSecondsTotal,\n            focusedSecondsTotal: session.focusedSecondsTotal,\n            keystrokesTotal: session.keystrokesTotal,\n            wordsAddedTotal: session.wordsAddedTotal,\n            wordsDeletedTotal: session.wordsDeletedTotal,\n            netWordsTotal: session.netWordsTotal,\n            currentWordCount: session.currentWordCount,\n            bodyTextLength: session.bodyTextLength,\n            locationLabel: session.locationLabel\n          })\n        });\n      } catch {\n        // non-blocking\n      }\n    },\n    [apiBase]\n  );\n\n  const endTrackedSession = useCallback(\n    async (saveProject = true) => {\n      const session = sessionRef.current;\n      if (!session || sessionBusy) return;\n      setSessionBusy(true);\n      try {\n        await postWritingProgress('end');\n        if (saveProject) {\n          await patchProject(session.project.id, {\n            bodyText: session.draftText,\n            currentWordCount: session.currentWordCount,\n            reentryNote: session.reentryNoteDraft,\n            lastTouchedAt: new Date().toISOString()\n          });\n        }\n        setActiveSession(null);\n        setNotice(`Saved session for ${session.project.title} (${session.netWordsTotal >= 0 ? '+' : ''}${session.netWordsTotal} words).`);\n        await loadDashboard(true);\n      } catch (endError) {\n        setError((endError as Error).message ?? 'Unable to end writing session.');\n      } finally {\n        setSessionBusy(false);\n      }\n    },\n    [loadDashboard, patchProject, postWritingProgress, sessionBusy]\n  );\n\n  useEffect(() => {\n    if (!activeSession) return undefined;\n    const onKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        void endTrackedSession(true);\n      }\n    };\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, [activeSession, endTrackedSession]);\n\n  useEffect(() => {\n    if (!activeSession) return undefined;\n    const timer = window.setInterval(() => {\n      setActiveSession((prev) => {\n        if (!prev) return prev;\n        const visible = document.visibilityState === 'visible';\n        const activeSecondsTotal = visible ? prev.activeSecondsTotal + 1 : prev.activeSecondsTotal;\n        const focusedSecondsTotal = visible && document.hasFocus() ? prev.focusedSecondsTotal + 1 : prev.focusedSecondsTotal;\n        const sprintCompleted =\n          !prev.sprintCompleted &&\n          prev.sprintMinutes != null &&\n          activeSecondsTotal >= prev.sprintMinutes * 60\n            ? true\n            : prev.sprintCompleted;\n        return { ...prev, activeSecondsTotal, focusedSecondsTotal, sprintCompleted };\n      });\n    }, 1000);\n    return () => window.clearInterval(timer);\n  }, [activeSession]);\n\n  useEffect(() => {\n    if (!activeSession) return undefined;\n    const timer = window.setInterval(() => {\n      void postWritingProgress('progress');\n    }, 5000);\n    return () => window.clearInterval(timer);\n  }, [activeSession, postWritingProgress]);\n\n  useEffect(() => {\n    return () => {\n      void postWritingProgress('end');\n    };\n  }, [postWritingProgress]);\n\n  const handleDraftTextChange = useCallback((nextText: string) => {\n    setActiveSession((prev) => {\n      if (!prev) return prev;\n      const prevWords = prev.currentWordCount;\n      const nextWords = countWords(nextText);\n      const diff = nextWords - prevWords;\n      return {\n        ...prev,\n        draftText: nextText,\n        currentWordCount: nextWords,\n        bodyTextLength: nextText.length,\n        wordsAddedTotal: prev.wordsAddedTotal + (diff > 0 ? diff : 0),\n        wordsDeletedTotal: prev.wordsDeletedTotal + (diff < 0 ? Math.abs(diff) : 0),\n        netWordsTotal: nextWords - prev.baselineWordCount\n      };\n    });\n  }, []);\n\n  const handleDraftKeyDown = useCallback((event: ReactKeyboardEvent<HTMLTextAreaElement>) => {\n    if (!canCountKeystroke(event)) return;\n    setActiveSession((prev) => (prev ? { ...prev, keystrokesTotal: prev.keystrokesTotal + 1 } : prev));\n  }, []);\n\n  const remainingSprintSeconds = useMemo(() => {\n    if (!activeSession?.sprintMinutes) return null;\n    return Math.max(0, activeSession.sprintMinutes * 60 - activeSession.activeSecondsTotal);\n  }, [activeSession]);\n\n  const createProjectFromPrompt = useCallback(\n    async (prompt: WritingPrompt, kind: WritingProjectKind = 'journal') => {\n      const titlePrefix = kind === 'journal' ? 'Journal' : formatProjectKind(kind);\n      const dateLabel = new Date().toLocaleDateString([], { month: 'short', day: 'numeric' });\n      const initialText = `Prompt: ${prompt.text}\\n\\n`;\n      await createProject({\n        title: `${titlePrefix}  ${dateLabel}`,\n        kind,\n        targetKind: 'tws-doc',\n        bodyText: initialText,\n        promptText: prompt.text,\n        reentryNote: 'Write one paragraph before editing.'\n      });\n    },\n    [createProject]\n  );\n\n  const createTemplateProject = useCallback(\n    async (kind: WritingProjectKind) => {\n      const dateLabel = new Date().toLocaleDateString([], { month: 'short', day: 'numeric' });\n      const prompt = dashboard?.prompts.find((item) => item.kind === kind || item.kind === 'any') ?? null;\n      const title =\n        kind === 'journal'\n          ? `Journal  ${dateLabel}`\n          : kind === 'paper'\n            ? 'Paper Draft'\n            : kind === 'substack'\n              ? 'Substack Post'\n              : kind === 'fiction'\n                ? 'Fiction Scene'\n                : `${formatProjectKind(kind)} Draft`;\n      await createProject({\n        title,\n        kind,\n        targetKind: 'tws-doc',\n        bodyText: prompt ? `Prompt: ${prompt.text}\\n\\n` : '',\n        promptText: prompt?.text ?? null,\n        reentryNote:\n          kind === 'journal'\n            ? 'Write one honest paragraph before deciding what it means.'\n            : 'Write the next small paragraph only.'\n      });\n    },\n    [createProject, dashboard?.prompts]\n  );\n\n  const submitCreateForm = useCallback(\n    async (event: FormEvent) => {\n      event.preventDefault();\n      const title = createForm.title.trim();\n      if (!title) {\n        setError('Give the writing project a title.');\n        return;\n      }\n      if (createForm.targetKind !== 'tws-doc' && !createForm.targetUrl.trim() && !createForm.targetId.trim()) {\n        setError('Add a target link or target ID for non-TWS projects.');\n        return;\n      }\n\n      await createProject({\n        title,\n        kind: createForm.kind,\n        targetKind: createForm.targetKind,\n        targetUrl: createForm.targetUrl.trim() || null,\n        targetId: createForm.targetId.trim() || null,\n        wordTarget: clampPositiveInt(createForm.wordTarget),\n        bodyText: createForm.targetKind === 'tws-doc' ? '' : null,\n        reentryNote: null,\n        promptText: selectedPrompt?.text ?? null\n      });\n    },\n    [createForm, createProject, selectedPrompt]\n  );\n\n  useEffect(() => {\n    if (variant !== 'extension') return;\n    const launchIntent = launchIntentRef.current;\n    if (!launchIntent || launchIntentHandledRef.current) return;\n    if (loading || !dashboard) return;\n    if (savingProject || sessionBusy || activeSession) return;\n\n    let cancelled = false;\n\n    const runLaunchIntent = async () => {\n      launchIntentHandledRef.current = true;\n      try {\n        if (launchIntent.action === 'resume') {\n          let project = dashboard.projects.find((item) => item.id === launchIntent.projectId) ?? null;\n          if (!project) {\n            const data = await fetchJson<{ items: WritingProjectRecord[] }>(\n              apiBase,\n              '/writing/projects?limit=50&includeArchived=false'\n            );\n            project = data.items.find((item) => item.id === launchIntent.projectId) ?? null;\n          }\n          if (!project) {\n            if (!cancelled) {\n              setError('The writing project for this redirect could not be found.');\n            }\n            return;\n          }\n          if (!cancelled) {\n            await launchProjectSession(project, launchIntent.sprintMinutes);\n          }\n          return;\n        }\n\n        const kind = launchIntent.kind;\n        const dateLabel = new Date().toLocaleDateString([], { month: 'short', day: 'numeric' });\n        const fallbackTitle =\n          kind === 'journal'\n            ? `Journal  ${dateLabel}`\n            : kind === 'paper'\n              ? 'Paper Draft'\n              : kind === 'substack'\n                ? 'Substack Post'\n                : kind === 'fiction'\n                  ? 'Fiction Scene'\n                  : `${formatProjectKind(kind)}  ${dateLabel}`;\n        const promptText = launchIntent.promptText?.trim() ? launchIntent.promptText.trim() : null;\n        const created = await createProject({\n          title: launchIntent.title?.trim() || fallbackTitle,\n          kind,\n          targetKind: 'tws-doc',\n          bodyText: promptText ? `Prompt: ${promptText}\\n\\n` : '',\n          promptText,\n          reentryNote:\n            kind === 'journal'\n              ? 'Write one honest paragraph before deciding what it means.'\n              : 'Write the next small paragraph only.'\n        });\n        if (!created || cancelled) return;\n        await startTrackedSession(created, launchIntent.sprintMinutes);\n      } catch (launchError) {\n        if (!cancelled) {\n          setError((launchError as Error).message ?? 'Unable to start redirected writing sprint.');\n        }\n      } finally {\n        launchIntentRef.current = null;\n        if (!cancelled) clearWritingLaunchIntentFromLocation();\n      }\n    };\n\n    void runLaunchIntent();\n    return () => {\n      cancelled = true;\n    };\n  }, [\n    activeSession,\n    apiBase,\n    createProject,\n    dashboard,\n    loading,\n    savingProject,\n    sessionBusy,\n    launchProjectSession,\n    startTrackedSession,\n    variant\n  ]);\n\n  const rootClassName =\n    variant === 'web'\n      ? 'card web-full-width writing-studio'\n      : 'newtab-card tall writing-studio writing-studio--extension';\n\n  return (\n    <>\n      <article className={rootClassName}>\n        <div className=\"writing-studio__header\">\n          <div>\n            <p className={variant === 'web' ? 'eyebrow' : 'newtab-eyebrow'}>Writing Studio</p>\n            <h2>Projects, prompts, and tracked writing sprints</h2>\n            <p className=\"writing-studio__subtle\">\n              Surface the right draft, start a timed sprint, and keep writing in a productive loop with re-entry notes.\n            </p>\n          </div>\n          <div className=\"writing-studio__headerActions\">\n            <button type=\"button\" onClick={() => void loadDashboard()}>\n              {loading ? 'Loading' : 'Refresh'}\n            </button>\n            <button type=\"button\" className=\"primary\" onClick={() => setComposerOpen((v) => !v)}>\n              {composerOpen ? 'Close Composer' : 'New Project'}\n            </button>\n          </div>\n        </div>\n\n        {error ? <p className=\"writing-studio__notice error\">{error}</p> : null}\n        {notice ? <p className=\"writing-studio__notice\">{notice}</p> : null}\n\n        <div className=\"writing-studio__topline\">\n          <span className=\"pill ghost\">{projectCounts.total} projects</span>\n          <span className=\"pill ghost\">{projectCounts.active} active</span>\n          <span className=\"pill ghost\">{projectCounts.tws} TWS drafts</span>\n          <span className=\"pill ghost\">\n            Today {dashboard ? `${dashboard.overview.today.netWords >= 0 ? '+' : ''}${dashboard.overview.today.netWords} words` : '--'}\n          </span>\n          <span className=\"pill ghost\">\n            Pace {dashboard ? `${dashboard.overview.pace.wordsPerMinute.toFixed(1)} w/m` : '--'}\n          </span>\n        </div>\n\n        <div className=\"writing-studio__templates\">\n          <button type=\"button\" onClick={() => void createTemplateProject('journal')} disabled={savingProject}>\n            Journal Sprint\n          </button>\n          <button type=\"button\" onClick={() => void createTemplateProject('paper')} disabled={savingProject}>\n            Paper Draft\n          </button>\n          <button type=\"button\" onClick={() => void createTemplateProject('substack')} disabled={savingProject}>\n            Substack Draft\n          </button>\n          <button type=\"button\" onClick={() => void createTemplateProject('fiction')} disabled={savingProject}>\n            Fiction Scene\n          </button>\n        </div>\n\n        {dashboard?.suggestions?.length ? (\n          <div className=\"writing-studio__suggestions\">\n            {dashboard.suggestions.map((suggestion) => (\n              <article key={`suggestion-${suggestion.project.id}`} className=\"writing-suggestion-card\">\n                <div className=\"writing-suggestion-card__cover\" style={{ background: projectGradient(suggestion.project.kind, suggestion.project.title) }}>\n                  <span className=\"writing-suggestion-card__badge\">{formatProjectKind(suggestion.project.kind)}</span>\n                  <strong>{suggestion.project.title}</strong>\n                  <small>{formatTargetLabel(suggestion.project.targetKind)}</small>\n                </div>\n                <div className=\"writing-suggestion-card__body\">\n                  <p className=\"writing-studio__subtle\">{suggestion.reason}</p>\n                  <p className=\"writing-suggestion-card__nextStep\">{suggestion.smallNextStep}</p>\n                  <div className=\"writing-studio__rowActions\">\n                    <button type=\"button\" onClick={() => void launchProjectSession(suggestion.project, 10)} disabled={sessionBusy}>\n                      Write 10m\n                    </button>\n                    <button type=\"button\" onClick={() => void launchProjectSession(suggestion.project, 25)} disabled={sessionBusy}>\n                      Write 25m\n                    </button>\n                    {suggestion.project.targetUrl ? (\n                      <button\n                        type=\"button\"\n                        onClick={() => void (variant === 'extension' && suggestion.project.targetKind !== 'tws-doc'\n                          ? startExternalTrackedSession(suggestion.project, 12)\n                          : openProjectTarget(suggestion.project))}\n                      >\n                        {variant === 'extension' && suggestion.project.targetKind !== 'tws-doc' ? 'Open + Track' : 'Open Target'}\n                      </button>\n                    ) : null}\n                  </div>\n                </div>\n              </article>\n            ))}\n          </div>\n        ) : null}\n\n        {dashboard?.prompts?.length ? (\n          <div className=\"writing-studio__prompts\">\n            <div className=\"writing-studio__promptsHeader\">\n              <strong>Prompt Capsule</strong>\n              <span className=\"writing-studio__subtle\">Use these to reduce start friction.</span>\n            </div>\n            <div className=\"writing-studio__promptList\">\n              {dashboard.prompts.map((prompt) => (\n                <button\n                  type=\"button\"\n                  key={prompt.id}\n                  className={`writing-prompt-chip ${selectedPrompt?.id === prompt.id ? 'active' : ''}`}\n                  onClick={() => setSelectedPromptId(prompt.id)}\n                >\n                  <span>{prompt.kind === 'any' ? 'Any' : formatProjectKind(prompt.kind)}</span>\n                  <small>{prompt.text}</small>\n                </button>\n              ))}\n            </div>\n            {selectedPrompt ? (\n              <div className=\"writing-studio__promptActions\">\n                <button type=\"button\" onClick={() => void createProjectFromPrompt(selectedPrompt, 'journal')} disabled={savingProject}>\n                  Journal From Prompt\n                </button>\n                <button type=\"button\" onClick={() => void createProjectFromPrompt(selectedPrompt, 'essay')} disabled={savingProject}>\n                  Essay Draft From Prompt\n                </button>\n              </div>\n            ) : null}\n          </div>\n        ) : null}\n\n        {composerOpen ? (\n          <form className=\"writing-studio__composer\" onSubmit={submitCreateForm}>\n            <div className=\"writing-studio__composerGrid\">\n              <div>\n                <label>Title</label>\n                <input\n                  value={createForm.title}\n                  onChange={(event) => setCreateForm((prev) => ({ ...prev, title: event.target.value }))}\n                  placeholder=\"Project title\"\n                />\n              </div>\n              <div>\n                <label>Kind</label>\n                <select\n                  value={createForm.kind}\n                  onChange={(event) => setCreateForm((prev) => ({ ...prev, kind: event.target.value as WritingProjectKind }))}\n                >\n                  <option value=\"journal\">Journal</option>\n                  <option value=\"paper\">Paper</option>\n                  <option value=\"substack\">Substack</option>\n                  <option value=\"fiction\">Fiction</option>\n                  <option value=\"essay\">Essay</option>\n                  <option value=\"notes\">Notes</option>\n                  <option value=\"other\">Other</option>\n                </select>\n              </div>\n              <div>\n                <label>Target</label>\n                <select\n                  value={createForm.targetKind}\n                  onChange={(event) => setCreateForm((prev) => ({ ...prev, targetKind: event.target.value as WritingTargetKind }))}\n                >\n                  <option value=\"tws-doc\">TWS Draft</option>\n                  <option value=\"google-doc\">Google Doc</option>\n                  <option value=\"tana-node\">Tana Node</option>\n                  <option value=\"external-link\">External Link</option>\n                </select>\n              </div>\n              <div>\n                <label>Word Target (optional)</label>\n                <input\n                  inputMode=\"numeric\"\n                  value={createForm.wordTarget}\n                  onChange={(event) => setCreateForm((prev) => ({ ...prev, wordTarget: event.target.value }))}\n                  placeholder=\"e.g. 1200\"\n                />\n              </div>\n            </div>\n            {createForm.targetKind !== 'tws-doc' ? (\n              <div className=\"writing-studio__composerGrid\">\n                <div>\n                  <label>Target URL / Deeplink</label>\n                  <input\n                    value={createForm.targetUrl}\n                    onChange={(event) => setCreateForm((prev) => ({ ...prev, targetUrl: event.target.value }))}\n                    placeholder=\"https://docs.google.com/... or tana://...\"\n                  />\n                </div>\n                <div>\n                  <label>Target ID (optional)</label>\n                  <input\n                    value={createForm.targetId}\n                    onChange={(event) => setCreateForm((prev) => ({ ...prev, targetId: event.target.value }))}\n                    placeholder=\"Tana node id / doc id\"\n                  />\n                </div>\n              </div>\n            ) : null}\n            <div className=\"writing-studio__rowActions\">\n              <button className=\"primary\" type=\"submit\" disabled={savingProject}>\n                {savingProject ? 'Creating' : 'Create Writing Project'}\n              </button>\n              {selectedPrompt ? <span className=\"pill ghost\">Prompt ready</span> : null}\n            </div>\n          </form>\n        ) : null}\n\n        <div className=\"writing-studio__projects\">\n          {dashboard?.projects?.length ? (\n            dashboard.projects.map((project) => {\n              const progressPct =\n                project.wordTarget && project.wordTarget > 0\n                  ? Math.max(0, Math.min(100, Math.round((project.currentWordCount / project.wordTarget) * 100)))\n                  : null;\n              return (\n                <article key={project.id} className={`writing-project-card status-${project.status}`}>\n                  <button\n                    type=\"button\"\n                    className=\"writing-project-card__coverButton\"\n                    onClick={() => void launchProjectSession(project, 10)}\n                    disabled={sessionBusy}\n                    aria-label={`Start writing on ${project.title}`}\n                  >\n                    <span className=\"writing-project-card__cover\" style={{ background: projectGradient(project.kind, project.title) }}>\n                      <span className=\"writing-project-card__badge\">{formatProjectKind(project.kind)}</span>\n                      <span className=\"writing-project-card__title\">{project.title}</span>\n                      <span className=\"writing-project-card__meta\">{formatTargetLabel(project.targetKind)}</span>\n                    </span>\n                  </button>\n                  <div className=\"writing-project-card__body\">\n                    <div className=\"writing-project-card__titleRow\">\n                      <strong>{project.title}</strong>\n                      <span className={`pill ghost ${project.status === 'done' ? 'success' : ''}`}>{project.status}</span>\n                    </div>\n                    <div className=\"writing-project-card__stats\">\n                      <span>{project.currentWordCount.toLocaleString()} words</span>\n                      <span>{project.sessionCount} sessions</span>\n                      <span>{formatRelativeTime(project.lastTouchedAt ?? project.updatedAt)}</span>\n                    </div>\n                    {project.reentryNote ? <p className=\"writing-project-card__reentry\">{project.reentryNote}</p> : null}\n                    {progressPct != null ? (\n                      <div className=\"writing-project-card__progress\">\n                        <div><span>Goal</span><span>{project.currentWordCount}/{project.wordTarget}</span></div>\n                        <div className=\"writing-project-card__progressBar\"><span style={{ width: `${progressPct}%` }} /></div>\n                      </div>\n                    ) : null}\n                    <div className=\"writing-studio__rowActions\">\n                      <button type=\"button\" onClick={() => void launchProjectSession(project, 10)} disabled={sessionBusy}>\n                        Write 10m\n                      </button>\n                      <button type=\"button\" onClick={() => void launchProjectSession(project, 25)} disabled={sessionBusy}>\n                        Write 25m\n                      </button>\n                      {project.targetUrl ? (\n                        <button\n                          type=\"button\"\n                          onClick={() => void (variant === 'extension' && project.targetKind !== 'tws-doc'\n                            ? startExternalTrackedSession(project, 12)\n                            : openProjectTarget(project))}\n                        >\n                          {variant === 'extension' && project.targetKind !== 'tws-doc' ? 'Open + Track' : 'Open Target'}\n                        </button>\n                      ) : null}\n                      <button\n                        type=\"button\"\n                        onClick={async () => {\n                          try {\n                            await patchProject(project.id, {\n                              status: project.status === 'done' ? 'active' : 'done',\n                              lastTouchedAt: new Date().toISOString()\n                            });\n                            await loadDashboard(true);\n                          } catch (markError) {\n                            setError((markError as Error).message ?? 'Unable to update project status.');\n                          }\n                        }}\n                      >\n                        {project.status === 'done' ? 'Reopen' : 'Done'}\n                      </button>\n                    </div>\n                  </div>\n                </article>\n              );\n            })\n          ) : loading ? (\n            <p className=\"writing-studio__subtle\">Loading writing projects</p>\n          ) : (\n            <p className=\"writing-studio__subtle\">\n              No writing projects yet. Create a journal, paper, Substack, or fiction project and start a timed sprint.\n            </p>\n          )}\n        </div>\n\n        {dashboard?.overview ? (\n          <div className=\"writing-studio__metrics\">\n            <div className=\"writing-studio__metric\">\n              <span>Writing Time Today</span>\n              <strong>{formatDuration(dashboard.overview.today.activeSeconds)}</strong>\n            </div>\n            <div className=\"writing-studio__metric\">\n              <span>Net Words Today</span>\n              <strong>{dashboard.overview.today.netWords >= 0 ? '+' : ''}{dashboard.overview.today.netWords}</strong>\n            </div>\n            <div className=\"writing-studio__metric\">\n              <span>Keys / Min</span>\n              <strong>{dashboard.overview.pace.keystrokesPerMinute.toFixed(1)}</strong>\n            </div>\n            <div className=\"writing-studio__metric\">\n              <span>Projects Touched</span>\n              <strong>{dashboard.overview.today.projects}</strong>\n            </div>\n          </div>\n        ) : null}\n\n        {dashboard?.overview?.insights?.length ? (\n          <ul className=\"writing-studio__insights\">\n            {dashboard.overview.insights.map((insight) => (\n              <li key={insight}>{insight}</li>\n            ))}\n          </ul>\n        ) : null}\n      </article>\n\n      {activeSession ? (\n        <div className=\"writing-overlay\" role=\"dialog\" aria-modal=\"true\" aria-label={`Writing ${activeSession.project.title}`}>\n          <div className=\"writing-overlay__panel\" onClick={(event) => event.stopPropagation()}>\n            <header className=\"writing-overlay__header\">\n              <div>\n                <p className={variant === 'web' ? 'eyebrow' : 'newtab-eyebrow'}>Writing Sprint</p>\n                <h2>{activeSession.project.title}</h2>\n                <p className=\"writing-studio__subtle\">\n                  {formatProjectKind(activeSession.project.kind)}  {formatTargetLabel(activeSession.project.targetKind)}  Started{' '}\n                  {new Date(activeSession.startedAtMs).toLocaleTimeString([], { timeStyle: 'short' })}\n                </p>\n              </div>\n              <div className=\"writing-studio__rowActions\">\n                {activeSession.project.targetUrl ? (\n                  <button type=\"button\" onClick={() => void openProjectTarget(activeSession.project)}>\n                    Open Target\n                  </button>\n                ) : null}\n                <button type=\"button\" onClick={() => void endTrackedSession(true)} disabled={sessionBusy}>\n                  {sessionBusy ? 'Saving' : 'Save & End'}\n                </button>\n              </div>\n            </header>\n\n            <div className=\"writing-overlay__body\">\n              <div className=\"writing-overlay__editorWrap\">\n                <div className=\"writing-overlay__toolbar\">\n                  <span className=\"pill ghost\">\n                    {activeSession.sprintMinutes ? `${activeSession.sprintMinutes}m sprint` : 'Open session'}\n                  </span>\n                  {remainingSprintSeconds != null ? (\n                    <span className={`pill ghost ${activeSession.sprintCompleted ? 'success' : ''}`}>\n                      {activeSession.sprintCompleted ? 'Sprint complete' : `${formatDuration(remainingSprintSeconds) } left`}\n                    </span>\n                  ) : null}\n                  <span className=\"pill ghost\">{activeSession.currentWordCount.toLocaleString()} words</span>\n                  <span className=\"pill ghost\">\n                    Net {activeSession.netWordsTotal >= 0 ? '+' : ''}{activeSession.netWordsTotal}\n                  </span>\n                  <span className=\"pill ghost\">{activeSession.keystrokesTotal.toLocaleString()} keys</span>\n                  <span className=\"pill ghost\">{formatDuration(activeSession.focusedSecondsTotal)} focused</span>\n                </div>\n                <textarea\n                  className=\"writing-overlay__editor\"\n                  value={activeSession.draftText}\n                  onChange={(event) => handleDraftTextChange(event.target.value)}\n                  onKeyDown={handleDraftKeyDown}\n                  placeholder={\n                    activeSession.project.promptText\n                      ? `Prompt: ${activeSession.project.promptText}\\n\\nStart with one paragraph.`\n                      : 'Write the next small paragraph. Keep moving.'\n                  }\n                  autoFocus\n                />\n              </div>\n\n              <aside className=\"writing-overlay__side\">\n                <div className=\"writing-overlay__sideCard\">\n                  <h3>Re-entry Note</h3>\n                  <p className=\"writing-studio__subtle\">What should future-you do first next time?</p>\n                  <textarea\n                    rows={4}\n                    value={activeSession.reentryNoteDraft}\n                    onChange={(event) =>\n                      setActiveSession((prev) => (prev ? { ...prev, reentryNoteDraft: event.target.value } : prev))\n                    }\n                    placeholder=\"Start with the hook. Then add one concrete example\"\n                  />\n                </div>\n\n                {activeSession.project.promptText ? (\n                  <div className=\"writing-overlay__sideCard\">\n                    <h3>Prompt</h3>\n                    <p>{activeSession.project.promptText}</p>\n                  </div>\n                ) : null}\n\n                <div className=\"writing-overlay__sideCard\">\n                  <h3>Session Metrics</h3>\n                  <ul className=\"writing-overlay__metricList\">\n                    <li><span>Active</span><strong>{formatDuration(activeSession.activeSecondsTotal)}</strong></li>\n                    <li><span>Focused</span><strong>{formatDuration(activeSession.focusedSecondsTotal)}</strong></li>\n                    <li><span>Keystrokes</span><strong>{activeSession.keystrokesTotal.toLocaleString()}</strong></li>\n                    <li><span>Words Added</span><strong>{activeSession.wordsAddedTotal.toLocaleString()}</strong></li>\n                    <li><span>Words Deleted</span><strong>{activeSession.wordsDeletedTotal.toLocaleString()}</strong></li>\n                    <li><span>Net Words</span><strong>{activeSession.netWordsTotal >= 0 ? '+' : ''}{activeSession.netWordsTotal}</strong></li>\n                  </ul>\n                </div>\n              </aside>\n            </div>\n          </div>\n          <button className=\"writing-overlay__backdropClose\" type=\"button\" aria-label=\"Close writing session\" onClick={() => void endTrackedSession(true)} />\n        </div>\n      ) : null}\n    </>\n  );\n}\n\nexport default WritingStudioPanel;\n","export type LocalReaderFormat = 'pdf' | 'epub' | 'unknown';\n\nexport type LocalReaderBook = {\n  id: string;\n  title: string;\n  fileName: string;\n  mimeType: string;\n  format: LocalReaderFormat;\n  sizeBytes: number;\n  createdAt: number;\n  updatedAt: number;\n  lastOpenedAt: number | null;\n};\n\ntype LocalReaderBookRecord = LocalReaderBook & {\n  blob: Blob;\n};\n\nconst DB_NAME = 'tws-local-reader';\nconst DB_VERSION = 1;\nconst BOOK_STORE = 'books';\n\nlet dbPromise: Promise<IDBDatabase> | null = null;\n\nfunction requestToPromise<T>(request: IDBRequest<T>) {\n  return new Promise<T>((resolve, reject) => {\n    request.onsuccess = () => resolve(request.result);\n    request.onerror = () => reject(request.error ?? new Error('IndexedDB request failed'));\n  });\n}\n\nfunction transactionDone(transaction: IDBTransaction) {\n  return new Promise<void>((resolve, reject) => {\n    transaction.oncomplete = () => resolve();\n    transaction.onerror = () => reject(transaction.error ?? new Error('IndexedDB transaction failed'));\n    transaction.onabort = () => reject(transaction.error ?? new Error('IndexedDB transaction aborted'));\n  });\n}\n\nfunction openDatabase() {\n  if (!dbPromise) {\n    dbPromise = new Promise<IDBDatabase>((resolve, reject) => {\n      const request = window.indexedDB.open(DB_NAME, DB_VERSION);\n      request.onupgradeneeded = () => {\n        const db = request.result;\n        if (!db.objectStoreNames.contains(BOOK_STORE)) {\n          const store = db.createObjectStore(BOOK_STORE, { keyPath: 'id' });\n          store.createIndex('updatedAt', 'updatedAt', { unique: false });\n          store.createIndex('lastOpenedAt', 'lastOpenedAt', { unique: false });\n        }\n      };\n      request.onsuccess = () => resolve(request.result);\n      request.onerror = () => reject(request.error ?? new Error('Unable to open local reader storage'));\n    });\n  }\n  return dbPromise;\n}\n\nfunction inferFormat(fileName: string, mimeType?: string | null): LocalReaderFormat {\n  const lowerName = fileName.toLowerCase();\n  const lowerMime = (mimeType ?? '').toLowerCase();\n  if (lowerName.endsWith('.pdf') || lowerMime === 'application/pdf') return 'pdf';\n  if (\n    lowerName.endsWith('.epub') ||\n    lowerMime === 'application/epub+zip' ||\n    lowerMime === 'application/x-zip-compressed'\n  ) {\n    return 'epub';\n  }\n  return 'unknown';\n}\n\nfunction titleFromFileName(fileName: string) {\n  const withoutExt = fileName.replace(/\\.[^.]+$/, '');\n  const normalized = withoutExt\n    .replace(/[_]+/g, ' ')\n    .replace(/\\s{2,}/g, ' ')\n    .replace(/\\s*-\\s*/g, ' - ')\n    .trim();\n  return normalized || fileName;\n}\n\nfunction mapRecord(record: LocalReaderBookRecord): LocalReaderBook {\n  const { blob: _blob, ...book } = record;\n  return book;\n}\n\nfunction createId() {\n  if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') {\n    return crypto.randomUUID();\n  }\n  return `book-${Date.now()}-${Math.random().toString(36).slice(2, 10)}`;\n}\n\nexport function isReaderFileSupported(file: File) {\n  return inferFormat(file.name, file.type) !== 'unknown';\n}\n\nexport async function listLocalReaderBooks(): Promise<LocalReaderBook[]> {\n  const db = await openDatabase();\n  const transaction = db.transaction(BOOK_STORE, 'readonly');\n  const store = transaction.objectStore(BOOK_STORE);\n  const request = store.getAll();\n  const records = (await requestToPromise(request)) as LocalReaderBookRecord[];\n  await transactionDone(transaction);\n  return records\n    .map(mapRecord)\n    .sort((a, b) => {\n      const aRank = a.lastOpenedAt ?? a.updatedAt ?? a.createdAt;\n      const bRank = b.lastOpenedAt ?? b.updatedAt ?? b.createdAt;\n      return bRank - aRank;\n    });\n}\n\nexport async function addLocalReaderBooks(files: File[]): Promise<LocalReaderBook[]> {\n  const acceptedFiles = files.filter(isReaderFileSupported);\n  if (!acceptedFiles.length) return [];\n\n  const now = Date.now();\n  const db = await openDatabase();\n  const transaction = db.transaction(BOOK_STORE, 'readwrite');\n  const store = transaction.objectStore(BOOK_STORE);\n  const inserted: LocalReaderBook[] = [];\n\n  for (const file of acceptedFiles) {\n    const record: LocalReaderBookRecord = {\n      id: createId(),\n      title: titleFromFileName(file.name),\n      fileName: file.name,\n      mimeType: file.type || (inferFormat(file.name) === 'epub' ? 'application/epub+zip' : 'application/pdf'),\n      format: inferFormat(file.name, file.type),\n      sizeBytes: file.size,\n      createdAt: now,\n      updatedAt: now,\n      lastOpenedAt: null,\n      blob: file\n    };\n    store.put(record);\n    inserted.push(mapRecord(record));\n  }\n\n  await transactionDone(transaction);\n  return inserted;\n}\n\nexport async function openLocalReaderBook(id: string): Promise<{ book: LocalReaderBook; blob: Blob } | null> {\n  const db = await openDatabase();\n  const transaction = db.transaction(BOOK_STORE, 'readwrite');\n  const store = transaction.objectStore(BOOK_STORE);\n  const existing = (await requestToPromise(store.get(id))) as LocalReaderBookRecord | undefined;\n  if (!existing) {\n    await transactionDone(transaction);\n    return null;\n  }\n\n  const updated: LocalReaderBookRecord = {\n    ...existing,\n    lastOpenedAt: Date.now(),\n    updatedAt: Date.now()\n  };\n  store.put(updated);\n  await transactionDone(transaction);\n\n  return {\n    book: mapRecord(updated),\n    blob: updated.blob\n  };\n}\n\nexport async function deleteLocalReaderBook(id: string): Promise<void> {\n  const db = await openDatabase();\n  const transaction = db.transaction(BOOK_STORE, 'readwrite');\n  transaction.objectStore(BOOK_STORE).delete(id);\n  await transactionDone(transaction);\n}\n","import { useCallback, useEffect, useMemo, useRef, useState, type FormEvent } from 'react';\nimport type {\n  ActivitySummary,\n  AnalyticsOverview,\n  DailyOnboardingState,\n  LibraryItem,\n  LibraryPurpose,\n  LiteraryAnnotationRecord,\n  LiteraryAnalyticsOverview,\n  TimeOfDayStats,\n  WalletSnapshot\n} from '@shared/types';\nimport type { EmbeddedReaderSnapshot } from './components/EmbeddedDocumentReader';\nimport { EmbeddedDocumentReader } from './components/EmbeddedDocumentReader';\nimport { WritingStudioPanel } from './components/WritingStudioPanel';\nimport {\n  addLocalReaderBooks,\n  deleteLocalReaderBook,\n  isReaderFileSupported,\n  listLocalReaderBooks,\n  openLocalReaderBook,\n  type LocalReaderBook\n} from './localReaderShelf';\n\ntype Pane = 'home' | 'library' | 'capture';\n\ntype ReadingAttractor = {\n  id: string;\n  source: 'zotero' | 'books';\n  title: string;\n  subtitle?: string;\n  updatedAt: number;\n  progress?: number;\n  action: { kind: 'deeplink' | 'file'; url?: string; path?: string; app?: 'Books' | 'Zotero' };\n};\n\ntype ReaderSession = {\n  book: LocalReaderBook;\n  objectUrl: string;\n};\n\nconst DEFAULT_API_BASE = 'http://127.0.0.1:17600';\nconst DAILY_START_HOUR = 4;\n\nfunction normalizeApiBase(value: string) {\n  const trimmed = value.trim();\n  if (!trimmed) return DEFAULT_API_BASE;\n  return trimmed.endsWith('/') ? trimmed.slice(0, -1) : trimmed;\n}\n\nfunction loadStoredApiBase() {\n  try {\n    return normalizeApiBase(window.localStorage.getItem('tws-web-api-base') ?? DEFAULT_API_BASE);\n  } catch {\n    return DEFAULT_API_BASE;\n  }\n}\n\nfunction formatHours(seconds: number) {\n  const hours = seconds / 3600;\n  if (hours >= 10) return `${Math.round(hours)}h`;\n  return `${hours.toFixed(1)}h`;\n}\n\nfunction formatDuration(seconds: number) {\n  const totalMinutes = Math.max(0, Math.round(seconds / 60));\n  const hours = Math.floor(totalMinutes / 60);\n  const minutes = totalMinutes % 60;\n  if (hours > 0) return `${hours}h ${minutes}m`;\n  return `${minutes}m`;\n}\n\nfunction formatDayLabel(day: string) {\n  const date = new Date(`${day}T00:00:00`);\n  return date.toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' });\n}\n\nfunction dayKeyFor(date: Date) {\n  const local = new Date(date);\n  if (local.getHours() < DAILY_START_HOUR) {\n    local.setDate(local.getDate() - 1);\n  }\n  const year = local.getFullYear();\n  const month = String(local.getMonth() + 1).padStart(2, '0');\n  const day = String(local.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n}\n\nfunction purposeLabel(purpose: LibraryPurpose) {\n  switch (purpose) {\n    case 'replace':\n      return 'Replace';\n    case 'productive':\n      return 'Productive';\n    case 'allow':\n      return 'Allow';\n    case 'temptation':\n      return 'Temptation';\n    default:\n      return purpose;\n  }\n}\n\nfunction safeDate(value: string | undefined) {\n  if (!value) return 0;\n  const parsed = Date.parse(value);\n  return Number.isFinite(parsed) ? parsed : 0;\n}\n\nasync function fetchJson<T>(apiBase: string, path: string, init?: RequestInit): Promise<T> {\n  const response = await fetch(`${apiBase}${path}`, {\n    ...init,\n    cache: 'no-store',\n    headers: {\n      'Content-Type': 'application/json',\n      ...(init?.headers ?? {})\n    }\n  });\n  if (!response.ok) {\n    const payload = await response.json().catch(() => null);\n    const message =\n      payload && typeof payload === 'object' && 'error' in payload && typeof payload.error === 'string'\n        ? payload.error\n        : `Request failed (${response.status})`;\n    throw new Error(message);\n  }\n  return response.json() as Promise<T>;\n}\n\nfunction normalizeUrl(raw: string) {\n  const trimmed = raw.trim();\n  if (!trimmed) return null;\n  if (trimmed.startsWith('http://') || trimmed.startsWith('https://')) return trimmed;\n  return `https://${trimmed}`;\n}\n\nfunction toPercent(value: number, total: number) {\n  if (!Number.isFinite(total) || total <= 0) return 0;\n  return Math.max(0, Math.min(100, Math.round((value / total) * 100)));\n}\n\nfunction formatBytes(value: number) {\n  if (!Number.isFinite(value) || value <= 0) return '0 B';\n  const units = ['B', 'KB', 'MB', 'GB'];\n  let amount = value;\n  let unitIndex = 0;\n  while (amount >= 1024 && unitIndex < units.length - 1) {\n    amount /= 1024;\n    unitIndex += 1;\n  }\n  const precision = amount >= 100 || unitIndex === 0 ? 0 : 1;\n  return `${amount.toFixed(precision)} ${units[unitIndex]}`;\n}\n\nfunction formatBookType(book: LocalReaderBook) {\n  if (book.format === 'pdf') return 'PDF';\n  if (book.format === 'epub') return 'EPUB';\n  return 'Document';\n}\n\nfunction coverGradientFor(title: string) {\n  let hash = 0;\n  for (let index = 0; index < title.length; index += 1) {\n    hash = (hash * 31 + title.charCodeAt(index)) | 0;\n  }\n  const hue = Math.abs(hash) % 360;\n  const hue2 = (hue + 54) % 360;\n  return `linear-gradient(160deg, hsl(${hue} 72% 58% / 0.95), hsl(${hue2} 80% 44% / 0.88))`;\n}\n\nfunction createReaderSessionId() {\n  if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') return crypto.randomUUID();\n  return `reader-${Date.now()}-${Math.random().toString(36).slice(2, 10)}`;\n}\n\nfunction localBookDocKey(book: LocalReaderBook) {\n  return `local:${book.format}:${book.fileName}:${book.sizeBytes}`;\n}\n\nexport default function WebHomepage() {\n  const [pane, setPane] = useState<Pane>('home');\n  const [apiBaseInput, setApiBaseInput] = useState(loadStoredApiBase);\n  const [apiBase, setApiBase] = useState(loadStoredApiBase);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [readerNotice, setReaderNotice] = useState<string | null>(null);\n  const [now, setNow] = useState(Date.now());\n\n  const [wallet, setWallet] = useState<WalletSnapshot>({ balance: 0 });\n  const [summary, setSummary] = useState<ActivitySummary | null>(null);\n  const [overview, setOverview] = useState<AnalyticsOverview | null>(null);\n  const [literaryOverview, setLiteraryOverview] = useState<LiteraryAnalyticsOverview | null>(null);\n  const [timeOfDay, setTimeOfDay] = useState<TimeOfDayStats[]>([]);\n  const [libraryItems, setLibraryItems] = useState<LibraryItem[]>([]);\n  const [readingItems, setReadingItems] = useState<ReadingAttractor[]>([]);\n  const [localReaderBooks, setLocalReaderBooks] = useState<LocalReaderBook[]>([]);\n  const [loadingLocalReaderBooks, setLoadingLocalReaderBooks] = useState(true);\n  const [uploadingReaderBooks, setUploadingReaderBooks] = useState(false);\n  const [readerUploadError, setReaderUploadError] = useState<string | null>(null);\n  const [readerDragActive, setReaderDragActive] = useState(false);\n  const [readerStorageUsage, setReaderStorageUsage] = useState<{ quota?: number; usage?: number } | null>(null);\n  const [readerSession, setReaderSession] = useState<ReaderSession | null>(null);\n  const [readerAnnotations, setReaderAnnotations] = useState<LiteraryAnnotationRecord[]>([]);\n  const [loadingReaderAnnotations, setLoadingReaderAnnotations] = useState(false);\n  const [annotationDraft, setAnnotationDraft] = useState('');\n  const [annotationBusy, setAnnotationBusy] = useState(false);\n  const readerFileInputRef = useRef<HTMLInputElement | null>(null);\n  const readerMetricsRef = useRef<EmbeddedReaderSnapshot | null>(null);\n  const readerTrackingRef = useRef<{ sessionId: string; docKey: string } | null>(null);\n  const [dailyState, setDailyState] = useState<DailyOnboardingState | null>(null);\n\n  const [captureUrl, setCaptureUrl] = useState('');\n  const [captureTitle, setCaptureTitle] = useState('');\n  const [captureNote, setCaptureNote] = useState('');\n  const [capturePurpose, setCapturePurpose] = useState<LibraryPurpose>('replace');\n  const [savingCapture, setSavingCapture] = useState(false);\n  const [captureError, setCaptureError] = useState<string | null>(null);\n\n  const [dailyNote, setDailyNote] = useState('');\n  const [savingNote, setSavingNote] = useState(false);\n  const [noteSavedAt, setNoteSavedAt] = useState<number | null>(null);\n\n  const loadHomepage = useCallback(\n    async (silent = false) => {\n      if (!silent) setLoading(true);\n      setRefreshing(true);\n      setError(null);\n      try {\n        await fetchJson<{ status: string }>(apiBase, '/health');\n        const [walletData, summaryData, overviewData, literaryData, timeData, libraryData, readingData, onboardingData] = await Promise.all([\n          fetchJson<WalletSnapshot>(apiBase, '/wallet'),\n          fetchJson<ActivitySummary>(apiBase, '/activities/summary?windowHours=24'),\n          fetchJson<AnalyticsOverview>(apiBase, '/analytics/overview?days=7'),\n          fetchJson<LiteraryAnalyticsOverview>(apiBase, '/analytics/literary/overview?days=14'),\n          fetchJson<TimeOfDayStats[]>(apiBase, '/analytics/time-of-day?days=7'),\n          fetchJson<LibraryItem[]>(apiBase, '/library'),\n          fetchJson<{ items: ReadingAttractor[] }>(apiBase, '/integrations/reading?limit=8'),\n          fetchJson<DailyOnboardingState>(apiBase, '/settings/daily-onboarding')\n        ]);\n        setWallet(walletData);\n        setSummary(summaryData);\n        setOverview(overviewData);\n        setLiteraryOverview(literaryData);\n        setTimeOfDay(timeData);\n        setLibraryItems(libraryData);\n        setReadingItems(readingData.items ?? []);\n        setDailyState(onboardingData);\n        setDailyNote(onboardingData.note?.message ?? '');\n        setConnected(true);\n      } catch (loadError) {\n        setConnected(false);\n        setError((loadError as Error).message || 'Failed to load homepage data.');\n      } finally {\n        setLoading(false);\n        setRefreshing(false);\n      }\n    },\n    [apiBase]\n  );\n\n  const refreshReaderStorageEstimate = useCallback(async () => {\n    try {\n      if (!navigator.storage?.estimate) return;\n      const estimate = await navigator.storage.estimate();\n      setReaderStorageUsage({\n        quota: estimate.quota,\n        usage: estimate.usage\n      });\n    } catch {\n      // best effort only\n    }\n  }, []);\n\n  const refreshLocalReaderBooks = useCallback(async (showLoader = false) => {\n    if (showLoader) setLoadingLocalReaderBooks(true);\n    try {\n      const books = await listLocalReaderBooks();\n      setLocalReaderBooks(books);\n    } catch (readerError) {\n      setReaderUploadError((readerError as Error).message || 'Unable to load local reader shelf.');\n    } finally {\n      if (showLoader) setLoadingLocalReaderBooks(false);\n    }\n  }, []);\n\n  const closeReader = useCallback(() => {\n    setReaderSession((previous) => {\n      if (previous) {\n        URL.revokeObjectURL(previous.objectUrl);\n      }\n      return null;\n    });\n  }, []);\n\n  const openUploadedBook = useCallback(\n    async (book: LocalReaderBook) => {\n      setReaderUploadError(null);\n      try {\n        const opened = await openLocalReaderBook(book.id);\n        if (!opened) {\n          setReaderUploadError('That file is no longer available in local storage.');\n          await refreshLocalReaderBooks();\n          return;\n        }\n        const objectUrl = URL.createObjectURL(opened.blob);\n        setReaderSession((previous) => {\n          if (previous) {\n            URL.revokeObjectURL(previous.objectUrl);\n          }\n          return { book: opened.book, objectUrl };\n        });\n        await refreshLocalReaderBooks();\n        setReaderNotice(`Opened ${opened.book.title} in the browser reader.`);\n      } catch (readerError) {\n        setReaderUploadError((readerError as Error).message || 'Unable to open file.');\n      }\n    },\n    [refreshLocalReaderBooks]\n  );\n\n  const handleReaderFiles = useCallback(\n    async (files: File[]) => {\n      const validFiles = files.filter((file) => isReaderFileSupported(file));\n      const rejectedCount = files.length - validFiles.length;\n      if (!validFiles.length) {\n        setReaderUploadError('Upload a PDF or EPUB file.');\n        return;\n      }\n\n      setUploadingReaderBooks(true);\n      setReaderUploadError(null);\n      try {\n        const inserted = await addLocalReaderBooks(validFiles);\n        await Promise.all([refreshLocalReaderBooks(), refreshReaderStorageEstimate()]);\n        if (inserted.length > 0) {\n          setReaderNotice(\n            rejectedCount > 0\n              ? `Saved ${inserted.length} book${inserted.length === 1 ? '' : 's'} (${rejectedCount} skipped).`\n              : `Saved ${inserted.length} book${inserted.length === 1 ? '' : 's'} to your local reader shelf.`\n          );\n          if (inserted.length === 1) {\n            await openUploadedBook(inserted[0]);\n          }\n        }\n      } catch (readerError) {\n        setReaderUploadError((readerError as Error).message || 'Unable to save uploaded books.');\n      } finally {\n        setUploadingReaderBooks(false);\n      }\n    },\n    [openUploadedBook, refreshLocalReaderBooks, refreshReaderStorageEstimate]\n  );\n\n  const removeUploadedBook = useCallback(\n    async (book: LocalReaderBook) => {\n      const confirmed = window.confirm(`Remove \"${book.title}\" from your local browser shelf?`);\n      if (!confirmed) return;\n      try {\n        await deleteLocalReaderBook(book.id);\n        setReaderSession((previous) => {\n          if (previous?.book.id === book.id) {\n            URL.revokeObjectURL(previous.objectUrl);\n            return null;\n          }\n          return previous;\n        });\n        await Promise.all([refreshLocalReaderBooks(), refreshReaderStorageEstimate()]);\n        setReaderNotice(`Removed ${book.title} from your local reader shelf.`);\n      } catch (readerError) {\n        setReaderUploadError((readerError as Error).message || 'Unable to remove book.');\n      }\n    },\n    [refreshLocalReaderBooks, refreshReaderStorageEstimate]\n  );\n\n  const openRandomUploadedBook = useCallback(async () => {\n    if (!localReaderBooks.length) {\n      setReaderNotice('Upload a PDF or EPUB to start your local reader shelf.');\n      return;\n    }\n    const choice = localReaderBooks[Math.floor(Math.random() * localReaderBooks.length)];\n    await openUploadedBook(choice);\n  }, [localReaderBooks, openUploadedBook]);\n\n  const postLiterarySessionProgress = useCallback(\n    async (kind: 'progress' | 'end') => {\n      if (!readerSession || !readerTrackingRef.current) return;\n      const snapshot = readerMetricsRef.current;\n      if (!snapshot) return;\n      try {\n        await fetchJson(apiBase, `/analytics/literary/sessions/${readerTrackingRef.current.sessionId}/${kind}`, {\n          method: 'POST',\n          body: JSON.stringify({\n            occurredAt: new Date().toISOString(),\n            currentPage: snapshot.currentPage,\n            totalPages: snapshot.totalPages,\n            progress: snapshot.progress,\n            activeSecondsTotal: snapshot.activeSecondsTotal,\n            focusedSecondsTotal: snapshot.focusedSecondsTotal,\n            pagesReadTotal: snapshot.pagesReadTotal,\n            wordsReadTotal: snapshot.wordsReadTotal,\n            estimatedTotalWords: snapshot.estimatedTotalWords,\n            locationLabel: snapshot.locationLabel\n          })\n        });\n      } catch {\n        // Literary analytics tracking should not block reading.\n      }\n    },\n    [apiBase, readerSession]\n  );\n\n  const handleEmbeddedReaderSnapshot = useCallback((snapshot: EmbeddedReaderSnapshot) => {\n    readerMetricsRef.current = snapshot;\n  }, []);\n\n  const loadReaderAnnotations = useCallback(\n    async (docKey: string) => {\n      setLoadingReaderAnnotations(true);\n      try {\n        const payload = await fetchJson<{ items: LiteraryAnnotationRecord[] }>(\n          apiBase,\n          `/analytics/literary/annotations?docKey=${encodeURIComponent(docKey)}&limit=200`\n        );\n        setReaderAnnotations(Array.isArray(payload.items) ? payload.items : []);\n      } catch {\n        setReaderAnnotations([]);\n      } finally {\n        setLoadingReaderAnnotations(false);\n      }\n    },\n    [apiBase]\n  );\n\n  const createReaderAnnotation = useCallback(\n    async (kind: 'highlight' | 'note') => {\n      if (!readerSession) return;\n      const snapshot = readerMetricsRef.current;\n      if (!snapshot) {\n        setReaderNotice('Open or navigate the reader before adding annotations.');\n        return;\n      }\n      const docKey = localBookDocKey(readerSession.book);\n      const noteText = annotationDraft.trim();\n      if (kind === 'note' && !noteText) {\n        setReaderNotice('Write a note first.');\n        return;\n      }\n      setAnnotationBusy(true);\n      try {\n        await fetchJson(apiBase, '/analytics/literary/annotations', {\n          method: 'POST',\n          body: JSON.stringify({\n            docKey,\n            title: readerSession.book.title,\n            kind,\n            sessionId: readerTrackingRef.current?.sessionId ?? null,\n            currentPage: snapshot.currentPage,\n            totalPages: snapshot.totalPages,\n            progress: snapshot.progress,\n            locationLabel: snapshot.locationLabel,\n            selectedText: null,\n            noteText: kind === 'note' ? noteText : null\n          })\n        });\n        if (kind === 'note') setAnnotationDraft('');\n        await Promise.all([loadReaderAnnotations(docKey), loadHomepage(true)]);\n        setReaderNotice(kind === 'note' ? 'Note saved.' : 'Highlight saved.');\n      } catch (annotationError) {\n        setReaderNotice((annotationError as Error).message || 'Unable to save annotation.');\n      } finally {\n        setAnnotationBusy(false);\n      }\n    },\n    [annotationDraft, apiBase, loadHomepage, loadReaderAnnotations, readerSession]\n  );\n\n  const deleteReaderAnnotation = useCallback(\n    async (id: number) => {\n      if (!readerSession) return;\n      setAnnotationBusy(true);\n      try {\n        await fetchJson(apiBase, `/analytics/literary/annotations/${id}`, { method: 'DELETE' });\n        await Promise.all([loadReaderAnnotations(localBookDocKey(readerSession.book)), loadHomepage(true)]);\n        setReaderNotice('Annotation removed.');\n      } catch (annotationError) {\n        setReaderNotice((annotationError as Error).message || 'Unable to delete annotation.');\n      } finally {\n        setAnnotationBusy(false);\n      }\n    },\n    [apiBase, loadHomepage, loadReaderAnnotations, readerSession]\n  );\n\n  useEffect(() => {\n    loadHomepage();\n  }, [loadHomepage]);\n\n  useEffect(() => {\n    void refreshLocalReaderBooks(true);\n    void refreshReaderStorageEstimate();\n  }, [refreshLocalReaderBooks, refreshReaderStorageEstimate]);\n\n  useEffect(() => {\n    const clockId = window.setInterval(() => setNow(Date.now()), 60_000);\n    return () => window.clearInterval(clockId);\n  }, []);\n\n  useEffect(() => {\n    const refreshId = window.setInterval(() => loadHomepage(true), 45_000);\n    return () => window.clearInterval(refreshId);\n  }, [loadHomepage]);\n\n  useEffect(() => {\n    const refreshOnVisibility = () => {\n      if (document.visibilityState === 'visible') {\n        void loadHomepage(true);\n      }\n    };\n    window.addEventListener('focus', refreshOnVisibility);\n    document.addEventListener('visibilitychange', refreshOnVisibility);\n    return () => {\n      window.removeEventListener('focus', refreshOnVisibility);\n      document.removeEventListener('visibilitychange', refreshOnVisibility);\n    };\n  }, [loadHomepage]);\n\n  useEffect(() => {\n    try {\n      window.localStorage.setItem('tws-web-api-base', apiBase);\n    } catch {\n      // ignore persistence failures in strict browser contexts.\n    }\n  }, [apiBase]);\n\n  useEffect(() => {\n    if (!readerSession) return undefined;\n    const onKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') closeReader();\n    };\n    window.addEventListener('keydown', onKeyDown);\n    return () => window.removeEventListener('keydown', onKeyDown);\n  }, [closeReader, readerSession]);\n\n  useEffect(() => {\n    return () => {\n      if (readerSession) {\n        URL.revokeObjectURL(readerSession.objectUrl);\n      }\n    };\n  }, [readerSession]);\n\n  useEffect(() => {\n    if (!readerSession) {\n      readerTrackingRef.current = null;\n      readerMetricsRef.current = null;\n      setReaderAnnotations([]);\n      setAnnotationDraft('');\n      return undefined;\n    }\n\n    const trackingSessionId = createReaderSessionId();\n    const docKey = localBookDocKey(readerSession.book);\n    readerTrackingRef.current = { sessionId: trackingSessionId, docKey };\n    readerMetricsRef.current = null;\n    setAnnotationDraft('');\n    void loadReaderAnnotations(docKey);\n\n    let cancelled = false;\n    (async () => {\n      try {\n        await fetchJson(apiBase, '/analytics/literary/sessions/start', {\n          method: 'POST',\n          body: JSON.stringify({\n            sessionId: trackingSessionId,\n            docKey,\n            title: readerSession.book.title,\n            fileName: readerSession.book.fileName,\n            format: readerSession.book.format,\n            sourceSurface: 'web-homepage'\n          })\n        });\n      } catch {\n        if (!cancelled) {\n          // non-blocking\n        }\n      }\n    })();\n\n    const progressTimer = window.setInterval(() => {\n      void postLiterarySessionProgress('progress');\n    }, 5000);\n\n    return () => {\n      cancelled = true;\n      window.clearInterval(progressTimer);\n      void postLiterarySessionProgress('end');\n      void loadHomepage(true);\n      readerTrackingRef.current = null;\n    };\n  }, [apiBase, loadHomepage, loadReaderAnnotations, postLiterarySessionProgress, readerSession]);\n\n  const topContexts = useMemo(() => summary?.topContexts?.slice(0, 6) ?? [], [summary]);\n  const activeSeconds = useMemo(() => {\n    const breakdown = overview?.categoryBreakdown;\n    if (!breakdown) return 0;\n    return breakdown.productive + breakdown.neutral + breakdown.frivolity + breakdown.draining + breakdown.idle;\n  }, [overview]);\n\n  const bestHour = useMemo(() => {\n    if (!timeOfDay.length) return null;\n    return [...timeOfDay].sort((a, b) => b.productive - a.productive)[0] ?? null;\n  }, [timeOfDay]);\n\n  const shelfItems = useMemo(() => {\n    const candidates = libraryItems\n      .filter((item) => item.kind === 'url' && !item.consumedAt)\n      .sort((a, b) => safeDate(a.lastUsedAt ?? a.createdAt) - safeDate(b.lastUsedAt ?? b.createdAt))\n      .slice(0, 6)\n      .map((item) => ({\n        id: `library-${item.id}`,\n        type: 'library' as const,\n        title: item.title ?? item.domain,\n        subtitle: item.note ?? item.url ?? item.domain,\n        url: item.url,\n        purpose: item.purpose,\n        libraryId: item.id\n      }));\n\n    const reading = readingItems.slice(0, 6).map((item) => ({\n      id: `reading-${item.id}`,\n      type: 'reading' as const,\n      title: item.title,\n      subtitle: item.subtitle ?? item.source.toUpperCase(),\n      url: item.action.kind === 'deeplink' ? item.action.url : undefined,\n      source: item.source,\n      progress: item.progress\n    }));\n\n    const merged: Array<(typeof candidates)[number] | (typeof reading)[number]> = [];\n    const max = Math.max(candidates.length, reading.length);\n    for (let idx = 0; idx < max; idx += 1) {\n      if (candidates[idx]) merged.push(candidates[idx]);\n      if (reading[idx]) merged.push(reading[idx]);\n    }\n    return merged.slice(0, 8);\n  }, [libraryItems, readingItems]);\n\n  const featuredUploadedBook = useMemo(() => localReaderBooks[0] ?? null, [localReaderBooks]);\n  const shelfPreviewBooks = useMemo(() => localReaderBooks.slice(0, 8), [localReaderBooks]);\n  const readerAnnotationCounts = useMemo(\n    () =>\n      readerAnnotations.reduce(\n        (acc, annotation) => {\n          if (annotation.kind === 'highlight') acc.highlights += 1;\n          if (annotation.kind === 'note') acc.notes += 1;\n          return acc;\n        },\n        { highlights: 0, notes: 0 }\n      ),\n    [readerAnnotations]\n  );\n  const uploadedBookCounts = useMemo(\n    () =>\n      localReaderBooks.reduce(\n        (acc, book) => {\n          if (book.format === 'pdf') acc.pdf += 1;\n          if (book.format === 'epub') acc.epub += 1;\n          if (book.lastOpenedAt) acc.opened += 1;\n          return acc;\n        },\n        { pdf: 0, epub: 0, opened: 0 }\n      ),\n    [localReaderBooks]\n  );\n  const readerStorageLabel = readerStorageUsage?.usage\n    ? `${formatBytes(readerStorageUsage.usage)} used${readerStorageUsage.quota ? `  ${formatBytes(readerStorageUsage.quota)} quota` : ''}`\n    : 'Stored locally in this browser profile';\n\n  const handleApplyApiBase = () => {\n    setApiBase(normalizeApiBase(apiBaseInput));\n  };\n\n  const handleCaptureSubmit = async (event: FormEvent) => {\n    event.preventDefault();\n    setCaptureError(null);\n    const normalized = normalizeUrl(captureUrl);\n    if (!normalized) {\n      setCaptureError('Enter a valid URL.');\n      return;\n    }\n    setSavingCapture(true);\n    try {\n      await fetchJson<LibraryItem>(apiBase, '/library', {\n        method: 'POST',\n        body: JSON.stringify({\n          kind: 'url',\n          url: normalized,\n          title: captureTitle.trim() || undefined,\n          note: captureNote.trim() || undefined,\n          purpose: capturePurpose\n        })\n      });\n      setCaptureUrl('');\n      setCaptureTitle('');\n      setCaptureNote('');\n      setCapturePurpose('replace');\n      await loadHomepage(true);\n      setPane('library');\n    } catch (submitError) {\n      setCaptureError((submitError as Error).message || 'Unable to save.');\n    } finally {\n      setSavingCapture(false);\n    }\n  };\n\n  const handleMarkDone = async (item: LibraryItem) => {\n    if (!item.id || item.consumedAt) return;\n    try {\n      const updated = await fetchJson<LibraryItem>(apiBase, `/library/${item.id}`, {\n        method: 'PATCH',\n        body: JSON.stringify({\n          consumedAt: new Date().toISOString()\n        })\n      });\n      setLibraryItems((prev) => prev.map((entry) => (entry.id === updated.id ? updated : entry)));\n    } catch (markError) {\n      setError((markError as Error).message || 'Unable to mark item complete.');\n    }\n  };\n\n  const handleSaveNote = async (event: FormEvent) => {\n    event.preventDefault();\n    setSavingNote(true);\n    try {\n      const day = dayKeyFor(new Date());\n      const message = dailyNote.trim();\n      const nextState = await fetchJson<DailyOnboardingState>(apiBase, '/settings/daily-onboarding', {\n        method: 'POST',\n        body: JSON.stringify({\n          lastPromptedDay: day,\n          note: message\n            ? {\n                day,\n                message,\n                deliveredAt: null,\n                acknowledged: false\n              }\n            : null\n        })\n      });\n      setDailyState(nextState);\n      setDailyNote(nextState.note?.message ?? '');\n      setNoteSavedAt(Date.now());\n    } catch (saveError) {\n      setError((saveError as Error).message || 'Unable to save note.');\n    } finally {\n      setSavingNote(false);\n    }\n  };\n\n  const noteDayLabel = dailyState?.note?.day ? formatDayLabel(dailyState.note.day) : null;\n\n  return (\n    <div className=\"app-shell web-home-shell\">\n      <div className=\"window-chrome\">\n        <div className=\"window-chrome-title\" aria-hidden>\n          <div className=\"title-dot\" />\n          <span>TimeWellSpent Web Home</span>\n        </div>\n        <div className=\"window-chrome-meta\">\n          <span className={`pill ${connected ? 'success' : 'danger'}`}>{connected ? 'API connected' : 'API offline'}</span>\n          <span className=\"pill ghost big\">{wallet.balance} f-coins</span>\n        </div>\n      </div>\n\n      <aside className=\"sidebar\">\n        <div className=\"brand\">\n          <div className=\"logo\"></div>\n          <span>Homepage</span>\n        </div>\n\n        <nav className=\"nav-menu\">\n          <button className={pane === 'home' ? 'active' : ''} onClick={() => setPane('home')}>\n            Home\n          </button>\n          <button className={pane === 'library' ? 'active' : ''} onClick={() => setPane('library')}>\n            Library\n          </button>\n          <button className={pane === 'capture' ? 'active' : ''} onClick={() => setPane('capture')}>\n            Capture\n          </button>\n        </nav>\n\n        <div className=\"wallet-summary\">\n          <div className=\"balance\">\n            <span className=\"coin\"></span>\n            <span className=\"amount\">{wallet.balance}</span>\n          </div>\n          <div className=\"rate\">{overview ? `${overview.productivityScore} focus score` : 'Focus score unavailable'}</div>\n        </div>\n\n        <div className=\"web-api-config\">\n          <label htmlFor=\"api-base\">Local API</label>\n          <input\n            id=\"api-base\"\n            value={apiBaseInput}\n            onChange={(event) => setApiBaseInput(event.target.value)}\n            placeholder={DEFAULT_API_BASE}\n          />\n          <button className=\"primary\" type=\"button\" onClick={handleApplyApiBase}>\n            Connect\n          </button>\n        </div>\n      </aside>\n\n      <main className=\"content web-home-main\">\n        <section className=\"panel\">\n          <header className=\"panel-header\">\n            <div>\n              <h1>Safe Landing</h1>\n              <p className=\"subtle\">Orient, choose your next move, and keep the day intentional.</p>\n            </div>\n            <div className=\"web-header-actions\">\n              <span className=\"pill ghost\">{new Date(now).toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' })}</span>\n              <button type=\"button\" onClick={() => loadHomepage()}>\n                {refreshing ? 'Refreshing...' : 'Refresh'}\n              </button>\n            </div>\n          </header>\n\n          {error && <div className=\"card web-inline-error\">{error}</div>}\n          {readerNotice && <div className=\"card web-inline-notice\">{readerNotice}</div>}\n          {loading ? <div className=\"card\">Loading homepage...</div> : null}\n\n          {!loading && pane === 'home' && (\n            <div className=\"panel-body web-home-grid\">\n              <article\n                className={`card web-full-width web-reader-stage ${readerDragActive ? 'drag-active' : ''}`}\n                onDragEnter={(event) => {\n                  event.preventDefault();\n                  setReaderDragActive(true);\n                }}\n                onDragOver={(event) => {\n                  event.preventDefault();\n                  if (!readerDragActive) setReaderDragActive(true);\n                }}\n                onDragLeave={(event) => {\n                  event.preventDefault();\n                  if (event.currentTarget.contains(event.relatedTarget as Node | null)) return;\n                  setReaderDragActive(false);\n                }}\n                onDrop={(event) => {\n                  event.preventDefault();\n                  setReaderDragActive(false);\n                  void handleReaderFiles(Array.from(event.dataTransfer.files ?? []));\n                }}\n              >\n                <div className=\"web-reader-stage-grid\">\n                  <div className=\"web-reader-stage-copy\">\n                    <p className=\"eyebrow\">Reading Room</p>\n                    <h2>Put books and papers directly into TimeWellSpent</h2>\n                    <p className=\"subtle\">\n                      Local-first browser shelf for PDF/EPUB reading. Open the homepage, click a cover, and continue where your attention already is.\n                    </p>\n                    <div className=\"web-reader-chip-row\">\n                      <span className=\"pill ghost big\">{localReaderBooks.length} books</span>\n                      <span className=\"pill ghost\">{uploadedBookCounts.pdf} PDFs</span>\n                      <span className=\"pill ghost\">{uploadedBookCounts.epub} EPUBs</span>\n                      <span className=\"pill ghost\">{uploadedBookCounts.opened} opened</span>\n                    </div>\n                    <div className=\"web-reader-actions\">\n                      <button\n                        className=\"primary\"\n                        type=\"button\"\n                        onClick={() => readerFileInputRef.current?.click()}\n                        disabled={uploadingReaderBooks}\n                      >\n                        {uploadingReaderBooks ? 'Uploading...' : 'Upload PDF / EPUB'}\n                      </button>\n                      <button type=\"button\" onClick={() => void openRandomUploadedBook()}>\n                        Open Random Local Book\n                      </button>\n                    </div>\n                    <p className=\"subtle web-reader-footnote\">{readerStorageLabel}</p>\n                    <input\n                      ref={readerFileInputRef}\n                      type=\"file\"\n                      accept=\".pdf,.epub,application/pdf,application/epub+zip\"\n                      multiple\n                      hidden\n                      onChange={(event) => {\n                        const files = Array.from(event.target.files ?? []);\n                        event.target.value = '';\n                        void handleReaderFiles(files);\n                      }}\n                    />\n                    {readerUploadError ? <p className=\"subtle web-reader-error\">{readerUploadError}</p> : null}\n                  </div>\n\n                  <div className=\"web-reader-stage-spotlight\">\n                    {loadingLocalReaderBooks ? (\n                      <div className=\"web-reader-empty\">\n                        <strong>Loading your local shelf</strong>\n                      </div>\n                    ) : featuredUploadedBook ? (\n                      <>\n                        <button\n                          type=\"button\"\n                          className=\"web-reader-cover-button\"\n                          onClick={() => void openUploadedBook(featuredUploadedBook)}\n                          aria-label={`Open ${featuredUploadedBook.title}`}\n                        >\n                          <span\n                            className=\"web-reader-cover\"\n                            style={{ background: coverGradientFor(featuredUploadedBook.title) }}\n                            aria-hidden=\"true\"\n                          >\n                            <span className=\"web-reader-cover-badge\">{formatBookType(featuredUploadedBook)}</span>\n                            <span className=\"web-reader-cover-title\">{featuredUploadedBook.title}</span>\n                            <span className=\"web-reader-cover-meta\">{formatBytes(featuredUploadedBook.sizeBytes)}</span>\n                          </span>\n                        </button>\n                        <div className=\"web-reader-spotlight-copy\">\n                          <span className=\"pill ghost\">Featured on shelf</span>\n                          <strong>{featuredUploadedBook.title}</strong>\n                          <span className=\"subtle\">{featuredUploadedBook.fileName}</span>\n                          <div className=\"web-item-actions\">\n                            <button type=\"button\" onClick={() => void openUploadedBook(featuredUploadedBook)}>\n                              Read\n                            </button>\n                            <button type=\"button\" onClick={() => void removeUploadedBook(featuredUploadedBook)}>\n                              Remove\n                            </button>\n                          </div>\n                        </div>\n                      </>\n                    ) : (\n                      <div className=\"web-reader-empty\">\n                        <strong>Drag files here to build your shelf</strong>\n                        <p className=\"subtle\">PDF and EPUB uploads are stored locally in this browser profile for fast access.</p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {shelfPreviewBooks.length ? (\n                  <div className=\"web-reader-shelf-grid\">\n                    {shelfPreviewBooks.map((book) => (\n                      <article\n                        key={book.id}\n                        className={`web-reader-shelf-card ${readerSession?.book.id === book.id ? 'active' : ''}`}\n                      >\n                        <button\n                          type=\"button\"\n                          className=\"web-reader-shelf-card-coverButton\"\n                          onClick={() => void openUploadedBook(book)}\n                          aria-label={`Open ${book.title}`}\n                        >\n                          <span\n                            className=\"web-reader-shelf-card-cover\"\n                            style={{ background: coverGradientFor(book.title) }}\n                            aria-hidden=\"true\"\n                          >\n                            <span className=\"web-reader-shelf-card-format\">{formatBookType(book)}</span>\n                            <span className=\"web-reader-shelf-card-title\">{book.title}</span>\n                          </span>\n                        </button>\n                        <div className=\"web-reader-shelf-card-body\">\n                          <div>\n                            <strong>{book.title}</strong>\n                            <span className=\"subtle\">{book.fileName}</span>\n                            <span className=\"subtle\">{formatBytes(book.sizeBytes)}</span>\n                          </div>\n                          <div className=\"web-item-actions\">\n                            <button type=\"button\" onClick={() => void openUploadedBook(book)}>\n                              Open\n                            </button>\n                            <button type=\"button\" onClick={() => void removeUploadedBook(book)}>\n                              Delete\n                            </button>\n                          </div>\n                        </div>\n                      </article>\n                    ))}\n                  </div>\n                ) : null}\n              </article>\n\n              <WritingStudioPanel apiBase={apiBase} surface=\"web-homepage\" variant=\"web\" />\n\n              <article className=\"card\">\n                <div className=\"card-header-row\">\n                  <h2>Literary Stats</h2>\n                  <span className=\"pill ghost\">{literaryOverview ? `${literaryOverview.periodDays}d window` : 'No data yet'}</span>\n                </div>\n                <div className=\"web-stat-grid\">\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Today Pages</span>\n                    <strong>{literaryOverview?.today.pagesRead ?? 0}</strong>\n                  </div>\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Today Words</span>\n                    <strong>{(literaryOverview?.today.wordsRead ?? 0).toLocaleString()}</strong>\n                  </div>\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Reading Time</span>\n                    <strong>{formatDuration(literaryOverview?.today.activeSeconds ?? 0)}</strong>\n                  </div>\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Pages / Hour</span>\n                    <strong>{literaryOverview?.pace.pagesPerHour?.toFixed(1) ?? '0.0'}</strong>\n                  </div>\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Annotations Today</span>\n                    <strong>{literaryOverview?.annotations.todayTotal ?? 0}</strong>\n                  </div>\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Total Annotations</span>\n                    <strong>{literaryOverview?.annotations.total ?? 0}</strong>\n                  </div>\n                </div>\n                {literaryOverview?.currentBook ? (\n                  <div className=\"web-reader-currentBook\">\n                    <strong>{literaryOverview.currentBook.title}</strong>\n                    <span className=\"subtle\">\n                      {literaryOverview.currentBook.totalPages\n                        ? `${literaryOverview.currentBook.currentPage ?? 0}/${literaryOverview.currentBook.totalPages}  `\n                        : ''}\n                      {literaryOverview.currentBook.progress != null\n                        ? `${Math.round(literaryOverview.currentBook.progress * 100)}% complete`\n                        : 'In progress'}\n                    </span>\n                  </div>\n                ) : (\n                  <p className=\"subtle\">Open a local book to start literary session tracking.</p>\n                )}\n              </article>\n\n              <article className=\"card\">\n                <h2>Literary Trend</h2>\n                {literaryOverview?.daily?.length ? (\n                  <div className=\"web-literary-bars\">\n                    {literaryOverview.daily.map((point) => {\n                      const maxWords = Math.max(1, ...literaryOverview.daily.map((d) => d.wordsRead));\n                      const pct = Math.round((point.wordsRead / maxWords) * 100);\n                      return (\n                        <div key={point.day} className=\"web-literary-barRow\">\n                          <div className=\"web-literary-barMeta\">\n                            <span>{formatDayLabel(point.day)}</span>\n                            <span>{point.pagesRead}p  {point.wordsRead.toLocaleString()}w</span>\n                          </div>\n                          <div className=\"web-category-bar web-literary-bar\">\n                            <span style={{ width: `${Math.max(point.wordsRead > 0 ? 4 : 0, pct)}%` }} />\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <p className=\"subtle\">No literary activity tracked yet.</p>\n                )}\n                {literaryOverview?.insights?.length ? (\n                  <ul className=\"web-insight-list\">\n                    {literaryOverview.insights.map((insight) => (\n                      <li key={insight}>{insight}</li>\n                    ))}\n                  </ul>\n                ) : null}\n              </article>\n\n              <article className=\"card\">\n                <div className=\"card-header-row\">\n                  <h2>Today Compass</h2>\n                  <span className=\"pill ghost\">{overview ? `${overview.periodDays}d lens` : 'Local view'}</span>\n                </div>\n                <div className=\"web-stat-grid\">\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Active</span>\n                    <strong>{summary ? formatDuration(summary.totalSeconds) : '0m'}</strong>\n                  </div>\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Deep Work</span>\n                    <strong>{summary ? formatDuration(summary.deepWorkSeconds) : '0m'}</strong>\n                  </div>\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Focus Score</span>\n                    <strong>{overview ? overview.productivityScore : 0}</strong>\n                  </div>\n                  <div className=\"web-stat\">\n                    <span className=\"subtle\">Sessions</span>\n                    <strong>{overview ? overview.totalSessions : 0}</strong>\n                  </div>\n                </div>\n                <div className=\"web-pill-row\">\n                  <span className=\"pill success\">Peak {overview ? `${overview.peakProductiveHour}:00` : '--'}</span>\n                  <span className=\"pill warning\">Risk {overview ? `${overview.riskHour}:00` : '--'}</span>\n                  <span className=\"pill ghost\">{bestHour ? `Best block ${bestHour.hour}:00` : 'No block yet'}</span>\n                </div>\n              </article>\n\n              <article className=\"card\">\n                <h2>Attention Mix</h2>\n                <div className=\"web-category-list\">\n                  <div className=\"web-category-row\">\n                    <div>\n                      <span>Productive</span>\n                      <strong>{formatHours(overview?.categoryBreakdown.productive ?? 0)}</strong>\n                    </div>\n                    <div className=\"web-category-bar\">\n                      <span style={{ width: `${toPercent(overview?.categoryBreakdown.productive ?? 0, activeSeconds)}%` }} />\n                    </div>\n                  </div>\n                  <div className=\"web-category-row\">\n                    <div>\n                      <span>Neutral</span>\n                      <strong>{formatHours(overview?.categoryBreakdown.neutral ?? 0)}</strong>\n                    </div>\n                    <div className=\"web-category-bar neutral\">\n                      <span style={{ width: `${toPercent(overview?.categoryBreakdown.neutral ?? 0, activeSeconds)}%` }} />\n                    </div>\n                  </div>\n                  <div className=\"web-category-row\">\n                    <div>\n                      <span>Frivolity</span>\n                      <strong>{formatHours(overview?.categoryBreakdown.frivolity ?? 0)}</strong>\n                    </div>\n                    <div className=\"web-category-bar frivolity\">\n                      <span style={{ width: `${toPercent(overview?.categoryBreakdown.frivolity ?? 0, activeSeconds)}%` }} />\n                    </div>\n                  </div>\n                </div>\n              </article>\n\n              <article className=\"card\">\n                <h2>Top Contexts</h2>\n                {topContexts.length ? (\n                  <ul className=\"web-list\">\n                    {topContexts.map((context) => (\n                      <li key={`${context.label}-${context.seconds}`}>\n                        <div>\n                          <strong>{context.label}</strong>\n                          <span className=\"subtle\">{context.category ?? 'uncategorized'}</span>\n                        </div>\n                        <span>{formatDuration(context.seconds)}</span>\n                      </li>\n                    ))}\n                  </ul>\n                ) : (\n                  <p className=\"subtle\">No context data yet.</p>\n                )}\n              </article>\n\n              <article className=\"card\">\n                <h2>Refresh Shelf</h2>\n                {shelfItems.length ? (\n                  <ul className=\"web-list\">\n                    {shelfItems.map((item) => (\n                      <li key={item.id}>\n                        <div>\n                          <strong>{item.title}</strong>\n                          <span className=\"subtle\">{item.subtitle}</span>\n                        </div>\n                        <div className=\"web-item-actions\">\n                          {item.type === 'library' ? <span className=\"pill ghost\">{purposeLabel(item.purpose)}</span> : null}\n                          {item.type === 'reading' && typeof item.progress === 'number' ? (\n                            <span className=\"pill ghost\">{Math.round(item.progress * 100)}%</span>\n                          ) : null}\n                          {item.url ? (\n                            <a href={item.url} target=\"_blank\" rel=\"noreferrer\">\n                              Open\n                            </a>\n                          ) : (\n                            <span className=\"subtle\">Desktop only</span>\n                          )}\n                        </div>\n                      </li>\n                    ))}\n                  </ul>\n                ) : (\n                  <p className=\"subtle\">No items in your shelf yet.</p>\n                )}\n              </article>\n\n              <article className=\"card web-full-width\">\n                <h2>Current Insight Feed</h2>\n                {overview?.insights?.length ? (\n                  <ul className=\"web-insight-list\">\n                    {overview.insights.map((insight) => (\n                      <li key={insight}>{insight}</li>\n                    ))}\n                  </ul>\n                ) : (\n                  <p className=\"subtle\">Insights will appear once enough activity is collected.</p>\n                )}\n              </article>\n            </div>\n          )}\n\n          {!loading && pane === 'library' && (\n            <div className=\"card\">\n              <div className=\"card-header-row\">\n                <h2>Library</h2>\n                <div className=\"web-item-actions\">\n                  <span className=\"pill ghost\">{libraryItems.length} items</span>\n                  <button type=\"button\" onClick={() => void openRandomUploadedBook()}>\n                    Random Local Book\n                  </button>\n                </div>\n              </div>\n              {libraryItems.length ? (\n                <ul className=\"web-list\">\n                  {libraryItems.slice(0, 40).map((item) => (\n                    <li key={item.id}>\n                      <div>\n                        <strong>{item.title ?? item.domain}</strong>\n                        <span className=\"subtle\">\n                          {purposeLabel(item.purpose)}\n                          {item.consumedAt ? `  done ${new Date(item.consumedAt).toLocaleDateString()}` : ''}\n                        </span>\n                      </div>\n                      <div className=\"web-item-actions\">\n                        {item.url ? (\n                          <a href={item.url} target=\"_blank\" rel=\"noreferrer\">\n                            Open\n                          </a>\n                        ) : null}\n                        {!item.consumedAt ? (\n                          <button type=\"button\" onClick={() => handleMarkDone(item)}>\n                            Done\n                          </button>\n                        ) : null}\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              ) : (\n                <p className=\"subtle\">Your library is empty. Capture a few URLs to start.</p>\n              )}\n            </div>\n          )}\n\n          {!loading && pane === 'capture' && (\n            <div className=\"web-capture-grid\">\n              <form className=\"card\" onSubmit={handleCaptureSubmit}>\n                <h2>Quick Capture</h2>\n                <div className=\"form-group\">\n                  <label htmlFor=\"capture-url\">URL</label>\n                  <input\n                    id=\"capture-url\"\n                    value={captureUrl}\n                    onChange={(event) => setCaptureUrl(event.target.value)}\n                    placeholder=\"https://...\"\n                  />\n                </div>\n                <div className=\"form-row\">\n                  <div className=\"form-group\">\n                    <label htmlFor=\"capture-title\">Title (optional)</label>\n                    <input\n                      id=\"capture-title\"\n                      value={captureTitle}\n                      onChange={(event) => setCaptureTitle(event.target.value)}\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label htmlFor=\"capture-purpose\">Purpose</label>\n                    <select\n                      id=\"capture-purpose\"\n                      value={capturePurpose}\n                      onChange={(event) => setCapturePurpose(event.target.value as LibraryPurpose)}\n                    >\n                      <option value=\"replace\">Replace</option>\n                      <option value=\"productive\">Productive</option>\n                      <option value=\"allow\">Allow</option>\n                      <option value=\"temptation\">Temptation</option>\n                    </select>\n                  </div>\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"capture-note\">Note (optional)</label>\n                  <textarea\n                    id=\"capture-note\"\n                    rows={4}\n                    value={captureNote}\n                    onChange={(event) => setCaptureNote(event.target.value)}\n                  />\n                </div>\n                {captureError ? <p className=\"subtle\">{captureError}</p> : null}\n                <div className=\"form-actions\">\n                  <button className=\"primary\" type=\"submit\" disabled={savingCapture}>\n                    {savingCapture ? 'Saving...' : 'Save to Library'}\n                  </button>\n                </div>\n              </form>\n\n              <form className=\"card\" onSubmit={handleSaveNote}>\n                <h2>Daily Orientation Note</h2>\n                <p className=\"subtle\">\n                  {noteDayLabel ? `Current note for ${noteDayLabel}.` : 'Set the note you want to see later today.'}\n                </p>\n                <div className=\"form-group\">\n                  <label htmlFor=\"daily-note\">Note</label>\n                  <textarea id=\"daily-note\" rows={8} value={dailyNote} onChange={(event) => setDailyNote(event.target.value)} />\n                </div>\n                <div className=\"form-actions\">\n                  {noteSavedAt ? <span className=\"pill success\">Saved {new Date(noteSavedAt).toLocaleTimeString()}</span> : null}\n                  <button className=\"primary\" type=\"submit\" disabled={savingNote}>\n                    {savingNote ? 'Saving...' : 'Save Note'}\n                  </button>\n                </div>\n              </form>\n            </div>\n          )}\n        </section>\n      </main>\n\n      {readerSession ? (\n        <div\n          className=\"web-reader-overlay\"\n          role=\"dialog\"\n          aria-modal=\"true\"\n          aria-label={`Reading ${readerSession.book.title}`}\n          onClick={closeReader}\n        >\n          <div className=\"web-reader-overlay-panel\" onClick={(event) => event.stopPropagation()}>\n            <header className=\"web-reader-overlay-header\">\n              <div>\n                <p className=\"eyebrow\">Browser Reader</p>\n                <h2>{readerSession.book.title}</h2>\n                <p className=\"subtle\">\n                  {readerSession.book.fileName}  {formatBookType(readerSession.book)}  {formatBytes(readerSession.book.sizeBytes)}\n                </p>\n              </div>\n              <div className=\"web-item-actions\">\n                <button type=\"button\" onClick={() => window.open(readerSession.objectUrl, '_blank', 'noopener,noreferrer')}>\n                  Open in Tab\n                </button>\n                <a href={readerSession.objectUrl} download={readerSession.book.fileName}>\n                  Download\n                </a>\n                <button type=\"button\" onClick={closeReader}>\n                  Close\n                </button>\n              </div>\n            </header>\n            <div className=\"web-reader-overlay-frameWrap\">\n              <div className=\"web-reader-overlay-readingGrid\">\n                <div className=\"web-reader-overlay-readerPane\">\n                  <EmbeddedDocumentReader\n                    src={readerSession.objectUrl}\n                    format={readerSession.book.format}\n                    title={readerSession.book.title}\n                    onSnapshotChange={handleEmbeddedReaderSnapshot}\n                  />\n                </div>\n                <aside className=\"web-reader-annotations\" aria-label=\"Reader annotations\">\n                  <div className=\"web-reader-annotations-header\">\n                    <div>\n                      <p className=\"eyebrow\">Annotations</p>\n                      <h3>Highlights & Notes</h3>\n                    </div>\n                    <div className=\"web-reader-chip-row\">\n                      <span className=\"pill ghost\">{readerAnnotations.length} total</span>\n                      <span className=\"pill ghost\">{readerAnnotationCounts.highlights} highlights</span>\n                      <span className=\"pill ghost\">{readerAnnotationCounts.notes} notes</span>\n                    </div>\n                  </div>\n\n                  <div className=\"web-reader-annotations-composer\">\n                    <label htmlFor=\"web-reader-note\" className=\"subtle\">\n                      Quick note at current location\n                    </label>\n                    <textarea\n                      id=\"web-reader-note\"\n                      rows={4}\n                      value={annotationDraft}\n                      onChange={(event) => setAnnotationDraft(event.target.value)}\n                      placeholder=\"Capture a thought, quote, or synthesis...\"\n                      disabled={annotationBusy}\n                    />\n                    <div className=\"web-item-actions\">\n                      <button type=\"button\" onClick={() => void createReaderAnnotation('highlight')} disabled={annotationBusy}>\n                        {annotationBusy ? 'Saving...' : 'Highlight Spot'}\n                      </button>\n                      <button type=\"button\" onClick={() => void createReaderAnnotation('note')} disabled={annotationBusy}>\n                        {annotationBusy ? 'Saving...' : 'Save Note'}\n                      </button>\n                    </div>\n                  </div>\n\n                  <div className=\"web-reader-annotations-listWrap\">\n                    {loadingReaderAnnotations ? (\n                      <p className=\"subtle\">Loading annotations...</p>\n                    ) : readerAnnotations.length ? (\n                      <ul className=\"web-reader-annotations-list\">\n                        {readerAnnotations.map((annotation) => (\n                          <li key={annotation.id} className={`web-reader-annotation-card kind-${annotation.kind}`}>\n                            <div className=\"web-reader-annotation-card-header\">\n                              <span className={`pill ghost ${annotation.kind === 'note' ? 'success' : ''}`}>\n                                {annotation.kind === 'note' ? 'Note' : 'Highlight'}\n                              </span>\n                              <span className=\"subtle\">\n                                {new Date(annotation.createdAt).toLocaleString([], {\n                                  dateStyle: 'short',\n                                  timeStyle: 'short'\n                                })}\n                              </span>\n                            </div>\n                            <div className=\"web-reader-annotation-card-meta\">\n                              <strong>{annotation.locationLabel ?? 'Current location'}</strong>\n                              {annotation.currentPage != null ? (\n                                <span className=\"subtle\">\n                                  {annotation.totalPages\n                                    ? `Page ${annotation.currentPage}/${annotation.totalPages}`\n                                    : `Page ${annotation.currentPage}`}\n                                </span>\n                              ) : null}\n                            </div>\n                            {annotation.selectedText ? (\n                              <blockquote className=\"web-reader-annotation-quote\">{annotation.selectedText}</blockquote>\n                            ) : null}\n                            {annotation.noteText ? <p className=\"web-reader-annotation-note\">{annotation.noteText}</p> : null}\n                            <div className=\"web-item-actions\">\n                              <button type=\"button\" onClick={() => void deleteReaderAnnotation(annotation.id)} disabled={annotationBusy}>\n                                Delete\n                              </button>\n                            </div>\n                          </li>\n                        ))}\n                      </ul>\n                    ) : (\n                      <p className=\"subtle\">\n                        Save location-based highlights or notes while you read. This feeds Literary Analytics and productive totals.\n                      </p>\n                    )}\n                  </div>\n                </aside>\n              </div>\n            </div>\n            {readerSession.book.format === 'epub' ? (\n              <p className=\"subtle web-reader-overlay-hint\">\n                EPUB rendering depends on browser support. If this file doesnt render inline, use Open in Tab.\n              </p>\n            ) : null}\n          </div>\n        </div>\n      ) : null}\n    </div>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport WebHomepage from './WebHomepage';\nimport './styles.css';\n\nReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(\n  <React.StrictMode>\n    <WebHomepage />\n  </React.StrictMode>\n);\n"],"file":"assets/home-BL_c-Mxg.js"}